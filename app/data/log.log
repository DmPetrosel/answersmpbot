2025-01-03, Fri, 13:32:37,46 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:32:37,342 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:32:41,10 aiogram.event INFO Update id=450709747 is handled. Duration 476 ms by bot id=7771835226
2025-01-03, Fri, 13:32:42,424 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:32:42,425 aiogram.event INFO Update id=450709748 is not handled. Duration 132 ms by bot id=7771835226
2025-01-03, Fri, 13:32:42,425 aiogram.event ERROR Cause exception while process update id=450709748 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'error'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    await async_session.add(user)
TypeError: object NoneType can't be used in 'await' expression

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 44, in get_answer_reg
    if await errh.handle_errors(partial(set_user,chat_id=message.from_user.id, username=usr[message.from_user.id]['username'], first_name=usr[message.from_user.id]['name'])):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 28, in handle_errors
    logger.error(f"Company: {company}. In function {coroutine.func.__module__}.{coroutine.func.__name__} error occurs: {e}. Try through {minutes} minutes. (Attempt number {i})\n {traceback.format_exc()}")
AttributeError: 'NoneType' object has no attribute 'error'
2025-01-03, Fri, 13:34:11,548 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:34:11,837 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:34:17,874 aiogram.event INFO Update id=450709749 is handled. Duration 1070 ms by bot id=7771835226
2025-01-03, Fri, 13:34:19,754 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:34:19,756 aiogram.event INFO Update id=450709750 is not handled. Duration 128 ms by bot id=7771835226
2025-01-03, Fri, 13:34:19,756 aiogram.event ERROR Cause exception while process update id=450709750 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'error'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    await async_session.add(user)
TypeError: object NoneType can't be used in 'await' expression

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 44, in get_answer_reg
    if await errh.handle_errors(partial(set_user,chat_id=message.from_user.id, username=usr[message.from_user.id]['username'], first_name=usr[message.from_user.id]['name'])):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 28, in handle_errors
    logger.error(f"Company: {company}. In function {coroutine.func.__module__}.{coroutine.func.__name__} error occurs: {e}. Try through {minutes} minutes. (Attempt number {i})\n {traceback.format_exc()}")
AttributeError: 'NoneType' object has no attribute 'error'
2025-01-03, Fri, 13:38:47,349 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:38:47,393 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:38:49,973 aiogram.event INFO Update id=450709751 is handled. Duration 383 ms by bot id=7771835226
2025-01-03, Fri, 13:38:51,253 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:38:51,255 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: object NoneType can't be used in 'await' expression. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    await async_session.add(user)
TypeError: object NoneType can't be used in 'await' expression

2025-01-03, Fri, 13:39:33,679 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:39:34,29 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:39:35,423 aiogram.event INFO Update id=450709753 is handled. Duration 280 ms by bot id=7771835226
2025-01-03, Fri, 13:39:36,864 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:39:36,868 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-03, Fri, 13:39:36,942 aiogram.event INFO Update id=450709754 is handled. Duration 168 ms by bot id=7771835226
2025-01-03, Fri, 13:41:32,564 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:41:32,614 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:41:36,287 aiogram.event INFO Update id=450709755 is handled. Duration 382 ms by bot id=7771835226
2025-01-03, Fri, 13:41:41,890 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:41:41,925 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:41:41,925 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:41:41,928 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:41:41,928 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:41:41,930 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:41:41,930 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:41:41,931 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:41:41,933 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:41:41,933 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-03, Fri, 13:41:41,935 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:41:41,940 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:42:41,945 aiogram.event INFO Update id=450709756 is not handled. Duration 60159 ms by bot id=7771835226
2025-01-03, Fri, 13:42:41,945 aiogram.event ERROR Cause exception while process update id=450709756 by bot id=7771835226
NameError: name 'e' is not defined
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 47, in get_answer_reg
    await bot.send_message(message.from_user.id, str('Регистрация не удалась: \n' + str(e)))
NameError: name 'e' is not defined
2025-01-03, Fri, 13:47:25,320 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:47:25,667 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:47:28,3 aiogram.event INFO Update id=450709757 is handled. Duration 295 ms by bot id=7771835226
2025-01-03, Fri, 13:47:33,493 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:47:33,520 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:47:33,520 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:47:33,522 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:47:33,522 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:47:33,523 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:47:33,524 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:47:33,524 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:47:33,526 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:47:33,526 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-03, Fri, 13:47:33,529 sqlalchemy.engine.Engine INFO COMMIT
2025-01-03, Fri, 13:47:33,532 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-03, Fri, 13:47:33,896 aiogram.event INFO Update id=450709758 is handled. Duration 712 ms by bot id=7771835226
2025-01-03, Fri, 13:49:17,92 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:49:17,901 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:49:20,947 aiogram.event INFO Update id=450709759 is handled. Duration 426 ms by bot id=7771835226
2025-01-03, Fri, 13:49:25,882 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:49:25,917 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:49:25,917 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:49:25,920 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:49:25,920 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:49:25,922 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:49:25,922 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:49:25,923 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:49:25,925 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:49:25,925 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077, 'DmPetrosel', 'Dmitriy', None, False)
2025-01-03, Fri, 13:49:25,928 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:49:25,933 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dmitriy', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dmitriy', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:50:25,940 aiogram.event INFO Update id=450709760 is not handled. Duration 60162 ms by bot id=7771835226
2025-01-03, Fri, 13:50:25,940 aiogram.event ERROR Cause exception while process update id=450709760 by bot id=7771835226
NameError: name 'e' is not defined
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 47, in get_answer_reg
    await bot.send_message(message.from_user.id, str('Регистрация не удалась: \n' + str(e)))
NameError: name 'e' is not defined
2025-01-03, Fri, 13:52:37,672 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:52:37,713 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:53:40,296 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:53:40,338 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:53:44,8 aiogram.event INFO Update id=450709761 is handled. Duration 782 ms by bot id=7771835226
2025-01-03, Fri, 13:53:50,312 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:53:50,340 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:53:50,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:53:50,342 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:53:50,342 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:53:50,343 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:53:50,344 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:53:50,345 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:53:50,347 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:53:50,347 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-03, Fri, 13:53:50,349 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:53:50,354 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:55:23,672 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:55:23,714 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:55:27,654 aiogram.event INFO Update id=450709763 is handled. Duration 1105 ms by bot id=7771835226
2025-01-03, Fri, 13:55:29,601 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:55:29,632 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:55:29,632 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:55:29,634 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:55:29,634 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:55:29,635 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:55:29,635 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:55:29,636 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:55:29,637 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:55:29,637 sqlalchemy.engine.Engine INFO [generated in 0.00018s] (2142024077, 'DmPetrosel', 'Dm', None, False)
2025-01-03, Fri, 13:55:29,640 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:55:29,644 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dm', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dm', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:56:29,647 aiogram.event INFO Update id=450709764 is not handled. Duration 60117 ms by bot id=7771835226
2025-01-03, Fri, 13:56:29,647 aiogram.event ERROR Cause exception while process update id=450709764 by bot id=7771835226
NameError: name 'e' is not defined
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 47, in get_answer_reg
    await bot.send_message(message.from_user.id, str('Регистрация не удалась: \n' + str(e)))
NameError: name 'e' is not defined
2025-01-04, Sat, 07:06:54,346 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:06:54,668 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:07:01,905 aiogram.event INFO Update id=450709765 is handled. Duration 978 ms by bot id=7771835226
2025-01-04, Sat, 07:07:06,225 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:07:06,257 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 07:07:06,257 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:07:06,258 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 07:07:06,258 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:07:06,260 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 07:07:06,260 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:07:06,261 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 07:07:06,263 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 07:07:06,263 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-04, Sat, 07:07:06,266 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-04, Sat, 07:07:06,271 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-04, Sat, 07:08:06,658 aiogram.event INFO Update id=450709766 is handled. Duration 60495 ms by bot id=7771835226
2025-01-04, Sat, 07:09:16,146 aiogram.event INFO Update id=450709767 is handled. Duration 989 ms by bot id=7771835226
2025-01-04, Sat, 07:10:14,195 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:10:14,196 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)

2025-01-04, Sat, 07:11:14,368 aiogram.event INFO Update id=450709768 is handled. Duration 60231 ms by bot id=7771835226
2025-01-04, Sat, 07:14:17,749 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 07:14:17,750 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:14:17,750 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 07:14:18,166 sqlalchemy.pool.impl.AsyncAdaptedQueuePool ERROR Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7fc67cfa16c0>>
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1117, in do_terminate
    dbapi_connection.terminate()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 910, in terminate
    self._connection.terminate()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.10/asyncio/selector_events.py", line 686, in abort
    self._force_close(None)
  File "/usr/lib/python3.10/asyncio/selector_events.py", line 737, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
  File "/usr/lib/python3.10/asyncio/base_events.py", line 753, in call_soon
    self._check_closed()
  File "/usr/lib/python3.10/asyncio/base_events.py", line 515, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-01-04, Sat, 07:14:18,168 sqlalchemy.pool.impl.AsyncAdaptedQueuePool ERROR The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7fc67cfa16c0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-01-04, Sat, 07:16:34,136 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:16:34,181 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:16:42,162 aiogram.event INFO Update id=450709769 is handled. Duration 1313 ms by bot id=7771835226
2025-01-04, Sat, 07:16:46,253 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:16:46,255 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: 'async_sessionmaker' object has no attribute 'add'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    async_session.add(user)
AttributeError: 'async_sessionmaker' object has no attribute 'add'

2025-01-04, Sat, 07:17:46,350 aiogram.event INFO Update id=450709770 is handled. Duration 60295 ms by bot id=7771835226
2025-01-04, Sat, 07:19:35,882 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:19:36,26 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:19:39,280 aiogram.event INFO Update id=450709771 is handled. Duration 1145 ms by bot id=7771835226
2025-01-04, Sat, 07:19:42,247 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:19:42,275 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 07:19:42,275 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:19:42,277 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 07:19:42,277 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:19:42,278 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 07:19:42,278 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:19:42,279 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 07:19:42,280 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 07:19:42,280 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (7675368439, 'Dm_dev_acc', 'David', None, False)
2025-01-04, Sat, 07:19:42,282 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-04, Sat, 07:19:42,286 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 60, in asyncpg.pgproto.pgproto.int4_encode
OverflowError: value out of int32 range

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: 7675368439 (value out of int32 range)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)

2025-01-04, Sat, 07:20:42,290 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi) (Background on this error at: https://sqlalche.me/e/20/7s2a). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi) (Background on this error at: https://sqlalche.me/e/20/7s2a)

2025-01-04, Sat, 07:24:39,642 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:24:40,8 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:24:45,636 aiogram.event INFO Update id=450709773 is handled. Duration 2335 ms by bot id=7771835226
2025-01-04, Sat, 07:24:48,179 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:24:48,208 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 07:24:48,208 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:24:48,210 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 07:24:48,210 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:24:48,211 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 07:24:48,211 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:24:48,212 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 07:24:48,213 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 07:24:48,213 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (7675368439, 'Dm_dev_acc', 'David', None, False)
2025-01-04, Sat, 07:24:48,216 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 07:24:48,218 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 07:24:48,280 aiogram.event INFO Update id=450709774 is handled. Duration 265 ms by bot id=7771835226
2025-01-04, Sat, 07:27:18,418 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 07:27:18,419 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:27:18,419 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 11:22:09,68 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:22:09,113 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:22:16,6 aiogram.event INFO Update id=450709775 is handled. Duration 751 ms by bot id=7771835226
2025-01-04, Sat, 11:22:25,474 aiogram.event INFO Update id=450709776 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:22:25,475 aiogram.event ERROR Cause exception while process update id=450709776 by bot id=7771835226
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/app/keyboard/basic_kb.py", line 5, in no_promo_kb
    return InlineKeyboardBuilder().add(InlineKeyboardButton('Продолжить без промокода', callback_data='no_promo'))
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-01-04, Sat, 11:24:19,59 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:24:19,103 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:24:24,109 aiogram.event INFO Update id=450709777 is handled. Duration 698 ms by bot id=7771835226
2025-01-04, Sat, 11:24:28,441 aiogram.event INFO Update id=450709778 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:24:28,441 aiogram.event ERROR Cause exception while process update id=450709778 by bot id=7771835226
ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 2948, in send_message
    call = SendMessage(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-01-04, Sat, 11:28:32,224 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:28:32,266 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:28:36,23 aiogram.event INFO Update id=450709779 is handled. Duration 366 ms by bot id=7771835226
2025-01-04, Sat, 11:28:42,484 aiogram.event INFO Update id=450709780 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:28:42,485 aiogram.event ERROR Cause exception while process update id=450709780 by bot id=7771835226
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/app/keyboard/basic_kb.py", line 6, in no_promo_kb
    return InlineKeyboardMarkup().add(InlineKeyboardButton(text='Продолжить без промокода', callback_data='no_promo'))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-01-04, Sat, 11:31:45,28 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:31:45,73 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:31:47,925 aiogram.event INFO Update id=450709781 is handled. Duration 321 ms by bot id=7771835226
2025-01-04, Sat, 11:31:53,126 aiogram.event INFO Update id=450709782 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:31:53,126 aiogram.event ERROR Cause exception while process update id=450709782 by bot id=7771835226
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/app/keyboard/basic_kb.py", line 6, in no_promo_kb
    return InlineKeyboardMarkup([InlineKeyboardButton(text='Продолжить без промокода', callback_data='no_promo')])
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-01-04, Sat, 11:36:32,357 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:36:32,403 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:36:35,506 aiogram.event INFO Update id=450709783 is handled. Duration 297 ms by bot id=7771835226
2025-01-04, Sat, 11:36:37,822 aiogram.event INFO Update id=450709784 is handled. Duration 107 ms by bot id=7771835226
2025-01-04, Sat, 11:36:54,422 aiogram.event INFO Update id=450709785 is handled. Duration 120 ms by bot id=7771835226
2025-01-04, Sat, 11:37:13,140 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 11:37:13,141 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:37:13,141 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 11:37:50,594 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:37:50,637 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:37:55,799 aiogram.event INFO Update id=450709786 is handled. Duration 285 ms by bot id=7771835226
2025-01-04, Sat, 11:37:59,836 aiogram.event INFO Update id=450709787 is handled. Duration 99 ms by bot id=7771835226
2025-01-04, Sat, 11:38:08,441 aiogram.event INFO Update id=450709788 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:43:55,814 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:43:56,190 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:43:58,942 aiogram.event INFO Update id=450709789 is handled. Duration 414 ms by bot id=7771835226
2025-01-04, Sat, 11:44:02,951 aiogram.event INFO Update id=450709790 is handled. Duration 105 ms by bot id=7771835226
2025-01-04, Sat, 11:44:16,881 aiogram.event INFO Update id=450709791 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:50:05,13 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:50:05,63 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:50:09,87 aiogram.event INFO Update id=450709792 is handled. Duration 303 ms by bot id=7771835226
2025-01-04, Sat, 11:50:12,44 aiogram.event INFO Update id=450709793 is handled. Duration 101 ms by bot id=7771835226
2025-01-04, Sat, 11:50:18,663 aiogram.event INFO Update id=450709794 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:51:07,713 aiogram.event INFO Update id=450709795 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:51:27,814 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 11:51:27,814 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:51:27,814 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 11:52:50,241 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:52:50,305 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:52:54,909 aiogram.event INFO Update id=450709796 is handled. Duration 287 ms by bot id=7771835226
2025-01-04, Sat, 11:52:57,3 aiogram.event INFO Update id=450709797 is handled. Duration 58 ms by bot id=7771835226
2025-01-04, Sat, 11:53:07,113 aiogram.event INFO Update id=450709798 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:59:19,265 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:59:19,311 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:59:22,952 aiogram.event INFO Update id=450709799 is handled. Duration 422 ms by bot id=7771835226
2025-01-04, Sat, 11:59:24,847 aiogram.event INFO Update id=450709800 is handled. Duration 61 ms by bot id=7771835226
2025-01-04, Sat, 11:59:26,708 aiogram.event INFO Update id=450709801 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:59:31,133 aiogram.event INFO Update id=450709802 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:00:05,547 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:00:05,928 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:00:07,658 aiogram.event INFO Update id=450709803 is handled. Duration 406 ms by bot id=7771835226
2025-01-04, Sat, 12:00:12,563 aiogram.event INFO Update id=450709804 is handled. Duration 63 ms by bot id=7771835226
2025-01-04, Sat, 12:00:17,222 root INFO Company: unnamed_company. Run function db.get.get_bot_price
2025-01-04, Sat, 12:00:17,223 root ERROR Company: unnamed_company. In function db.get.get_bot_price error occurs: 'AsyncSession' object has no attribute 'query'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 8, in get_bot_price
    return await async_session.query(Promo).get(promocode).price
AttributeError: 'AsyncSession' object has no attribute 'query'

2025-01-04, Sat, 12:01:17,230 root ERROR Company: unnamed_company. In function db.get.get_bot_price error occurs: 'AsyncSession' object has no attribute 'query'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 8, in get_bot_price
    return await async_session.query(Promo).get(promocode).price
AttributeError: 'AsyncSession' object has no attribute 'query'

2025-01-04, Sat, 12:02:17,234 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, я маретолог, False
2025-01-04, Sat, 12:02:17,234 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:02:17,263 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:02:17,263 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:02:17,265 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:02:17,265 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:02:17,266 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:02:17,266 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:02:17,267 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:02:17,269 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:02:17,269 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077, 'DmPetrosel', 'Дмитрий', 'я маретолог', False)
2025-01-04, Sat, 12:02:17,271 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:02:17,273 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:02:17,421 aiogram.event INFO Update id=450709805 is handled. Duration 120198 ms by bot id=7771835226
2025-01-04, Sat, 12:10:54,327 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:10:54,369 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:10:59,205 aiogram.event INFO Update id=450709806 is handled. Duration 735 ms by bot id=7771835226
2025-01-04, Sat, 12:11:02,216 aiogram.event INFO Update id=450709807 is handled. Duration 463 ms by bot id=7771835226
2025-01-04, Sat, 12:11:17,980 root INFO REGISTRATION DATA: DmPetrosel, Dm, ямаркетолог, True
2025-01-04, Sat, 12:11:17,981 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:11:18,9 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:11:18,9 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:11:18,10 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:11:18,10 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:11:18,11 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:11:18,11 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:11:18,12 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:11:18,14 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:11:18,14 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (2142024077, 'DmPetrosel', 'Dm', 'ямаркетолог', True)
2025-01-04, Sat, 12:11:18,16 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:11:18,18 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:11:18,395 aiogram.event INFO Update id=450709808 is handled. Duration 414 ms by bot id=7771835226
2025-01-04, Sat, 12:11:51,161 aiogram.event INFO Update id=450709809 is handled. Duration 807 ms by bot id=7771835226
2025-01-04, Sat, 12:11:55,343 aiogram.event INFO Update id=450709810 is handled. Duration 60 ms by bot id=7771835226
2025-01-04, Sat, 12:11:57,818 aiogram.event INFO Update id=450709811 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:19:03,217 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:19:03,263 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:19:05,949 aiogram.event INFO Update id=450709812 is handled. Duration 369 ms by bot id=7771835226
2025-01-04, Sat, 12:19:09,202 aiogram.event INFO Update id=450709813 is handled. Duration 203 ms by bot id=7771835226
2025-01-04, Sat, 12:19:11,571 aiogram.event INFO Update id=450709814 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:22:07,953 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:22:07,999 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:22:11,23 aiogram.event INFO Update id=450709815 is handled. Duration 308 ms by bot id=7771835226
2025-01-04, Sat, 12:22:13,434 aiogram.event INFO Update id=450709816 is handled. Duration 111 ms by bot id=7771835226
2025-01-04, Sat, 12:22:15,268 aiogram.event INFO Update id=450709817 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:37:29,617 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:37:30,2 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:37:34,724 aiogram.event INFO Update id=450709818 is handled. Duration 454 ms by bot id=7771835226
2025-01-04, Sat, 12:37:41,508 aiogram.event INFO Update id=450709819 is handled. Duration 93 ms by bot id=7771835226
2025-01-04, Sat, 12:40:32,241 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:40:32,289 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:40:37,672 aiogram.event INFO Update id=450709820 is handled. Duration 732 ms by bot id=7771835226
2025-01-04, Sat, 12:40:40,327 aiogram.event INFO Update id=450709821 is handled. Duration 81 ms by bot id=7771835226
2025-01-04, Sat, 12:41:28,165 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:41:28,208 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:41:30,691 aiogram.event INFO Update id=450709822 is handled. Duration 291 ms by bot id=7771835226
2025-01-04, Sat, 12:41:32,902 aiogram.event INFO Update id=450709823 is handled. Duration 72 ms by bot id=7771835226
2025-01-04, Sat, 12:41:34,703 aiogram.event INFO Update id=450709824 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:41:34,703 aiogram.event ERROR Cause exception while process update id=450709824 by bot id=7771835226
KeyError: 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 86, in callback_selling
    await promo_continue(callback.from_user.id, price, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 90, in promo_continue
    await write_registration(chat_id, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 73, in write_registration
    logging.info(f"REGISTRATION DATA: {usr[chat_id]['username']}, {usr[chat_id]['name']}, {usr[chat_id]['promocode']}, {usr[chat_id]['marketer']}")
KeyError: 'promocode'
2025-01-04, Sat, 12:42:40,358 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:42:40,688 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:42:43,143 aiogram.event INFO Update id=450709825 is handled. Duration 682 ms by bot id=7771835226
2025-01-04, Sat, 12:42:45,92 aiogram.event INFO Update id=450709826 is handled. Duration 78 ms by bot id=7771835226
2025-01-04, Sat, 12:42:46,338 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, None
2025-01-04, Sat, 12:42:46,338 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:42:46,367 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:42:46,367 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:42:46,369 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:42:46,369 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:42:46,370 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:42:46,370 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:42:46,371 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:42:46,373 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:42:46,373 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (7675368439, 'Dm_dev_acc', 'Devid', None, None)
2025-01-04, Sat, 12:42:46,375 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-04, Sat, 12:42:46,379 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-04, Sat, 12:43:46,383 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)

2025-01-04, Sat, 12:44:46,518 aiogram.event INFO Update id=450709827 is handled. Duration 120180 ms by bot id=7771835226
2025-01-04, Sat, 12:45:38,396 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:45:38,551 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:45:40,29 aiogram.event INFO Update id=450709828 is handled. Duration 313 ms by bot id=7771835226
2025-01-04, Sat, 12:45:42,457 aiogram.event INFO Update id=450709829 is handled. Duration 63 ms by bot id=7771835226
2025-01-04, Sat, 12:45:44,797 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-04, Sat, 12:45:44,797 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:45:44,839 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:45:44,840 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:45:44,841 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:45:44,842 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:45:44,843 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:45:44,843 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:45:44,844 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:45:44,845 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:45:44,845 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-04, Sat, 12:45:44,848 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:45:44,849 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:45:45,108 aiogram.event INFO Update id=450709830 is handled. Duration 312 ms by bot id=7771835226
2025-01-04, Sat, 12:45:49,1 aiogram.event INFO Update id=450709831 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:53:00,821 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:53:00,867 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:53:08,612 aiogram.event INFO Update id=450709832 is handled. Duration 1421 ms by bot id=7771835226
2025-01-04, Sat, 12:53:13,35 aiogram.event INFO Update id=450709833 is handled. Duration 126 ms by bot id=7771835226
2025-01-04, Sat, 12:53:15,125 aiogram.event INFO Update id=450709834 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:54:53,567 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:54:53,611 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:54:59,545 aiogram.event INFO Update id=450709835 is handled. Duration 1143 ms by bot id=7771835226
2025-01-04, Sat, 12:55:02,148 aiogram.event INFO Update id=450709836 is handled. Duration 63 ms by bot id=7771835226
2025-01-04, Sat, 12:55:03,603 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-04, Sat, 12:55:03,603 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:55:03,631 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:55:03,631 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:55:03,633 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:55:03,633 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:55:03,634 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:55:03,634 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:55:03,635 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:55:03,637 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:55:03,637 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-04, Sat, 12:55:03,640 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:55:03,641 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:55:03,827 aiogram.event INFO Update id=450709837 is handled. Duration 225 ms by bot id=7771835226
2025-01-04, Sat, 12:55:06,382 aiogram.event INFO Update id=450709838 is handled. Duration 68 ms by bot id=7771835226
2025-01-04, Sat, 12:55:33,613 aiogram.event INFO Update id=450709839 is handled. Duration 721 ms by bot id=7771835226
2025-01-04, Sat, 12:55:36,65 aiogram.event INFO Update id=450709840 is handled. Duration 188 ms by bot id=7771835226
2025-01-04, Sat, 12:55:43,132 root ERROR Message(message_id=386, date=datetime.datetime(2025, 1, 4, 9, 55, 43, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, username='DmPetrosel', first_name='Dmitriy', last_name='Petrov', is_forum=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None), message_thread_id=None, from_user=User(id=2142024077, is_bot=False, first_name='Dmitriy', last_name='Petrov', username='DmPetrosel', language_code='en', is_premium=None, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None), sender_chat=None, sender_boost_count=None, sender_business_bot=None, business_connection_id=None, forward_origin=None, is_topic_message=None, is_automatic_forward=None, reply_to_message=None, external_reply=None, quote=None, reply_to_story=None, via_bot=None, edit_date=None, has_protected_content=None, is_from_offline=None, media_group_id=None, author_signature=None, text='Я маркетолог', entities=None, link_preview_options=None, effect_id=None, animation=None, audio=None, document=None, paid_media=None, photo=None, sticker=None, story=None, video=None, video_note=None, voice=None, caption=None, caption_entities=None, show_caption_above_media=None, has_media_spoiler=None, contact=None, dice=None, game=None, poll=None, venue=None, location=None, new_chat_members=None, left_chat_member=None, new_chat_title=None, new_chat_photo=None, delete_chat_photo=None, group_chat_created=None, supergroup_chat_created=None, channel_chat_created=None, message_auto_delete_timer_changed=None, migrate_to_chat_id=None, migrate_from_chat_id=None, pinned_message=None, invoice=None, successful_payment=None, refunded_payment=None, users_shared=None, chat_shared=None, connected_website=None, write_access_allowed=None, passport_data=None, proximity_alert_triggered=None, boost_added=None, chat_background_set=None, forum_topic_created=None, forum_topic_edited=None, forum_topic_closed=None, forum_topic_reopened=None, general_forum_topic_hidden=None, general_forum_topic_unhidden=None, giveaway_created=None, giveaway=None, giveaway_winners=None, giveaway_completed=None, video_chat_scheduled=None, video_chat_started=None, video_chat_ended=None, video_chat_participants_invited=None, web_app_data=None, reply_markup=None, forward_date=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None)
2025-01-04, Sat, 12:55:43,132 aiogram.event INFO Update id=450709841 is handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:57:27,797 aiogram.event INFO Update id=450709842 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:58:30,254 aiogram.event INFO Update id=450709843 is handled. Duration 1233 ms by bot id=7771835226
2025-01-04, Sat, 12:58:36,245 aiogram.event INFO Update id=450709844 is handled. Duration 261 ms by bot id=7771835226
2025-01-04, Sat, 12:58:40,906 root ERROR Message(message_id=394, date=datetime.datetime(2025, 1, 4, 9, 58, 40, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, username='DmPetrosel', first_name='Dmitriy', last_name='Petrov', is_forum=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None), message_thread_id=None, from_user=User(id=2142024077, is_bot=False, first_name='Dmitriy', last_name='Petrov', username='DmPetrosel', language_code='en', is_premium=None, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None), sender_chat=None, sender_boost_count=None, sender_business_bot=None, business_connection_id=None, forward_origin=None, is_topic_message=None, is_automatic_forward=None, reply_to_message=None, external_reply=None, quote=None, reply_to_story=None, via_bot=None, edit_date=None, has_protected_content=None, is_from_offline=None, media_group_id=None, author_signature=None, text='Я маркетолог', entities=None, link_preview_options=None, effect_id=None, animation=None, audio=None, document=None, paid_media=None, photo=None, sticker=None, story=None, video=None, video_note=None, voice=None, caption=None, caption_entities=None, show_caption_above_media=None, has_media_spoiler=None, contact=None, dice=None, game=None, poll=None, venue=None, location=None, new_chat_members=None, left_chat_member=None, new_chat_title=None, new_chat_photo=None, delete_chat_photo=None, group_chat_created=None, supergroup_chat_created=None, channel_chat_created=None, message_auto_delete_timer_changed=None, migrate_to_chat_id=None, migrate_from_chat_id=None, pinned_message=None, invoice=None, successful_payment=None, refunded_payment=None, users_shared=None, chat_shared=None, connected_website=None, write_access_allowed=None, passport_data=None, proximity_alert_triggered=None, boost_added=None, chat_background_set=None, forum_topic_created=None, forum_topic_edited=None, forum_topic_closed=None, forum_topic_reopened=None, general_forum_topic_hidden=None, general_forum_topic_unhidden=None, giveaway_created=None, giveaway=None, giveaway_winners=None, giveaway_completed=None, video_chat_scheduled=None, video_chat_started=None, video_chat_ended=None, video_chat_participants_invited=None, web_app_data=None, reply_markup=None, forward_date=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None)
2025-01-04, Sat, 12:58:40,906 aiogram.event INFO Update id=450709845 is handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 13:00:42,770 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 13:00:42,962 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 13:00:47,269 aiogram.event INFO Update id=450709846 is handled. Duration 1522 ms by bot id=7771835226
2025-01-04, Sat, 13:00:51,205 aiogram.event INFO Update id=450709847 is handled. Duration 256 ms by bot id=7771835226
2025-01-04, Sat, 13:00:57,98 root ERROR Message(message_id=402, date=datetime.datetime(2025, 1, 4, 10, 0, 56, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, username='DmPetrosel', first_name='Dmitriy', last_name='Petrov', is_forum=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None), message_thread_id=None, from_user=User(id=2142024077, is_bot=False, first_name='Dmitriy', last_name='Petrov', username='DmPetrosel', language_code='en', is_premium=None, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None), sender_chat=None, sender_boost_count=None, sender_business_bot=None, business_connection_id=None, forward_origin=None, is_topic_message=None, is_automatic_forward=None, reply_to_message=None, external_reply=None, quote=None, reply_to_story=None, via_bot=None, edit_date=None, has_protected_content=None, is_from_offline=None, media_group_id=None, author_signature=None, text='Я маркетолог', entities=None, link_preview_options=None, effect_id=None, animation=None, audio=None, document=None, paid_media=None, photo=None, sticker=None, story=None, video=None, video_note=None, voice=None, caption=None, caption_entities=None, show_caption_above_media=None, has_media_spoiler=None, contact=None, dice=None, game=None, poll=None, venue=None, location=None, new_chat_members=None, left_chat_member=None, new_chat_title=None, new_chat_photo=None, delete_chat_photo=None, group_chat_created=None, supergroup_chat_created=None, channel_chat_created=None, message_auto_delete_timer_changed=None, migrate_to_chat_id=None, migrate_from_chat_id=None, pinned_message=None, invoice=None, successful_payment=None, refunded_payment=None, users_shared=None, chat_shared=None, connected_website=None, write_access_allowed=None, passport_data=None, proximity_alert_triggered=None, boost_added=None, chat_background_set=None, forum_topic_created=None, forum_topic_edited=None, forum_topic_closed=None, forum_topic_reopened=None, general_forum_topic_hidden=None, general_forum_topic_unhidden=None, giveaway_created=None, giveaway=None, giveaway_winners=None, giveaway_completed=None, video_chat_scheduled=None, video_chat_started=None, video_chat_ended=None, video_chat_participants_invited=None, web_app_data=None, reply_markup=None, forward_date=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None)
2025-01-04, Sat, 13:00:57,98 aiogram.event INFO Update id=450709848 is handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 13:06:23,30 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 13:06:23,30 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 13:06:23,31 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 13:06:27,765 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 13:06:28,142 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 13:06:34,492 aiogram.event INFO Update id=450709849 is handled. Duration 1715 ms by bot id=7771835226
2025-01-04, Sat, 13:06:38,965 aiogram.event INFO Update id=450709850 is handled. Duration 60 ms by bot id=7771835226
2025-01-04, Sat, 13:06:44,742 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, я маркетолог, True
2025-01-04, Sat, 13:06:44,742 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 13:06:44,770 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 13:06:44,770 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 13:06:44,772 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 13:06:44,772 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 13:06:44,773 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 13:06:44,773 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 13:06:44,774 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 13:06:44,775 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 13:06:44,775 sqlalchemy.engine.Engine INFO [generated in 0.00018s] (2142024077, 'DmPetrosel', 'Дмитрий', 'я маркетолог', True)
2025-01-04, Sat, 13:06:44,778 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 13:06:44,780 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 13:06:45,54 aiogram.event INFO Update id=450709851 is handled. Duration 312 ms by bot id=7771835226
2025-01-05, Sun, 07:19:55,970 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 07:19:56,268 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 07:20:05,85 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-05, Sun, 07:20:05,86 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 07:20:05,86 aiogram.dispatcher INFO Polling stopped
2025-01-05, Sun, 07:20:43,849 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 07:20:43,950 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 07:20:58,688 aiogram.event INFO Update id=450709852 is handled. Duration 1066 ms by bot id=7771835226
2025-01-05, Sun, 07:21:03,805 aiogram.event INFO Update id=450709853 is handled. Duration 403 ms by bot id=7771835226
2025-01-05, Sun, 07:21:07,891 root INFO Company: unnamed_company. Run function db.get.get_bot_price
2025-01-05, Sun, 07:21:07,891 root ERROR Company: unnamed_company. In function db.get.get_bot_price error occurs: 'AsyncSession' object has no attribute 'query'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 8, in get_bot_price
    return await async_session.query(Promo).get(promocode).price
AttributeError: 'AsyncSession' object has no attribute 'query'

2025-01-05, Sun, 08:49:34,340 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:49:34,638 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:49:42,456 aiogram.event INFO Update id=450709855 is handled. Duration 623 ms by bot id=7771835226
2025-01-05, Sun, 08:49:44,846 aiogram.event INFO Update id=450709856 is not handled. Duration 0 ms by bot id=7771835226
2025-01-05, Sun, 08:53:57,623 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:53:57,922 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:54:00,968 aiogram.event INFO Update id=450709857 is handled. Duration 309 ms by bot id=7771835226
2025-01-05, Sun, 08:54:03,216 aiogram.event INFO Update id=450709858 is not handled. Duration 0 ms by bot id=7771835226
2025-01-05, Sun, 08:56:14,387 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:56:14,464 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:56:15,771 aiogram.event INFO Update id=450709859 is handled. Duration 510 ms by bot id=7771835226
2025-01-05, Sun, 08:56:18,40 aiogram.event INFO Update id=450709860 is handled. Duration 68 ms by bot id=7771835226
2025-01-05, Sun, 08:57:58,239 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-05, Sun, 08:57:58,240 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:57:58,240 aiogram.dispatcher INFO Polling stopped
2025-01-05, Sun, 08:58:02,552 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:58:02,597 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:58:05,975 aiogram.event INFO Update id=450709861 is handled. Duration 303 ms by bot id=7771835226
2025-01-05, Sun, 08:58:08,811 aiogram.event INFO Update id=450709862 is handled. Duration 101 ms by bot id=7771835226
2025-01-05, Sun, 08:58:11,863 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 08:58:11,863 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 08:58:11,863 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: __aenter__. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 25, in wrapper
    async with async_sessionmaker(bind=engine) as session:
AttributeError: __aenter__

2025-01-05, Sun, 08:59:11,869 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: __aenter__. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 25, in wrapper
    async with async_sessionmaker(bind=engine) as session:
AttributeError: __aenter__

2025-01-05, Sun, 08:59:29,965 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:59:30,10 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:59:34,335 aiogram.event INFO Update id=450709864 is handled. Duration 516 ms by bot id=7771835226
2025-01-05, Sun, 08:59:36,428 aiogram.event INFO Update id=450709865 is handled. Duration 65 ms by bot id=7771835226
2025-01-05, Sun, 08:59:38,651 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 08:59:38,651 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 08:59:38,652 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: add_user() missing 1 required positional argument: 'user_data'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
TypeError: add_user() missing 1 required positional argument: 'user_data'

2025-01-05, Sun, 09:00:38,658 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: add_user() missing 1 required positional argument: 'user_data'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
TypeError: add_user() missing 1 required positional argument: 'user_data'

2025-01-05, Sun, 09:01:13,921 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 09:01:13,965 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:01:22,187 aiogram.event INFO Update id=450709867 is handled. Duration 986 ms by bot id=7771835226
2025-01-05, Sun, 09:01:24,459 aiogram.event INFO Update id=450709868 is handled. Duration 108 ms by bot id=7771835226
2025-01-05, Sun, 09:01:26,97 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 09:01:26,97 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 09:01:26,98 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-05, Sun, 09:01:26,298 aiogram.event INFO Update id=450709869 is handled. Duration 201 ms by bot id=7771835226
2025-01-05, Sun, 09:01:29,315 aiogram.event INFO Update id=450709870 is handled. Duration 167 ms by bot id=7771835226
2025-01-05, Sun, 09:03:09,614 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 09:03:09,658 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:03:11,843 aiogram.event INFO Update id=450709871 is handled. Duration 267 ms by bot id=7771835226
2025-01-05, Sun, 09:03:14,317 aiogram.event INFO Update id=450709872 is handled. Duration 105 ms by bot id=7771835226
2025-01-05, Sun, 09:03:16,351 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 09:03:16,351 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 09:03:16,355 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'is_admin' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 10, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2177, in _declarative_constructor
    raise TypeError(
TypeError: 'is_admin' is an invalid keyword argument for User

2025-01-05, Sun, 09:04:19,488 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 09:04:19,578 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:04:22,244 aiogram.event INFO Update id=450709874 is handled. Duration 1219 ms by bot id=7771835226
2025-01-05, Sun, 09:04:24,33 aiogram.event INFO Update id=450709875 is handled. Duration 65 ms by bot id=7771835226
2025-01-05, Sun, 09:04:26,134 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 09:04:26,134 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 09:04:26,164 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-05, Sun, 09:04:26,164 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-05, Sun, 09:04:26,166 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-05, Sun, 09:04:26,166 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-05, Sun, 09:04:26,168 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-05, Sun, 09:04:26,168 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-05, Sun, 09:04:26,169 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-05, Sun, 09:04:26,171 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-05, Sun, 09:04:26,171 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-05, Sun, 09:04:26,173 sqlalchemy.engine.Engine INFO COMMIT
2025-01-05, Sun, 09:04:26,176 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-05, Sun, 09:04:26,332 aiogram.event INFO Update id=450709876 is handled. Duration 199 ms by bot id=7771835226
2025-01-05, Sun, 09:05:00,234 aiogram.event INFO Update id=450709877 is handled. Duration 314 ms by bot id=7771835226
2025-01-05, Sun, 09:06:14,183 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-05, Sun, 09:06:14,184 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:06:14,184 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:14:15,339 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:14:15,399 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:14:31,789 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:14:31,790 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:14:31,790 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:23:35,669 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:23:35,794 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:23:45,777 aiogram.event INFO Update id=450709878 is not handled. Duration 686 ms by bot id=7771835226
2025-01-08, Wed, 11:23:45,777 aiogram.event ERROR Cause exception while process update id=450709878 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(user_id)
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
2025-01-08, Wed, 11:25:09,270 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:25:09,316 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:25:11,378 aiogram.event INFO Update id=450709879 is not handled. Duration 158 ms by bot id=7771835226
2025-01-08, Wed, 11:25:11,378 aiogram.event ERROR Cause exception while process update id=450709879 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session, user_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
2025-01-08, Wed, 11:25:59,60 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:25:59,60 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:25:59,60 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:30:36,993 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:30:37,140 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:30:39,235 aiogram.event INFO Update id=450709880 is not handled. Duration 183 ms by bot id=7771835226
2025-01-08, Wed, 11:30:39,235 aiogram.event ERROR Cause exception while process update id=450709880 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session, chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
2025-01-08, Wed, 11:33:24,202 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:33:24,203 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:33:24,203 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:35:50,401 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:35:50,664 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:35:53,158 aiogram.event INFO Update id=450709881 is not handled. Duration 180 ms by bot id=7771835226
2025-01-08, Wed, 11:35:53,158 aiogram.event ERROR Cause exception while process update id=450709881 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session, chat_id=chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
2025-01-08, Wed, 11:36:19,656 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:36:19,732 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:36:21,588 aiogram.event INFO Update id=450709882 is not handled. Duration 231 ms by bot id=7771835226
2025-01-08, Wed, 11:36:21,588 aiogram.event ERROR Cause exception while process update id=450709882 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'cls'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session=session, chat_id=chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'cls'
2025-01-08, Wed, 11:36:50,467 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:36:50,468 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:36:50,468 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:38:58,164 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:38:58,554 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:39:00,501 aiogram.event INFO Update id=450709883 is not handled. Duration 162 ms by bot id=7771835226
2025-01-08, Wed, 11:39:00,501 aiogram.event ERROR Cause exception while process update id=450709883 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(kwargs.get('chat_id'))
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
2025-01-08, Wed, 11:39:28,639 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:39:28,639 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:39:28,640 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:40:19,141 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:40:19,331 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:40:21,478 aiogram.event INFO Update id=450709884 is not handled. Duration 198 ms by bot id=7771835226
2025-01-08, Wed, 11:40:21,479 aiogram.event ERROR Cause exception while process update id=450709884 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(kwargs.get('chat_id'))
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
2025-01-08, Wed, 11:41:40,683 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:41:40,683 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:41:40,684 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:41:56,55 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:41:56,223 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:41:58,26 aiogram.event INFO Update id=450709885 is not handled. Duration 249 ms by bot id=7771835226
2025-01-08, Wed, 11:41:58,26 aiogram.event ERROR Cause exception while process update id=450709885 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(kwargs.get('chat_id'))
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
2025-01-08, Wed, 11:51:31,470 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:51:31,470 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:51:31,471 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:51:35,700 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:51:35,781 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:51:38,402 aiogram.event INFO Update id=450709886 is not handled. Duration 178 ms by bot id=7771835226
2025-01-08, Wed, 11:51:38,402 aiogram.event ERROR Cause exception while process update id=450709886 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
2025-01-08, Wed, 11:53:42,295 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:53:42,296 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:53:42,296 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:53:47,204 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:53:47,247 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:53:48,486 aiogram.event INFO Update id=450709887 is not handled. Duration 182 ms by bot id=7771835226
2025-01-08, Wed, 11:53:48,486 aiogram.event ERROR Cause exception while process update id=450709887 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
2025-01-08, Wed, 11:54:02,309 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:54:02,310 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:54:02,310 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:55:03,91 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:55:03,137 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:55:04,576 aiogram.event INFO Update id=450709888 is not handled. Duration 149 ms by bot id=7771835226
2025-01-08, Wed, 11:55:04,577 aiogram.event ERROR Cause exception while process update id=450709888 by bot id=7771835226
AttributeError: type object 'User' has no attribute 'select'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 25, in get_by_chat_id
    result = await session.execute(cls.model.select().where(args.get('chat_id') == cls.model.chat_id))
AttributeError: type object 'User' has no attribute 'select'
2025-01-08, Wed, 11:55:27,444 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:55:27,445 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:55:27,445 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:59:03,79 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:59:03,130 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:59:06,784 aiogram.event INFO Update id=450709889 is not handled. Duration 603 ms by bot id=7771835226
2025-01-08, Wed, 11:59:06,784 aiogram.event ERROR Cause exception while process update id=450709889 by bot id=7771835226
AttributeError: 'tuple' object has no attribute 'get'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 26, in get_by_chat_id
    query =select(cls.model).where(args.get('chat_id') == cls.model.chat_id)
AttributeError: 'tuple' object has no attribute 'get'
2025-01-08, Wed, 11:59:51,423 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:59:51,424 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:59:51,424 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 12:00:29,264 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 12:00:29,314 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:00:31,742 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-08, Wed, 12:00:31,742 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:00:31,745 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-08, Wed, 12:00:31,745 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:00:31,746 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-08, Wed, 12:00:31,746 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:00:31,747 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:00:31,751 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:00:31,751 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-08, Wed, 12:00:31,753 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:00:31,754 aiogram.event INFO Update id=450709890 is not handled. Duration 250 ms by bot id=7771835226
2025-01-08, Wed, 12:00:31,754 aiogram.event ERROR Cause exception while process update id=450709890 by bot id=7771835226
AttributeError: 'User' object has no attribute 'first'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 28, in get_by_chat_id
    records = result.scalar_one_or_none().first()
AttributeError: 'User' object has no attribute 'first'
2025-01-08, Wed, 12:01:02,434 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 12:01:02,435 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:01:02,435 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 12:01:07,66 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 12:01:07,407 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:01:08,537 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-08, Wed, 12:01:08,537 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:01:08,539 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-08, Wed, 12:01:08,539 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:01:08,540 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-08, Wed, 12:01:08,540 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:01:08,541 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:01:08,546 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:01:08,546 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-08, Wed, 12:01:08,548 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:01:08,623 aiogram.event INFO Update id=450709891 is handled. Duration 262 ms by bot id=7771835226
2025-01-08, Wed, 12:02:04,696 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 12:02:04,697 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:02:04,697 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 12:02:09,882 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 12:02:10,153 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbotif await is_marketer(message.from_user.id):
            await marketer(message, state) id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:02:42,973 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-08, Wed, 12:02:42,973 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:02:42,976 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-08, Wed, 12:02:42,976 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:02:42,977 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-08, Wed, 12:02:42,978 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:02:42,979 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:02:42,983 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:02:42,983 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (7675368439,)
2025-01-08, Wed, 12:02:42,985 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:02:43,631 aiogram.event INFO Update id=450709892 is handled. Duration 1402 ms by bot id=7771835226
2025-01-08, Wed, 12:02:47,655 aiogram.event INFO Update id=450709893 is handled. Duration 311 ms by bot id=7771835226
2025-01-08, Wed, 12:02:49,766 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-08, Wed, 12:02:49,766 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-08, Wed, 12:02:49,767 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:02:49,768 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-08, Wed, 12:02:49,768 sqlalchemy.engine.Engine INFO [generated in 0.00019s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-08, Wed, 12:02:49,771 sqlalchemy.engine.Engine INFO COMMIT
2025-01-08, Wed, 12:02:49,773 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-08, Wed, 12:02:50,185 aiogram.event INFO Update id=450709894 is handled. Duration 418 ms by bot id=7771835226
2025-01-08, Wed, 12:02:51,760 aiogram.event INFO Update id=450709895 is handled. Duration 316 ms by bot id=7771835226
2025-01-08, Wed, 12:02:54,466 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:02:54,467 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:02:54,467 sqlalchemy.engine.Engine INFO [cached since 11.48s ago] (7675368439,)
2025-01-08, Wed, 12:02:54,470 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:02:54,572 aiogram.event INFO Update id=450709896 is handled. Duration 219 ms by bot id=7771835226
2025-01-08, Wed, 12:03:57,896 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 12:03:57,896 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:03:57,896 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:07:22,508 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:07:22,641 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:07:22,703 aiogram.event INFO Update id=450709898 is not handled. Duration 0 ms by bot id=7771835226
2025-01-09, Thu, 12:07:22,883 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:07:22,883 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:07:22,885 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:07:22,885 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:07:22,887 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:07:22,887 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:07:22,888 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:07:22,892 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:07:22,893 aiogram.event INFO Update id=450709897 is not handled. Duration 190 ms by bot id=7771835226
2025-01-09, Thu, 12:07:22,893 aiogram.event ERROR Cause exception while process update id=450709897 by bot id=7771835226
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
KeyError: 'promocodes'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-09, Thu, 12:07:35,28 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:07:35,28 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:07:35,30 aiogram.event INFO Update id=450709899 is not handled. Duration 151 ms by bot id=7771835226
2025-01-09, Thu, 12:07:35,30 aiogram.event ERROR Cause exception while process update id=450709899 by bot id=7771835226
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4252, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-09, Thu, 12:08:31,771 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:08:31,772 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:08:31,772 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:08:51,239 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:08:51,377 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:08:54,608 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:08:54,608 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:08:54,610 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:08:54,610 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:08:54,611 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:08:54,611 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:08:54,612 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:08:54,616 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:08:54,616 aiogram.event INFO Update id=450709900 is not handled. Duration 414 ms by bot id=7771835226
2025-01-09, Thu, 12:08:54,616 aiogram.event ERROR Cause exception while process update id=450709900 by bot id=7771835226
InvalidRequestError: back_populates on relationship 'Promo.user' refers to attribute 'User.promocode' that is not a relationship.  The back_populates parameter should refer to the name of a relationship on the target class.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1580, in _add_reverse_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: back_populates on relationship 'Promo.user' refers to attribute 'User.promocode' that is not a relationship.  The back_populates parameter should refer to the name of a relationship on the target class.
2025-01-09, Thu, 12:09:50,90 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:09:50,90 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:09:50,91 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:10:14,795 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:10:14,843 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:10:17,479 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:10:17,479 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:10:17,481 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:10:17,482 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:10:17,483 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:10:17,483 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:10:17,484 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:10:17,487 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:10:17,488 aiogram.event INFO Update id=450709901 is not handled. Duration 336 ms by bot id=7771835226
2025-01-09, Thu, 12:10:17,488 aiogram.event ERROR Cause exception while process update id=450709901 by bot id=7771835226
ArgumentError: FROM expression, such as a Table or alias() object expected, got False.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1644, in do_init
    self._setup_join_conditions()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1884, in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2310, in __init__
    self._determine_joins()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2406, in _determine_joins
    self.secondaryjoin = join_condition(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/util.py", line 123, in join_condition
    return Join._join_condition(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/selectable.py", line 1363, in _join_condition
    constraints = cls._joincond_scan_left_right(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/selectable.py", line 1431, in _joincond_scan_left_right
    b = coercions.expect(roles.FromClauseRole, b)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 395, in expect
    resolved = impl._literal_coercion(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 604, in _literal_coercion
    self._raise_for_expected(element, argname)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 695, in _raise_for_expected
    super()._raise_for_expected(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 518, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
sqlalchemy.exc.ArgumentError: FROM expression, such as a Table or alias() object expected, got False.
2025-01-09, Thu, 12:11:10,262 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:11:10,263 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:11:10,263 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:11:14,632 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:11:14,699 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:11:16,532 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:11:16,532 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:11:16,534 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:11:16,534 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:11:16,535 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:11:16,536 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:11:16,537 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:11:16,540 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:11:16,541 aiogram.event INFO Update id=450709902 is not handled. Duration 206 ms by bot id=7771835226
2025-01-09, Thu, 12:11:16,541 aiogram.event ERROR Cause exception while process update id=450709902 by bot id=7771835226
ArgumentError: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2075, in _generate_backref
    raise sa_exc.ArgumentError(
sqlalchemy.exc.ArgumentError: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
2025-01-09, Thu, 12:12:45,206 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:12:45,207 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:12:45,207 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:14:16,854 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:14:16,901 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:14:20,340 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:14:20,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:14:20,342 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:14:20,342 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:14:20,343 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:14:20,343 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:14:20,344 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:14:20,350 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:14:20,351 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 12:14:20,353 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:14:20,428 aiogram.event INFO Update id=450709903 is not handled. Duration 275 ms by bot id=7771835226
2025-01-09, Thu, 12:14:20,428 aiogram.event ERROR Cause exception while process update id=450709903 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    if await is_marketer(message.from_user.id):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in is_marketer
    return await get_user(chat_id=chat_id)['marketer']
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:14:55,763 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:14:55,764 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:14:55,764 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:19:36,911 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:19:36,978 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:19:40,203 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:19:40,203 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:19:40,205 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:19:40,205 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:19:40,206 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:19:40,206 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:19:40,207 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:19:40,214 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:19:40,214 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-09, Thu, 12:19:40,216 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:19:40,282 aiogram.event INFO Update id=450709904 is not handled. Duration 269 ms by bot id=7771835226
2025-01-09, Thu, 12:19:40,282 aiogram.event ERROR Cause exception while process update id=450709904 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'marketer'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    if await is_marketer(message.from_user.id):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in is_marketer
    return await get_user(chat_id=chat_id).marketer
AttributeError: 'coroutine' object has no attribute 'marketer'
2025-01-09, Thu, 12:21:27,822 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:21:27,823 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:21:27,823 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:21:32,62 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:21:32,104 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:21:34,579 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:21:34,579 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:21:34,581 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:21:34,582 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:21:34,583 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:21:34,583 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:21:34,584 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:21:34,591 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:21:34,591 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077,)
2025-01-09, Thu, 12:21:34,594 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:21:34,671 aiogram.event INFO Update id=450709905 is not handled. Duration 272 ms by bot id=7771835226
2025-01-09, Thu, 12:21:34,671 aiogram.event ERROR Cause exception while process update id=450709905 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    if await is_marketer(message.from_user.id):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in is_marketer
    return await get_user(chat_id=chat_id)['marketer'] == 'ямаркетолог'
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:24:10,375 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:24:10,375 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:24:10,375 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:24:14,682 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:24:14,726 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:24:17,62 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:24:17,62 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:24:17,64 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:24:17,64 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:24:17,65 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:24:17,65 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:24:17,66 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:24:17,73 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:24:17,73 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:24:17,75 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:24:17,175 aiogram.event INFO Update id=450709906 is not handled. Duration 316 ms by bot id=7771835226
2025-01-09, Thu, 12:24:17,175 aiogram.event ERROR Cause exception while process update id=450709906 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 28, in start
    if await get_user(message.from_user.id)['marketer']:
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:26:27,197 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:26:27,197 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:26:27,197 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:26:31,111 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:26:31,158 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:26:33,278 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:26:33,278 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:26:33,280 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:26:33,280 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:26:33,281 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:26:33,281 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:26:33,282 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:26:33,291 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:26:33,291 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:26:33,294 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:26:33,439 aiogram.event INFO Update id=450709907 is not handled. Duration 406 ms by bot id=7771835226
2025-01-09, Thu, 12:26:33,439 aiogram.event ERROR Cause exception while process update id=450709907 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'get'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 28, in start
    if await get_user(message.from_user.id).get('marketer'):
AttributeError: 'coroutine' object has no attribute 'get'
2025-01-09, Thu, 12:27:34,520 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:27:34,520 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:27:34,521 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:28:50,859 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:28:51,249 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:28:52,552 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:28:52,552 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:28:52,554 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:28:52,554 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:28:52,555 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:28:52,555 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:28:52,556 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:28:52,562 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:28:52,562 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 12:28:52,565 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:28:52,698 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:28:52,698 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:28:52,698 sqlalchemy.engine.Engine INFO [cached since 0.1367s ago] (2142024077,)
2025-01-09, Thu, 12:28:52,700 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:28:52,700 aiogram.event INFO Update id=450709908 is not handled. Duration 350 ms by bot id=7771835226
2025-01-09, Thu, 12:28:52,701 aiogram.event ERROR Cause exception while process update id=450709908 by bot id=7771835226
TypeError: 'User' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if user_m['marketer'] == True:
TypeError: 'User' object is not subscriptable
2025-01-09, Thu, 12:30:49,34 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:30:49,34 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:30:49,34 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:30:53,172 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:30:53,215 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:30:55,396 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:30:55,396 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:30:55,399 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:30:55,399 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:30:55,401 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:30:55,401 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:30:55,402 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:30:55,408 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:30:55,409 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077,)
2025-01-09, Thu, 12:30:55,412 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:30:55,596 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:30:55,597 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:30:55,597 sqlalchemy.engine.Engine INFO [cached since 0.1884s ago] (2142024077,)
2025-01-09, Thu, 12:30:55,598 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:30:55,599 aiogram.event INFO Update id=450709909 is handled. Duration 469 ms by bot id=7771835226
2025-01-09, Thu, 12:32:42,222 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:32:42,223 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:32:42,223 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:32:46,402 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:32:46,446 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:32:47,767 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:32:47,767 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:32:47,769 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:32:47,769 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:32:47,770 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:32:47,770 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:32:47,771 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:32:47,776 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:32:47,776 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-09, Thu, 12:32:47,778 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:32:47,921 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:32:47,922 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:32:47,922 sqlalchemy.engine.Engine INFO [cached since 0.1458s ago] (2142024077,)
2025-01-09, Thu, 12:32:47,923 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:32:47,924 aiogram.event INFO Update id=450709910 is handled. Duration 406 ms by bot id=7771835226
2025-01-09, Thu, 12:33:48,836 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:33:48,836 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:33:48,836 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:33:55,60 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:33:55,110 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:33:58,688 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:33:58,689 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:33:58,691 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:33:58,691 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:33:58,692 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:33:58,692 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:33:58,694 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:33:58,701 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:33:58,701 sqlalchemy.engine.Engine INFO [generated in 0.00036s] (2142024077,)
2025-01-09, Thu, 12:33:58,704 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:33:59,270 aiogram.event INFO Update id=450709911 is handled. Duration 920 ms by bot id=7771835226
2025-01-09, Thu, 12:34:04,625 aiogram.event INFO Update id=450709912 is handled. Duration 145 ms by bot id=7771835226
2025-01-09, Thu, 12:34:11,766 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 12:34:11,766 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 12:34:11,767 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:34:11,770 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 12:34:11,771 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 12:34:11,773 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 12:34:11,775 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 12:34:11,876 aiogram.event INFO Update id=450709913 is handled. Duration 110 ms by bot id=7771835226
2025-01-09, Thu, 12:35:07,267 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:07,267 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:07,268 sqlalchemy.engine.Engine INFO [cached since 68.57s ago] (2142024077,)
2025-01-09, Thu, 12:35:07,269 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:07,376 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:07,376 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:07,376 sqlalchemy.engine.Engine INFO [cached since 68.68s ago] (2142024077,)
2025-01-09, Thu, 12:35:07,378 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:07,380 aiogram.event INFO Update id=450709914 is not handled. Duration 426 ms by bot id=7771835226
2025-01-09, Thu, 12:35:07,380 aiogram.event ERROR Cause exception while process update id=450709914 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    await marketer(message, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 20, in marketer
    balance = await get_user(message.from_user.id)['balance']
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:35:46,592 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:35:46,592 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:35:46,593 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:35:50,860 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:35:50,903 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:35:52,390 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:35:52,390 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:35:52,392 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:35:52,392 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:35:52,393 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:35:52,393 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:35:52,394 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:52,400 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:52,400 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:35:52,403 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:52,474 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:52,475 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:52,475 sqlalchemy.engine.Engine INFO [cached since 0.07471s ago] (2142024077,)
2025-01-09, Thu, 12:35:52,477 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:52,478 aiogram.event INFO Update id=450709915 is not handled. Duration 293 ms by bot id=7771835226
2025-01-09, Thu, 12:35:52,478 aiogram.event ERROR Cause exception while process update id=450709915 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    await marketer(message, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 20, in marketer
    balance = await get_user(message.from_user.id).balance()
AttributeError: 'coroutine' object has no attribute 'balance'
2025-01-09, Thu, 12:36:23,747 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:36:23,747 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:36:23,747 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:36:27,655 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:36:27,734 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:36:29,577 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:36:29,577 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:36:29,579 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:36:29,579 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:36:29,581 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:36:29,581 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:36:29,582 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:36:29,589 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:36:29,589 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (2142024077,)
2025-01-09, Thu, 12:36:29,593 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:36:29,685 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:36:29,686 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:36:29,686 sqlalchemy.engine.Engine INFO [cached since 0.09684s ago] (2142024077,)
2025-01-09, Thu, 12:36:29,691 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:36:29,692 aiogram.event INFO Update id=450709916 is not handled. Duration 322 ms by bot id=7771835226
2025-01-09, Thu, 12:36:29,693 aiogram.event ERROR Cause exception while process update id=450709916 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    await marketer(message, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 20, in marketer
    balance = await get_user(message.from_user.id).balance
AttributeError: 'coroutine' object has no attribute 'balance'
2025-01-09, Thu, 12:37:03,509 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:37:03,510 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:03,510 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:37:07,815 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:37:08,204 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:09,260 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:37:09,260 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:09,262 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:37:09,262 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:09,263 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:37:09,263 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:09,264 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:09,270 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:09,271 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 12:37:09,272 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:09,449 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:09,449 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:09,449 sqlalchemy.engine.Engine INFO [cached since 0.1791s ago] (2142024077,)
2025-01-09, Thu, 12:37:09,451 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:09,451 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:09,452 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:09,452 sqlalchemy.engine.Engine INFO [cached since 0.1813s ago] (2142024077,)
2025-01-09, Thu, 12:37:09,452 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:09,456 aiogram.event INFO Update id=450709917 is handled. Duration 520 ms by bot id=7771835226
2025-01-09, Thu, 12:37:25,480 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:37:25,481 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:25,481 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:37:29,122 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:37:29,166 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:29,488 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:37:29,488 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:29,491 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:37:29,491 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:29,493 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:37:29,493 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:29,494 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:29,501 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:29,502 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-09, Thu, 12:37:29,504 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:29,629 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:29,630 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:29,630 sqlalchemy.engine.Engine INFO [cached since 0.1288s ago] (2142024077,)
2025-01-09, Thu, 12:37:29,631 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:29,632 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:29,633 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:29,633 sqlalchemy.engine.Engine INFO [cached since 0.1315s ago] (2142024077,)
2025-01-09, Thu, 12:37:29,634 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:29,772 aiogram.event INFO Update id=450709918 is handled. Duration 542 ms by bot id=7771835226
2025-01-09, Thu, 12:37:42,806 aiogram.event INFO Update id=450709919 is handled. Duration 0 ms by bot id=7771835226
2025-01-09, Thu, 12:43:10,228 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:43:10,228 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:43:10,228 sqlalchemy.engine.Engine INFO [cached since 340.7s ago] (2142024077,)
2025-01-09, Thu, 12:43:10,231 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:43:10,512 aiogram.event INFO Update id=450709920 is handled. Duration 344 ms by bot id=7771835226
2025-01-09, Thu, 12:43:19,699 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:43:19,700 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:43:19,700 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:43:53,22 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:43:53,65 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:43:55,803 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:43:55,803 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:43:55,805 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:43:55,806 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:43:55,807 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:43:55,807 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:43:55,808 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:43:55,814 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:43:55,814 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:43:55,817 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:43:56,85 aiogram.event INFO Update id=450709921 is handled. Duration 909 ms by bot id=7771835226
2025-01-09, Thu, 12:44:02,326 aiogram.event INFO Update id=450709922 is handled. Duration 68 ms by bot id=7771835226
2025-01-09, Thu, 12:44:10,621 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 12:44:10,621 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 12:44:10,622 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:44:10,626 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 12:44:10,626 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 12:44:10,628 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 12:44:10,630 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 12:44:10,776 aiogram.event INFO Update id=450709923 is handled. Duration 154 ms by bot id=7771835226
2025-01-09, Thu, 12:48:15,307 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:48:15,307 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:48:15,307 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:48:31,456 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:48:31,519 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:48:36,833 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:48:36,833 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:48:36,835 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:48:36,835 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:48:36,836 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:48:36,836 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:48:36,837 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:48:36,843 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:48:36,843 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:48:36,845 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:48:37,358 aiogram.event INFO Update id=450709924 is handled. Duration 1092 ms by bot id=7771835226
2025-01-09, Thu, 12:48:45,163 aiogram.event INFO Update id=450709925 is handled. Duration 409 ms by bot id=7771835226
2025-01-09, Thu, 12:48:51,658 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 12:48:51,658 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 12:48:51,659 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:48:51,661 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 12:48:51,661 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 12:48:51,663 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 12:48:51,666 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 12:48:51,736 aiogram.event INFO Update id=450709926 is handled. Duration 78 ms by bot id=7771835226
2025-01-09, Thu, 12:49:30,988 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:49:30,989 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:49:30,989 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:55:00,685 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:55:00,935 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:55:06,313 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:55:06,313 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:55:06,315 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:55:06,315 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:55:06,316 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:55:06,317 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:55:06,317 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:55:06,323 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:55:06,323 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-09, Thu, 12:55:06,325 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:55:06,817 aiogram.event INFO Update id=450709927 is handled. Duration 1205 ms by bot id=7771835226
2025-01-09, Thu, 12:55:11,623 aiogram.event INFO Update id=450709928 is handled. Duration 0 ms by bot id=7771835226
2025-01-09, Thu, 12:55:24,351 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:55:24,352 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:55:24,352 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:03:27,263 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:03:27,321 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:03:31,436 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:03:31,436 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:03:31,439 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:03:31,439 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:03:31,440 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:03:31,440 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:03:31,441 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:03:31,447 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:03:31,448 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-09, Thu, 13:03:31,450 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:03:31,592 aiogram.event INFO Update id=450709929 is handled. Duration 335 ms by bot id=7771835226
2025-01-09, Thu, 13:03:38,698 aiogram.event INFO Update id=450709930 is handled. Duration 211 ms by bot id=7771835226
2025-01-09, Thu, 13:03:44,605 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:03:44,605 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:03:44,606 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:03:44,609 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:03:44,609 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:03:44,611 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:03:44,614 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:03:44,702 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:03:44,703 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:03:44,703 sqlalchemy.engine.Engine INFO [cached since 13.26s ago] (2142024077,)
2025-01-09, Thu, 13:03:44,704 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:03:44,705 root ERROR 'dict' object has no attribute 'marketer'
2025-01-09, Thu, 13:03:44,705 aiogram.event INFO Update id=450709931 is handled. Duration 99 ms by bot id=7771835226
2025-01-09, Thu, 13:05:38,244 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:05:38,244 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:05:38,244 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:05:54,146 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:05:54,214 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:05:57,811 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:05:57,811 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:05:57,813 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:05:57,813 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:05:57,815 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:05:57,815 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:05:57,816 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:05:57,822 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:05:57,822 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 13:05:57,826 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:05:58,395 aiogram.event INFO Update id=450709932 is handled. Duration 1313 ms by bot id=7771835226
2025-01-09, Thu, 13:06:02,10 aiogram.event INFO Update id=450709933 is handled. Duration 103 ms by bot id=7771835226
2025-01-09, Thu, 13:06:08,508 root INFO REGISTRATION DATA: DmPetrosel, Дм, ямаркетолог, True
2025-01-09, Thu, 13:06:08,508 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:06:08,509 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:06:08,512 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:06:08,512 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (2142024077, 'DmPetrosel', 'Дм', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:06:08,514 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:06:08,517 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:06:08,584 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:06:08,584 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:06:08,584 sqlalchemy.engine.Engine INFO [cached since 10.76s ago] (2142024077,)
2025-01-09, Thu, 13:06:08,585 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:06:08,586 root ERROR 'dict' object has no attribute 'marketer'
2025-01-09, Thu, 13:06:08,586 aiogram.event INFO Update id=450709934 is handled. Duration 77 ms by bot id=7771835226
2025-01-09, Thu, 13:08:26,913 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:08:26,913 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:08:26,914 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:08:31,580 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:08:31,624 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:08:36,589 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:08:36,589 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:08:36,592 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:08:36,592 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:08:36,594 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:08:36,594 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:08:36,595 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:08:36,602 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:08:36,602 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 13:08:36,604 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:08:36,786 aiogram.event INFO Update id=450709935 is handled. Duration 453 ms by bot id=7771835226
2025-01-09, Thu, 13:08:41,561 aiogram.event INFO Update id=450709936 is handled. Duration 98 ms by bot id=7771835226
2025-01-09, Thu, 13:08:48,208 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:08:48,208 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:08:48,209 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:08:48,212 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:08:48,213 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:08:48,214 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:08:48,216 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:08:48,291 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:08:48,291 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:08:48,291 sqlalchemy.engine.Engine INFO [cached since 11.69s ago] (2142024077,)
2025-01-09, Thu, 13:08:48,292 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:08:48,293 root ERROR 'dict' object has no attribute 'marketer'
2025-01-09, Thu, 13:08:48,293 aiogram.event INFO Update id=450709937 is handled. Duration 85 ms by bot id=7771835226
2025-01-09, Thu, 13:11:04,374 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:11:04,375 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:11:04,375 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:11:08,940 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:11:09,198 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:11:13,487 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:11:13,488 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:11:13,490 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:11:13,490 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:11:13,491 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:11:13,491 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:11:13,492 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:11:13,500 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:11:13,500 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 13:11:13,503 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:11:13,595 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:11:13,595 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:11:13,595 sqlalchemy.engine.Engine INFO [cached since 0.09517s ago] (2142024077,)
2025-01-09, Thu, 13:11:13,596 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:11:13,597 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:11:13,598 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:11:13,598 sqlalchemy.engine.Engine INFO [cached since 0.0981s ago] (2142024077,)
2025-01-09, Thu, 13:11:13,600 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:11:13,601 aiogram.event INFO Update id=450709938 is not handled. Duration 405 ms by bot id=7771835226
2025-01-09, Thu, 13:11:13,601 aiogram.event ERROR Cause exception while process update id=450709938 by bot id=7771835226
AttributeError: 'str' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 32, in start
    await marketer(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 22, in marketer
    balance = user.balance
AttributeError: 'str' object has no attribute 'balance'
2025-01-09, Thu, 13:13:48,994 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:13:48,994 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:13:48,994 sqlalchemy.engine.Engine INFO [cached since 155.5s ago] (2142024077,)
2025-01-09, Thu, 13:13:48,995 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:13:49,88 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:13:49,88 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:13:49,89 sqlalchemy.engine.Engine INFO [cached since 155.6s ago] (2142024077,)
2025-01-09, Thu, 13:13:49,90 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:13:49,91 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:13:49,91 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:13:49,91 sqlalchemy.engine.Engine INFO [cached since 155.6s ago] (2142024077,)
2025-01-09, Thu, 13:13:49,92 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:13:49,93 aiogram.event INFO Update id=450709939 is not handled. Duration 170 ms by bot id=7771835226
2025-01-09, Thu, 13:13:49,93 aiogram.event ERROR Cause exception while process update id=450709939 by bot id=7771835226
AttributeError: 'str' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 32, in start
    await marketer(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 22, in marketer
    balance = user.balance
AttributeError: 'str' object has no attribute 'balance'
2025-01-09, Thu, 13:15:03,781 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:15:03,781 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:15:03,781 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:15:07,625 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:15:07,774 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:15:10,444 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:15:10,444 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:15:10,446 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:15:10,446 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:15:10,447 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:15:10,447 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:15:10,448 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:10,454 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:10,454 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 13:15:10,456 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:10,597 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:10,597 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:10,597 sqlalchemy.engine.Engine INFO [cached since 0.1434s ago] (2142024077,)
2025-01-09, Thu, 13:15:10,598 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:10,600 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:10,600 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:10,600 sqlalchemy.engine.Engine INFO [cached since 0.1464s ago] (2142024077,)
2025-01-09, Thu, 13:15:10,601 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:10,707 aiogram.event INFO Update id=450709940 is handled. Duration 583 ms by bot id=7771835226
2025-01-09, Thu, 13:15:29,723 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:29,723 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:29,725 sqlalchemy.engine.Engine INFO [cached since 19.27s ago] (2142024077,)
2025-01-09, Thu, 13:15:29,726 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:29,874 aiogram.event INFO Update id=450709941 is handled. Duration 227 ms by bot id=7771835226
2025-01-09, Thu, 13:15:34,868 aiogram.event INFO Update id=450709942 is handled. Duration 96 ms by bot id=7771835226
2025-01-09, Thu, 13:15:39,738 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:15:39,738 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:15:39,740 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:39,741 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:15:39,742 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:15:39,743 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:15:39,745 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:15:39,810 aiogram.event INFO Update id=450709943 is handled. Duration 72 ms by bot id=7771835226
2025-01-09, Thu, 13:16:54,662 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:16:54,663 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:16:54,663 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:17:17,943 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:17:17,986 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:17:21,646 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:17:21,646 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:17:21,648 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:17:21,648 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:17:21,649 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:17:21,649 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:17:21,651 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:21,658 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:17:21,658 sqlalchemy.engine.Engine INFO [generated in 0.00036s] (2142024077,)
2025-01-09, Thu, 13:17:21,661 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:17:21,837 aiogram.event INFO Update id=450709944 is handled. Duration 413 ms by bot id=7771835226
2025-01-09, Thu, 13:17:26,994 aiogram.event INFO Update id=450709945 is handled. Duration 111 ms by bot id=7771835226
2025-01-09, Thu, 13:17:31,737 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:17:31,737 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:17:31,738 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:31,741 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:17:31,741 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:17:31,743 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:17:31,745 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:17:31,838 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:31,839 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:17:31,839 sqlalchemy.engine.Engine INFO [cached since 10.18s ago] (2142024077,)
2025-01-09, Thu, 13:17:31,840 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:17:31,841 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:31,841 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:17:31,841 sqlalchemy.engine.Engine INFO [cached since 10.18s ago] (2142024077,)
2025-01-09, Thu, 13:17:31,842 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:17:31,941 aiogram.event INFO Update id=450709946 is handled. Duration 203 ms by bot id=7771835226
2025-01-09, Thu, 13:18:12,89 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:18:12,90 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:18:12,90 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:22:40,572 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:22:40,858 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:22:41,92 aiogram.event INFO Update id=450709947 is not handled. Duration 0 ms by bot id=7771835226
2025-01-10, Fri, 12:22:45,206 aiogram.event INFO Update id=450709948 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:23:33,453 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:23:33,454 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:23:33,454 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:39:12,575 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:39:12,650 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:41:20,712 aiogram.event INFO Update id=450709949 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:43:25,583 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:43:25,584 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:43:25,584 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:43:31,958 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:43:32,3 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:43:34,635 aiogram.event INFO Update id=450709950 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:44:30,450 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:44:30,451 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:44:30,452 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:44:36,666 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:44:36,712 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:44:40,108 aiogram.event INFO Update id=450709951 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:46:40,72 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:46:40,73 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:46:40,73 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:46:46,675 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:46:46,721 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:46:47,165 aiogram.event INFO Update id=450709952 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:46:51,971 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 12:46:51,971 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:46:51,974 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 12:46:51,975 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:46:51,978 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 12:46:51,978 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:46:51,981 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:46:51,994 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:46:51,994 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-10, Fri, 12:46:51,998 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:46:52,69 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:46:52,70 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:46:52,70 sqlalchemy.engine.Engine INFO [cached since 0.0768s ago] (2142024077,)
2025-01-10, Fri, 12:46:52,72 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:46:52,74 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:46:52,75 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:46:52,75 sqlalchemy.engine.Engine INFO [cached since 0.08188s ago] (2142024077,)
2025-01-10, Fri, 12:46:52,78 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:46:52,165 aiogram.event INFO Update id=450709953 is handled. Duration 424 ms by bot id=7771835226
2025-01-10, Fri, 12:46:54,416 aiogram.event INFO Update id=450709954 is handled. Duration 3 ms by bot id=7771835226
2025-01-10, Fri, 12:49:45,209 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:49:45,209 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:49:45,210 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:51:27,600 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:51:27,644 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:51:27,716 aiogram.event INFO Update id=450709955 is handled. Duration 2 ms by bot id=7771835226
2025-01-10, Fri, 12:51:27,717 aiogram.event INFO Update id=450709956 is handled. Duration 2 ms by bot id=7771835226
2025-01-10, Fri, 12:51:27,717 aiogram.event INFO Update id=450709957 is handled. Duration 2 ms by bot id=7771835226
2025-01-10, Fri, 12:51:42,102 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 12:51:42,103 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:51:42,107 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 12:51:42,107 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:51:42,111 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 12:51:42,111 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:51:42,114 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:51:42,127 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:51:42,127 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-10, Fri, 12:51:42,135 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:51:42,229 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:51:42,230 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:51:42,230 sqlalchemy.engine.Engine INFO [cached since 0.1032s ago] (2142024077,)
2025-01-10, Fri, 12:51:42,232 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:51:42,234 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:51:42,235 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:51:42,235 sqlalchemy.engine.Engine INFO [cached since 0.1081s ago] (2142024077,)
2025-01-10, Fri, 12:51:42,237 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:51:42,338 aiogram.event INFO Update id=450709958 is handled. Duration 464 ms by bot id=7771835226
2025-01-10, Fri, 12:51:43,847 aiogram.event INFO Update id=450709959 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:52:34,798 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:52:34,799 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:52:34,799 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:52:40,831 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:52:40,910 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:52:40,978 aiogram.event INFO Update id=450709960 is handled. Duration 0 ms by bot id=7771835226
2025-01-10, Fri, 12:53:15,627 aiogram.event INFO Update id=450709961 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:55:33,210 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:55:33,211 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:55:33,211 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:55:39,580 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:55:39,627 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:55:41,131 aiogram.event INFO Update id=450709962 is handled. Duration 0 ms by bot id=7771835226
2025-01-10, Fri, 12:58:10,186 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:58:10,187 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:58:10,187 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:58:17,97 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:58:17,143 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:58:26,695 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 12:58:26,695 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:58:26,701 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 12:58:26,701 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:58:26,705 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 12:58:26,705 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:58:26,707 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:58:26,719 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:58:26,720 sqlalchemy.engine.Engine INFO [generated in 0.00060s] (7675368439,)
2025-01-10, Fri, 12:58:26,724 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:58:27,7 aiogram.event INFO Update id=450709963 is handled. Duration 674 ms by bot id=7771835226
2025-01-10, Fri, 12:58:30,473 aiogram.event INFO Update id=450709964 is handled. Duration 74 ms by bot id=7771835226
2025-01-10, Fri, 12:58:32,624 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 12:58:32,624 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 12:58:32,628 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:58:32,630 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 12:58:32,631 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 12:58:32,635 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 12:58:32,638 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 12:58:32,761 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:58:32,762 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:58:32,762 sqlalchemy.engine.Engine INFO [cached since 6.043s ago] (7675368439,)
2025-01-10, Fri, 12:58:32,764 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:58:32,877 aiogram.event INFO Update id=450709965 is handled. Duration 254 ms by bot id=7771835226
2025-01-10, Fri, 12:58:36,870 aiogram.event INFO Update id=450709966 is handled. Duration 126 ms by bot id=7771835226
2025-01-10, Fri, 13:01:43,300 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:01:43,301 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:01:43,301 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:01:49,703 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:01:49,747 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:01:49,876 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:01:49,876 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:01:49,880 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:01:49,881 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:01:49,884 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:01:49,884 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:01:49,886 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:01:49,896 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.id = $1::BIGINT
2025-01-10, Fri, 13:01:49,896 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (2142024077,)
2025-01-10, Fri, 13:01:49,900 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:01:49,901 aiogram.event INFO Update id=450709967 is handled. Duration 77 ms by bot id=7771835226
2025-01-10, Fri, 13:06:19,100 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:06:19,101 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:06:19,101 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:06:43,128 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:06:43,174 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:06:43,307 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:06:43,307 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:06:43,312 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:06:43,312 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:06:43,315 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:06:43,315 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:06:43,318 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:06:43,329 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.id = $1::BIGINT
2025-01-10, Fri, 13:06:43,329 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (2142024077,)
2025-01-10, Fri, 13:06:43,334 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:06:43,335 aiogram.event INFO Update id=450709968 is handled. Duration 82 ms by bot id=7771835226
2025-01-10, Fri, 13:08:46,705 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:08:46,706 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:08:46,706 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:08:52,996 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:08:53,43 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:08:54,778 aiogram.event INFO Update id=450709969 is not handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 13:08:54,778 aiogram.event ERROR Cause exception while process update id=450709969 by bot id=7771835226
TypeError: get_all_promos() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 29, in callback_marketer
    promos_list = await get_all_promos()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
TypeError: get_all_promos() missing 1 required positional argument: 'chat_id'
2025-01-10, Fri, 13:09:47,129 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:09:47,130 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:09:47,130 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:12:11,806 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:12:11,854 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:12:14,459 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:12:14,460 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:12:14,464 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:12:14,465 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:12:14,468 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:12:14,468 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:12:14,471 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:12:14,475 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:12:14,476 aiogram.event INFO Update id=450709970 is not handled. Duration 74 ms by bot id=7771835226
2025-01-10, Fri, 13:12:14,476 aiogram.event ERROR Cause exception while process update id=450709970 by bot id=7771835226
ArgumentError: relationship 'user' expects a class or a mapper argument (received: <class 'sqlalchemy.orm.attributes.InstrumentedAttribute'>)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 29, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 27, in get_all
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1874, in _setup_entity
    raise sa_exc.ArgumentError(
sqlalchemy.exc.ArgumentError: relationship 'user' expects a class or a mapper argument (received: <class 'sqlalchemy.orm.attributes.InstrumentedAttribute'>)
2025-01-10, Fri, 13:17:51,345 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:17:51,346 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:17:51,346 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:34:18,284 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:34:18,335 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:34:18,660 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:34:18,661 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:34:18,666 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:34:18,666 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:34:18,669 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:34:18,669 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:34:18,672 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:34:18,686 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:34:18,687 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-10, Fri, 13:34:18,692 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:34:18,854 aiogram.event INFO Update id=450709971 is handled. Duration 438 ms by bot id=7771835226
2025-01-10, Fri, 13:34:26,288 aiogram.event INFO Update id=450709972 is handled. Duration 161 ms by bot id=7771835226
2025-01-10, Fri, 13:34:31,838 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 13:34:31,839 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 13:34:31,840 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:34:31,845 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:34:31,846 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:34:31,849 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:34:31,859 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:35:31,870 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:35:31,870 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:35:31,871 sqlalchemy.engine.Engine INFO [cached since 60.03s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:35:31,873 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:35:31,875 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:35:53,465 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:35:53,465 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:35:53,466 sqlalchemy.engine.Engine INFO [cached since 94.78s ago] (2142024077,)
2025-01-10, Fri, 13:35:53,468 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:35:53,773 aiogram.event INFO Update id=450709974 is handled. Duration 408 ms by bot id=7771835226
2025-01-10, Fri, 13:35:57,410 aiogram.event INFO Update id=450709975 is handled. Duration 62 ms by bot id=7771835226
2025-01-10, Fri, 13:36:07,408 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 13:36:07,408 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 13:36:07,410 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:36:07,410 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:36:07,410 sqlalchemy.engine.Engine INFO [cached since 95.57s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:36:07,412 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:36:07,414 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:36:32,39 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:36:32,39 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:36:32,39 sqlalchemy.engine.Engine INFO [cached since 133.4s ago] (2142024077,)
2025-01-10, Fri, 13:36:32,42 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:36:32,43 root ERROR 'NoneType' object has no attribute 'marketer'
2025-01-10, Fri, 13:36:32,44 aiogram.event INFO Update id=450709973 is handled. Duration 120205 ms by bot id=7771835226
2025-01-10, Fri, 13:37:07,424 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:37:07,425 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:37:07,425 sqlalchemy.engine.Engine INFO [cached since 155.6s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:37:07,427 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:37:07,430 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:38:07,591 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:38:07,591 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:38:07,591 sqlalchemy.engine.Engine INFO [cached since 228.9s ago] (2142024077,)
2025-01-10, Fri, 13:38:07,593 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:38:07,595 root ERROR 'NoneType' object has no attribute 'marketer'
2025-01-10, Fri, 13:38:07,595 aiogram.event INFO Update id=450709976 is handled. Duration 120186 ms by bot id=7771835226
2025-01-10, Fri, 13:38:24,54 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:38:24,54 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:38:24,55 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:54:04,994 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:54:05,42 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:54:10,419 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:54:10,419 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:54:10,424 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:54:10,424 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:54:10,427 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:54:10,428 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:54:10,430 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:54:10,442 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:54:10,443 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (2142024077,)
2025-01-10, Fri, 13:54:10,447 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:54:10,635 aiogram.event INFO Update id=450709977 is handled. Duration 456 ms by bot id=7771835226
2025-01-10, Fri, 13:54:14,904 aiogram.event INFO Update id=450709978 is handled. Duration 98 ms by bot id=7771835226
2025-01-10, Fri, 13:54:19,441 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 13:54:19,441 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 13:54:19,442 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:54:19,447 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:54:19,448 sqlalchemy.engine.Engine INFO [generated in 0.00058s] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:54:19,451 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:54:19,459 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:55:19,465 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:55:19,466 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:55:19,466 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:55:19,468 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:55:19,470 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:56:19,638 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:56:19,639 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:56:19,639 sqlalchemy.engine.Engine INFO [cached since 129.2s ago] (2142024077,)
2025-01-10, Fri, 13:56:19,641 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:56:19,642 root ERROR 'NoneType' object has no attribute 'marketer'
2025-01-10, Fri, 13:56:19,643 aiogram.event INFO Update id=450709979 is handled. Duration 120202 ms by bot id=7771835226
2025-01-10, Fri, 14:04:50,572 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:04:50,573 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:04:50,573 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:04:56,694 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:04:56,744 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:05:02,177 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:05:02,177 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:05:02,183 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:05:02,183 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:05:02,186 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:05:02,186 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:05:02,189 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:05:02,201 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:05:02,202 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (2142024077,)
2025-01-10, Fri, 14:05:02,205 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:05:02,709 aiogram.event INFO Update id=450709980 is handled. Duration 2089 ms by bot id=7771835226
2025-01-10, Fri, 14:05:05,767 aiogram.event INFO Update id=450709981 is handled. Duration 105 ms by bot id=7771835226
2025-01-10, Fri, 14:05:20,718 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:05:20,718 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:05:20,720 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:05:20,725 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:05:20,725 sqlalchemy.engine.Engine INFO [generated in 0.00050s] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:05:20,728 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:05:20,738 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:06:05,300 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:06:05,301 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:06:05,301 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:06:05,553 aiogram.event INFO Update id=450709982 is not handled. Duration 44835 ms by bot id=7771835226
2025-01-10, Fri, 14:08:17,294 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:08:17,394 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:08:19,59 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:08:19,59 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:08:19,64 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:08:19,64 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:08:19,67 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:08:19,67 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:08:19,70 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:08:19,81 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:08:19,82 sqlalchemy.engine.Engine INFO [generated in 0.00052s] (2142024077,)
2025-01-10, Fri, 14:08:19,86 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:08:19,323 aiogram.event INFO Update id=450709983 is handled. Duration 581 ms by bot id=7771835226
2025-01-10, Fri, 14:08:24,274 aiogram.event INFO Update id=450709984 is handled. Duration 119 ms by bot id=7771835226
2025-01-10, Fri, 14:08:29,985 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:08:29,985 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:08:29,986 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:08:29,991 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:08:29,991 sqlalchemy.engine.Engine INFO [generated in 0.00057s] (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:08:29,995 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:08:30,4 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:09:30,14 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:30,15 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:09:30,15 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:09:30,18 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:30,20 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:09:43,967 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:09:43,968 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:09:43,968 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:09:44,220 aiogram.event INFO Update id=450709985 is not handled. Duration 74235 ms by bot id=7771835226
2025-01-10, Fri, 14:09:50,709 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:09:50,754 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:09:52,208 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:09:52,208 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:09:52,213 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:09:52,213 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:09:52,216 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:09:52,217 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:09:52,218 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:52,232 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:09:52,232 sqlalchemy.engine.Engine INFO [generated in 0.00053s] (2142024077,)
2025-01-10, Fri, 14:09:52,236 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:52,499 aiogram.event INFO Update id=450709986 is handled. Duration 607 ms by bot id=7771835226
2025-01-10, Fri, 14:09:54,306 aiogram.event INFO Update id=450709987 is handled. Duration 123 ms by bot id=7771835226
2025-01-10, Fri, 14:09:59,109 root INFO REGISTRATION DATA: DmPetrosel, Дм, ямаркетолог, True
2025-01-10, Fri, 14:09:59,109 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:09:59,110 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:59,116 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:09:59,116 sqlalchemy.engine.Engine INFO [generated in 0.00057s] (1, 2142024077, 'DmPetrosel', 'Дм', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:09:59,120 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 14:09:59,123 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 14:09:59,190 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:59,191 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:09:59,191 sqlalchemy.engine.Engine INFO [cached since 6.959s ago] (2142024077,)
2025-01-10, Fri, 14:09:59,193 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:59,196 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:59,196 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:09:59,196 sqlalchemy.engine.Engine INFO [cached since 6.965s ago] (2142024077,)
2025-01-10, Fri, 14:09:59,198 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:59,278 aiogram.event INFO Update id=450709988 is handled. Duration 169 ms by bot id=7771835226
2025-01-10, Fri, 14:10:21,991 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:10:21,992 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:10:21,992 sqlalchemy.engine.Engine INFO [cached since 29.76s ago] (7675368439,)
2025-01-10, Fri, 14:10:21,994 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:10:22,301 aiogram.event INFO Update id=450709989 is handled. Duration 473 ms by bot id=7771835226
2025-01-10, Fri, 14:10:25,949 aiogram.event INFO Update id=450709990 is handled. Duration 67 ms by bot id=7771835226
2025-01-10, Fri, 14:10:27,556 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:10:27,556 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:10:27,557 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:10:27,558 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:10:27,558 sqlalchemy.engine.Engine INFO [cached since 28.44s ago] (1, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:10:27,560 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:10:27,569 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:11:00,911 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:11:00,912 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:11:00,912 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:11:01,164 aiogram.event INFO Update id=450709991 is not handled. Duration 33610 ms by bot id=7771835226
2025-01-10, Fri, 14:12:31,549 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:12:31,594 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:12:35,251 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:12:35,251 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:12:35,256 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:12:35,256 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:12:35,259 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:12:35,260 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:12:35,262 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:12:35,274 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:12:35,274 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (7675368439,)
2025-01-10, Fri, 14:12:35,278 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:12:35,455 aiogram.event INFO Update id=450709992 is handled. Duration 416 ms by bot id=7771835226
2025-01-10, Fri, 14:12:37,959 aiogram.event INFO Update id=450709993 is handled. Duration 99 ms by bot id=7771835226
2025-01-10, Fri, 14:12:39,923 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:12:39,923 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:12:39,926 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:12:39,929 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:12:39,929 sqlalchemy.engine.Engine INFO [generated in 0.00050s] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:12:39,932 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:12:39,941 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:13:37,856 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:13:37,857 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:13:37,857 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:13:38,109 aiogram.event INFO Update id=450709994 is not handled. Duration 58188 ms by bot id=7771835226
2025-01-10, Fri, 14:13:58,650 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:13:58,693 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:14:02,322 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:14:02,322 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:14:02,326 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:14:02,327 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:14:02,330 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:14:02,330 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:14:02,333 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:14:02,345 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:14:02,345 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (7675368439,)
2025-01-10, Fri, 14:14:02,350 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:14:02,991 aiogram.event INFO Update id=450709995 is handled. Duration 1153 ms by bot id=7771835226
2025-01-10, Fri, 14:14:05,522 aiogram.event INFO Update id=450709996 is handled. Duration 74 ms by bot id=7771835226
2025-01-10, Fri, 14:14:07,46 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:14:07,47 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:14:07,50 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:14:07,53 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:14:07,53 sqlalchemy.engine.Engine INFO [generated in 0.00053s] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:14:07,56 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:14:07,64 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:15:07,70 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:15:07,71 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:15:07,71 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:15:07,73 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:15:07,76 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:15:11,526 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:15:11,526 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:15:11,527 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:15:11,779 aiogram.event INFO Update id=450709997 is not handled. Duration 64734 ms by bot id=7771835226
2025-01-10, Fri, 14:18:34,780 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:18:34,825 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:18:40,101 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:18:40,101 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:18:40,106 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:18:40,107 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:18:40,110 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:18:40,110 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:18:40,113 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:18:40,126 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:18:40,126 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (7675368439,)
2025-01-10, Fri, 14:18:40,130 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:18:40,764 aiogram.event INFO Update id=450709998 is handled. Duration 1349 ms by bot id=7771835226
2025-01-10, Fri, 14:18:43,836 aiogram.event INFO Update id=450709999 is handled. Duration 402 ms by bot id=7771835226
2025-01-10, Fri, 14:18:45,429 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:18:45,429 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:18:45,432 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:18:45,435 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:18:45,435 sqlalchemy.engine.Engine INFO [generated in 0.00054s] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:18:45,438 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:18:45,447 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:19:45,455 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:19:45,456 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:19:45,456 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:19:45,458 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:19:45,461 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:19:50,108 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:19:50,109 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:19:50,110 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:19:50,362 aiogram.event INFO Update id=450710000 is not handled. Duration 64934 ms by bot id=7771835226
2025-01-10, Fri, 14:29:32,632 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:29:32,679 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:29:38,340 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:29:38,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:29:38,342 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:29:38,342 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:29:38,344 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:29:38,344 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:29:38,345 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:29:38,352 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:29:38,352 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (7675368439,)
2025-01-10, Fri, 14:29:38,355 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:29:38,538 aiogram.event INFO Update id=450710001 is handled. Duration 408 ms by bot id=7771835226
2025-01-10, Fri, 14:29:41,339 aiogram.event INFO Update id=450710002 is handled. Duration 131 ms by bot id=7771835226
2025-01-10, Fri, 14:29:42,768 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:29:42,768 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:29:42,770 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:29:42,771 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:29:42,771 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:29:42,773 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:29:42,777 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:31:31,932 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:31:31,992 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:31:35,514 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:31:35,514 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:31:35,516 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:31:35,516 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:31:35,518 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:31:35,518 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:31:35,519 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:31:35,525 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:31:35,526 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (7675368439,)
2025-01-10, Fri, 14:31:35,527 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:31:35,984 aiogram.event INFO Update id=450710004 is handled. Duration 871 ms by bot id=7771835226
2025-01-10, Fri, 14:31:38,316 aiogram.event INFO Update id=450710005 is handled. Duration 269 ms by bot id=7771835226
2025-01-10, Fri, 14:31:39,218 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:31:39,218 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:31:39,220 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:31:39,222 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:31:39,222 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:31:39,224 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:31:39,229 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

2025-01-10, Fri, 14:32:32,809 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:32:32,810 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:32:32,810 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:32:33,61 aiogram.event INFO Update id=450710006 is not handled. Duration 53844 ms by bot id=7771835226
2025-01-10, Fri, 14:34:02,570 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:34:02,956 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:34:14,554 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:34:14,554 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:34:14,556 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:34:14,556 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:34:14,557 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:34:14,557 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:34:14,558 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:34:14,565 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:34:14,565 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-10, Fri, 14:34:14,567 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:34:14,968 aiogram.event INFO Update id=450710007 is handled. Duration 1467 ms by bot id=7771835226
2025-01-10, Fri, 14:34:20,161 aiogram.event INFO Update id=450710008 is handled. Duration 312 ms by bot id=7771835226
2025-01-10, Fri, 14:34:26,937 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:34:26,937 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:34:26,938 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:34:26,941 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:34:26,941 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:34:26,943 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:34:26,948 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

2025-01-10, Fri, 14:35:26,954 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:35:26,955 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:35:26,956 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:35:26,958 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:35:26,959 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

2025-01-10, Fri, 14:35:31,513 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:35:31,514 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:35:31,514 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:35:31,766 aiogram.event INFO Update id=450710009 is not handled. Duration 64829 ms by bot id=7771835226
2025-01-10, Fri, 14:36:09,574 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:36:09,628 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:36:13,641 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:36:13,641 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:36:13,643 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:36:13,643 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:36:13,644 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:36:13,645 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:36:13,645 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:13,652 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:13,652 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (2142024077,)
2025-01-10, Fri, 14:36:13,654 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:13,948 aiogram.event INFO Update id=450710010 is handled. Duration 1031 ms by bot id=7771835226
2025-01-10, Fri, 14:36:18,103 aiogram.event INFO Update id=450710011 is handled. Duration 162 ms by bot id=7771835226
2025-01-10, Fri, 14:36:23,369 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:36:23,369 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:36:23,370 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:23,373 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-10, Fri, 14:36:23,374 sqlalchemy.engine.Engine INFO [generated in 0.00031s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:36:23,376 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 14:36:23,378 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 14:36:23,485 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:23,485 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:23,485 sqlalchemy.engine.Engine INFO [cached since 9.834s ago] (2142024077,)
2025-01-10, Fri, 14:36:23,486 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:23,487 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:23,487 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:23,487 sqlalchemy.engine.Engine INFO [cached since 9.836s ago] (2142024077,)
2025-01-10, Fri, 14:36:23,488 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:23,600 aiogram.event INFO Update id=450710012 is handled. Duration 230 ms by bot id=7771835226
2025-01-10, Fri, 14:36:40,540 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:40,540 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:40,540 sqlalchemy.engine.Engine INFO [cached since 26.89s ago] (7675368439,)
2025-01-10, Fri, 14:36:40,541 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:40,677 aiogram.event INFO Update id=450710013 is handled. Duration 215 ms by bot id=7771835226
2025-01-10, Fri, 14:36:44,393 aiogram.event INFO Update id=450710014 is handled. Duration 91 ms by bot id=7771835226
2025-01-10, Fri, 14:36:45,726 root INFO REGISTRATION DATA: Dm_dev_acc, Девид, None, False
2025-01-10, Fri, 14:36:45,726 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:36:45,726 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:45,727 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-10, Fri, 14:36:45,727 sqlalchemy.engine.Engine INFO [cached since 22.35s ago] (7675368439, 'Dm_dev_acc', 'Девид', None, False, 0)
2025-01-10, Fri, 14:36:45,728 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 14:36:45,730 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 14:36:45,790 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:45,790 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:45,791 sqlalchemy.engine.Engine INFO [cached since 32.14s ago] (7675368439,)
2025-01-10, Fri, 14:36:45,792 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:45,877 aiogram.event INFO Update id=450710015 is handled. Duration 152 ms by bot id=7771835226
2025-01-10, Fri, 14:36:59,861 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:36:59,861 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:36:59,862 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:28:16,678 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:28:16,763 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:28:28,192 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:28:28,193 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:28:28,195 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:28:28,195 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:28:28,197 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:28:28,197 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:28:28,199 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:28:28,210 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:28:28,210 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (2142024077,)
2025-01-12, Sun, 08:28:28,214 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:28:28,304 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:28:28,305 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:28:28,305 sqlalchemy.engine.Engine INFO [cached since 0.09529s ago] (2142024077,)
2025-01-12, Sun, 08:28:28,307 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:28:28,309 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:28:28,310 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:28:28,310 sqlalchemy.engine.Engine INFO [cached since 0.09981s ago] (2142024077,)
2025-01-12, Sun, 08:28:28,312 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:28:28,371 aiogram.event INFO Update id=450710016 is handled. Duration 644 ms by bot id=7771835226
2025-01-12, Sun, 08:28:30,806 aiogram.event INFO Update id=450710017 is handled. Duration 77 ms by bot id=7771835226
2025-01-12, Sun, 08:28:49,486 aiogram.event INFO Update id=450710018 is not handled. Duration 0 ms by bot id=7771835226
2025-01-12, Sun, 08:29:51,568 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:29:51,569 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:29:51,569 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:32:55,191 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:32:55,331 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:32:58,126 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:32:58,126 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:32:58,128 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:32:58,128 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:32:58,129 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:32:58,129 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:32:58,130 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:32:58,140 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:32:58,140 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-12, Sun, 08:32:58,144 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:32:58,219 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:32:58,220 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:32:58,220 sqlalchemy.engine.Engine INFO [cached since 0.08015s ago] (2142024077,)
2025-01-12, Sun, 08:32:58,222 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:32:58,224 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:32:58,225 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:32:58,225 sqlalchemy.engine.Engine INFO [cached since 0.08508s ago] (2142024077,)
2025-01-12, Sun, 08:32:58,227 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:32:58,442 aiogram.event INFO Update id=450710019 is handled. Duration 834 ms by bot id=7771835226
2025-01-12, Sun, 08:33:03,885 aiogram.event INFO Update id=450710020 is handled. Duration 118 ms by bot id=7771835226
2025-01-12, Sun, 08:33:11,514 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:33:11,515 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:33:11,515 sqlalchemy.engine.Engine INFO [cached since 13.37s ago] (Message(message_id=860, date=datetime.datetime(2025, 1, 12, 5, 33, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:33:11,517 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:33:11,518 aiogram.event INFO Update id=450710021 is not handled. Duration 4 ms by bot id=7771835226
2025-01-12, Sun, 08:33:11,518 aiogram.event ERROR Cause exception while process update id=450710021 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=860, date=datetime.datetime(2025, 1, 12, 5, 33, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=860, date=datetime.datetime(2025, 1, 12, 5, 33, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:35:09,929 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:35:09,929 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:35:09,929 sqlalchemy.engine.Engine INFO [cached since 131.8s ago] (Message(message_id=861, date=datetime.datetime(2025, 1, 12, 5, 35, 9, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3029 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:35:09,930 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:35:09,931 aiogram.event INFO Update id=450710022 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 08:35:09,931 aiogram.event ERROR Cause exception while process update id=450710022 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=861, date=datetime.datetime(2025, 1, 12, 5, 35, 9, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3029 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=861, date=datetime.datetime(2025, 1, 12, 5, 35, 9, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3029 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:42:28,79 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:42:28,80 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:42:28,80 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:42:32,614 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:42:32,660 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:42:37,194 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:42:37,194 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:42:37,197 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:42:37,197 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:42:37,198 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:42:37,198 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:42:37,200 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:37,209 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:37,209 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-12, Sun, 08:42:37,213 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:37,580 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:37,580 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:37,581 sqlalchemy.engine.Engine INFO [cached since 0.3714s ago] (2142024077,)
2025-01-12, Sun, 08:42:37,582 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:37,584 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:37,584 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:37,585 sqlalchemy.engine.Engine INFO [cached since 0.3753s ago] (2142024077,)
2025-01-12, Sun, 08:42:37,586 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:37,720 aiogram.event INFO Update id=450710023 is handled. Duration 1223 ms by bot id=7771835226
2025-01-12, Sun, 08:42:40,51 aiogram.event INFO Update id=450710024 is handled. Duration 89 ms by bot id=7771835226
2025-01-12, Sun, 08:42:46,899 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:46,899 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:46,899 sqlalchemy.engine.Engine INFO [cached since 9.69s ago] (Message(message_id=867, date=datetime.datetime(2025, 1, 12, 5, 42, 46, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:42:46,901 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:46,902 aiogram.event INFO Update id=450710025 is not handled. Duration 4 ms by bot id=7771835226
2025-01-12, Sun, 08:42:46,902 aiogram.event ERROR Cause exception while process update id=450710025 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=867, date=datetime.datetime(2025, 1, 12, 5, 42, 46, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=867, date=datetime.datetime(2025, 1, 12, 5, 42, 46, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:44:02,983 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:44:02,984 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:44:02,984 sqlalchemy.engine.Engine INFO [cached since 85.77s ago] (Message(message_id=868, date=datetime.datetime(2025, 1, 12, 5, 44, 2, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3139 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:44:02,985 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:44:02,986 aiogram.event INFO Update id=450710026 is not handled. Duration 5 ms by bot id=7771835226
2025-01-12, Sun, 08:44:02,986 aiogram.event ERROR Cause exception while process update id=450710026 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=868, date=datetime.datetime(2025, 1, 12, 5, 44, 2, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3139 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=868, date=datetime.datetime(2025, 1, 12, 5, 44, 2, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3139 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:52:57,972 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:52:57,972 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:52:57,972 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:53:02,206 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:53:02,253 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:53:04,395 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:53:04,395 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:53:04,398 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:53:04,398 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:53:04,400 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:53:04,400 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:53:04,403 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:53:04,410 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:53:04,410 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (2142024077,)
2025-01-12, Sun, 08:53:04,413 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:53:04,492 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:53:04,492 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:53:04,493 sqlalchemy.engine.Engine INFO [cached since 0.0827s ago] (2142024077,)
2025-01-12, Sun, 08:53:04,494 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:53:04,495 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:53:04,495 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:53:04,495 sqlalchemy.engine.Engine INFO [cached since 0.08558s ago] (2142024077,)
2025-01-12, Sun, 08:53:04,497 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:53:04,873 aiogram.event INFO Update id=450710027 is handled. Duration 902 ms by bot id=7771835226
2025-01-12, Sun, 08:53:06,685 aiogram.event INFO Update id=450710028 is handled. Duration 101 ms by bot id=7771835226
2025-01-12, Sun, 08:53:11,457 aiogram.event INFO Update id=450710029 is not handled. Duration 235 ms by bot id=7771835226
2025-01-12, Sun, 08:53:11,457 aiogram.event ERROR Cause exception while process update id=450710029 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message identifier is not specified
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.edit_message_text('Введите цену')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 1588, in edit_message_text
    return await self(call, request_timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message identifier is not specified
2025-01-12, Sun, 08:54:11,455 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:54:11,455 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:54:11,455 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:55:48,427 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:55:48,525 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:55:50,15 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:55:50,15 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:55:50,19 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:55:50,19 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:55:50,21 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:55:50,21 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:55:50,23 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:55:50,30 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:55:50,30 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-12, Sun, 08:55:50,34 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:55:50,250 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:55:50,250 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:55:50,251 sqlalchemy.engine.Engine INFO [cached since 0.2206s ago] (2142024077,)
2025-01-12, Sun, 08:55:50,253 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:55:50,254 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:55:50,255 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:55:50,255 sqlalchemy.engine.Engine INFO [cached since 0.225s ago] (2142024077,)
2025-01-12, Sun, 08:55:50,257 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:55:50,355 aiogram.event INFO Update id=450710030 is handled. Duration 697 ms by bot id=7771835226
2025-01-12, Sun, 08:55:51,320 aiogram.event INFO Update id=450710031 is handled. Duration 71 ms by bot id=7771835226
2025-01-12, Sun, 08:55:56,906 aiogram.event INFO Update id=450710032 is not handled. Duration 0 ms by bot id=7771835226
2025-01-12, Sun, 08:55:56,906 aiogram.event ERROR Cause exception while process update id=450710032 by bot id=7771835226
ValidationError: 1 validation error for EditMessageText
text
  Input should be a valid string [type=string_type, input_value=2142024077, input_type=int]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.edit_message_text(message.from_user.id,'Введите цену')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 1576, in edit_message_text
    call = EditMessageText(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
text
  Input should be a valid string [type=string_type, input_value=2142024077, input_type=int]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
2025-01-12, Sun, 08:57:30,885 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:57:30,885 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:57:30,885 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:59:12,99 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:59:12,487 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:59:13,952 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:59:13,952 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:59:13,955 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:59:13,955 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:59:13,957 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:59:13,957 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:59:13,958 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:59:13,965 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:59:13,965 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-12, Sun, 08:59:13,969 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:59:14,203 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:59:14,204 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:59:14,204 sqlalchemy.engine.Engine INFO [cached since 0.2391s ago] (2142024077,)
2025-01-12, Sun, 08:59:14,205 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:59:14,206 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:59:14,207 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:59:14,207 sqlalchemy.engine.Engine INFO [cached since 0.2421s ago] (2142024077,)
2025-01-12, Sun, 08:59:14,208 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:59:14,433 aiogram.event INFO Update id=450710033 is handled. Duration 1110 ms by bot id=7771835226
2025-01-12, Sun, 08:59:15,684 aiogram.event INFO Update id=450710034 is handled. Duration 71 ms by bot id=7771835226
2025-01-12, Sun, 08:59:20,370 aiogram.event INFO Update id=450710035 is not handled. Duration 47 ms by bot id=7771835226
2025-01-12, Sun, 08:59:20,370 aiogram.event ERROR Cause exception while process update id=450710035 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message can't be edited
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.edit_message_text(chat_id = message.from_user.id,message_id=message.message_id, text= 'Введите цену')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 1588, in edit_message_text
    return await self(call, request_timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message can't be edited
2025-01-12, Sun, 09:01:31,394 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:01:31,394 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:01:31,394 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:01:35,341 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:01:35,424 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:01:38,63 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:01:38,63 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:01:38,65 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:01:38,65 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:01:38,66 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:01:38,66 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:01:38,68 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:01:38,80 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:01:38,80 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-12, Sun, 09:01:38,83 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:01:38,199 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:01:38,200 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:01:38,200 sqlalchemy.engine.Engine INFO [cached since 0.1207s ago] (2142024077,)
2025-01-12, Sun, 09:01:38,203 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:01:38,204 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:01:38,205 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:01:38,205 sqlalchemy.engine.Engine INFO [cached since 0.1251s ago] (2142024077,)
2025-01-12, Sun, 09:01:38,206 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:01:38,474 aiogram.event INFO Update id=450710036 is handled. Duration 972 ms by bot id=7771835226
2025-01-12, Sun, 09:01:39,778 aiogram.event INFO Update id=450710037 is handled. Duration 139 ms by bot id=7771835226
2025-01-12, Sun, 09:01:43,939 aiogram.event INFO Update id=450710038 is not handled. Duration 0 ms by bot id=7771835226
2025-01-12, Sun, 09:01:43,939 aiogram.event ERROR Cause exception while process update id=450710038 by bot id=7771835226
TypeError: Bot.send_message() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.send_message( text= 'Введите цену')
TypeError: Bot.send_message() missing 1 required positional argument: 'chat_id'
2025-01-12, Sun, 09:03:19,540 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:03:19,541 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:03:19,541 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:03:23,692 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:03:23,984 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:03:24,490 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:03:24,490 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:03:24,494 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:03:24,494 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:03:24,496 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:03:24,496 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:03:24,497 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:03:24,509 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:03:24,509 sqlalchemy.engine.Engine INFO [generated in 0.00084s] (2142024077,)
2025-01-12, Sun, 09:03:24,513 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:03:24,575 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:03:24,576 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:03:24,576 sqlalchemy.engine.Engine INFO [cached since 0.06748s ago] (2142024077,)
2025-01-12, Sun, 09:03:24,578 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:03:24,579 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:03:24,579 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:03:24,579 sqlalchemy.engine.Engine INFO [cached since 0.0708s ago] (2142024077,)
2025-01-12, Sun, 09:03:24,581 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:03:24,698 aiogram.event INFO Update id=450710039 is handled. Duration 455 ms by bot id=7771835226
2025-01-12, Sun, 09:03:25,876 aiogram.event INFO Update id=450710040 is handled. Duration 75 ms by bot id=7771835226
2025-01-12, Sun, 09:03:29,633 aiogram.event INFO Update id=450710041 is handled. Duration 120 ms by bot id=7771835226
2025-01-12, Sun, 09:03:36,418 aiogram.event INFO Update id=450710042 is handled. Duration 148 ms by bot id=7771835226
2025-01-12, Sun, 09:04:19,689 aiogram.event INFO Update id=450710043 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:04:19,689 aiogram.event ERROR Cause exception while process update id=450710043 by bot id=7771835226
TypeError: create_promo() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message, promos_dict[message.from_user.id])
TypeError: create_promo() takes 1 positional argument but 2 were given
2025-01-12, Sun, 09:04:44,335 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:04:44,335 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:04:44,335 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:05:52,775 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:05:52,822 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:05:57,711 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:05:57,711 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:05:57,713 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:05:57,713 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:05:57,714 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:05:57,715 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:05:57,716 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:05:57,724 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:05:57,725 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-12, Sun, 09:05:57,727 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:05:57,794 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:05:57,795 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:05:57,795 sqlalchemy.engine.Engine INFO [cached since 0.07088s ago] (2142024077,)
2025-01-12, Sun, 09:05:57,797 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:05:57,799 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:05:57,800 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:05:57,800 sqlalchemy.engine.Engine INFO [cached since 0.07562s ago] (2142024077,)
2025-01-12, Sun, 09:05:57,802 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:05:57,871 aiogram.event INFO Update id=450710044 is handled. Duration 1029 ms by bot id=7771835226
2025-01-12, Sun, 09:05:59,711 aiogram.event INFO Update id=450710045 is handled. Duration 86 ms by bot id=7771835226
2025-01-12, Sun, 09:06:11,787 aiogram.event INFO Update id=450710046 is handled. Duration 75 ms by bot id=7771835226
2025-01-12, Sun, 09:06:22,771 aiogram.event INFO Update id=450710047 is handled. Duration 326 ms by bot id=7771835226
2025-01-12, Sun, 09:06:33,681 aiogram.event INFO Update id=450710048 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:06:33,682 aiogram.event ERROR Cause exception while process update id=450710048 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
2025-01-12, Sun, 09:10:29,206 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:10:29,207 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:10:29,207 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:21:45,190 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:21:45,232 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:21:53,603 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:21:53,604 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:21:53,606 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:21:53,606 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:21:53,607 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:21:53,608 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:21:53,609 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:21:53,615 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:21:53,615 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-12, Sun, 09:21:53,618 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:21:53,882 aiogram.event INFO Update id=450710049 is handled. Duration 701 ms by bot id=7771835226
2025-01-12, Sun, 09:21:58,750 aiogram.event INFO Update id=450710050 is handled. Duration 57 ms by bot id=7771835226
2025-01-12, Sun, 09:22:06,63 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-12, Sun, 09:22:06,63 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-12, Sun, 09:22:06,64 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'dict' object has no attribute 'add'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 12, in add
    session.add(new_instance)
AttributeError: 'dict' object has no attribute 'add'

2025-01-12, Sun, 09:23:06,66 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'dict' object has no attribute 'add'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 12, in add
    session.add(new_instance)
AttributeError: 'dict' object has no attribute 'add'

2025-01-12, Sun, 09:23:09,803 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:23:09,803 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:23:09,804 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:23:10,54 aiogram.event INFO Update id=450710051 is not handled. Duration 63992 ms by bot id=7771835226
2025-01-12, Sun, 09:32:25,667 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:32:25,714 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:32:32,363 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:32:32,363 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:32:32,366 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:32:32,366 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:32:32,367 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:32:32,367 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:32:32,369 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:32,375 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:32:32,376 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (2142024077,)
2025-01-12, Sun, 09:32:32,378 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:32:32,850 aiogram.event INFO Update id=450710052 is handled. Duration 1478 ms by bot id=7771835226
2025-01-12, Sun, 09:32:37,17 aiogram.event INFO Update id=450710053 is handled. Duration 280 ms by bot id=7771835226
2025-01-12, Sun, 09:32:41,441 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-12, Sun, 09:32:41,442 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-12, Sun, 09:32:41,442 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:41,446 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-12, Sun, 09:32:41,446 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-12, Sun, 09:32:41,448 sqlalchemy.engine.Engine INFO COMMIT
2025-01-12, Sun, 09:32:41,449 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-12, Sun, 09:32:41,548 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:41,549 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:32:41,549 sqlalchemy.engine.Engine INFO [cached since 9.174s ago] (2142024077,)
2025-01-12, Sun, 09:32:41,550 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:32:41,551 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:41,551 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:32:41,551 sqlalchemy.engine.Engine INFO [cached since 9.176s ago] (2142024077,)
2025-01-12, Sun, 09:32:41,553 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:32:41,678 aiogram.event INFO Update id=450710054 is handled. Duration 236 ms by bot id=7771835226
2025-01-12, Sun, 09:33:09,473 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:33:09,474 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:33:09,474 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:33:13,448 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:33:13,494 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:33:19,554 aiogram.event INFO Update id=450710055 is handled. Duration 193 ms by bot id=7771835226
2025-01-12, Sun, 09:33:29,949 aiogram.event INFO Update id=450710056 is handled. Duration 62 ms by bot id=7771835226
2025-01-12, Sun, 09:33:33,785 aiogram.event INFO Update id=450710057 is handled. Duration 104 ms by bot id=7771835226
2025-01-12, Sun, 09:33:44,936 aiogram.event INFO Update id=450710058 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:33:44,936 aiogram.event ERROR Cause exception while process update id=450710058 by bot id=7771835226
KeyError: 'user_data'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = d['user_data'] if d['user_data'] else d['kwargs']
KeyError: 'user_data'
2025-01-12, Sun, 09:35:58,198 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:35:58,199 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:35:58,199 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:36:01,975 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:36:02,63 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:36:09,706 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:36:09,706 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:36:09,709 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:36:09,709 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:36:09,710 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:36:09,710 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:36:09,711 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:09,717 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:36:09,717 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-12, Sun, 09:36:09,719 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:09,786 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:09,787 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:36:09,787 sqlalchemy.engine.Engine INFO [cached since 0.06989s ago] (2142024077,)
2025-01-12, Sun, 09:36:09,788 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:09,789 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:09,790 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:36:09,790 sqlalchemy.engine.Engine INFO [cached since 0.07269s ago] (2142024077,)
2025-01-12, Sun, 09:36:09,791 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:10,36 aiogram.event INFO Update id=450710059 is handled. Duration 808 ms by bot id=7771835226
2025-01-12, Sun, 09:36:12,270 aiogram.event INFO Update id=450710060 is handled. Duration 236 ms by bot id=7771835226
2025-01-12, Sun, 09:36:20,241 aiogram.event INFO Update id=450710061 is handled. Duration 275 ms by bot id=7771835226
2025-01-12, Sun, 09:36:23,125 aiogram.event INFO Update id=450710062 is handled. Duration 58 ms by bot id=7771835226
2025-01-12, Sun, 09:36:29,741 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:29,743 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id
2025-01-12, Sun, 09:36:29,743 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (None, None, 0, None, None, None)
2025-01-12, Sun, 09:36:29,745 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:29,746 aiogram.event INFO Update id=450710063 is not handled. Duration 8 ms by bot id=7771835226
2025-01-12, Sun, 09:36:29,746 aiogram.event ERROR Cause exception while process update id=450710063 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: (None, None, 0, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: (None, None, 0, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-12, Sun, 09:39:37,389 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:39:37,389 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:39:37,389 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:39:41,468 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:39:41,521 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:39:44,905 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:39:44,905 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:39:44,907 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:39:44,907 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:39:44,908 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:39:44,908 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:39:44,908 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:39:44,915 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:39:44,916 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-12, Sun, 09:39:44,918 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:39:45,280 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:39:45,281 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:39:45,281 sqlalchemy.engine.Engine INFO [cached since 0.3655s ago] (2142024077,)
2025-01-12, Sun, 09:39:45,282 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:39:45,283 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:39:45,283 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:39:45,283 sqlalchemy.engine.Engine INFO [cached since 0.3681s ago] (2142024077,)
2025-01-12, Sun, 09:39:45,285 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:39:45,393 aiogram.event INFO Update id=450710064 is handled. Duration 698 ms by bot id=7771835226
2025-01-12, Sun, 09:39:46,573 aiogram.event INFO Update id=450710065 is handled. Duration 99 ms by bot id=7771835226
2025-01-12, Sun, 09:39:50,114 aiogram.event INFO Update id=450710066 is handled. Duration 128 ms by bot id=7771835226
2025-01-12, Sun, 09:39:52,778 aiogram.event INFO Update id=450710067 is handled. Duration 59 ms by bot id=7771835226
2025-01-12, Sun, 09:39:58,510 aiogram.event INFO Update id=450710068 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 09:39:58,510 aiogram.event ERROR Cause exception while process update id=450710068 by bot id=7771835226
TypeError: db.dao.BaseDAO.add() argument after ** must be a mapping, not tuple
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: db.dao.BaseDAO.add() argument after ** must be a mapping, not tuple
2025-01-12, Sun, 09:40:55,417 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:40:55,418 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:40:55,418 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:40:59,539 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:40:59,691 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:41:02,882 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:41:02,882 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:41:02,884 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:41:02,884 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:41:02,886 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:41:02,886 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:41:02,887 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:41:02,893 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:41:02,894 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-12, Sun, 09:41:02,896 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:41:02,986 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:41:02,986 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:41:02,987 sqlalchemy.engine.Engine INFO [cached since 0.0933s ago] (2142024077,)
2025-01-12, Sun, 09:41:02,988 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:41:02,988 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:41:02,989 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:41:02,989 sqlalchemy.engine.Engine INFO [cached since 0.09545s ago] (2142024077,)
2025-01-12, Sun, 09:41:02,990 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:41:03,151 aiogram.event INFO Update id=450710069 is handled. Duration 441 ms by bot id=7771835226
2025-01-12, Sun, 09:41:04,566 aiogram.event INFO Update id=450710070 is handled. Duration 193 ms by bot id=7771835226
2025-01-12, Sun, 09:41:10,678 aiogram.event INFO Update id=450710071 is handled. Duration 104 ms by bot id=7771835226
2025-01-12, Sun, 09:41:13,449 aiogram.event INFO Update id=450710072 is handled. Duration 110 ms by bot id=7771835226
2025-01-12, Sun, 09:41:18,154 aiogram.event INFO Update id=450710073 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:41:18,154 aiogram.event ERROR Cause exception while process update id=450710073 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
2025-01-12, Sun, 09:43:39,285 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:43:39,285 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:43:39,286 aiogram.dispatcher INFO Polling stopped
