2025-01-03, Fri, 13:32:37,46 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:32:37,342 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:32:41,10 aiogram.event INFO Update id=450709747 is handled. Duration 476 ms by bot id=7771835226
2025-01-03, Fri, 13:32:42,424 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:32:42,425 aiogram.event INFO Update id=450709748 is not handled. Duration 132 ms by bot id=7771835226
2025-01-03, Fri, 13:32:42,425 aiogram.event ERROR Cause exception while process update id=450709748 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'error'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    await async_session.add(user)
TypeError: object NoneType can't be used in 'await' expression

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 44, in get_answer_reg
    if await errh.handle_errors(partial(set_user,chat_id=message.from_user.id, username=usr[message.from_user.id]['username'], first_name=usr[message.from_user.id]['name'])):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 28, in handle_errors
    logger.error(f"Company: {company}. In function {coroutine.func.__module__}.{coroutine.func.__name__} error occurs: {e}. Try through {minutes} minutes. (Attempt number {i})\n {traceback.format_exc()}")
AttributeError: 'NoneType' object has no attribute 'error'
2025-01-03, Fri, 13:34:11,548 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:34:11,837 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:34:17,874 aiogram.event INFO Update id=450709749 is handled. Duration 1070 ms by bot id=7771835226
2025-01-03, Fri, 13:34:19,754 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:34:19,756 aiogram.event INFO Update id=450709750 is not handled. Duration 128 ms by bot id=7771835226
2025-01-03, Fri, 13:34:19,756 aiogram.event ERROR Cause exception while process update id=450709750 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'error'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    await async_session.add(user)
TypeError: object NoneType can't be used in 'await' expression

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 44, in get_answer_reg
    if await errh.handle_errors(partial(set_user,chat_id=message.from_user.id, username=usr[message.from_user.id]['username'], first_name=usr[message.from_user.id]['name'])):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 28, in handle_errors
    logger.error(f"Company: {company}. In function {coroutine.func.__module__}.{coroutine.func.__name__} error occurs: {e}. Try through {minutes} minutes. (Attempt number {i})\n {traceback.format_exc()}")
AttributeError: 'NoneType' object has no attribute 'error'
2025-01-03, Fri, 13:38:47,349 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:38:47,393 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:38:49,973 aiogram.event INFO Update id=450709751 is handled. Duration 383 ms by bot id=7771835226
2025-01-03, Fri, 13:38:51,253 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:38:51,255 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: object NoneType can't be used in 'await' expression. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    await async_session.add(user)
TypeError: object NoneType can't be used in 'await' expression

2025-01-03, Fri, 13:39:33,679 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:39:34,29 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:39:35,423 aiogram.event INFO Update id=450709753 is handled. Duration 280 ms by bot id=7771835226
2025-01-03, Fri, 13:39:36,864 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:39:36,868 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-03, Fri, 13:39:36,942 aiogram.event INFO Update id=450709754 is handled. Duration 168 ms by bot id=7771835226
2025-01-03, Fri, 13:41:32,564 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:41:32,614 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:41:36,287 aiogram.event INFO Update id=450709755 is handled. Duration 382 ms by bot id=7771835226
2025-01-03, Fri, 13:41:41,890 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:41:41,925 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:41:41,925 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:41:41,928 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:41:41,928 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:41:41,930 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:41:41,930 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:41:41,931 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:41:41,933 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:41:41,933 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-03, Fri, 13:41:41,935 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:41:41,940 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "last_name" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (1, 2142024077, DmPetrosel, Дмитрий, null, f).
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:42:41,945 aiogram.event INFO Update id=450709756 is not handled. Duration 60159 ms by bot id=7771835226
2025-01-03, Fri, 13:42:41,945 aiogram.event ERROR Cause exception while process update id=450709756 by bot id=7771835226
NameError: name 'e' is not defined
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 47, in get_answer_reg
    await bot.send_message(message.from_user.id, str('Регистрация не удалась: \n' + str(e)))
NameError: name 'e' is not defined
2025-01-03, Fri, 13:47:25,320 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:47:25,667 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:47:28,3 aiogram.event INFO Update id=450709757 is handled. Duration 295 ms by bot id=7771835226
2025-01-03, Fri, 13:47:33,493 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:47:33,520 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:47:33,520 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:47:33,522 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:47:33,522 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:47:33,523 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:47:33,524 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:47:33,524 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:47:33,526 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:47:33,526 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-03, Fri, 13:47:33,529 sqlalchemy.engine.Engine INFO COMMIT
2025-01-03, Fri, 13:47:33,532 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-03, Fri, 13:47:33,896 aiogram.event INFO Update id=450709758 is handled. Duration 712 ms by bot id=7771835226
2025-01-03, Fri, 13:49:17,92 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:49:17,901 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:49:20,947 aiogram.event INFO Update id=450709759 is handled. Duration 426 ms by bot id=7771835226
2025-01-03, Fri, 13:49:25,882 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:49:25,917 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:49:25,917 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:49:25,920 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:49:25,920 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:49:25,922 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:49:25,922 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:49:25,923 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:49:25,925 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:49:25,925 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077, 'DmPetrosel', 'Dmitriy', None, False)
2025-01-03, Fri, 13:49:25,928 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:49:25,933 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dmitriy', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dmitriy', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:50:25,940 aiogram.event INFO Update id=450709760 is not handled. Duration 60162 ms by bot id=7771835226
2025-01-03, Fri, 13:50:25,940 aiogram.event ERROR Cause exception while process update id=450709760 by bot id=7771835226
NameError: name 'e' is not defined
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 47, in get_answer_reg
    await bot.send_message(message.from_user.id, str('Регистрация не удалась: \n' + str(e)))
NameError: name 'e' is not defined
2025-01-03, Fri, 13:52:37,672 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:52:37,713 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:53:40,296 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:53:40,338 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:53:44,8 aiogram.event INFO Update id=450709761 is handled. Duration 782 ms by bot id=7771835226
2025-01-03, Fri, 13:53:50,312 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:53:50,340 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:53:50,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:53:50,342 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:53:50,342 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:53:50,343 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:53:50,344 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:53:50,345 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:53:50,347 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:53:50,347 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-03, Fri, 13:53:50,349 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:53:50,354 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:55:23,672 aiogram.dispatcher INFO Start polling
2025-01-03, Fri, 13:55:23,714 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-03, Fri, 13:55:27,654 aiogram.event INFO Update id=450709763 is handled. Duration 1105 ms by bot id=7771835226
2025-01-03, Fri, 13:55:29,601 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-03, Fri, 13:55:29,632 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-03, Fri, 13:55:29,632 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:55:29,634 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-03, Fri, 13:55:29,634 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:55:29,635 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-03, Fri, 13:55:29,635 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-03, Fri, 13:55:29,636 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-03, Fri, 13:55:29,637 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-03, Fri, 13:55:29,637 sqlalchemy.engine.Engine INFO [generated in 0.00018s] (2142024077, 'DmPetrosel', 'Dm', None, False)
2025-01-03, Fri, 13:55:29,640 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-03, Fri, 13:55:29,644 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dm', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Dm', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-03, Fri, 13:56:29,647 aiogram.event INFO Update id=450709764 is not handled. Duration 60117 ms by bot id=7771835226
2025-01-03, Fri, 13:56:29,647 aiogram.event ERROR Cause exception while process update id=450709764 by bot id=7771835226
NameError: name 'e' is not defined
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 47, in get_answer_reg
    await bot.send_message(message.from_user.id, str('Регистрация не удалась: \n' + str(e)))
NameError: name 'e' is not defined
2025-01-04, Sat, 07:06:54,346 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:06:54,668 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:07:01,905 aiogram.event INFO Update id=450709765 is handled. Duration 978 ms by bot id=7771835226
2025-01-04, Sat, 07:07:06,225 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:07:06,257 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 07:07:06,257 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:07:06,258 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 07:07:06,258 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:07:06,260 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 07:07:06,260 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:07:06,261 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 07:07:06,263 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 07:07:06,263 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077, 'DmPetrosel', 'Дмитрий', None, False)
2025-01-04, Sat, 07:07:06,266 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-04, Sat, 07:07:06,271 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-04, Sat, 07:08:06,658 aiogram.event INFO Update id=450709766 is handled. Duration 60495 ms by bot id=7771835226
2025-01-04, Sat, 07:09:16,146 aiogram.event INFO Update id=450709767 is handled. Duration 989 ms by bot id=7771835226
2025-01-04, Sat, 07:10:14,195 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:10:14,196 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(2142024077) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', None, False)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)

2025-01-04, Sat, 07:11:14,368 aiogram.event INFO Update id=450709768 is handled. Duration 60231 ms by bot id=7771835226
2025-01-04, Sat, 07:14:17,749 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 07:14:17,750 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:14:17,750 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 07:14:18,166 sqlalchemy.pool.impl.AsyncAdaptedQueuePool ERROR Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7fc67cfa16c0>>
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/pool/base.py", line 374, in _close_connection
    self._dialect.do_terminate(connection)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 1117, in do_terminate
    dbapi_connection.terminate()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 910, in terminate
    self._connection.terminate()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 1515, in terminate
    self._abort()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 1567, in _abort
    self._protocol.abort()
  File "asyncpg/protocol/protocol.pyx", line 608, in asyncpg.protocol.protocol.BaseProtocol.abort
  File "/usr/lib/python3.10/asyncio/selector_events.py", line 686, in abort
    self._force_close(None)
  File "/usr/lib/python3.10/asyncio/selector_events.py", line 737, in _force_close
    self._loop.call_soon(self._call_connection_lost, exc)
  File "/usr/lib/python3.10/asyncio/base_events.py", line 753, in call_soon
    self._check_closed()
  File "/usr/lib/python3.10/asyncio/base_events.py", line 515, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-01-04, Sat, 07:14:18,168 sqlalchemy.pool.impl.AsyncAdaptedQueuePool ERROR The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <asyncpg.connection.Connection object at 0x7fc67cfa16c0>>, which will be terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-01-04, Sat, 07:16:34,136 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:16:34,181 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:16:42,162 aiogram.event INFO Update id=450709769 is handled. Duration 1313 ms by bot id=7771835226
2025-01-04, Sat, 07:16:46,253 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:16:46,255 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: 'async_sessionmaker' object has no attribute 'add'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 6, in set_user
    async_session.add(user)
AttributeError: 'async_sessionmaker' object has no attribute 'add'

2025-01-04, Sat, 07:17:46,350 aiogram.event INFO Update id=450709770 is handled. Duration 60295 ms by bot id=7771835226
2025-01-04, Sat, 07:19:35,882 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:19:36,26 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:19:39,280 aiogram.event INFO Update id=450709771 is handled. Duration 1145 ms by bot id=7771835226
2025-01-04, Sat, 07:19:42,247 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:19:42,275 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 07:19:42,275 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:19:42,277 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 07:19:42,277 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:19:42,278 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 07:19:42,278 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:19:42,279 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 07:19:42,280 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 07:19:42,280 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (7675368439, 'Dm_dev_acc', 'David', None, False)
2025-01-04, Sat, 07:19:42,282 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-04, Sat, 07:19:42,286 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 60, in asyncpg.pgproto.pgproto.int4_encode
OverflowError: value out of int32 range

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: 7675368439 (value out of int32 range)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)

2025-01-04, Sat, 07:20:42,290 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi) (Background on this error at: https://sqlalche.me/e/20/7s2a). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 7675368439 (value out of int32 range)
[SQL: INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'David', None, False)]
(Background on this error at: https://sqlalche.me/e/20/dbapi) (Background on this error at: https://sqlalche.me/e/20/7s2a)

2025-01-04, Sat, 07:24:39,642 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 07:24:40,8 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:24:45,636 aiogram.event INFO Update id=450709773 is handled. Duration 2335 ms by bot id=7771835226
2025-01-04, Sat, 07:24:48,179 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 07:24:48,208 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 07:24:48,208 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:24:48,210 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 07:24:48,210 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:24:48,211 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 07:24:48,211 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 07:24:48,212 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 07:24:48,213 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, last_name, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 07:24:48,213 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (7675368439, 'Dm_dev_acc', 'David', None, False)
2025-01-04, Sat, 07:24:48,216 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 07:24:48,218 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 07:24:48,280 aiogram.event INFO Update id=450709774 is handled. Duration 265 ms by bot id=7771835226
2025-01-04, Sat, 07:27:18,418 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 07:27:18,419 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 07:27:18,419 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 11:22:09,68 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:22:09,113 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:22:16,6 aiogram.event INFO Update id=450709775 is handled. Duration 751 ms by bot id=7771835226
2025-01-04, Sat, 11:22:25,474 aiogram.event INFO Update id=450709776 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:22:25,475 aiogram.event ERROR Cause exception while process update id=450709776 by bot id=7771835226
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/app/keyboard/basic_kb.py", line 5, in no_promo_kb
    return InlineKeyboardBuilder().add(InlineKeyboardButton('Продолжить без промокода', callback_data='no_promo'))
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-01-04, Sat, 11:24:19,59 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:24:19,103 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:24:24,109 aiogram.event INFO Update id=450709777 is handled. Duration 698 ms by bot id=7771835226
2025-01-04, Sat, 11:24:28,441 aiogram.event INFO Update id=450709778 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:24:28,441 aiogram.event ERROR Cause exception while process update id=450709778 by bot id=7771835226
ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 2948, in send_message
    call = SendMessage(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 4 validation errors for SendMessage
reply_markup.InlineKeyboardMarkup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardMarkup
  Input should be a valid dictionary or instance of ReplyKeyboardMarkup [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ReplyKeyboardRemove
  Input should be a valid dictionary or instance of ReplyKeyboardRemove [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
reply_markup.ForceReply
  Input should be a valid dictionary or instance of ForceReply [type=model_type, input_value=<aiogram.utils.keyboard.I...bject at 0x71b69f9da980>, input_type=InlineKeyboardBuilder]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-01-04, Sat, 11:28:32,224 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:28:32,266 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:28:36,23 aiogram.event INFO Update id=450709779 is handled. Duration 366 ms by bot id=7771835226
2025-01-04, Sat, 11:28:42,484 aiogram.event INFO Update id=450709780 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:28:42,485 aiogram.event ERROR Cause exception while process update id=450709780 by bot id=7771835226
ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/app/keyboard/basic_kb.py", line 6, in no_promo_kb
    return InlineKeyboardMarkup().add(InlineKeyboardButton(text='Продолжить без промокода', callback_data='no_promo'))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.10/v/missing
2025-01-04, Sat, 11:31:45,28 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:31:45,73 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:31:47,925 aiogram.event INFO Update id=450709781 is handled. Duration 321 ms by bot id=7771835226
2025-01-04, Sat, 11:31:53,126 aiogram.event INFO Update id=450709782 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:31:53,126 aiogram.event ERROR Cause exception while process update id=450709782 by bot id=7771835226
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 48, in get_answer_reg
    await bot.send_message(message.from_user.id, f"Введите промокод.", reply_markup=no_promo_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/app/keyboard/basic_kb.py", line 6, in no_promo_kb
    return InlineKeyboardMarkup([InlineKeyboardButton(text='Продолжить без промокода', callback_data='no_promo')])
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-01-04, Sat, 11:36:32,357 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:36:32,403 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:36:35,506 aiogram.event INFO Update id=450709783 is handled. Duration 297 ms by bot id=7771835226
2025-01-04, Sat, 11:36:37,822 aiogram.event INFO Update id=450709784 is handled. Duration 107 ms by bot id=7771835226
2025-01-04, Sat, 11:36:54,422 aiogram.event INFO Update id=450709785 is handled. Duration 120 ms by bot id=7771835226
2025-01-04, Sat, 11:37:13,140 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 11:37:13,141 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:37:13,141 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 11:37:50,594 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:37:50,637 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:37:55,799 aiogram.event INFO Update id=450709786 is handled. Duration 285 ms by bot id=7771835226
2025-01-04, Sat, 11:37:59,836 aiogram.event INFO Update id=450709787 is handled. Duration 99 ms by bot id=7771835226
2025-01-04, Sat, 11:38:08,441 aiogram.event INFO Update id=450709788 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:43:55,814 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:43:56,190 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:43:58,942 aiogram.event INFO Update id=450709789 is handled. Duration 414 ms by bot id=7771835226
2025-01-04, Sat, 11:44:02,951 aiogram.event INFO Update id=450709790 is handled. Duration 105 ms by bot id=7771835226
2025-01-04, Sat, 11:44:16,881 aiogram.event INFO Update id=450709791 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:50:05,13 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:50:05,63 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:50:09,87 aiogram.event INFO Update id=450709792 is handled. Duration 303 ms by bot id=7771835226
2025-01-04, Sat, 11:50:12,44 aiogram.event INFO Update id=450709793 is handled. Duration 101 ms by bot id=7771835226
2025-01-04, Sat, 11:50:18,663 aiogram.event INFO Update id=450709794 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:51:07,713 aiogram.event INFO Update id=450709795 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:51:27,814 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 11:51:27,814 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:51:27,814 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 11:52:50,241 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:52:50,305 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:52:54,909 aiogram.event INFO Update id=450709796 is handled. Duration 287 ms by bot id=7771835226
2025-01-04, Sat, 11:52:57,3 aiogram.event INFO Update id=450709797 is handled. Duration 58 ms by bot id=7771835226
2025-01-04, Sat, 11:53:07,113 aiogram.event INFO Update id=450709798 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:59:19,265 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 11:59:19,311 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 11:59:22,952 aiogram.event INFO Update id=450709799 is handled. Duration 422 ms by bot id=7771835226
2025-01-04, Sat, 11:59:24,847 aiogram.event INFO Update id=450709800 is handled. Duration 61 ms by bot id=7771835226
2025-01-04, Sat, 11:59:26,708 aiogram.event INFO Update id=450709801 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 11:59:31,133 aiogram.event INFO Update id=450709802 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:00:05,547 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:00:05,928 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:00:07,658 aiogram.event INFO Update id=450709803 is handled. Duration 406 ms by bot id=7771835226
2025-01-04, Sat, 12:00:12,563 aiogram.event INFO Update id=450709804 is handled. Duration 63 ms by bot id=7771835226
2025-01-04, Sat, 12:00:17,222 root INFO Company: unnamed_company. Run function db.get.get_bot_price
2025-01-04, Sat, 12:00:17,223 root ERROR Company: unnamed_company. In function db.get.get_bot_price error occurs: 'AsyncSession' object has no attribute 'query'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 8, in get_bot_price
    return await async_session.query(Promo).get(promocode).price
AttributeError: 'AsyncSession' object has no attribute 'query'

2025-01-04, Sat, 12:01:17,230 root ERROR Company: unnamed_company. In function db.get.get_bot_price error occurs: 'AsyncSession' object has no attribute 'query'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 8, in get_bot_price
    return await async_session.query(Promo).get(promocode).price
AttributeError: 'AsyncSession' object has no attribute 'query'

2025-01-04, Sat, 12:02:17,234 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, я маретолог, False
2025-01-04, Sat, 12:02:17,234 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:02:17,263 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:02:17,263 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:02:17,265 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:02:17,265 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:02:17,266 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:02:17,266 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:02:17,267 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:02:17,269 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:02:17,269 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077, 'DmPetrosel', 'Дмитрий', 'я маретолог', False)
2025-01-04, Sat, 12:02:17,271 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:02:17,273 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:02:17,421 aiogram.event INFO Update id=450709805 is handled. Duration 120198 ms by bot id=7771835226
2025-01-04, Sat, 12:10:54,327 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:10:54,369 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:10:59,205 aiogram.event INFO Update id=450709806 is handled. Duration 735 ms by bot id=7771835226
2025-01-04, Sat, 12:11:02,216 aiogram.event INFO Update id=450709807 is handled. Duration 463 ms by bot id=7771835226
2025-01-04, Sat, 12:11:17,980 root INFO REGISTRATION DATA: DmPetrosel, Dm, ямаркетолог, True
2025-01-04, Sat, 12:11:17,981 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:11:18,9 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:11:18,9 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:11:18,10 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:11:18,10 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:11:18,11 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:11:18,11 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:11:18,12 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:11:18,14 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:11:18,14 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (2142024077, 'DmPetrosel', 'Dm', 'ямаркетолог', True)
2025-01-04, Sat, 12:11:18,16 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:11:18,18 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:11:18,395 aiogram.event INFO Update id=450709808 is handled. Duration 414 ms by bot id=7771835226
2025-01-04, Sat, 12:11:51,161 aiogram.event INFO Update id=450709809 is handled. Duration 807 ms by bot id=7771835226
2025-01-04, Sat, 12:11:55,343 aiogram.event INFO Update id=450709810 is handled. Duration 60 ms by bot id=7771835226
2025-01-04, Sat, 12:11:57,818 aiogram.event INFO Update id=450709811 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:19:03,217 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:19:03,263 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:19:05,949 aiogram.event INFO Update id=450709812 is handled. Duration 369 ms by bot id=7771835226
2025-01-04, Sat, 12:19:09,202 aiogram.event INFO Update id=450709813 is handled. Duration 203 ms by bot id=7771835226
2025-01-04, Sat, 12:19:11,571 aiogram.event INFO Update id=450709814 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:22:07,953 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:22:07,999 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:22:11,23 aiogram.event INFO Update id=450709815 is handled. Duration 308 ms by bot id=7771835226
2025-01-04, Sat, 12:22:13,434 aiogram.event INFO Update id=450709816 is handled. Duration 111 ms by bot id=7771835226
2025-01-04, Sat, 12:22:15,268 aiogram.event INFO Update id=450709817 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:37:29,617 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:37:30,2 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:37:34,724 aiogram.event INFO Update id=450709818 is handled. Duration 454 ms by bot id=7771835226
2025-01-04, Sat, 12:37:41,508 aiogram.event INFO Update id=450709819 is handled. Duration 93 ms by bot id=7771835226
2025-01-04, Sat, 12:40:32,241 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:40:32,289 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:40:37,672 aiogram.event INFO Update id=450709820 is handled. Duration 732 ms by bot id=7771835226
2025-01-04, Sat, 12:40:40,327 aiogram.event INFO Update id=450709821 is handled. Duration 81 ms by bot id=7771835226
2025-01-04, Sat, 12:41:28,165 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:41:28,208 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:41:30,691 aiogram.event INFO Update id=450709822 is handled. Duration 291 ms by bot id=7771835226
2025-01-04, Sat, 12:41:32,902 aiogram.event INFO Update id=450709823 is handled. Duration 72 ms by bot id=7771835226
2025-01-04, Sat, 12:41:34,703 aiogram.event INFO Update id=450709824 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:41:34,703 aiogram.event ERROR Cause exception while process update id=450709824 by bot id=7771835226
KeyError: 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 86, in callback_selling
    await promo_continue(callback.from_user.id, price, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 90, in promo_continue
    await write_registration(chat_id, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 73, in write_registration
    logging.info(f"REGISTRATION DATA: {usr[chat_id]['username']}, {usr[chat_id]['name']}, {usr[chat_id]['promocode']}, {usr[chat_id]['marketer']}")
KeyError: 'promocode'
2025-01-04, Sat, 12:42:40,358 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:42:40,688 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:42:43,143 aiogram.event INFO Update id=450709825 is handled. Duration 682 ms by bot id=7771835226
2025-01-04, Sat, 12:42:45,92 aiogram.event INFO Update id=450709826 is handled. Duration 78 ms by bot id=7771835226
2025-01-04, Sat, 12:42:46,338 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, None
2025-01-04, Sat, 12:42:46,338 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:42:46,367 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:42:46,367 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:42:46,369 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:42:46,369 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:42:46,370 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:42:46,370 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:42:46,371 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:42:46,373 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:42:46,373 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (7675368439, 'Dm_dev_acc', 'Devid', None, None)
2025-01-04, Sat, 12:42:46,375 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-04, Sat, 12:42:46,379 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-04, Sat, 12:43:46,383 root ERROR Company: unnamed_company. In function db.set.set_user error occurs: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 7, in set_user
    await async_session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "is_admin" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (10, 7675368439, Dm_dev_acc, Devid, null, null).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)

2025-01-04, Sat, 12:44:46,518 aiogram.event INFO Update id=450709827 is handled. Duration 120180 ms by bot id=7771835226
2025-01-04, Sat, 12:45:38,396 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:45:38,551 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:45:40,29 aiogram.event INFO Update id=450709828 is handled. Duration 313 ms by bot id=7771835226
2025-01-04, Sat, 12:45:42,457 aiogram.event INFO Update id=450709829 is handled. Duration 63 ms by bot id=7771835226
2025-01-04, Sat, 12:45:44,797 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-04, Sat, 12:45:44,797 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:45:44,839 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:45:44,840 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:45:44,841 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:45:44,842 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:45:44,843 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:45:44,843 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:45:44,844 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:45:44,845 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:45:44,845 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-04, Sat, 12:45:44,848 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:45:44,849 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:45:45,108 aiogram.event INFO Update id=450709830 is handled. Duration 312 ms by bot id=7771835226
2025-01-04, Sat, 12:45:49,1 aiogram.event INFO Update id=450709831 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:53:00,821 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:53:00,867 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:53:08,612 aiogram.event INFO Update id=450709832 is handled. Duration 1421 ms by bot id=7771835226
2025-01-04, Sat, 12:53:13,35 aiogram.event INFO Update id=450709833 is handled. Duration 126 ms by bot id=7771835226
2025-01-04, Sat, 12:53:15,125 aiogram.event INFO Update id=450709834 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:54:53,567 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 12:54:53,611 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 12:54:59,545 aiogram.event INFO Update id=450709835 is handled. Duration 1143 ms by bot id=7771835226
2025-01-04, Sat, 12:55:02,148 aiogram.event INFO Update id=450709836 is handled. Duration 63 ms by bot id=7771835226
2025-01-04, Sat, 12:55:03,603 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-04, Sat, 12:55:03,603 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 12:55:03,631 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 12:55:03,631 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:55:03,633 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 12:55:03,633 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:55:03,634 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 12:55:03,634 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 12:55:03,635 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 12:55:03,637 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 12:55:03,637 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-04, Sat, 12:55:03,640 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 12:55:03,641 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 12:55:03,827 aiogram.event INFO Update id=450709837 is handled. Duration 225 ms by bot id=7771835226
2025-01-04, Sat, 12:55:06,382 aiogram.event INFO Update id=450709838 is handled. Duration 68 ms by bot id=7771835226
2025-01-04, Sat, 12:55:33,613 aiogram.event INFO Update id=450709839 is handled. Duration 721 ms by bot id=7771835226
2025-01-04, Sat, 12:55:36,65 aiogram.event INFO Update id=450709840 is handled. Duration 188 ms by bot id=7771835226
2025-01-04, Sat, 12:55:43,132 root ERROR Message(message_id=386, date=datetime.datetime(2025, 1, 4, 9, 55, 43, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, username='DmPetrosel', first_name='Dmitriy', last_name='Petrov', is_forum=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None), message_thread_id=None, from_user=User(id=2142024077, is_bot=False, first_name='Dmitriy', last_name='Petrov', username='DmPetrosel', language_code='en', is_premium=None, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None), sender_chat=None, sender_boost_count=None, sender_business_bot=None, business_connection_id=None, forward_origin=None, is_topic_message=None, is_automatic_forward=None, reply_to_message=None, external_reply=None, quote=None, reply_to_story=None, via_bot=None, edit_date=None, has_protected_content=None, is_from_offline=None, media_group_id=None, author_signature=None, text='Я маркетолог', entities=None, link_preview_options=None, effect_id=None, animation=None, audio=None, document=None, paid_media=None, photo=None, sticker=None, story=None, video=None, video_note=None, voice=None, caption=None, caption_entities=None, show_caption_above_media=None, has_media_spoiler=None, contact=None, dice=None, game=None, poll=None, venue=None, location=None, new_chat_members=None, left_chat_member=None, new_chat_title=None, new_chat_photo=None, delete_chat_photo=None, group_chat_created=None, supergroup_chat_created=None, channel_chat_created=None, message_auto_delete_timer_changed=None, migrate_to_chat_id=None, migrate_from_chat_id=None, pinned_message=None, invoice=None, successful_payment=None, refunded_payment=None, users_shared=None, chat_shared=None, connected_website=None, write_access_allowed=None, passport_data=None, proximity_alert_triggered=None, boost_added=None, chat_background_set=None, forum_topic_created=None, forum_topic_edited=None, forum_topic_closed=None, forum_topic_reopened=None, general_forum_topic_hidden=None, general_forum_topic_unhidden=None, giveaway_created=None, giveaway=None, giveaway_winners=None, giveaway_completed=None, video_chat_scheduled=None, video_chat_started=None, video_chat_ended=None, video_chat_participants_invited=None, web_app_data=None, reply_markup=None, forward_date=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None)
2025-01-04, Sat, 12:55:43,132 aiogram.event INFO Update id=450709841 is handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:57:27,797 aiogram.event INFO Update id=450709842 is not handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 12:58:30,254 aiogram.event INFO Update id=450709843 is handled. Duration 1233 ms by bot id=7771835226
2025-01-04, Sat, 12:58:36,245 aiogram.event INFO Update id=450709844 is handled. Duration 261 ms by bot id=7771835226
2025-01-04, Sat, 12:58:40,906 root ERROR Message(message_id=394, date=datetime.datetime(2025, 1, 4, 9, 58, 40, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, username='DmPetrosel', first_name='Dmitriy', last_name='Petrov', is_forum=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None), message_thread_id=None, from_user=User(id=2142024077, is_bot=False, first_name='Dmitriy', last_name='Petrov', username='DmPetrosel', language_code='en', is_premium=None, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None), sender_chat=None, sender_boost_count=None, sender_business_bot=None, business_connection_id=None, forward_origin=None, is_topic_message=None, is_automatic_forward=None, reply_to_message=None, external_reply=None, quote=None, reply_to_story=None, via_bot=None, edit_date=None, has_protected_content=None, is_from_offline=None, media_group_id=None, author_signature=None, text='Я маркетолог', entities=None, link_preview_options=None, effect_id=None, animation=None, audio=None, document=None, paid_media=None, photo=None, sticker=None, story=None, video=None, video_note=None, voice=None, caption=None, caption_entities=None, show_caption_above_media=None, has_media_spoiler=None, contact=None, dice=None, game=None, poll=None, venue=None, location=None, new_chat_members=None, left_chat_member=None, new_chat_title=None, new_chat_photo=None, delete_chat_photo=None, group_chat_created=None, supergroup_chat_created=None, channel_chat_created=None, message_auto_delete_timer_changed=None, migrate_to_chat_id=None, migrate_from_chat_id=None, pinned_message=None, invoice=None, successful_payment=None, refunded_payment=None, users_shared=None, chat_shared=None, connected_website=None, write_access_allowed=None, passport_data=None, proximity_alert_triggered=None, boost_added=None, chat_background_set=None, forum_topic_created=None, forum_topic_edited=None, forum_topic_closed=None, forum_topic_reopened=None, general_forum_topic_hidden=None, general_forum_topic_unhidden=None, giveaway_created=None, giveaway=None, giveaway_winners=None, giveaway_completed=None, video_chat_scheduled=None, video_chat_started=None, video_chat_ended=None, video_chat_participants_invited=None, web_app_data=None, reply_markup=None, forward_date=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None)
2025-01-04, Sat, 12:58:40,906 aiogram.event INFO Update id=450709845 is handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 13:00:42,770 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 13:00:42,962 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 13:00:47,269 aiogram.event INFO Update id=450709846 is handled. Duration 1522 ms by bot id=7771835226
2025-01-04, Sat, 13:00:51,205 aiogram.event INFO Update id=450709847 is handled. Duration 256 ms by bot id=7771835226
2025-01-04, Sat, 13:00:57,98 root ERROR Message(message_id=402, date=datetime.datetime(2025, 1, 4, 10, 0, 56, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, username='DmPetrosel', first_name='Dmitriy', last_name='Petrov', is_forum=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None), message_thread_id=None, from_user=User(id=2142024077, is_bot=False, first_name='Dmitriy', last_name='Petrov', username='DmPetrosel', language_code='en', is_premium=None, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None), sender_chat=None, sender_boost_count=None, sender_business_bot=None, business_connection_id=None, forward_origin=None, is_topic_message=None, is_automatic_forward=None, reply_to_message=None, external_reply=None, quote=None, reply_to_story=None, via_bot=None, edit_date=None, has_protected_content=None, is_from_offline=None, media_group_id=None, author_signature=None, text='Я маркетолог', entities=None, link_preview_options=None, effect_id=None, animation=None, audio=None, document=None, paid_media=None, photo=None, sticker=None, story=None, video=None, video_note=None, voice=None, caption=None, caption_entities=None, show_caption_above_media=None, has_media_spoiler=None, contact=None, dice=None, game=None, poll=None, venue=None, location=None, new_chat_members=None, left_chat_member=None, new_chat_title=None, new_chat_photo=None, delete_chat_photo=None, group_chat_created=None, supergroup_chat_created=None, channel_chat_created=None, message_auto_delete_timer_changed=None, migrate_to_chat_id=None, migrate_from_chat_id=None, pinned_message=None, invoice=None, successful_payment=None, refunded_payment=None, users_shared=None, chat_shared=None, connected_website=None, write_access_allowed=None, passport_data=None, proximity_alert_triggered=None, boost_added=None, chat_background_set=None, forum_topic_created=None, forum_topic_edited=None, forum_topic_closed=None, forum_topic_reopened=None, general_forum_topic_hidden=None, general_forum_topic_unhidden=None, giveaway_created=None, giveaway=None, giveaway_winners=None, giveaway_completed=None, video_chat_scheduled=None, video_chat_started=None, video_chat_ended=None, video_chat_participants_invited=None, web_app_data=None, reply_markup=None, forward_date=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None)
2025-01-04, Sat, 13:00:57,98 aiogram.event INFO Update id=450709848 is handled. Duration 0 ms by bot id=7771835226
2025-01-04, Sat, 13:06:23,30 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-04, Sat, 13:06:23,30 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 13:06:23,31 aiogram.dispatcher INFO Polling stopped
2025-01-04, Sat, 13:06:27,765 aiogram.dispatcher INFO Start polling
2025-01-04, Sat, 13:06:28,142 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-04, Sat, 13:06:34,492 aiogram.event INFO Update id=450709849 is handled. Duration 1715 ms by bot id=7771835226
2025-01-04, Sat, 13:06:38,965 aiogram.event INFO Update id=450709850 is handled. Duration 60 ms by bot id=7771835226
2025-01-04, Sat, 13:06:44,742 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, я маркетолог, True
2025-01-04, Sat, 13:06:44,742 root INFO Company: unnamed_company. Run function db.set.set_user
2025-01-04, Sat, 13:06:44,770 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-04, Sat, 13:06:44,770 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 13:06:44,772 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-04, Sat, 13:06:44,772 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 13:06:44,773 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-04, Sat, 13:06:44,773 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-04, Sat, 13:06:44,774 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-04, Sat, 13:06:44,775 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, is_admin) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-04, Sat, 13:06:44,775 sqlalchemy.engine.Engine INFO [generated in 0.00018s] (2142024077, 'DmPetrosel', 'Дмитрий', 'я маркетолог', True)
2025-01-04, Sat, 13:06:44,778 sqlalchemy.engine.Engine INFO COMMIT
2025-01-04, Sat, 13:06:44,780 root INFO Company: unnamed_company. Function db.set.set_user is done successfully! (Attempt number 1)
2025-01-04, Sat, 13:06:45,54 aiogram.event INFO Update id=450709851 is handled. Duration 312 ms by bot id=7771835226
2025-01-05, Sun, 07:19:55,970 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 07:19:56,268 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 07:20:05,85 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-05, Sun, 07:20:05,86 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 07:20:05,86 aiogram.dispatcher INFO Polling stopped
2025-01-05, Sun, 07:20:43,849 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 07:20:43,950 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 07:20:58,688 aiogram.event INFO Update id=450709852 is handled. Duration 1066 ms by bot id=7771835226
2025-01-05, Sun, 07:21:03,805 aiogram.event INFO Update id=450709853 is handled. Duration 403 ms by bot id=7771835226
2025-01-05, Sun, 07:21:07,891 root INFO Company: unnamed_company. Run function db.get.get_bot_price
2025-01-05, Sun, 07:21:07,891 root ERROR Company: unnamed_company. In function db.get.get_bot_price error occurs: 'AsyncSession' object has no attribute 'query'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 8, in get_bot_price
    return await async_session.query(Promo).get(promocode).price
AttributeError: 'AsyncSession' object has no attribute 'query'

2025-01-05, Sun, 08:49:34,340 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:49:34,638 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:49:42,456 aiogram.event INFO Update id=450709855 is handled. Duration 623 ms by bot id=7771835226
2025-01-05, Sun, 08:49:44,846 aiogram.event INFO Update id=450709856 is not handled. Duration 0 ms by bot id=7771835226
2025-01-05, Sun, 08:53:57,623 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:53:57,922 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:54:00,968 aiogram.event INFO Update id=450709857 is handled. Duration 309 ms by bot id=7771835226
2025-01-05, Sun, 08:54:03,216 aiogram.event INFO Update id=450709858 is not handled. Duration 0 ms by bot id=7771835226
2025-01-05, Sun, 08:56:14,387 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:56:14,464 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:56:15,771 aiogram.event INFO Update id=450709859 is handled. Duration 510 ms by bot id=7771835226
2025-01-05, Sun, 08:56:18,40 aiogram.event INFO Update id=450709860 is handled. Duration 68 ms by bot id=7771835226
2025-01-05, Sun, 08:57:58,239 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-05, Sun, 08:57:58,240 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:57:58,240 aiogram.dispatcher INFO Polling stopped
2025-01-05, Sun, 08:58:02,552 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:58:02,597 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:58:05,975 aiogram.event INFO Update id=450709861 is handled. Duration 303 ms by bot id=7771835226
2025-01-05, Sun, 08:58:08,811 aiogram.event INFO Update id=450709862 is handled. Duration 101 ms by bot id=7771835226
2025-01-05, Sun, 08:58:11,863 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 08:58:11,863 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 08:58:11,863 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: __aenter__. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 25, in wrapper
    async with async_sessionmaker(bind=engine) as session:
AttributeError: __aenter__

2025-01-05, Sun, 08:59:11,869 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: __aenter__. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 25, in wrapper
    async with async_sessionmaker(bind=engine) as session:
AttributeError: __aenter__

2025-01-05, Sun, 08:59:29,965 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 08:59:30,10 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 08:59:34,335 aiogram.event INFO Update id=450709864 is handled. Duration 516 ms by bot id=7771835226
2025-01-05, Sun, 08:59:36,428 aiogram.event INFO Update id=450709865 is handled. Duration 65 ms by bot id=7771835226
2025-01-05, Sun, 08:59:38,651 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 08:59:38,651 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 08:59:38,652 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: add_user() missing 1 required positional argument: 'user_data'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
TypeError: add_user() missing 1 required positional argument: 'user_data'

2025-01-05, Sun, 09:00:38,658 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: add_user() missing 1 required positional argument: 'user_data'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
TypeError: add_user() missing 1 required positional argument: 'user_data'

2025-01-05, Sun, 09:01:13,921 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 09:01:13,965 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:01:22,187 aiogram.event INFO Update id=450709867 is handled. Duration 986 ms by bot id=7771835226
2025-01-05, Sun, 09:01:24,459 aiogram.event INFO Update id=450709868 is handled. Duration 108 ms by bot id=7771835226
2025-01-05, Sun, 09:01:26,97 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 09:01:26,97 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 09:01:26,98 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-05, Sun, 09:01:26,298 aiogram.event INFO Update id=450709869 is handled. Duration 201 ms by bot id=7771835226
2025-01-05, Sun, 09:01:29,315 aiogram.event INFO Update id=450709870 is handled. Duration 167 ms by bot id=7771835226
2025-01-05, Sun, 09:03:09,614 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 09:03:09,658 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:03:11,843 aiogram.event INFO Update id=450709871 is handled. Duration 267 ms by bot id=7771835226
2025-01-05, Sun, 09:03:14,317 aiogram.event INFO Update id=450709872 is handled. Duration 105 ms by bot id=7771835226
2025-01-05, Sun, 09:03:16,351 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 09:03:16,351 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 09:03:16,355 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'is_admin' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 10, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2177, in _declarative_constructor
    raise TypeError(
TypeError: 'is_admin' is an invalid keyword argument for User

2025-01-05, Sun, 09:04:19,488 aiogram.dispatcher INFO Start polling
2025-01-05, Sun, 09:04:19,578 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:04:22,244 aiogram.event INFO Update id=450709874 is handled. Duration 1219 ms by bot id=7771835226
2025-01-05, Sun, 09:04:24,33 aiogram.event INFO Update id=450709875 is handled. Duration 65 ms by bot id=7771835226
2025-01-05, Sun, 09:04:26,134 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-05, Sun, 09:04:26,134 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-05, Sun, 09:04:26,164 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-05, Sun, 09:04:26,164 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-05, Sun, 09:04:26,166 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-05, Sun, 09:04:26,166 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-05, Sun, 09:04:26,168 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-05, Sun, 09:04:26,168 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-05, Sun, 09:04:26,169 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-05, Sun, 09:04:26,171 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-05, Sun, 09:04:26,171 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-05, Sun, 09:04:26,173 sqlalchemy.engine.Engine INFO COMMIT
2025-01-05, Sun, 09:04:26,176 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-05, Sun, 09:04:26,332 aiogram.event INFO Update id=450709876 is handled. Duration 199 ms by bot id=7771835226
2025-01-05, Sun, 09:05:00,234 aiogram.event INFO Update id=450709877 is handled. Duration 314 ms by bot id=7771835226
2025-01-05, Sun, 09:06:14,183 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-05, Sun, 09:06:14,184 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-05, Sun, 09:06:14,184 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:14:15,339 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:14:15,399 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:14:31,789 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:14:31,790 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:14:31,790 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:23:35,669 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:23:35,794 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:23:45,777 aiogram.event INFO Update id=450709878 is not handled. Duration 686 ms by bot id=7771835226
2025-01-08, Wed, 11:23:45,777 aiogram.event ERROR Cause exception while process update id=450709878 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(user_id)
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
2025-01-08, Wed, 11:25:09,270 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:25:09,316 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:25:11,378 aiogram.event INFO Update id=450709879 is not handled. Duration 158 ms by bot id=7771835226
2025-01-08, Wed, 11:25:11,378 aiogram.event ERROR Cause exception while process update id=450709879 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session, user_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
2025-01-08, Wed, 11:25:59,60 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:25:59,60 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:25:59,60 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:30:36,993 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:30:37,140 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:30:39,235 aiogram.event INFO Update id=450709880 is not handled. Duration 183 ms by bot id=7771835226
2025-01-08, Wed, 11:30:39,235 aiogram.event ERROR Cause exception while process update id=450709880 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session, chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'chat_id'
2025-01-08, Wed, 11:33:24,202 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:33:24,203 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:33:24,203 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:35:50,401 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:35:50,664 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:35:53,158 aiogram.event INFO Update id=450709881 is not handled. Duration 180 ms by bot id=7771835226
2025-01-08, Wed, 11:35:53,158 aiogram.event ERROR Cause exception while process update id=450709881 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session, chat_id=chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
2025-01-08, Wed, 11:36:19,656 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:36:19,732 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:36:21,588 aiogram.event INFO Update id=450709882 is not handled. Duration 231 ms by bot id=7771835226
2025-01-08, Wed, 11:36:21,588 aiogram.event ERROR Cause exception while process update id=450709882 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'cls'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(session=session, chat_id=chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'cls'
2025-01-08, Wed, 11:36:50,467 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:36:50,468 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:36:50,468 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:38:58,164 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:38:58,554 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:39:00,501 aiogram.event INFO Update id=450709883 is not handled. Duration 162 ms by bot id=7771835226
2025-01-08, Wed, 11:39:00,501 aiogram.event ERROR Cause exception while process update id=450709883 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(kwargs.get('chat_id'))
TypeError: BaseDAO.get_by_chat_id() missing 2 required positional arguments: 'session' and 'chat_id'
2025-01-08, Wed, 11:39:28,639 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:39:28,639 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:39:28,640 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:40:19,141 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:40:19,331 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:40:21,478 aiogram.event INFO Update id=450709884 is not handled. Duration 198 ms by bot id=7771835226
2025-01-08, Wed, 11:40:21,479 aiogram.event ERROR Cause exception while process update id=450709884 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(kwargs.get('chat_id'))
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
2025-01-08, Wed, 11:41:40,683 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:41:40,683 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:41:40,684 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:41:56,55 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:41:56,223 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:41:58,26 aiogram.event INFO Update id=450709885 is not handled. Duration 249 ms by bot id=7771835226
2025-01-08, Wed, 11:41:58,26 aiogram.event ERROR Cause exception while process update id=450709885 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(kwargs.get('chat_id'))
TypeError: BaseDAO.get_by_chat_id() missing 1 required positional argument: 'session'
2025-01-08, Wed, 11:51:31,470 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:51:31,470 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:51:31,471 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:51:35,700 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:51:35,781 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:51:38,402 aiogram.event INFO Update id=450709886 is not handled. Duration 178 ms by bot id=7771835226
2025-01-08, Wed, 11:51:38,402 aiogram.event ERROR Cause exception while process update id=450709886 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
2025-01-08, Wed, 11:53:42,295 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:53:42,296 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:53:42,296 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:53:47,204 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:53:47,247 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:53:48,486 aiogram.event INFO Update id=450709887 is not handled. Duration 182 ms by bot id=7771835226
2025-01-08, Wed, 11:53:48,486 aiogram.event ERROR Cause exception while process update id=450709887 by bot id=7771835226
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id)
TypeError: BaseDAO.get_by_chat_id() missing 1 required keyword-only argument: 'session'
2025-01-08, Wed, 11:54:02,309 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:54:02,310 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:54:02,310 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:55:03,91 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:55:03,137 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:55:04,576 aiogram.event INFO Update id=450709888 is not handled. Duration 149 ms by bot id=7771835226
2025-01-08, Wed, 11:55:04,577 aiogram.event ERROR Cause exception while process update id=450709888 by bot id=7771835226
AttributeError: type object 'User' has no attribute 'select'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 25, in get_by_chat_id
    result = await session.execute(cls.model.select().where(args.get('chat_id') == cls.model.chat_id))
AttributeError: type object 'User' has no attribute 'select'
2025-01-08, Wed, 11:55:27,444 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:55:27,445 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:55:27,445 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 11:59:03,79 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 11:59:03,130 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:59:06,784 aiogram.event INFO Update id=450709889 is not handled. Duration 603 ms by bot id=7771835226
2025-01-08, Wed, 11:59:06,784 aiogram.event ERROR Cause exception while process update id=450709889 by bot id=7771835226
AttributeError: 'tuple' object has no attribute 'get'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 26, in get_by_chat_id
    query =select(cls.model).where(args.get('chat_id') == cls.model.chat_id)
AttributeError: 'tuple' object has no attribute 'get'
2025-01-08, Wed, 11:59:51,423 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 11:59:51,424 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 11:59:51,424 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 12:00:29,264 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 12:00:29,314 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:00:31,742 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-08, Wed, 12:00:31,742 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:00:31,745 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-08, Wed, 12:00:31,745 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:00:31,746 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-08, Wed, 12:00:31,746 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:00:31,747 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:00:31,751 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:00:31,751 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-08, Wed, 12:00:31,753 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:00:31,754 aiogram.event INFO Update id=450709890 is not handled. Duration 250 ms by bot id=7771835226
2025-01-08, Wed, 12:00:31,754 aiogram.event ERROR Cause exception while process update id=450709890 by bot id=7771835226
AttributeError: 'User' object has no attribute 'first'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 28, in get_by_chat_id
    records = result.scalar_one_or_none().first()
AttributeError: 'User' object has no attribute 'first'
2025-01-08, Wed, 12:01:02,434 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 12:01:02,435 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:01:02,435 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 12:01:07,66 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 12:01:07,407 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:01:08,537 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-08, Wed, 12:01:08,537 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:01:08,539 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-08, Wed, 12:01:08,539 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:01:08,540 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-08, Wed, 12:01:08,540 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:01:08,541 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:01:08,546 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:01:08,546 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-08, Wed, 12:01:08,548 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:01:08,623 aiogram.event INFO Update id=450709891 is handled. Duration 262 ms by bot id=7771835226
2025-01-08, Wed, 12:02:04,696 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 12:02:04,697 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:02:04,697 aiogram.dispatcher INFO Polling stopped
2025-01-08, Wed, 12:02:09,882 aiogram.dispatcher INFO Start polling
2025-01-08, Wed, 12:02:10,153 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbotif await is_marketer(message.from_user.id):
            await marketer(message, state) id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:02:42,973 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-08, Wed, 12:02:42,973 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:02:42,976 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-08, Wed, 12:02:42,976 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:02:42,977 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-08, Wed, 12:02:42,978 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-08, Wed, 12:02:42,979 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:02:42,983 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:02:42,983 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (7675368439,)
2025-01-08, Wed, 12:02:42,985 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:02:43,631 aiogram.event INFO Update id=450709892 is handled. Duration 1402 ms by bot id=7771835226
2025-01-08, Wed, 12:02:47,655 aiogram.event INFO Update id=450709893 is handled. Duration 311 ms by bot id=7771835226
2025-01-08, Wed, 12:02:49,766 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-08, Wed, 12:02:49,766 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-08, Wed, 12:02:49,767 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:02:49,768 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN) RETURNING users.id
2025-01-08, Wed, 12:02:49,768 sqlalchemy.engine.Engine INFO [generated in 0.00019s] (7675368439, 'Dm_dev_acc', 'Devid', None, False)
2025-01-08, Wed, 12:02:49,771 sqlalchemy.engine.Engine INFO COMMIT
2025-01-08, Wed, 12:02:49,773 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-08, Wed, 12:02:50,185 aiogram.event INFO Update id=450709894 is handled. Duration 418 ms by bot id=7771835226
2025-01-08, Wed, 12:02:51,760 aiogram.event INFO Update id=450709895 is handled. Duration 316 ms by bot id=7771835226
2025-01-08, Wed, 12:02:54,466 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-08, Wed, 12:02:54,467 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-08, Wed, 12:02:54,467 sqlalchemy.engine.Engine INFO [cached since 11.48s ago] (7675368439,)
2025-01-08, Wed, 12:02:54,470 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-08, Wed, 12:02:54,572 aiogram.event INFO Update id=450709896 is handled. Duration 219 ms by bot id=7771835226
2025-01-08, Wed, 12:03:57,896 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-08, Wed, 12:03:57,896 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-08, Wed, 12:03:57,896 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:07:22,508 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:07:22,641 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:07:22,703 aiogram.event INFO Update id=450709898 is not handled. Duration 0 ms by bot id=7771835226
2025-01-09, Thu, 12:07:22,883 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:07:22,883 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:07:22,885 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:07:22,885 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:07:22,887 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:07:22,887 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:07:22,888 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:07:22,892 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:07:22,893 aiogram.event INFO Update id=450709897 is not handled. Duration 190 ms by bot id=7771835226
2025-01-09, Thu, 12:07:22,893 aiogram.event ERROR Cause exception while process update id=450709897 by bot id=7771835226
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
KeyError: 'promocodes'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-09, Thu, 12:07:35,28 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:07:35,28 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:07:35,30 aiogram.event INFO Update id=450709899 is not handled. Duration 151 ms by bot id=7771835226
2025-01-09, Thu, 12:07:35,30 aiogram.event ERROR Cause exception while process update id=450709899 by bot id=7771835226
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4252, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'promocodes'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-09, Thu, 12:08:31,771 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:08:31,772 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:08:31,772 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:08:51,239 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:08:51,377 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:08:54,608 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:08:54,608 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:08:54,610 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:08:54,610 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:08:54,611 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:08:54,611 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:08:54,612 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:08:54,616 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:08:54,616 aiogram.event INFO Update id=450709900 is not handled. Duration 414 ms by bot id=7771835226
2025-01-09, Thu, 12:08:54,616 aiogram.event ERROR Cause exception while process update id=450709900 by bot id=7771835226
InvalidRequestError: back_populates on relationship 'Promo.user' refers to attribute 'User.promocode' that is not a relationship.  The back_populates parameter should refer to the name of a relationship on the target class.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1580, in _add_reverse_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: back_populates on relationship 'Promo.user' refers to attribute 'User.promocode' that is not a relationship.  The back_populates parameter should refer to the name of a relationship on the target class.
2025-01-09, Thu, 12:09:50,90 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:09:50,90 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:09:50,91 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:10:14,795 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:10:14,843 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:10:17,479 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:10:17,479 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:10:17,481 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:10:17,482 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:10:17,483 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:10:17,483 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:10:17,484 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:10:17,487 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:10:17,488 aiogram.event INFO Update id=450709901 is not handled. Duration 336 ms by bot id=7771835226
2025-01-09, Thu, 12:10:17,488 aiogram.event ERROR Cause exception while process update id=450709901 by bot id=7771835226
ArgumentError: FROM expression, such as a Table or alias() object expected, got False.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1644, in do_init
    self._setup_join_conditions()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1884, in _setup_join_conditions
    self._join_condition = jc = JoinCondition(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2310, in __init__
    self._determine_joins()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2406, in _determine_joins
    self.secondaryjoin = join_condition(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/util.py", line 123, in join_condition
    return Join._join_condition(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/selectable.py", line 1363, in _join_condition
    constraints = cls._joincond_scan_left_right(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/selectable.py", line 1431, in _joincond_scan_left_right
    b = coercions.expect(roles.FromClauseRole, b)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 395, in expect
    resolved = impl._literal_coercion(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 604, in _literal_coercion
    self._raise_for_expected(element, argname)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 695, in _raise_for_expected
    super()._raise_for_expected(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/coercions.py", line 518, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
sqlalchemy.exc.ArgumentError: FROM expression, such as a Table or alias() object expected, got False.
2025-01-09, Thu, 12:11:10,262 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:11:10,263 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:11:10,263 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:11:14,632 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:11:14,699 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:11:16,532 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:11:16,532 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:11:16,534 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:11:16,534 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:11:16,535 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:11:16,536 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:11:16,537 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:11:16,540 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:11:16,541 aiogram.event INFO Update id=450709902 is not handled. Duration 206 ms by bot id=7771835226
2025-01-09, Thu, 12:11:16,541 aiogram.event ERROR Cause exception while process update id=450709902 by bot id=7771835226
ArgumentError: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2075, in _generate_backref
    raise sa_exc.ArgumentError(
sqlalchemy.exc.ArgumentError: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
2025-01-09, Thu, 12:12:45,206 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:12:45,207 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:12:45,207 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:14:16,854 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:14:16,901 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:14:20,340 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:14:20,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:14:20,342 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:14:20,342 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:14:20,343 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:14:20,343 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:14:20,344 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:14:20,350 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:14:20,351 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 12:14:20,353 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:14:20,428 aiogram.event INFO Update id=450709903 is not handled. Duration 275 ms by bot id=7771835226
2025-01-09, Thu, 12:14:20,428 aiogram.event ERROR Cause exception while process update id=450709903 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    if await is_marketer(message.from_user.id):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in is_marketer
    return await get_user(chat_id=chat_id)['marketer']
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:14:55,763 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:14:55,764 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:14:55,764 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:19:36,911 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:19:36,978 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:19:40,203 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:19:40,203 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:19:40,205 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:19:40,205 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:19:40,206 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:19:40,206 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:19:40,207 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:19:40,214 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:19:40,214 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-09, Thu, 12:19:40,216 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:19:40,282 aiogram.event INFO Update id=450709904 is not handled. Duration 269 ms by bot id=7771835226
2025-01-09, Thu, 12:19:40,282 aiogram.event ERROR Cause exception while process update id=450709904 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'marketer'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    if await is_marketer(message.from_user.id):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in is_marketer
    return await get_user(chat_id=chat_id).marketer
AttributeError: 'coroutine' object has no attribute 'marketer'
2025-01-09, Thu, 12:21:27,822 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:21:27,823 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:21:27,823 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:21:32,62 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:21:32,104 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:21:34,579 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:21:34,579 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:21:34,581 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:21:34,582 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:21:34,583 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:21:34,583 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:21:34,584 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:21:34,591 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:21:34,591 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077,)
2025-01-09, Thu, 12:21:34,594 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:21:34,671 aiogram.event INFO Update id=450709905 is not handled. Duration 272 ms by bot id=7771835226
2025-01-09, Thu, 12:21:34,671 aiogram.event ERROR Cause exception while process update id=450709905 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    if await is_marketer(message.from_user.id):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 25, in is_marketer
    return await get_user(chat_id=chat_id)['marketer'] == 'ямаркетолог'
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:24:10,375 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:24:10,375 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:24:10,375 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:24:14,682 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:24:14,726 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:24:17,62 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:24:17,62 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:24:17,64 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:24:17,64 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:24:17,65 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:24:17,65 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:24:17,66 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:24:17,73 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:24:17,73 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:24:17,75 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:24:17,175 aiogram.event INFO Update id=450709906 is not handled. Duration 316 ms by bot id=7771835226
2025-01-09, Thu, 12:24:17,175 aiogram.event ERROR Cause exception while process update id=450709906 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 28, in start
    if await get_user(message.from_user.id)['marketer']:
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:26:27,197 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:26:27,197 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:26:27,197 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:26:31,111 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:26:31,158 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:26:33,278 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:26:33,278 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:26:33,280 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:26:33,280 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:26:33,281 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:26:33,281 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:26:33,282 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:26:33,291 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:26:33,291 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:26:33,294 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:26:33,439 aiogram.event INFO Update id=450709907 is not handled. Duration 406 ms by bot id=7771835226
2025-01-09, Thu, 12:26:33,439 aiogram.event ERROR Cause exception while process update id=450709907 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'get'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 28, in start
    if await get_user(message.from_user.id).get('marketer'):
AttributeError: 'coroutine' object has no attribute 'get'
2025-01-09, Thu, 12:27:34,520 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:27:34,520 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:27:34,521 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:28:50,859 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:28:51,249 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:28:52,552 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:28:52,552 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:28:52,554 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:28:52,554 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:28:52,555 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:28:52,555 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:28:52,556 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:28:52,562 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:28:52,562 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 12:28:52,565 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:28:52,698 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:28:52,698 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:28:52,698 sqlalchemy.engine.Engine INFO [cached since 0.1367s ago] (2142024077,)
2025-01-09, Thu, 12:28:52,700 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:28:52,700 aiogram.event INFO Update id=450709908 is not handled. Duration 350 ms by bot id=7771835226
2025-01-09, Thu, 12:28:52,701 aiogram.event ERROR Cause exception while process update id=450709908 by bot id=7771835226
TypeError: 'User' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    if user_m['marketer'] == True:
TypeError: 'User' object is not subscriptable
2025-01-09, Thu, 12:30:49,34 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:30:49,34 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:30:49,34 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:30:53,172 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:30:53,215 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:30:55,396 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:30:55,396 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:30:55,399 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:30:55,399 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:30:55,401 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:30:55,401 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:30:55,402 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:30:55,408 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:30:55,409 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077,)
2025-01-09, Thu, 12:30:55,412 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:30:55,596 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:30:55,597 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:30:55,597 sqlalchemy.engine.Engine INFO [cached since 0.1884s ago] (2142024077,)
2025-01-09, Thu, 12:30:55,598 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:30:55,599 aiogram.event INFO Update id=450709909 is handled. Duration 469 ms by bot id=7771835226
2025-01-09, Thu, 12:32:42,222 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:32:42,223 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:32:42,223 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:32:46,402 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:32:46,446 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:32:47,767 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:32:47,767 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:32:47,769 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:32:47,769 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:32:47,770 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:32:47,770 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:32:47,771 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:32:47,776 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:32:47,776 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-09, Thu, 12:32:47,778 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:32:47,921 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:32:47,922 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:32:47,922 sqlalchemy.engine.Engine INFO [cached since 0.1458s ago] (2142024077,)
2025-01-09, Thu, 12:32:47,923 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:32:47,924 aiogram.event INFO Update id=450709910 is handled. Duration 406 ms by bot id=7771835226
2025-01-09, Thu, 12:33:48,836 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:33:48,836 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:33:48,836 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:33:55,60 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:33:55,110 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:33:58,688 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:33:58,689 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:33:58,691 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:33:58,691 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:33:58,692 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:33:58,692 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:33:58,694 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:33:58,701 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:33:58,701 sqlalchemy.engine.Engine INFO [generated in 0.00036s] (2142024077,)
2025-01-09, Thu, 12:33:58,704 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:33:59,270 aiogram.event INFO Update id=450709911 is handled. Duration 920 ms by bot id=7771835226
2025-01-09, Thu, 12:34:04,625 aiogram.event INFO Update id=450709912 is handled. Duration 145 ms by bot id=7771835226
2025-01-09, Thu, 12:34:11,766 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 12:34:11,766 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 12:34:11,767 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:34:11,770 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 12:34:11,771 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 12:34:11,773 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 12:34:11,775 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 12:34:11,876 aiogram.event INFO Update id=450709913 is handled. Duration 110 ms by bot id=7771835226
2025-01-09, Thu, 12:35:07,267 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:07,267 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:07,268 sqlalchemy.engine.Engine INFO [cached since 68.57s ago] (2142024077,)
2025-01-09, Thu, 12:35:07,269 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:07,376 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:07,376 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:07,376 sqlalchemy.engine.Engine INFO [cached since 68.68s ago] (2142024077,)
2025-01-09, Thu, 12:35:07,378 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:07,380 aiogram.event INFO Update id=450709914 is not handled. Duration 426 ms by bot id=7771835226
2025-01-09, Thu, 12:35:07,380 aiogram.event ERROR Cause exception while process update id=450709914 by bot id=7771835226
TypeError: 'coroutine' object is not subscriptable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    await marketer(message, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 20, in marketer
    balance = await get_user(message.from_user.id)['balance']
TypeError: 'coroutine' object is not subscriptable
2025-01-09, Thu, 12:35:46,592 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:35:46,592 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:35:46,593 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:35:50,860 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:35:50,903 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:35:52,390 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:35:52,390 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:35:52,392 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:35:52,392 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:35:52,393 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:35:52,393 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:35:52,394 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:52,400 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:52,400 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:35:52,403 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:52,474 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:35:52,475 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:35:52,475 sqlalchemy.engine.Engine INFO [cached since 0.07471s ago] (2142024077,)
2025-01-09, Thu, 12:35:52,477 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:35:52,478 aiogram.event INFO Update id=450709915 is not handled. Duration 293 ms by bot id=7771835226
2025-01-09, Thu, 12:35:52,478 aiogram.event ERROR Cause exception while process update id=450709915 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    await marketer(message, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 20, in marketer
    balance = await get_user(message.from_user.id).balance()
AttributeError: 'coroutine' object has no attribute 'balance'
2025-01-09, Thu, 12:36:23,747 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:36:23,747 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:36:23,747 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:36:27,655 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:36:27,734 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:36:29,577 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:36:29,577 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:36:29,579 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:36:29,579 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:36:29,581 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:36:29,581 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:36:29,582 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:36:29,589 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:36:29,589 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (2142024077,)
2025-01-09, Thu, 12:36:29,593 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:36:29,685 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:36:29,686 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:36:29,686 sqlalchemy.engine.Engine INFO [cached since 0.09684s ago] (2142024077,)
2025-01-09, Thu, 12:36:29,691 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:36:29,692 aiogram.event INFO Update id=450709916 is not handled. Duration 322 ms by bot id=7771835226
2025-01-09, Thu, 12:36:29,693 aiogram.event ERROR Cause exception while process update id=450709916 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    await marketer(message, state)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 20, in marketer
    balance = await get_user(message.from_user.id).balance
AttributeError: 'coroutine' object has no attribute 'balance'
2025-01-09, Thu, 12:37:03,509 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:37:03,510 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:03,510 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:37:07,815 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:37:08,204 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:09,260 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:37:09,260 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:09,262 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:37:09,262 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:09,263 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:37:09,263 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:09,264 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:09,270 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:09,271 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 12:37:09,272 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:09,449 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:09,449 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:09,449 sqlalchemy.engine.Engine INFO [cached since 0.1791s ago] (2142024077,)
2025-01-09, Thu, 12:37:09,451 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:09,451 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:09,452 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:09,452 sqlalchemy.engine.Engine INFO [cached since 0.1813s ago] (2142024077,)
2025-01-09, Thu, 12:37:09,452 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:09,456 aiogram.event INFO Update id=450709917 is handled. Duration 520 ms by bot id=7771835226
2025-01-09, Thu, 12:37:25,480 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:37:25,481 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:25,481 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:37:29,122 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:37:29,166 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:37:29,488 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:37:29,488 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:29,491 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:37:29,491 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:29,493 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:37:29,493 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:37:29,494 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:29,501 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:29,502 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-09, Thu, 12:37:29,504 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:29,629 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:29,630 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:29,630 sqlalchemy.engine.Engine INFO [cached since 0.1288s ago] (2142024077,)
2025-01-09, Thu, 12:37:29,631 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:29,632 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:37:29,633 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:37:29,633 sqlalchemy.engine.Engine INFO [cached since 0.1315s ago] (2142024077,)
2025-01-09, Thu, 12:37:29,634 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:37:29,772 aiogram.event INFO Update id=450709918 is handled. Duration 542 ms by bot id=7771835226
2025-01-09, Thu, 12:37:42,806 aiogram.event INFO Update id=450709919 is handled. Duration 0 ms by bot id=7771835226
2025-01-09, Thu, 12:43:10,228 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:43:10,228 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:43:10,228 sqlalchemy.engine.Engine INFO [cached since 340.7s ago] (2142024077,)
2025-01-09, Thu, 12:43:10,231 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:43:10,512 aiogram.event INFO Update id=450709920 is handled. Duration 344 ms by bot id=7771835226
2025-01-09, Thu, 12:43:19,699 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:43:19,700 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:43:19,700 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:43:53,22 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:43:53,65 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:43:55,803 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:43:55,803 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:43:55,805 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:43:55,806 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:43:55,807 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:43:55,807 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:43:55,808 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:43:55,814 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:43:55,814 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:43:55,817 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:43:56,85 aiogram.event INFO Update id=450709921 is handled. Duration 909 ms by bot id=7771835226
2025-01-09, Thu, 12:44:02,326 aiogram.event INFO Update id=450709922 is handled. Duration 68 ms by bot id=7771835226
2025-01-09, Thu, 12:44:10,621 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 12:44:10,621 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 12:44:10,622 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:44:10,626 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 12:44:10,626 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 12:44:10,628 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 12:44:10,630 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 12:44:10,776 aiogram.event INFO Update id=450709923 is handled. Duration 154 ms by bot id=7771835226
2025-01-09, Thu, 12:48:15,307 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:48:15,307 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:48:15,307 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:48:31,456 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:48:31,519 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:48:36,833 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:48:36,833 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:48:36,835 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:48:36,835 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:48:36,836 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:48:36,836 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:48:36,837 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:48:36,843 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:48:36,843 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 12:48:36,845 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:48:37,358 aiogram.event INFO Update id=450709924 is handled. Duration 1092 ms by bot id=7771835226
2025-01-09, Thu, 12:48:45,163 aiogram.event INFO Update id=450709925 is handled. Duration 409 ms by bot id=7771835226
2025-01-09, Thu, 12:48:51,658 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 12:48:51,658 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 12:48:51,659 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:48:51,661 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 12:48:51,661 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 12:48:51,663 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 12:48:51,666 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 12:48:51,736 aiogram.event INFO Update id=450709926 is handled. Duration 78 ms by bot id=7771835226
2025-01-09, Thu, 12:49:30,988 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:49:30,989 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:49:30,989 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 12:55:00,685 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 12:55:00,935 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:55:06,313 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 12:55:06,313 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:55:06,315 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 12:55:06,315 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:55:06,316 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 12:55:06,317 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 12:55:06,317 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 12:55:06,323 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 12:55:06,323 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-09, Thu, 12:55:06,325 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 12:55:06,817 aiogram.event INFO Update id=450709927 is handled. Duration 1205 ms by bot id=7771835226
2025-01-09, Thu, 12:55:11,623 aiogram.event INFO Update id=450709928 is handled. Duration 0 ms by bot id=7771835226
2025-01-09, Thu, 12:55:24,351 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 12:55:24,352 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 12:55:24,352 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:03:27,263 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:03:27,321 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:03:31,436 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:03:31,436 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:03:31,439 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:03:31,439 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:03:31,440 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:03:31,440 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:03:31,441 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:03:31,447 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:03:31,448 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-09, Thu, 13:03:31,450 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:03:31,592 aiogram.event INFO Update id=450709929 is handled. Duration 335 ms by bot id=7771835226
2025-01-09, Thu, 13:03:38,698 aiogram.event INFO Update id=450709930 is handled. Duration 211 ms by bot id=7771835226
2025-01-09, Thu, 13:03:44,605 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:03:44,605 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:03:44,606 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:03:44,609 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:03:44,609 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:03:44,611 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:03:44,614 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:03:44,702 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:03:44,703 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:03:44,703 sqlalchemy.engine.Engine INFO [cached since 13.26s ago] (2142024077,)
2025-01-09, Thu, 13:03:44,704 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:03:44,705 root ERROR 'dict' object has no attribute 'marketer'
2025-01-09, Thu, 13:03:44,705 aiogram.event INFO Update id=450709931 is handled. Duration 99 ms by bot id=7771835226
2025-01-09, Thu, 13:05:38,244 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:05:38,244 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:05:38,244 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:05:54,146 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:05:54,214 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:05:57,811 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:05:57,811 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:05:57,813 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:05:57,813 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:05:57,815 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:05:57,815 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:05:57,816 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:05:57,822 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:05:57,822 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 13:05:57,826 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:05:58,395 aiogram.event INFO Update id=450709932 is handled. Duration 1313 ms by bot id=7771835226
2025-01-09, Thu, 13:06:02,10 aiogram.event INFO Update id=450709933 is handled. Duration 103 ms by bot id=7771835226
2025-01-09, Thu, 13:06:08,508 root INFO REGISTRATION DATA: DmPetrosel, Дм, ямаркетолог, True
2025-01-09, Thu, 13:06:08,508 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:06:08,509 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:06:08,512 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:06:08,512 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (2142024077, 'DmPetrosel', 'Дм', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:06:08,514 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:06:08,517 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:06:08,584 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:06:08,584 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:06:08,584 sqlalchemy.engine.Engine INFO [cached since 10.76s ago] (2142024077,)
2025-01-09, Thu, 13:06:08,585 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:06:08,586 root ERROR 'dict' object has no attribute 'marketer'
2025-01-09, Thu, 13:06:08,586 aiogram.event INFO Update id=450709934 is handled. Duration 77 ms by bot id=7771835226
2025-01-09, Thu, 13:08:26,913 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:08:26,913 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:08:26,914 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:08:31,580 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:08:31,624 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:08:36,589 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:08:36,589 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:08:36,592 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:08:36,592 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:08:36,594 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:08:36,594 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:08:36,595 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:08:36,602 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:08:36,602 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 13:08:36,604 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:08:36,786 aiogram.event INFO Update id=450709935 is handled. Duration 453 ms by bot id=7771835226
2025-01-09, Thu, 13:08:41,561 aiogram.event INFO Update id=450709936 is handled. Duration 98 ms by bot id=7771835226
2025-01-09, Thu, 13:08:48,208 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:08:48,208 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:08:48,209 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:08:48,212 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:08:48,213 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:08:48,214 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:08:48,216 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:08:48,291 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:08:48,291 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:08:48,291 sqlalchemy.engine.Engine INFO [cached since 11.69s ago] (2142024077,)
2025-01-09, Thu, 13:08:48,292 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:08:48,293 root ERROR 'dict' object has no attribute 'marketer'
2025-01-09, Thu, 13:08:48,293 aiogram.event INFO Update id=450709937 is handled. Duration 85 ms by bot id=7771835226
2025-01-09, Thu, 13:11:04,374 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:11:04,375 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:11:04,375 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:11:08,940 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:11:09,198 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:11:13,487 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:11:13,488 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:11:13,490 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:11:13,490 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:11:13,491 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:11:13,491 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:11:13,492 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:11:13,500 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:11:13,500 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-09, Thu, 13:11:13,503 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:11:13,595 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:11:13,595 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:11:13,595 sqlalchemy.engine.Engine INFO [cached since 0.09517s ago] (2142024077,)
2025-01-09, Thu, 13:11:13,596 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:11:13,597 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:11:13,598 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:11:13,598 sqlalchemy.engine.Engine INFO [cached since 0.0981s ago] (2142024077,)
2025-01-09, Thu, 13:11:13,600 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:11:13,601 aiogram.event INFO Update id=450709938 is not handled. Duration 405 ms by bot id=7771835226
2025-01-09, Thu, 13:11:13,601 aiogram.event ERROR Cause exception while process update id=450709938 by bot id=7771835226
AttributeError: 'str' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 32, in start
    await marketer(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 22, in marketer
    balance = user.balance
AttributeError: 'str' object has no attribute 'balance'
2025-01-09, Thu, 13:13:48,994 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:13:48,994 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:13:48,994 sqlalchemy.engine.Engine INFO [cached since 155.5s ago] (2142024077,)
2025-01-09, Thu, 13:13:48,995 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:13:49,88 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:13:49,88 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:13:49,89 sqlalchemy.engine.Engine INFO [cached since 155.6s ago] (2142024077,)
2025-01-09, Thu, 13:13:49,90 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:13:49,91 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:13:49,91 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:13:49,91 sqlalchemy.engine.Engine INFO [cached since 155.6s ago] (2142024077,)
2025-01-09, Thu, 13:13:49,92 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:13:49,93 aiogram.event INFO Update id=450709939 is not handled. Duration 170 ms by bot id=7771835226
2025-01-09, Thu, 13:13:49,93 aiogram.event ERROR Cause exception while process update id=450709939 by bot id=7771835226
AttributeError: 'str' object has no attribute 'balance'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 32, in start
    await marketer(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 22, in marketer
    balance = user.balance
AttributeError: 'str' object has no attribute 'balance'
2025-01-09, Thu, 13:15:03,781 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:15:03,781 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:15:03,781 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:15:07,625 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:15:07,774 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:15:10,444 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:15:10,444 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:15:10,446 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:15:10,446 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:15:10,447 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:15:10,447 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:15:10,448 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:10,454 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:10,454 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-09, Thu, 13:15:10,456 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:10,597 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:10,597 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:10,597 sqlalchemy.engine.Engine INFO [cached since 0.1434s ago] (2142024077,)
2025-01-09, Thu, 13:15:10,598 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:10,600 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:10,600 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:10,600 sqlalchemy.engine.Engine INFO [cached since 0.1464s ago] (2142024077,)
2025-01-09, Thu, 13:15:10,601 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:10,707 aiogram.event INFO Update id=450709940 is handled. Duration 583 ms by bot id=7771835226
2025-01-09, Thu, 13:15:29,723 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:29,723 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:15:29,725 sqlalchemy.engine.Engine INFO [cached since 19.27s ago] (2142024077,)
2025-01-09, Thu, 13:15:29,726 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:15:29,874 aiogram.event INFO Update id=450709941 is handled. Duration 227 ms by bot id=7771835226
2025-01-09, Thu, 13:15:34,868 aiogram.event INFO Update id=450709942 is handled. Duration 96 ms by bot id=7771835226
2025-01-09, Thu, 13:15:39,738 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:15:39,738 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:15:39,740 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:15:39,741 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:15:39,742 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:15:39,743 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:15:39,745 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:15:39,810 aiogram.event INFO Update id=450709943 is handled. Duration 72 ms by bot id=7771835226
2025-01-09, Thu, 13:16:54,662 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:16:54,663 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:16:54,663 aiogram.dispatcher INFO Polling stopped
2025-01-09, Thu, 13:17:17,943 aiogram.dispatcher INFO Start polling
2025-01-09, Thu, 13:17:17,986 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:17:21,646 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-09, Thu, 13:17:21,646 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:17:21,648 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-09, Thu, 13:17:21,648 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:17:21,649 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-09, Thu, 13:17:21,649 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-09, Thu, 13:17:21,651 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:21,658 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:17:21,658 sqlalchemy.engine.Engine INFO [generated in 0.00036s] (2142024077,)
2025-01-09, Thu, 13:17:21,661 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:17:21,837 aiogram.event INFO Update id=450709944 is handled. Duration 413 ms by bot id=7771835226
2025-01-09, Thu, 13:17:26,994 aiogram.event INFO Update id=450709945 is handled. Duration 111 ms by bot id=7771835226
2025-01-09, Thu, 13:17:31,737 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-09, Thu, 13:17:31,737 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-09, Thu, 13:17:31,738 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:31,741 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-09, Thu, 13:17:31,741 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-09, Thu, 13:17:31,743 sqlalchemy.engine.Engine INFO COMMIT
2025-01-09, Thu, 13:17:31,745 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-09, Thu, 13:17:31,838 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:31,839 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:17:31,839 sqlalchemy.engine.Engine INFO [cached since 10.18s ago] (2142024077,)
2025-01-09, Thu, 13:17:31,840 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:17:31,841 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-09, Thu, 13:17:31,841 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-09, Thu, 13:17:31,841 sqlalchemy.engine.Engine INFO [cached since 10.18s ago] (2142024077,)
2025-01-09, Thu, 13:17:31,842 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-09, Thu, 13:17:31,941 aiogram.event INFO Update id=450709946 is handled. Duration 203 ms by bot id=7771835226
2025-01-09, Thu, 13:18:12,89 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-09, Thu, 13:18:12,90 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-09, Thu, 13:18:12,90 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:22:40,572 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:22:40,858 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:22:41,92 aiogram.event INFO Update id=450709947 is not handled. Duration 0 ms by bot id=7771835226
2025-01-10, Fri, 12:22:45,206 aiogram.event INFO Update id=450709948 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:23:33,453 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:23:33,454 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:23:33,454 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:39:12,575 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:39:12,650 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:41:20,712 aiogram.event INFO Update id=450709949 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:43:25,583 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:43:25,584 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:43:25,584 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:43:31,958 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:43:32,3 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:43:34,635 aiogram.event INFO Update id=450709950 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:44:30,450 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:44:30,451 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:44:30,452 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:44:36,666 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:44:36,712 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:44:40,108 aiogram.event INFO Update id=450709951 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:46:40,72 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:46:40,73 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:46:40,73 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:46:46,675 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:46:46,721 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:46:47,165 aiogram.event INFO Update id=450709952 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:46:51,971 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 12:46:51,971 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:46:51,974 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 12:46:51,975 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:46:51,978 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 12:46:51,978 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:46:51,981 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:46:51,994 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:46:51,994 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-10, Fri, 12:46:51,998 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:46:52,69 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:46:52,70 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:46:52,70 sqlalchemy.engine.Engine INFO [cached since 0.0768s ago] (2142024077,)
2025-01-10, Fri, 12:46:52,72 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:46:52,74 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:46:52,75 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:46:52,75 sqlalchemy.engine.Engine INFO [cached since 0.08188s ago] (2142024077,)
2025-01-10, Fri, 12:46:52,78 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:46:52,165 aiogram.event INFO Update id=450709953 is handled. Duration 424 ms by bot id=7771835226
2025-01-10, Fri, 12:46:54,416 aiogram.event INFO Update id=450709954 is handled. Duration 3 ms by bot id=7771835226
2025-01-10, Fri, 12:49:45,209 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:49:45,209 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:49:45,210 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:51:27,600 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:51:27,644 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:51:27,716 aiogram.event INFO Update id=450709955 is handled. Duration 2 ms by bot id=7771835226
2025-01-10, Fri, 12:51:27,717 aiogram.event INFO Update id=450709956 is handled. Duration 2 ms by bot id=7771835226
2025-01-10, Fri, 12:51:27,717 aiogram.event INFO Update id=450709957 is handled. Duration 2 ms by bot id=7771835226
2025-01-10, Fri, 12:51:42,102 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 12:51:42,103 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:51:42,107 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 12:51:42,107 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:51:42,111 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 12:51:42,111 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:51:42,114 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:51:42,127 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:51:42,127 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-10, Fri, 12:51:42,135 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:51:42,229 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:51:42,230 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:51:42,230 sqlalchemy.engine.Engine INFO [cached since 0.1032s ago] (2142024077,)
2025-01-10, Fri, 12:51:42,232 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:51:42,234 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:51:42,235 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:51:42,235 sqlalchemy.engine.Engine INFO [cached since 0.1081s ago] (2142024077,)
2025-01-10, Fri, 12:51:42,237 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:51:42,338 aiogram.event INFO Update id=450709958 is handled. Duration 464 ms by bot id=7771835226
2025-01-10, Fri, 12:51:43,847 aiogram.event INFO Update id=450709959 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:52:34,798 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:52:34,799 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:52:34,799 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:52:40,831 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:52:40,910 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:52:40,978 aiogram.event INFO Update id=450709960 is handled. Duration 0 ms by bot id=7771835226
2025-01-10, Fri, 12:53:15,627 aiogram.event INFO Update id=450709961 is handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 12:55:33,210 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:55:33,211 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:55:33,211 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:55:39,580 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:55:39,627 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:55:41,131 aiogram.event INFO Update id=450709962 is handled. Duration 0 ms by bot id=7771835226
2025-01-10, Fri, 12:58:10,186 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 12:58:10,187 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:58:10,187 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 12:58:17,97 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 12:58:17,143 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 12:58:26,695 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 12:58:26,695 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:58:26,701 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 12:58:26,701 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:58:26,705 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 12:58:26,705 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 12:58:26,707 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:58:26,719 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:58:26,720 sqlalchemy.engine.Engine INFO [generated in 0.00060s] (7675368439,)
2025-01-10, Fri, 12:58:26,724 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:58:27,7 aiogram.event INFO Update id=450709963 is handled. Duration 674 ms by bot id=7771835226
2025-01-10, Fri, 12:58:30,473 aiogram.event INFO Update id=450709964 is handled. Duration 74 ms by bot id=7771835226
2025-01-10, Fri, 12:58:32,624 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 12:58:32,624 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 12:58:32,628 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:58:32,630 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 12:58:32,631 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 12:58:32,635 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 12:58:32,638 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 12:58:32,761 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 12:58:32,762 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 12:58:32,762 sqlalchemy.engine.Engine INFO [cached since 6.043s ago] (7675368439,)
2025-01-10, Fri, 12:58:32,764 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 12:58:32,877 aiogram.event INFO Update id=450709965 is handled. Duration 254 ms by bot id=7771835226
2025-01-10, Fri, 12:58:36,870 aiogram.event INFO Update id=450709966 is handled. Duration 126 ms by bot id=7771835226
2025-01-10, Fri, 13:01:43,300 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:01:43,301 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:01:43,301 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:01:49,703 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:01:49,747 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:01:49,876 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:01:49,876 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:01:49,880 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:01:49,881 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:01:49,884 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:01:49,884 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:01:49,886 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:01:49,896 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.id = $1::BIGINT
2025-01-10, Fri, 13:01:49,896 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (2142024077,)
2025-01-10, Fri, 13:01:49,900 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:01:49,901 aiogram.event INFO Update id=450709967 is handled. Duration 77 ms by bot id=7771835226
2025-01-10, Fri, 13:06:19,100 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:06:19,101 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:06:19,101 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:06:43,128 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:06:43,174 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:06:43,307 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:06:43,307 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:06:43,312 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:06:43,312 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:06:43,315 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:06:43,315 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:06:43,318 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:06:43,329 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.id = $1::BIGINT
2025-01-10, Fri, 13:06:43,329 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (2142024077,)
2025-01-10, Fri, 13:06:43,334 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:06:43,335 aiogram.event INFO Update id=450709968 is handled. Duration 82 ms by bot id=7771835226
2025-01-10, Fri, 13:08:46,705 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:08:46,706 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:08:46,706 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:08:52,996 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:08:53,43 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:08:54,778 aiogram.event INFO Update id=450709969 is not handled. Duration 1 ms by bot id=7771835226
2025-01-10, Fri, 13:08:54,778 aiogram.event ERROR Cause exception while process update id=450709969 by bot id=7771835226
TypeError: get_all_promos() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 29, in callback_marketer
    promos_list = await get_all_promos()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
TypeError: get_all_promos() missing 1 required positional argument: 'chat_id'
2025-01-10, Fri, 13:09:47,129 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:09:47,130 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:09:47,130 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:12:11,806 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:12:11,854 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:12:14,459 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:12:14,460 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:12:14,464 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:12:14,465 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:12:14,468 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:12:14,468 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:12:14,471 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:12:14,475 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:12:14,476 aiogram.event INFO Update id=450709970 is not handled. Duration 74 ms by bot id=7771835226
2025-01-10, Fri, 13:12:14,476 aiogram.event ERROR Cause exception while process update id=450709970 by bot id=7771835226
ArgumentError: relationship 'user' expects a class or a mapper argument (received: <class 'sqlalchemy.orm.attributes.InstrumentedAttribute'>)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 29, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 27, in get_all
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1642, in do_init
    self._setup_entity()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1874, in _setup_entity
    raise sa_exc.ArgumentError(
sqlalchemy.exc.ArgumentError: relationship 'user' expects a class or a mapper argument (received: <class 'sqlalchemy.orm.attributes.InstrumentedAttribute'>)
2025-01-10, Fri, 13:17:51,345 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:17:51,346 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:17:51,346 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:34:18,284 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:34:18,335 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:34:18,660 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:34:18,661 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:34:18,666 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:34:18,666 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:34:18,669 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:34:18,669 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:34:18,672 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:34:18,686 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:34:18,687 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-10, Fri, 13:34:18,692 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:34:18,854 aiogram.event INFO Update id=450709971 is handled. Duration 438 ms by bot id=7771835226
2025-01-10, Fri, 13:34:26,288 aiogram.event INFO Update id=450709972 is handled. Duration 161 ms by bot id=7771835226
2025-01-10, Fri, 13:34:31,838 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 13:34:31,839 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 13:34:31,840 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:34:31,845 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:34:31,846 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:34:31,849 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:34:31,859 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:35:31,870 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:35:31,870 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:35:31,871 sqlalchemy.engine.Engine INFO [cached since 60.03s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:35:31,873 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:35:31,875 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:35:53,465 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:35:53,465 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:35:53,466 sqlalchemy.engine.Engine INFO [cached since 94.78s ago] (2142024077,)
2025-01-10, Fri, 13:35:53,468 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:35:53,773 aiogram.event INFO Update id=450709974 is handled. Duration 408 ms by bot id=7771835226
2025-01-10, Fri, 13:35:57,410 aiogram.event INFO Update id=450709975 is handled. Duration 62 ms by bot id=7771835226
2025-01-10, Fri, 13:36:07,408 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 13:36:07,408 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 13:36:07,410 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:36:07,410 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:36:07,410 sqlalchemy.engine.Engine INFO [cached since 95.57s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:36:07,412 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:36:07,414 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:36:32,39 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:36:32,39 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:36:32,39 sqlalchemy.engine.Engine INFO [cached since 133.4s ago] (2142024077,)
2025-01-10, Fri, 13:36:32,42 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:36:32,43 root ERROR 'NoneType' object has no attribute 'marketer'
2025-01-10, Fri, 13:36:32,44 aiogram.event INFO Update id=450709973 is handled. Duration 120205 ms by bot id=7771835226
2025-01-10, Fri, 13:37:07,424 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:37:07,425 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:37:07,425 sqlalchemy.engine.Engine INFO [cached since 155.6s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:37:07,427 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:37:07,430 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:38:07,591 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:38:07,591 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:38:07,591 sqlalchemy.engine.Engine INFO [cached since 228.9s ago] (2142024077,)
2025-01-10, Fri, 13:38:07,593 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:38:07,595 root ERROR 'NoneType' object has no attribute 'marketer'
2025-01-10, Fri, 13:38:07,595 aiogram.event INFO Update id=450709976 is handled. Duration 120186 ms by bot id=7771835226
2025-01-10, Fri, 13:38:24,54 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 13:38:24,54 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:38:24,55 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 13:54:04,994 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 13:54:05,42 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 13:54:10,419 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 13:54:10,419 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:54:10,424 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 13:54:10,424 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:54:10,427 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 13:54:10,428 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 13:54:10,430 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:54:10,442 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:54:10,443 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (2142024077,)
2025-01-10, Fri, 13:54:10,447 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:54:10,635 aiogram.event INFO Update id=450709977 is handled. Duration 456 ms by bot id=7771835226
2025-01-10, Fri, 13:54:14,904 aiogram.event INFO Update id=450709978 is handled. Duration 98 ms by bot id=7771835226
2025-01-10, Fri, 13:54:19,441 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 13:54:19,441 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 13:54:19,442 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:54:19,447 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:54:19,448 sqlalchemy.engine.Engine INFO [generated in 0.00058s] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:54:19,451 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:54:19,459 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:55:19,465 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:55:19,466 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 13:55:19,466 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 13:55:19,468 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:55:19,470 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 13:56:19,638 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 13:56:19,639 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 13:56:19,639 sqlalchemy.engine.Engine INFO [cached since 129.2s ago] (2142024077,)
2025-01-10, Fri, 13:56:19,641 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 13:56:19,642 root ERROR 'NoneType' object has no attribute 'marketer'
2025-01-10, Fri, 13:56:19,643 aiogram.event INFO Update id=450709979 is handled. Duration 120202 ms by bot id=7771835226
2025-01-10, Fri, 14:04:50,572 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:04:50,573 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:04:50,573 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:04:56,694 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:04:56,744 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:05:02,177 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:05:02,177 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:05:02,183 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:05:02,183 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:05:02,186 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:05:02,186 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:05:02,189 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:05:02,201 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:05:02,202 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (2142024077,)
2025-01-10, Fri, 14:05:02,205 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:05:02,709 aiogram.event INFO Update id=450709980 is handled. Duration 2089 ms by bot id=7771835226
2025-01-10, Fri, 14:05:05,767 aiogram.event INFO Update id=450709981 is handled. Duration 105 ms by bot id=7771835226
2025-01-10, Fri, 14:05:20,718 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:05:20,718 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:05:20,720 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:05:20,725 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:05:20,725 sqlalchemy.engine.Engine INFO [generated in 0.00050s] (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:05:20,728 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:05:20,738 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 2142024077, DmPetrosel, Дмитрий, ямаркетолог, t, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:06:05,300 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:06:05,301 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:06:05,301 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:06:05,553 aiogram.event INFO Update id=450709982 is not handled. Duration 44835 ms by bot id=7771835226
2025-01-10, Fri, 14:08:17,294 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:08:17,394 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:08:19,59 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:08:19,59 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:08:19,64 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:08:19,64 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:08:19,67 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:08:19,67 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:08:19,70 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:08:19,81 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:08:19,82 sqlalchemy.engine.Engine INFO [generated in 0.00052s] (2142024077,)
2025-01-10, Fri, 14:08:19,86 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:08:19,323 aiogram.event INFO Update id=450709983 is handled. Duration 581 ms by bot id=7771835226
2025-01-10, Fri, 14:08:24,274 aiogram.event INFO Update id=450709984 is handled. Duration 119 ms by bot id=7771835226
2025-01-10, Fri, 14:08:29,985 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:08:29,985 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:08:29,986 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:08:29,991 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:08:29,991 sqlalchemy.engine.Engine INFO [generated in 0.00057s] (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:08:29,995 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:08:30,4 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:09:30,14 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:30,15 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:09:30,15 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:09:30,18 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:30,20 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:09:43,967 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:09:43,968 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:09:43,968 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:09:44,220 aiogram.event INFO Update id=450709985 is not handled. Duration 74235 ms by bot id=7771835226
2025-01-10, Fri, 14:09:50,709 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:09:50,754 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:09:52,208 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:09:52,208 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:09:52,213 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:09:52,213 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:09:52,216 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:09:52,217 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:09:52,218 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:52,232 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:09:52,232 sqlalchemy.engine.Engine INFO [generated in 0.00053s] (2142024077,)
2025-01-10, Fri, 14:09:52,236 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:52,499 aiogram.event INFO Update id=450709986 is handled. Duration 607 ms by bot id=7771835226
2025-01-10, Fri, 14:09:54,306 aiogram.event INFO Update id=450709987 is handled. Duration 123 ms by bot id=7771835226
2025-01-10, Fri, 14:09:59,109 root INFO REGISTRATION DATA: DmPetrosel, Дм, ямаркетолог, True
2025-01-10, Fri, 14:09:59,109 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:09:59,110 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:59,116 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:09:59,116 sqlalchemy.engine.Engine INFO [generated in 0.00057s] (1, 2142024077, 'DmPetrosel', 'Дм', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:09:59,120 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 14:09:59,123 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 14:09:59,190 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:59,191 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:09:59,191 sqlalchemy.engine.Engine INFO [cached since 6.959s ago] (2142024077,)
2025-01-10, Fri, 14:09:59,193 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:59,196 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:09:59,196 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:09:59,196 sqlalchemy.engine.Engine INFO [cached since 6.965s ago] (2142024077,)
2025-01-10, Fri, 14:09:59,198 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:09:59,278 aiogram.event INFO Update id=450709988 is handled. Duration 169 ms by bot id=7771835226
2025-01-10, Fri, 14:10:21,991 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:10:21,992 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:10:21,992 sqlalchemy.engine.Engine INFO [cached since 29.76s ago] (7675368439,)
2025-01-10, Fri, 14:10:21,994 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:10:22,301 aiogram.event INFO Update id=450709989 is handled. Duration 473 ms by bot id=7771835226
2025-01-10, Fri, 14:10:25,949 aiogram.event INFO Update id=450709990 is handled. Duration 67 ms by bot id=7771835226
2025-01-10, Fri, 14:10:27,556 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:10:27,556 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:10:27,557 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:10:27,558 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:10:27,558 sqlalchemy.engine.Engine INFO [cached since 28.44s ago] (1, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:10:27,560 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:10:27,569 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_id_key"
DETAIL:  Key (id)=(1) already exists.
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (1, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:11:00,911 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:11:00,912 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:11:00,912 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:11:01,164 aiogram.event INFO Update id=450709991 is not handled. Duration 33610 ms by bot id=7771835226
2025-01-10, Fri, 14:12:31,549 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:12:31,594 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:12:35,251 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:12:35,251 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:12:35,256 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:12:35,256 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:12:35,259 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:12:35,260 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:12:35,262 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:12:35,274 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:12:35,274 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (7675368439,)
2025-01-10, Fri, 14:12:35,278 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:12:35,455 aiogram.event INFO Update id=450709992 is handled. Duration 416 ms by bot id=7771835226
2025-01-10, Fri, 14:12:37,959 aiogram.event INFO Update id=450709993 is handled. Duration 99 ms by bot id=7771835226
2025-01-10, Fri, 14:12:39,923 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:12:39,923 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:12:39,926 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:12:39,929 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:12:39,929 sqlalchemy.engine.Engine INFO [generated in 0.00050s] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:12:39,932 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:12:39,941 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:13:37,856 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:13:37,857 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:13:37,857 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:13:38,109 aiogram.event INFO Update id=450709994 is not handled. Duration 58188 ms by bot id=7771835226
2025-01-10, Fri, 14:13:58,650 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:13:58,693 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:14:02,322 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:14:02,322 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:14:02,326 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:14:02,327 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:14:02,330 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:14:02,330 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:14:02,333 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:14:02,345 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:14:02,345 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (7675368439,)
2025-01-10, Fri, 14:14:02,350 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:14:02,991 aiogram.event INFO Update id=450709995 is handled. Duration 1153 ms by bot id=7771835226
2025-01-10, Fri, 14:14:05,522 aiogram.event INFO Update id=450709996 is handled. Duration 74 ms by bot id=7771835226
2025-01-10, Fri, 14:14:07,46 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:14:07,47 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:14:07,50 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:14:07,53 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:14:07,53 sqlalchemy.engine.Engine INFO [generated in 0.00053s] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:14:07,56 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:14:07,64 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:15:07,70 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:15:07,71 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:15:07,71 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:15:07,73 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:15:07,76 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:15:11,526 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:15:11,526 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:15:11,527 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:15:11,779 aiogram.event INFO Update id=450709997 is not handled. Duration 64734 ms by bot id=7771835226
2025-01-10, Fri, 14:18:34,780 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:18:34,825 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:18:40,101 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:18:40,101 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:18:40,106 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:18:40,107 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:18:40,110 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:18:40,110 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:18:40,113 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:18:40,126 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:18:40,126 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (7675368439,)
2025-01-10, Fri, 14:18:40,130 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:18:40,764 aiogram.event INFO Update id=450709998 is handled. Duration 1349 ms by bot id=7771835226
2025-01-10, Fri, 14:18:43,836 aiogram.event INFO Update id=450709999 is handled. Duration 402 ms by bot id=7771835226
2025-01-10, Fri, 14:18:45,429 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:18:45,429 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:18:45,432 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:18:45,435 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:18:45,435 sqlalchemy.engine.Engine INFO [generated in 0.00054s] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:18:45,438 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:18:45,447 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:19:45,455 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:19:45,456 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)
2025-01-10, Fri, 14:19:45,456 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:19:45,458 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:19:45,461 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::BIGINT, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BIGINT)]
[parameters: (None, 7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:19:50,108 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:19:50,109 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:19:50,110 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:19:50,362 aiogram.event INFO Update id=450710000 is not handled. Duration 64934 ms by bot id=7771835226
2025-01-10, Fri, 14:29:32,632 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:29:32,679 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:29:38,340 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:29:38,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:29:38,342 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:29:38,342 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:29:38,344 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:29:38,344 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:29:38,345 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:29:38,352 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:29:38,352 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (7675368439,)
2025-01-10, Fri, 14:29:38,355 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:29:38,538 aiogram.event INFO Update id=450710001 is handled. Duration 408 ms by bot id=7771835226
2025-01-10, Fri, 14:29:41,339 aiogram.event INFO Update id=450710002 is handled. Duration 131 ms by bot id=7771835226
2025-01-10, Fri, 14:29:42,768 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:29:42,768 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:29:42,770 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:29:42,771 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:29:42,771 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:29:42,773 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:29:42,777 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "id" of relation "users" violates not-null constraint
DETAIL:  Failing row contains (null, 7675368439, Dm_dev_acc, Devid, null, f, 0).
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-10, Fri, 14:31:31,932 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:31:31,992 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:31:35,514 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:31:35,514 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:31:35,516 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:31:35,516 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:31:35,518 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:31:35,518 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:31:35,519 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:31:35,525 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:31:35,526 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (7675368439,)
2025-01-10, Fri, 14:31:35,527 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:31:35,984 aiogram.event INFO Update id=450710004 is handled. Duration 871 ms by bot id=7771835226
2025-01-10, Fri, 14:31:38,316 aiogram.event INFO Update id=450710005 is handled. Duration 269 ms by bot id=7771835226
2025-01-10, Fri, 14:31:39,218 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, None, False
2025-01-10, Fri, 14:31:39,218 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:31:39,220 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:31:39,222 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:31:39,222 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)
2025-01-10, Fri, 14:31:39,224 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:31:39,229 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', None, False, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

2025-01-10, Fri, 14:32:32,809 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:32:32,810 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:32:32,810 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:32:33,61 aiogram.event INFO Update id=450710006 is not handled. Duration 53844 ms by bot id=7771835226
2025-01-10, Fri, 14:34:02,570 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:34:02,956 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:34:14,554 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:34:14,554 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:34:14,556 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:34:14,556 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:34:14,557 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:34:14,557 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:34:14,558 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:34:14,565 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:34:14,565 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-10, Fri, 14:34:14,567 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:34:14,968 aiogram.event INFO Update id=450710007 is handled. Duration 1467 ms by bot id=7771835226
2025-01-10, Fri, 14:34:20,161 aiogram.event INFO Update id=450710008 is handled. Duration 312 ms by bot id=7771835226
2025-01-10, Fri, 14:34:26,937 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:34:26,937 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:34:26,938 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:34:26,941 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:34:26,941 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:34:26,943 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:34:26,948 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

2025-01-10, Fri, 14:35:26,954 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:35:26,955 sqlalchemy.engine.Engine INFO INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-10, Fri, 14:35:26,956 sqlalchemy.engine.Engine INFO [cached since 60.02s ago] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:35:26,958 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:35:26,959 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "seq_user_id" does not exist
[SQL: INSERT INTO users (id, chat_id, username, first_name, promocode, marketer, balance) VALUES (nextval('seq_user_id'), $1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)

2025-01-10, Fri, 14:35:31,513 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:35:31,514 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:35:31,514 aiogram.dispatcher INFO Polling stopped
2025-01-10, Fri, 14:35:31,766 aiogram.event INFO Update id=450710009 is not handled. Duration 64829 ms by bot id=7771835226
2025-01-10, Fri, 14:36:09,574 aiogram.dispatcher INFO Start polling
2025-01-10, Fri, 14:36:09,628 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:36:13,641 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-10, Fri, 14:36:13,641 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:36:13,643 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-10, Fri, 14:36:13,643 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:36:13,644 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-10, Fri, 14:36:13,645 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-10, Fri, 14:36:13,645 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:13,652 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:13,652 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (2142024077,)
2025-01-10, Fri, 14:36:13,654 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:13,948 aiogram.event INFO Update id=450710010 is handled. Duration 1031 ms by bot id=7771835226
2025-01-10, Fri, 14:36:18,103 aiogram.event INFO Update id=450710011 is handled. Duration 162 ms by bot id=7771835226
2025-01-10, Fri, 14:36:23,369 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-10, Fri, 14:36:23,369 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:36:23,370 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:23,373 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-10, Fri, 14:36:23,374 sqlalchemy.engine.Engine INFO [generated in 0.00031s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-10, Fri, 14:36:23,376 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 14:36:23,378 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 14:36:23,485 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:23,485 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:23,485 sqlalchemy.engine.Engine INFO [cached since 9.834s ago] (2142024077,)
2025-01-10, Fri, 14:36:23,486 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:23,487 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:23,487 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:23,487 sqlalchemy.engine.Engine INFO [cached since 9.836s ago] (2142024077,)
2025-01-10, Fri, 14:36:23,488 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:23,600 aiogram.event INFO Update id=450710012 is handled. Duration 230 ms by bot id=7771835226
2025-01-10, Fri, 14:36:40,540 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:40,540 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:40,540 sqlalchemy.engine.Engine INFO [cached since 26.89s ago] (7675368439,)
2025-01-10, Fri, 14:36:40,541 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:40,677 aiogram.event INFO Update id=450710013 is handled. Duration 215 ms by bot id=7771835226
2025-01-10, Fri, 14:36:44,393 aiogram.event INFO Update id=450710014 is handled. Duration 91 ms by bot id=7771835226
2025-01-10, Fri, 14:36:45,726 root INFO REGISTRATION DATA: Dm_dev_acc, Девид, None, False
2025-01-10, Fri, 14:36:45,726 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-10, Fri, 14:36:45,726 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:45,727 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-10, Fri, 14:36:45,727 sqlalchemy.engine.Engine INFO [cached since 22.35s ago] (7675368439, 'Dm_dev_acc', 'Девид', None, False, 0)
2025-01-10, Fri, 14:36:45,728 sqlalchemy.engine.Engine INFO COMMIT
2025-01-10, Fri, 14:36:45,730 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-10, Fri, 14:36:45,790 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-10, Fri, 14:36:45,790 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-10, Fri, 14:36:45,791 sqlalchemy.engine.Engine INFO [cached since 32.14s ago] (7675368439,)
2025-01-10, Fri, 14:36:45,792 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-10, Fri, 14:36:45,877 aiogram.event INFO Update id=450710015 is handled. Duration 152 ms by bot id=7771835226
2025-01-10, Fri, 14:36:59,861 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-10, Fri, 14:36:59,861 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-10, Fri, 14:36:59,862 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:28:16,678 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:28:16,763 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:28:28,192 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:28:28,193 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:28:28,195 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:28:28,195 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:28:28,197 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:28:28,197 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:28:28,199 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:28:28,210 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:28:28,210 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (2142024077,)
2025-01-12, Sun, 08:28:28,214 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:28:28,304 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:28:28,305 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:28:28,305 sqlalchemy.engine.Engine INFO [cached since 0.09529s ago] (2142024077,)
2025-01-12, Sun, 08:28:28,307 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:28:28,309 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:28:28,310 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:28:28,310 sqlalchemy.engine.Engine INFO [cached since 0.09981s ago] (2142024077,)
2025-01-12, Sun, 08:28:28,312 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:28:28,371 aiogram.event INFO Update id=450710016 is handled. Duration 644 ms by bot id=7771835226
2025-01-12, Sun, 08:28:30,806 aiogram.event INFO Update id=450710017 is handled. Duration 77 ms by bot id=7771835226
2025-01-12, Sun, 08:28:49,486 aiogram.event INFO Update id=450710018 is not handled. Duration 0 ms by bot id=7771835226
2025-01-12, Sun, 08:29:51,568 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:29:51,569 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:29:51,569 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:32:55,191 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:32:55,331 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:32:58,126 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:32:58,126 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:32:58,128 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:32:58,128 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:32:58,129 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:32:58,129 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:32:58,130 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:32:58,140 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:32:58,140 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-12, Sun, 08:32:58,144 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:32:58,219 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:32:58,220 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:32:58,220 sqlalchemy.engine.Engine INFO [cached since 0.08015s ago] (2142024077,)
2025-01-12, Sun, 08:32:58,222 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:32:58,224 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:32:58,225 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:32:58,225 sqlalchemy.engine.Engine INFO [cached since 0.08508s ago] (2142024077,)
2025-01-12, Sun, 08:32:58,227 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:32:58,442 aiogram.event INFO Update id=450710019 is handled. Duration 834 ms by bot id=7771835226
2025-01-12, Sun, 08:33:03,885 aiogram.event INFO Update id=450710020 is handled. Duration 118 ms by bot id=7771835226
2025-01-12, Sun, 08:33:11,514 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:33:11,515 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:33:11,515 sqlalchemy.engine.Engine INFO [cached since 13.37s ago] (Message(message_id=860, date=datetime.datetime(2025, 1, 12, 5, 33, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:33:11,517 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:33:11,518 aiogram.event INFO Update id=450710021 is not handled. Duration 4 ms by bot id=7771835226
2025-01-12, Sun, 08:33:11,518 aiogram.event ERROR Cause exception while process update id=450710021 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=860, date=datetime.datetime(2025, 1, 12, 5, 33, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=860, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=860, date=datetime.datetime(2025, 1, 12, 5, 33, 11, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:35:09,929 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:35:09,929 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:35:09,929 sqlalchemy.engine.Engine INFO [cached since 131.8s ago] (Message(message_id=861, date=datetime.datetime(2025, 1, 12, 5, 35, 9, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3029 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:35:09,930 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:35:09,931 aiogram.event INFO Update id=450710022 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 08:35:09,931 aiogram.event ERROR Cause exception while process update id=450710022 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=861, date=datetime.datetime(2025, 1, 12, 5, 35, 9, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3029 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=861, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=861, date=datetime.datetime(2025, 1, 12, 5, 35, 9, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3029 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:42:28,79 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:42:28,80 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:42:28,80 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:42:32,614 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:42:32,660 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:42:37,194 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:42:37,194 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:42:37,197 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:42:37,197 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:42:37,198 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:42:37,198 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:42:37,200 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:37,209 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:37,209 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-12, Sun, 08:42:37,213 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:37,580 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:37,580 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:37,581 sqlalchemy.engine.Engine INFO [cached since 0.3714s ago] (2142024077,)
2025-01-12, Sun, 08:42:37,582 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:37,584 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:37,584 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:37,585 sqlalchemy.engine.Engine INFO [cached since 0.3753s ago] (2142024077,)
2025-01-12, Sun, 08:42:37,586 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:37,720 aiogram.event INFO Update id=450710023 is handled. Duration 1223 ms by bot id=7771835226
2025-01-12, Sun, 08:42:40,51 aiogram.event INFO Update id=450710024 is handled. Duration 89 ms by bot id=7771835226
2025-01-12, Sun, 08:42:46,899 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:42:46,899 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:42:46,899 sqlalchemy.engine.Engine INFO [cached since 9.69s ago] (Message(message_id=867, date=datetime.datetime(2025, 1, 12, 5, 42, 46, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:42:46,901 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:42:46,902 aiogram.event INFO Update id=450710025 is not handled. Duration 4 ms by bot id=7771835226
2025-01-12, Sun, 08:42:46,902 aiogram.event ERROR Cause exception while process update id=450710025 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=867, date=datetime.datetime(2025, 1, 12, 5, 42, 46, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=867, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=867, date=datetime.datetime(2025, 1, 12, 5, 42, 46, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, usern ... (3030 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:44:02,983 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:44:02,984 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:44:02,984 sqlalchemy.engine.Engine INFO [cached since 85.77s ago] (Message(message_id=868, date=datetime.datetime(2025, 1, 12, 5, 44, 2, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3139 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)
2025-01-12, Sun, 08:44:02,985 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:44:02,986 aiogram.event INFO Update id=450710026 is not handled. Duration 5 ms by bot id=7771835226
2025-01-12, Sun, 08:44:02,986 aiogram.event ERROR Cause exception while process update id=450710026 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=868, date=datetime.datetime(2025, 1, 12, 5, 44, 2, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3139 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'Message' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 28, in marketer
    user_obj[chat_id] = await get_user(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 33, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: Message(message_id=868, date=datetime.da... ('Message' object cannot be interpreted as an integer)
[SQL: SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT]
[parameters: (Message(message_id=868, date=datetime.datetime(2025, 1, 12, 5, 44, 2, tzinfo=TzInfo(UTC)), chat=Chat(id=2142024077, type='private', title=None, userna ... (3139 characters truncated) ... ate=None, forward_from=None, forward_from_chat=None, forward_from_message_id=None, forward_sender_name=None, forward_signature=None, user_shared=None),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 08:52:57,972 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:52:57,972 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:52:57,972 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:53:02,206 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:53:02,253 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:53:04,395 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:53:04,395 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:53:04,398 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:53:04,398 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:53:04,400 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:53:04,400 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:53:04,403 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:53:04,410 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:53:04,410 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (2142024077,)
2025-01-12, Sun, 08:53:04,413 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:53:04,492 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:53:04,492 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:53:04,493 sqlalchemy.engine.Engine INFO [cached since 0.0827s ago] (2142024077,)
2025-01-12, Sun, 08:53:04,494 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:53:04,495 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:53:04,495 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:53:04,495 sqlalchemy.engine.Engine INFO [cached since 0.08558s ago] (2142024077,)
2025-01-12, Sun, 08:53:04,497 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:53:04,873 aiogram.event INFO Update id=450710027 is handled. Duration 902 ms by bot id=7771835226
2025-01-12, Sun, 08:53:06,685 aiogram.event INFO Update id=450710028 is handled. Duration 101 ms by bot id=7771835226
2025-01-12, Sun, 08:53:11,457 aiogram.event INFO Update id=450710029 is not handled. Duration 235 ms by bot id=7771835226
2025-01-12, Sun, 08:53:11,457 aiogram.event ERROR Cause exception while process update id=450710029 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message identifier is not specified
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.edit_message_text('Введите цену')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 1588, in edit_message_text
    return await self(call, request_timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message identifier is not specified
2025-01-12, Sun, 08:54:11,455 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:54:11,455 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:54:11,455 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:55:48,427 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:55:48,525 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:55:50,15 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:55:50,15 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:55:50,19 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:55:50,19 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:55:50,21 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:55:50,21 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:55:50,23 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:55:50,30 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:55:50,30 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-12, Sun, 08:55:50,34 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:55:50,250 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:55:50,250 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:55:50,251 sqlalchemy.engine.Engine INFO [cached since 0.2206s ago] (2142024077,)
2025-01-12, Sun, 08:55:50,253 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:55:50,254 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:55:50,255 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:55:50,255 sqlalchemy.engine.Engine INFO [cached since 0.225s ago] (2142024077,)
2025-01-12, Sun, 08:55:50,257 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:55:50,355 aiogram.event INFO Update id=450710030 is handled. Duration 697 ms by bot id=7771835226
2025-01-12, Sun, 08:55:51,320 aiogram.event INFO Update id=450710031 is handled. Duration 71 ms by bot id=7771835226
2025-01-12, Sun, 08:55:56,906 aiogram.event INFO Update id=450710032 is not handled. Duration 0 ms by bot id=7771835226
2025-01-12, Sun, 08:55:56,906 aiogram.event ERROR Cause exception while process update id=450710032 by bot id=7771835226
ValidationError: 1 validation error for EditMessageText
text
  Input should be a valid string [type=string_type, input_value=2142024077, input_type=int]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.edit_message_text(message.from_user.id,'Введите цену')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 1576, in edit_message_text
    call = EditMessageText(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
text
  Input should be a valid string [type=string_type, input_value=2142024077, input_type=int]
    For further information visit https://errors.pydantic.dev/2.10/v/string_type
2025-01-12, Sun, 08:57:30,885 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 08:57:30,885 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:57:30,885 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 08:59:12,99 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 08:59:12,487 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 08:59:13,952 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 08:59:13,952 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:59:13,955 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 08:59:13,955 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:59:13,957 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 08:59:13,957 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 08:59:13,958 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:59:13,965 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:59:13,965 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-12, Sun, 08:59:13,969 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:59:14,203 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:59:14,204 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:59:14,204 sqlalchemy.engine.Engine INFO [cached since 0.2391s ago] (2142024077,)
2025-01-12, Sun, 08:59:14,205 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:59:14,206 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 08:59:14,207 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 08:59:14,207 sqlalchemy.engine.Engine INFO [cached since 0.2421s ago] (2142024077,)
2025-01-12, Sun, 08:59:14,208 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 08:59:14,433 aiogram.event INFO Update id=450710033 is handled. Duration 1110 ms by bot id=7771835226
2025-01-12, Sun, 08:59:15,684 aiogram.event INFO Update id=450710034 is handled. Duration 71 ms by bot id=7771835226
2025-01-12, Sun, 08:59:20,370 aiogram.event INFO Update id=450710035 is not handled. Duration 47 ms by bot id=7771835226
2025-01-12, Sun, 08:59:20,370 aiogram.event ERROR Cause exception while process update id=450710035 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message can't be edited
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.edit_message_text(chat_id = message.from_user.id,message_id=message.message_id, text= 'Введите цену')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 1588, in edit_message_text
    return await self(call, request_timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message can't be edited
2025-01-12, Sun, 09:01:31,394 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:01:31,394 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:01:31,394 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:01:35,341 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:01:35,424 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:01:38,63 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:01:38,63 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:01:38,65 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:01:38,65 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:01:38,66 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:01:38,66 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:01:38,68 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:01:38,80 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:01:38,80 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-12, Sun, 09:01:38,83 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:01:38,199 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:01:38,200 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:01:38,200 sqlalchemy.engine.Engine INFO [cached since 0.1207s ago] (2142024077,)
2025-01-12, Sun, 09:01:38,203 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:01:38,204 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:01:38,205 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:01:38,205 sqlalchemy.engine.Engine INFO [cached since 0.1251s ago] (2142024077,)
2025-01-12, Sun, 09:01:38,206 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:01:38,474 aiogram.event INFO Update id=450710036 is handled. Duration 972 ms by bot id=7771835226
2025-01-12, Sun, 09:01:39,778 aiogram.event INFO Update id=450710037 is handled. Duration 139 ms by bot id=7771835226
2025-01-12, Sun, 09:01:43,939 aiogram.event INFO Update id=450710038 is not handled. Duration 0 ms by bot id=7771835226
2025-01-12, Sun, 09:01:43,939 aiogram.event ERROR Cause exception while process update id=450710038 by bot id=7771835226
TypeError: Bot.send_message() missing 1 required positional argument: 'chat_id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 52, in new_promo
    await bot.send_message( text= 'Введите цену')
TypeError: Bot.send_message() missing 1 required positional argument: 'chat_id'
2025-01-12, Sun, 09:03:19,540 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:03:19,541 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:03:19,541 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:03:23,692 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:03:23,984 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:03:24,490 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:03:24,490 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:03:24,494 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:03:24,494 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:03:24,496 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:03:24,496 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:03:24,497 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:03:24,509 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:03:24,509 sqlalchemy.engine.Engine INFO [generated in 0.00084s] (2142024077,)
2025-01-12, Sun, 09:03:24,513 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:03:24,575 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:03:24,576 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:03:24,576 sqlalchemy.engine.Engine INFO [cached since 0.06748s ago] (2142024077,)
2025-01-12, Sun, 09:03:24,578 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:03:24,579 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:03:24,579 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:03:24,579 sqlalchemy.engine.Engine INFO [cached since 0.0708s ago] (2142024077,)
2025-01-12, Sun, 09:03:24,581 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:03:24,698 aiogram.event INFO Update id=450710039 is handled. Duration 455 ms by bot id=7771835226
2025-01-12, Sun, 09:03:25,876 aiogram.event INFO Update id=450710040 is handled. Duration 75 ms by bot id=7771835226
2025-01-12, Sun, 09:03:29,633 aiogram.event INFO Update id=450710041 is handled. Duration 120 ms by bot id=7771835226
2025-01-12, Sun, 09:03:36,418 aiogram.event INFO Update id=450710042 is handled. Duration 148 ms by bot id=7771835226
2025-01-12, Sun, 09:04:19,689 aiogram.event INFO Update id=450710043 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:04:19,689 aiogram.event ERROR Cause exception while process update id=450710043 by bot id=7771835226
TypeError: create_promo() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message, promos_dict[message.from_user.id])
TypeError: create_promo() takes 1 positional argument but 2 were given
2025-01-12, Sun, 09:04:44,335 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:04:44,335 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:04:44,335 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:05:52,775 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:05:52,822 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:05:57,711 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:05:57,711 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:05:57,713 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:05:57,713 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:05:57,714 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:05:57,715 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:05:57,716 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:05:57,724 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:05:57,725 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-12, Sun, 09:05:57,727 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:05:57,794 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:05:57,795 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:05:57,795 sqlalchemy.engine.Engine INFO [cached since 0.07088s ago] (2142024077,)
2025-01-12, Sun, 09:05:57,797 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:05:57,799 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:05:57,800 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:05:57,800 sqlalchemy.engine.Engine INFO [cached since 0.07562s ago] (2142024077,)
2025-01-12, Sun, 09:05:57,802 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:05:57,871 aiogram.event INFO Update id=450710044 is handled. Duration 1029 ms by bot id=7771835226
2025-01-12, Sun, 09:05:59,711 aiogram.event INFO Update id=450710045 is handled. Duration 86 ms by bot id=7771835226
2025-01-12, Sun, 09:06:11,787 aiogram.event INFO Update id=450710046 is handled. Duration 75 ms by bot id=7771835226
2025-01-12, Sun, 09:06:22,771 aiogram.event INFO Update id=450710047 is handled. Duration 326 ms by bot id=7771835226
2025-01-12, Sun, 09:06:33,681 aiogram.event INFO Update id=450710048 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:06:33,682 aiogram.event ERROR Cause exception while process update id=450710048 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
2025-01-12, Sun, 09:10:29,206 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:10:29,207 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:10:29,207 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:21:45,190 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:21:45,232 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:21:53,603 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:21:53,604 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:21:53,606 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:21:53,606 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:21:53,607 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:21:53,608 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:21:53,609 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:21:53,615 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:21:53,615 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-12, Sun, 09:21:53,618 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:21:53,882 aiogram.event INFO Update id=450710049 is handled. Duration 701 ms by bot id=7771835226
2025-01-12, Sun, 09:21:58,750 aiogram.event INFO Update id=450710050 is handled. Duration 57 ms by bot id=7771835226
2025-01-12, Sun, 09:22:06,63 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-12, Sun, 09:22:06,63 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-12, Sun, 09:22:06,64 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'dict' object has no attribute 'add'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 12, in add
    session.add(new_instance)
AttributeError: 'dict' object has no attribute 'add'

2025-01-12, Sun, 09:23:06,66 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'dict' object has no attribute 'add'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 12, in add
    session.add(new_instance)
AttributeError: 'dict' object has no attribute 'add'

2025-01-12, Sun, 09:23:09,803 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:23:09,803 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:23:09,804 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:23:10,54 aiogram.event INFO Update id=450710051 is not handled. Duration 63992 ms by bot id=7771835226
2025-01-12, Sun, 09:32:25,667 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:32:25,714 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:32:32,363 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:32:32,363 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:32:32,366 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:32:32,366 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:32:32,367 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:32:32,367 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:32:32,369 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:32,375 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:32:32,376 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (2142024077,)
2025-01-12, Sun, 09:32:32,378 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:32:32,850 aiogram.event INFO Update id=450710052 is handled. Duration 1478 ms by bot id=7771835226
2025-01-12, Sun, 09:32:37,17 aiogram.event INFO Update id=450710053 is handled. Duration 280 ms by bot id=7771835226
2025-01-12, Sun, 09:32:41,441 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-12, Sun, 09:32:41,442 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-12, Sun, 09:32:41,442 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:41,446 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-12, Sun, 09:32:41,446 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-12, Sun, 09:32:41,448 sqlalchemy.engine.Engine INFO COMMIT
2025-01-12, Sun, 09:32:41,449 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-12, Sun, 09:32:41,548 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:41,549 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:32:41,549 sqlalchemy.engine.Engine INFO [cached since 9.174s ago] (2142024077,)
2025-01-12, Sun, 09:32:41,550 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:32:41,551 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:32:41,551 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:32:41,551 sqlalchemy.engine.Engine INFO [cached since 9.176s ago] (2142024077,)
2025-01-12, Sun, 09:32:41,553 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:32:41,678 aiogram.event INFO Update id=450710054 is handled. Duration 236 ms by bot id=7771835226
2025-01-12, Sun, 09:33:09,473 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:33:09,474 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:33:09,474 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:33:13,448 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:33:13,494 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:33:19,554 aiogram.event INFO Update id=450710055 is handled. Duration 193 ms by bot id=7771835226
2025-01-12, Sun, 09:33:29,949 aiogram.event INFO Update id=450710056 is handled. Duration 62 ms by bot id=7771835226
2025-01-12, Sun, 09:33:33,785 aiogram.event INFO Update id=450710057 is handled. Duration 104 ms by bot id=7771835226
2025-01-12, Sun, 09:33:44,936 aiogram.event INFO Update id=450710058 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:33:44,936 aiogram.event ERROR Cause exception while process update id=450710058 by bot id=7771835226
KeyError: 'user_data'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = d['user_data'] if d['user_data'] else d['kwargs']
KeyError: 'user_data'
2025-01-12, Sun, 09:35:58,198 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:35:58,199 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:35:58,199 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:36:01,975 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:36:02,63 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:36:09,706 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:36:09,706 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:36:09,709 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:36:09,709 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:36:09,710 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:36:09,710 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:36:09,711 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:09,717 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:36:09,717 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-12, Sun, 09:36:09,719 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:09,786 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:09,787 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:36:09,787 sqlalchemy.engine.Engine INFO [cached since 0.06989s ago] (2142024077,)
2025-01-12, Sun, 09:36:09,788 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:09,789 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:09,790 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:36:09,790 sqlalchemy.engine.Engine INFO [cached since 0.07269s ago] (2142024077,)
2025-01-12, Sun, 09:36:09,791 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:10,36 aiogram.event INFO Update id=450710059 is handled. Duration 808 ms by bot id=7771835226
2025-01-12, Sun, 09:36:12,270 aiogram.event INFO Update id=450710060 is handled. Duration 236 ms by bot id=7771835226
2025-01-12, Sun, 09:36:20,241 aiogram.event INFO Update id=450710061 is handled. Duration 275 ms by bot id=7771835226
2025-01-12, Sun, 09:36:23,125 aiogram.event INFO Update id=450710062 is handled. Duration 58 ms by bot id=7771835226
2025-01-12, Sun, 09:36:29,741 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:36:29,743 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id
2025-01-12, Sun, 09:36:29,743 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (None, None, 0, None, None, None)
2025-01-12, Sun, 09:36:29,745 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:36:29,746 aiogram.event INFO Update id=450710063 is not handled. Duration 8 ms by bot id=7771835226
2025-01-12, Sun, 09:36:29,746 aiogram.event ERROR Cause exception while process update id=450710063 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: (None, None, 0, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (1, null, null, 0, null, null, null).
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: (None, None, 0, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-12, Sun, 09:39:37,389 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:39:37,389 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:39:37,389 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:39:41,468 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:39:41,521 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:39:44,905 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:39:44,905 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:39:44,907 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:39:44,907 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:39:44,908 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:39:44,908 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:39:44,908 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:39:44,915 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:39:44,916 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-12, Sun, 09:39:44,918 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:39:45,280 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:39:45,281 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:39:45,281 sqlalchemy.engine.Engine INFO [cached since 0.3655s ago] (2142024077,)
2025-01-12, Sun, 09:39:45,282 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:39:45,283 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:39:45,283 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:39:45,283 sqlalchemy.engine.Engine INFO [cached since 0.3681s ago] (2142024077,)
2025-01-12, Sun, 09:39:45,285 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:39:45,393 aiogram.event INFO Update id=450710064 is handled. Duration 698 ms by bot id=7771835226
2025-01-12, Sun, 09:39:46,573 aiogram.event INFO Update id=450710065 is handled. Duration 99 ms by bot id=7771835226
2025-01-12, Sun, 09:39:50,114 aiogram.event INFO Update id=450710066 is handled. Duration 128 ms by bot id=7771835226
2025-01-12, Sun, 09:39:52,778 aiogram.event INFO Update id=450710067 is handled. Duration 59 ms by bot id=7771835226
2025-01-12, Sun, 09:39:58,510 aiogram.event INFO Update id=450710068 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 09:39:58,510 aiogram.event ERROR Cause exception while process update id=450710068 by bot id=7771835226
TypeError: db.dao.BaseDAO.add() argument after ** must be a mapping, not tuple
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: db.dao.BaseDAO.add() argument after ** must be a mapping, not tuple
2025-01-12, Sun, 09:40:55,417 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:40:55,418 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:40:55,418 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:40:59,539 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:40:59,691 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:41:02,882 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:41:02,882 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:41:02,884 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:41:02,884 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:41:02,886 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:41:02,886 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:41:02,887 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:41:02,893 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:41:02,894 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-12, Sun, 09:41:02,896 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:41:02,986 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:41:02,986 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:41:02,987 sqlalchemy.engine.Engine INFO [cached since 0.0933s ago] (2142024077,)
2025-01-12, Sun, 09:41:02,988 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:41:02,988 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:41:02,989 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:41:02,989 sqlalchemy.engine.Engine INFO [cached since 0.09545s ago] (2142024077,)
2025-01-12, Sun, 09:41:02,990 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:41:03,151 aiogram.event INFO Update id=450710069 is handled. Duration 441 ms by bot id=7771835226
2025-01-12, Sun, 09:41:04,566 aiogram.event INFO Update id=450710070 is handled. Duration 193 ms by bot id=7771835226
2025-01-12, Sun, 09:41:10,678 aiogram.event INFO Update id=450710071 is handled. Duration 104 ms by bot id=7771835226
2025-01-12, Sun, 09:41:13,449 aiogram.event INFO Update id=450710072 is handled. Duration 110 ms by bot id=7771835226
2025-01-12, Sun, 09:41:18,154 aiogram.event INFO Update id=450710073 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:41:18,154 aiogram.event ERROR Cause exception while process update id=450710073 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: BaseDAO.add() missing 1 required positional argument: 'session'
2025-01-12, Sun, 09:43:39,285 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:43:39,285 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:43:39,286 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:46:37,149 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:46:37,227 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:46:42,502 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:46:42,503 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:46:42,505 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:46:42,505 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:46:42,506 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:46:42,506 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:46:42,507 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:46:42,513 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:46:42,514 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-12, Sun, 09:46:42,516 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:46:42,863 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:46:42,863 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:46:42,864 sqlalchemy.engine.Engine INFO [cached since 0.3502s ago] (2142024077,)
2025-01-12, Sun, 09:46:42,865 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:46:42,866 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:46:42,866 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:46:42,866 sqlalchemy.engine.Engine INFO [cached since 0.3529s ago] (2142024077,)
2025-01-12, Sun, 09:46:42,867 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:46:43,267 aiogram.event INFO Update id=450710074 is handled. Duration 1623 ms by bot id=7771835226
2025-01-12, Sun, 09:46:44,616 aiogram.event INFO Update id=450710075 is handled. Duration 157 ms by bot id=7771835226
2025-01-12, Sun, 09:46:48,289 aiogram.event INFO Update id=450710076 is handled. Duration 101 ms by bot id=7771835226
2025-01-12, Sun, 09:46:52,501 aiogram.event INFO Update id=450710077 is handled. Duration 101 ms by bot id=7771835226
2025-01-12, Sun, 09:47:00,70 aiogram.event INFO Update id=450710078 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 09:47:00,70 aiogram.event ERROR Cause exception while process update id=450710078 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(**data)
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'
2025-01-12, Sun, 09:48:15,443 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:48:15,444 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:48:15,444 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:48:23,851 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:48:24,203 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:48:28,738 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:48:28,739 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:48:28,741 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:48:28,741 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:48:28,742 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:48:28,742 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:48:28,743 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:48:28,749 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:48:28,749 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (2142024077,)
2025-01-12, Sun, 09:48:28,751 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:48:28,814 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:48:28,814 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:48:28,815 sqlalchemy.engine.Engine INFO [cached since 0.06582s ago] (2142024077,)
2025-01-12, Sun, 09:48:28,816 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:48:28,817 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:48:28,818 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:48:28,818 sqlalchemy.engine.Engine INFO [cached since 0.0692s ago] (2142024077,)
2025-01-12, Sun, 09:48:28,820 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:48:29,154 aiogram.event INFO Update id=450710079 is handled. Duration 905 ms by bot id=7771835226
2025-01-12, Sun, 09:48:31,829 aiogram.event INFO Update id=450710080 is handled. Duration 325 ms by bot id=7771835226
2025-01-12, Sun, 09:48:34,476 aiogram.event INFO Update id=450710081 is handled. Duration 201 ms by bot id=7771835226
2025-01-12, Sun, 09:48:37,7 aiogram.event INFO Update id=450710082 is handled. Duration 133 ms by bot id=7771835226
2025-01-12, Sun, 09:48:42,264 aiogram.event INFO Update id=450710083 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:48:42,264 aiogram.event ERROR Cause exception while process update id=450710083 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 22, in add_promocode
    promocode = await PromoDAO.add(data)
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'
2025-01-12, Sun, 09:53:01,717 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:53:01,718 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:53:01,718 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:53:05,826 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:53:05,871 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:53:08,486 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:53:08,486 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:53:08,488 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:53:08,488 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:53:08,489 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:53:08,489 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:53:08,490 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:53:08,497 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:53:08,497 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-12, Sun, 09:53:08,500 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:53:08,813 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:53:08,814 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:53:08,814 sqlalchemy.engine.Engine INFO [cached since 0.3168s ago] (2142024077,)
2025-01-12, Sun, 09:53:08,815 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:53:08,816 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:53:08,817 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:53:08,817 sqlalchemy.engine.Engine INFO [cached since 0.3196s ago] (2142024077,)
2025-01-12, Sun, 09:53:08,818 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:53:09,25 aiogram.event INFO Update id=450710084 is handled. Duration 1082 ms by bot id=7771835226
2025-01-12, Sun, 09:53:11,213 aiogram.event INFO Update id=450710085 is handled. Duration 249 ms by bot id=7771835226
2025-01-12, Sun, 09:53:13,489 aiogram.event INFO Update id=450710086 is handled. Duration 64 ms by bot id=7771835226
2025-01-12, Sun, 09:53:17,86 aiogram.event INFO Update id=450710087 is handled. Duration 80 ms by bot id=7771835226
2025-01-12, Sun, 09:53:25,297 aiogram.event INFO Update id=450710088 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:53:25,297 aiogram.event ERROR Cause exception while process update id=450710088 by bot id=7771835226
TypeError: unhashable type: 'dict'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = d.get(kwargs).update(d.get('args', 0))
TypeError: unhashable type: 'dict'
2025-01-12, Sun, 09:55:05,736 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:55:05,736 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:55:05,736 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:55:11,502 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:55:11,894 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:55:13,125 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:55:13,125 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:55:13,128 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:55:13,128 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:55:13,129 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:55:13,129 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:55:13,130 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:55:13,136 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:55:13,136 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-12, Sun, 09:55:13,138 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:55:13,435 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:55:13,435 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:55:13,435 sqlalchemy.engine.Engine INFO [cached since 0.3s ago] (2142024077,)
2025-01-12, Sun, 09:55:13,437 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:55:13,438 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:55:13,438 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:55:13,438 sqlalchemy.engine.Engine INFO [cached since 0.3026s ago] (2142024077,)
2025-01-12, Sun, 09:55:13,439 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:55:13,600 aiogram.event INFO Update id=450710089 is handled. Duration 975 ms by bot id=7771835226
2025-01-12, Sun, 09:55:15,102 aiogram.event INFO Update id=450710090 is handled. Duration 234 ms by bot id=7771835226
2025-01-12, Sun, 09:55:19,266 aiogram.event INFO Update id=450710091 is handled. Duration 200 ms by bot id=7771835226
2025-01-12, Sun, 09:55:24,81 aiogram.event INFO Update id=450710092 is handled. Duration 303 ms by bot id=7771835226
2025-01-12, Sun, 09:55:30,431 aiogram.event INFO Update id=450710093 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:55:30,431 aiogram.event ERROR Cause exception while process update id=450710093 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'update'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = d.get(tuple(kwargs.items())).update(d.get('args', 0))
AttributeError: 'NoneType' object has no attribute 'update'
2025-01-12, Sun, 09:56:33,195 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:56:33,196 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:56:33,196 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:56:37,246 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:56:37,319 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:56:40,191 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:56:40,191 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:56:40,193 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:56:40,193 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:56:40,194 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:56:40,194 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:56:40,195 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:56:40,201 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:56:40,201 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-12, Sun, 09:56:40,203 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:56:40,819 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:56:40,819 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:56:40,819 sqlalchemy.engine.Engine INFO [cached since 0.6182s ago] (2142024077,)
2025-01-12, Sun, 09:56:40,820 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:56:40,821 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:56:40,822 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:56:40,822 sqlalchemy.engine.Engine INFO [cached since 0.6207s ago] (2142024077,)
2025-01-12, Sun, 09:56:40,823 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:56:41,120 aiogram.event INFO Update id=450710094 is handled. Duration 1963 ms by bot id=7771835226
2025-01-12, Sun, 09:56:42,869 aiogram.event INFO Update id=450710095 is handled. Duration 183 ms by bot id=7771835226
2025-01-12, Sun, 09:56:45,521 aiogram.event INFO Update id=450710096 is handled. Duration 77 ms by bot id=7771835226
2025-01-12, Sun, 09:56:48,187 aiogram.event INFO Update id=450710097 is handled. Duration 63 ms by bot id=7771835226
2025-01-12, Sun, 09:56:54,195 aiogram.event INFO Update id=450710098 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 09:56:54,195 aiogram.event ERROR Cause exception while process update id=450710098 by bot id=7771835226
TypeError: tuple() argument after ** must be a mapping, not dict_items
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = d.get(tuple(**kwargs.items())).update(d.get('args', 0))
TypeError: tuple() argument after ** must be a mapping, not dict_items
2025-01-12, Sun, 09:57:34,686 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:57:34,686 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:57:34,687 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 09:57:40,297 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 09:57:40,340 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:57:43,682 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 09:57:43,682 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:57:43,685 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 09:57:43,685 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:57:43,686 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 09:57:43,686 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 09:57:43,687 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:57:43,693 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:57:43,693 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077,)
2025-01-12, Sun, 09:57:43,695 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:57:43,753 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:57:43,754 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:57:43,754 sqlalchemy.engine.Engine INFO [cached since 0.06149s ago] (2142024077,)
2025-01-12, Sun, 09:57:43,755 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:57:43,756 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 09:57:43,757 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 09:57:43,757 sqlalchemy.engine.Engine INFO [cached since 0.06463s ago] (2142024077,)
2025-01-12, Sun, 09:57:43,759 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 09:57:44,65 aiogram.event INFO Update id=450710099 is handled. Duration 1101 ms by bot id=7771835226
2025-01-12, Sun, 09:57:46,87 aiogram.event INFO Update id=450710100 is handled. Duration 123 ms by bot id=7771835226
2025-01-12, Sun, 09:57:47,697 aiogram.event INFO Update id=450710101 is handled. Duration 136 ms by bot id=7771835226
2025-01-12, Sun, 09:57:51,111 aiogram.event INFO Update id=450710102 is handled. Duration 79 ms by bot id=7771835226
2025-01-12, Sun, 09:57:56,459 aiogram.event INFO Update id=450710103 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 09:57:56,459 aiogram.event ERROR Cause exception while process update id=450710103 by bot id=7771835226
TypeError: tuple() takes no keyword arguments
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = d.get(tuple(**kwargs)).update(d.get('args', 0))
TypeError: tuple() takes no keyword arguments
2025-01-12, Sun, 09:58:56,550 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 09:58:56,550 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 09:58:56,550 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:16:21,232 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:16:21,618 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:16:25,213 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:16:25,213 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:16:25,215 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:16:25,215 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:16:25,217 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:16:25,217 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:16:25,218 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:16:25,225 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:16:25,225 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-12, Sun, 10:16:25,227 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:16:25,293 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:16:25,293 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:16:25,294 sqlalchemy.engine.Engine INFO [cached since 0.06904s ago] (2142024077,)
2025-01-12, Sun, 10:16:25,296 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:16:25,298 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:16:25,299 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:16:25,299 sqlalchemy.engine.Engine INFO [cached since 0.07409s ago] (2142024077,)
2025-01-12, Sun, 10:16:25,300 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:16:25,367 aiogram.event INFO Update id=450710104 is handled. Duration 344 ms by bot id=7771835226
2025-01-12, Sun, 10:16:26,448 aiogram.event INFO Update id=450710105 is handled. Duration 104 ms by bot id=7771835226
2025-01-12, Sun, 10:16:31,416 aiogram.event INFO Update id=450710106 is handled. Duration 324 ms by bot id=7771835226
2025-01-12, Sun, 10:16:35,658 aiogram.event INFO Update id=450710107 is handled. Duration 109 ms by bot id=7771835226
2025-01-12, Sun, 10:16:41,385 aiogram.event INFO Update id=450710108 is not handled. Duration 4 ms by bot id=7771835226
2025-01-12, Sun, 10:16:41,385 aiogram.event ERROR Cause exception while process update id=450710108 by bot id=7771835226
TypeError: 'NoneType' object is not iterable
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 21, in add_promocode
    data = dict(d.get(tuple(kwargs.items()))).update(d.get('args', 0))
TypeError: 'NoneType' object is not iterable
2025-01-12, Sun, 10:17:31,157 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:17:31,157 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:17:31,157 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:23:27,434 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:23:27,596 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:23:33,131 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:23:33,131 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:23:33,136 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:23:33,136 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:23:33,138 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:23:33,139 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:23:33,140 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:23:33,147 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:23:33,148 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077,)
2025-01-12, Sun, 10:23:33,151 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:23:33,237 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:23:33,238 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:23:33,238 sqlalchemy.engine.Engine INFO [cached since 0.09074s ago] (2142024077,)
2025-01-12, Sun, 10:23:33,239 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:23:33,241 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:23:33,241 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:23:33,241 sqlalchemy.engine.Engine INFO [cached since 0.09394s ago] (2142024077,)
2025-01-12, Sun, 10:23:33,242 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:23:33,641 aiogram.event INFO Update id=450710109 is handled. Duration 1476 ms by bot id=7771835226
2025-01-12, Sun, 10:23:41,644 aiogram.event INFO Update id=450710110 is handled. Duration 114 ms by bot id=7771835226
2025-01-12, Sun, 10:23:43,850 aiogram.event INFO Update id=450710111 is handled. Duration 69 ms by bot id=7771835226
2025-01-12, Sun, 10:23:48,494 aiogram.event INFO Update id=450710112 is handled. Duration 346 ms by bot id=7771835226
2025-01-12, Sun, 10:23:54,167 aiogram.event INFO Update id=450710113 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 10:23:54,167 aiogram.event ERROR Cause exception while process update id=450710113 by bot id=7771835226
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(data)
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'
2025-01-12, Sun, 10:25:49,801 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:25:49,802 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:25:49,802 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:25:53,848 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:25:54,164 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:25:58,225 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:25:58,225 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:25:58,227 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:25:58,227 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:25:58,228 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:25:58,228 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:25:58,229 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:25:58,237 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:25:58,237 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-12, Sun, 10:25:58,239 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:25:58,310 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:25:58,310 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:25:58,310 sqlalchemy.engine.Engine INFO [cached since 0.07356s ago] (2142024077,)
2025-01-12, Sun, 10:25:58,312 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:25:58,313 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:25:58,313 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:25:58,313 sqlalchemy.engine.Engine INFO [cached since 0.07645s ago] (2142024077,)
2025-01-12, Sun, 10:25:58,315 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:25:58,407 aiogram.event INFO Update id=450710114 is handled. Duration 638 ms by bot id=7771835226
2025-01-12, Sun, 10:26:00,160 aiogram.event INFO Update id=450710115 is handled. Duration 291 ms by bot id=7771835226
2025-01-12, Sun, 10:26:01,903 aiogram.event INFO Update id=450710116 is handled. Duration 60 ms by bot id=7771835226
2025-01-12, Sun, 10:26:05,74 aiogram.event INFO Update id=450710117 is handled. Duration 285 ms by bot id=7771835226
2025-01-12, Sun, 10:26:09,394 aiogram.event INFO Update id=450710118 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 10:26:09,394 aiogram.event ERROR Cause exception while process update id=450710118 by bot id=7771835226
TypeError: __init__() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 11, in add
    new_instance = cls.model(*args,**kwargs)
TypeError: __init__() takes 1 positional argument but 2 were given
2025-01-12, Sun, 10:27:35,260 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:27:35,261 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:27:35,261 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:27:39,620 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:27:39,664 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:27:41,784 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:27:41,785 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:27:41,787 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:27:41,787 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:27:41,788 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:27:41,788 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:27:41,789 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:27:41,794 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:27:41,794 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-12, Sun, 10:27:41,797 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:27:42,11 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:27:42,11 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:27:42,11 sqlalchemy.engine.Engine INFO [cached since 0.2173s ago] (2142024077,)
2025-01-12, Sun, 10:27:42,13 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:27:42,14 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:27:42,14 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:27:42,14 sqlalchemy.engine.Engine INFO [cached since 0.2201s ago] (2142024077,)
2025-01-12, Sun, 10:27:42,15 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:27:42,80 aiogram.event INFO Update id=450710119 is handled. Duration 609 ms by bot id=7771835226
2025-01-12, Sun, 10:27:43,335 aiogram.event INFO Update id=450710120 is handled. Duration 103 ms by bot id=7771835226
2025-01-12, Sun, 10:27:45,938 aiogram.event INFO Update id=450710121 is handled. Duration 189 ms by bot id=7771835226
2025-01-12, Sun, 10:27:48,874 aiogram.event INFO Update id=450710122 is handled. Duration 57 ms by bot id=7771835226
2025-01-12, Sun, 10:27:53,614 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:27:53,616 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id
2025-01-12, Sun, 10:27:53,616 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (None, None, 0, None, None, None)
2025-01-12, Sun, 10:27:53,618 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:27:53,619 aiogram.event INFO Update id=450710123 is not handled. Duration 7 ms by bot id=7771835226
2025-01-12, Sun, 10:27:53,619 aiogram.event ERROR Cause exception while process update id=450710123 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (2, null, null, 0, null, null, null).
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: (None, None, 0, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (2, null, null, 0, null, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (2, null, null, 0, null, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 17, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 14, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "promocode" of relation "promos" violates not-null constraint
DETAIL:  Failing row contains (2, null, null, 0, null, null, null).
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: (None, None, 0, None, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-12, Sun, 10:28:46,684 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:28:46,685 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:28:46,685 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:28:51,513 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:28:51,828 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:28:54,526 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:28:54,527 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:28:54,529 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:28:54,529 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:28:54,530 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:28:54,530 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:28:54,531 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:28:54,537 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:28:54,537 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-12, Sun, 10:28:54,539 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:28:54,874 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:28:54,875 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:28:54,875 sqlalchemy.engine.Engine INFO [cached since 0.3377s ago] (2142024077,)
2025-01-12, Sun, 10:28:54,876 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:28:54,877 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:28:54,877 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:28:54,877 sqlalchemy.engine.Engine INFO [cached since 0.3401s ago] (2142024077,)
2025-01-12, Sun, 10:28:54,878 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:28:55,18 aiogram.event INFO Update id=450710124 is handled. Duration 805 ms by bot id=7771835226
2025-01-12, Sun, 10:28:56,691 aiogram.event INFO Update id=450710125 is handled. Duration 81 ms by bot id=7771835226
2025-01-12, Sun, 10:29:11,90 aiogram.event INFO Update id=450710126 is handled. Duration 138 ms by bot id=7771835226
2025-01-12, Sun, 10:29:17,412 aiogram.event INFO Update id=450710127 is handled. Duration 112 ms by bot id=7771835226
2025-01-12, Sun, 10:29:30,168 aiogram.event INFO Update id=450710128 is not handled. Duration 3 ms by bot id=7771835226
2025-01-12, Sun, 10:29:30,168 aiogram.event ERROR Cause exception while process update id=450710128 by bot id=7771835226
ValueError: dictionary update sequence element #0 has length 5; 2 is required
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 11, in add
    new_instance = cls.model(**kwargs.update(args))
ValueError: dictionary update sequence element #0 has length 5; 2 is required
2025-01-12, Sun, 10:30:56,653 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:30:56,653 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:30:56,654 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:32:08,292 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:32:08,336 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:32:12,475 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:32:12,475 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:32:12,477 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:32:12,477 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:32:12,478 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:32:12,479 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:32:12,480 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:32:12,486 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:32:12,486 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-12, Sun, 10:32:12,489 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:32:12,566 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:32:12,566 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:32:12,567 sqlalchemy.engine.Engine INFO [cached since 0.08042s ago] (2142024077,)
2025-01-12, Sun, 10:32:12,568 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:32:12,569 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:32:12,570 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:32:12,570 sqlalchemy.engine.Engine INFO [cached since 0.08371s ago] (2142024077,)
2025-01-12, Sun, 10:32:12,572 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:32:12,882 aiogram.event INFO Update id=450710129 is handled. Duration 980 ms by bot id=7771835226
2025-01-12, Sun, 10:32:15,455 aiogram.event INFO Update id=450710130 is handled. Duration 178 ms by bot id=7771835226
2025-01-12, Sun, 10:32:20,998 aiogram.event INFO Update id=450710131 is handled. Duration 786 ms by bot id=7771835226
2025-01-12, Sun, 10:32:24,498 aiogram.event INFO Update id=450710132 is handled. Duration 222 ms by bot id=7771835226
2025-01-12, Sun, 10:32:29,915 aiogram.event INFO Update id=450710133 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 10:32:29,915 aiogram.event ERROR Cause exception while process update id=450710133 by bot id=7771835226
TypeError: db.models.models.Promo() argument after ** must be a mapping, not NoneType
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 11, in add
    new_instance = cls.model(**kwargs.update(*args))
TypeError: db.models.models.Promo() argument after ** must be a mapping, not NoneType
2025-01-12, Sun, 10:36:38,492 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:36:38,493 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:36:38,493 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:36:42,347 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:36:42,404 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:36:49,524 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:36:49,524 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:36:49,527 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:36:49,527 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:36:49,528 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:36:49,528 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:36:49,529 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:36:49,535 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:36:49,536 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-12, Sun, 10:36:49,539 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:36:49,784 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:36:49,784 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:36:49,784 sqlalchemy.engine.Engine INFO [cached since 0.249s ago] (2142024077,)
2025-01-12, Sun, 10:36:49,786 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:36:49,787 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:36:49,787 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:36:49,788 sqlalchemy.engine.Engine INFO [cached since 0.2524s ago] (2142024077,)
2025-01-12, Sun, 10:36:49,789 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:36:49,900 aiogram.event INFO Update id=450710134 is handled. Duration 745 ms by bot id=7771835226
2025-01-12, Sun, 10:36:55,549 aiogram.event INFO Update id=450710135 is handled. Duration 164 ms by bot id=7771835226
2025-01-12, Sun, 10:37:00,394 aiogram.event INFO Update id=450710136 is handled. Duration 182 ms by bot id=7771835226
2025-01-12, Sun, 10:37:04,410 aiogram.event INFO Update id=450710137 is handled. Duration 229 ms by bot id=7771835226
2025-01-12, Sun, 10:37:10,593 aiogram.event INFO Update id=450710138 is not handled. Duration 2 ms by bot id=7771835226
2025-01-12, Sun, 10:37:10,593 aiogram.event ERROR Cause exception while process update id=450710138 by bot id=7771835226
TypeError: 'message.from_user.id' is an invalid keyword argument for Promo
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 13, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2177, in _declarative_constructor
    raise TypeError(
TypeError: 'message.from_user.id' is an invalid keyword argument for Promo
2025-01-12, Sun, 10:40:17,930 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:40:17,930 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:40:17,931 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:40:22,325 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:40:22,372 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:40:24,562 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:40:24,562 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:40:24,565 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:40:24,565 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:40:24,566 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:40:24,566 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:40:24,567 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:40:24,575 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:40:24,575 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077,)
2025-01-12, Sun, 10:40:24,577 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:40:24,944 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:40:24,944 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:40:24,944 sqlalchemy.engine.Engine INFO [cached since 0.3697s ago] (2142024077,)
2025-01-12, Sun, 10:40:24,946 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:40:24,947 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:40:24,947 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:40:24,947 sqlalchemy.engine.Engine INFO [cached since 0.3722s ago] (2142024077,)
2025-01-12, Sun, 10:40:24,948 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:40:25,124 aiogram.event INFO Update id=450710139 is handled. Duration 988 ms by bot id=7771835226
2025-01-12, Sun, 10:40:27,6 aiogram.event INFO Update id=450710140 is handled. Duration 395 ms by bot id=7771835226
2025-01-12, Sun, 10:40:30,313 aiogram.event INFO Update id=450710141 is handled. Duration 146 ms by bot id=7771835226
2025-01-12, Sun, 10:40:32,866 aiogram.event INFO Update id=450710142 is handled. Duration 139 ms by bot id=7771835226
2025-01-12, Sun, 10:40:46,553 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:40:46,555 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id
2025-01-12, Sun, 10:40:46,555 sqlalchemy.engine.Engine INFO [generated in 0.00045s] ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '21.07.2025')
2025-01-12, Sun, 10:40:46,557 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:40:46,558 aiogram.event INFO Update id=450710143 is not handled. Duration 7 ms by bot id=7771835226
2025-01-12, Sun, 10:40:46,558 aiogram.event ERROR Cause exception while process update id=450710143 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '21.07.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::TIMESTAMP WITHOUT TIME ZONE) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '21.07.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 10:41:37,500 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-12, Sun, 10:41:37,501 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:41:37,501 aiogram.dispatcher INFO Polling stopped
2025-01-12, Sun, 10:43:13,917 aiogram.dispatcher INFO Start polling
2025-01-12, Sun, 10:43:14,212 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-12, Sun, 10:43:18,159 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-12, Sun, 10:43:18,159 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:43:18,161 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-12, Sun, 10:43:18,161 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:43:18,162 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-12, Sun, 10:43:18,162 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-12, Sun, 10:43:18,163 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:43:18,170 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:43:18,170 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (2142024077,)
2025-01-12, Sun, 10:43:18,173 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:43:18,232 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:43:18,232 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:43:18,232 sqlalchemy.engine.Engine INFO [cached since 0.06234s ago] (2142024077,)
2025-01-12, Sun, 10:43:18,233 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:43:18,234 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:43:18,234 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-12, Sun, 10:43:18,234 sqlalchemy.engine.Engine INFO [cached since 0.06472s ago] (2142024077,)
2025-01-12, Sun, 10:43:18,236 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:43:18,300 aiogram.event INFO Update id=450710144 is handled. Duration 1110 ms by bot id=7771835226
2025-01-12, Sun, 10:43:20,704 aiogram.event INFO Update id=450710145 is handled. Duration 144 ms by bot id=7771835226
2025-01-12, Sun, 10:43:28,389 aiogram.event INFO Update id=450710146 is handled. Duration 252 ms by bot id=7771835226
2025-01-12, Sun, 10:43:31,17 aiogram.event INFO Update id=450710147 is handled. Duration 103 ms by bot id=7771835226
2025-01-12, Sun, 10:43:41,144 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-12, Sun, 10:43:41,146 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-12, Sun, 10:43:41,146 sqlalchemy.engine.Engine INFO [generated in 0.00034s] ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '21.05.2025')
2025-01-12, Sun, 10:43:41,148 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-12, Sun, 10:43:41,149 aiogram.event INFO Update id=450710148 is not handled. Duration 8 ms by bot id=7771835226
2025-01-12, Sun, 10:43:41,149 aiogram.event ERROR Cause exception while process update id=450710148 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '21.05.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '21.05.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-12, Sun, 13:03:16,800 aiogram.dispatcher ERROR Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-01-12, Sun, 13:03:16,800 aiogram.dispatcher WARNING Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7771835226)
2025-01-12, Sun, 13:03:27,759 aiogram.dispatcher INFO Connection established (tryings = 1, bot id = 7771835226)
2025-01-15, Wed, 07:17:46,54 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 07:17:46,99 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:17:50,619 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 07:17:50,619 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:17:50,622 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 07:17:50,622 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:17:50,624 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 07:17:50,624 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:17:50,626 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:17:50,631 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:17:50,632 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (2142024077,)
2025-01-15, Wed, 07:17:50,636 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:17:50,846 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:17:50,846 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:17:50,846 sqlalchemy.engine.Engine INFO [cached since 0.2151s ago] (2142024077,)
2025-01-15, Wed, 07:17:50,848 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:17:50,849 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:17:50,849 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:17:50,849 sqlalchemy.engine.Engine INFO [cached since 0.218s ago] (2142024077,)
2025-01-15, Wed, 07:17:50,850 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:17:50,995 aiogram.event INFO Update id=450710149 is handled. Duration 854 ms by bot id=7771835226
2025-01-15, Wed, 07:17:52,702 aiogram.event INFO Update id=450710150 is handled. Duration 74 ms by bot id=7771835226
2025-01-15, Wed, 07:17:57,660 aiogram.event INFO Update id=450710151 is handled. Duration 161 ms by bot id=7771835226
2025-01-15, Wed, 07:18:01,395 aiogram.event INFO Update id=450710152 is handled. Duration 198 ms by bot id=7771835226
2025-01-15, Wed, 07:18:18,288 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:18:18,290 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-15, Wed, 07:18:18,290 sqlalchemy.engine.Engine INFO [generated in 0.00036s] ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.05.2025')
2025-01-15, Wed, 07:18:18,293 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:18:18,294 aiogram.event INFO Update id=450710153 is not handled. Duration 9 ms by bot id=7771835226
2025-01-15, Wed, 07:18:18,294 aiogram.event ERROR Cause exception while process update id=450710153 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.05.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.05.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-15, Wed, 07:21:36,906 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 07:21:36,907 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:21:36,907 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 07:21:41,161 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 07:21:41,423 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:21:45,375 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 07:21:45,375 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:21:45,377 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 07:21:45,377 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:21:45,378 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 07:21:45,378 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:21:45,379 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:21:45,383 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:21:45,383 aiogram.event INFO Update id=450710154 is not handled. Duration 736 ms by bot id=7771835226
2025-01-15, Wed, 07:21:45,383 aiogram.event ERROR Cause exception while process update id=450710154 by bot id=7771835226
ArgumentError: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 22, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 35, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2075, in _generate_backref
    raise sa_exc.ArgumentError(
sqlalchemy.exc.ArgumentError: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
2025-01-15, Wed, 07:21:55,620 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:21:55,621 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:21:55,622 aiogram.event INFO Update id=450710155 is not handled. Duration 241 ms by bot id=7771835226
2025-01-15, Wed, 07:21:55,622 aiogram.event ERROR Cause exception while process update id=450710155 by bot id=7771835226
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 22, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 35, in get_by_chat_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4252, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Error creating backref 'promocode' on relationship 'Promo.user': property of that name exists on mapper 'Mapper[User(users)]'
2025-01-15, Wed, 07:22:23,499 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 07:22:23,500 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:22:23,500 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 07:30:13,943 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 07:30:14,85 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:30:16,924 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 07:30:16,924 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:30:16,925 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 07:30:16,925 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:30:16,926 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 07:30:16,926 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:30:16,927 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:30:16,930 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:30:16,930 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077,)
2025-01-15, Wed, 07:30:16,932 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:30:17,204 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:30:17,204 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:30:17,205 sqlalchemy.engine.Engine INFO [cached since 0.2745s ago] (2142024077,)
2025-01-15, Wed, 07:30:17,206 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:30:17,208 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:30:17,208 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:30:17,208 sqlalchemy.engine.Engine INFO [cached since 0.278s ago] (2142024077,)
2025-01-15, Wed, 07:30:17,209 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:30:17,609 aiogram.event INFO Update id=450710156 is handled. Duration 1108 ms by bot id=7771835226
2025-01-15, Wed, 07:30:19,242 aiogram.event INFO Update id=450710157 is handled. Duration 300 ms by bot id=7771835226
2025-01-15, Wed, 07:30:23,676 aiogram.event INFO Update id=450710158 is handled. Duration 324 ms by bot id=7771835226
2025-01-15, Wed, 07:30:26,943 aiogram.event INFO Update id=450710159 is handled. Duration 122 ms by bot id=7771835226
2025-01-15, Wed, 07:30:40,456 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:30:40,459 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-15, Wed, 07:30:40,459 sqlalchemy.engine.Engine INFO [generated in 0.00044s] ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.04.2025')
2025-01-15, Wed, 07:30:40,461 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:30:40,462 aiogram.event INFO Update id=450710160 is not handled. Duration 8 ms by bot id=7771835226
2025-01-15, Wed, 07:30:40,462 aiogram.event ERROR Cause exception while process update id=450710160 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.04.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/int.pyx", line 105, in asyncpg.pgproto.pgproto.int8_encode
TypeError: 'str' object cannot be interpreted as an integer

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 78, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: '45000' ('str' object cannot be interpreted as an integer)
[SQL: INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id]
[parameters: ('Старт', '45000', 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.04.2025')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-15, Wed, 07:31:08,658 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 07:31:08,658 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:31:08,659 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 07:47:13,661 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 07:47:13,709 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:47:20,29 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 07:47:20,29 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:47:20,31 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 07:47:20,31 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:47:20,32 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 07:47:20,32 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:47:20,33 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:47:20,36 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:47:20,36 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-15, Wed, 07:47:20,38 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:47:20,413 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:47:20,413 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:47:20,414 sqlalchemy.engine.Engine INFO [cached since 0.3777s ago] (2142024077,)
2025-01-15, Wed, 07:47:20,415 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:47:20,417 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:47:20,417 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:47:20,417 sqlalchemy.engine.Engine INFO [cached since 0.3813s ago] (2142024077,)
2025-01-15, Wed, 07:47:20,419 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:47:20,643 aiogram.event INFO Update id=450710161 is handled. Duration 1338 ms by bot id=7771835226
2025-01-15, Wed, 07:47:21,903 aiogram.event INFO Update id=450710162 is handled. Duration 267 ms by bot id=7771835226
2025-01-15, Wed, 07:47:26,596 aiogram.event INFO Update id=450710163 is handled. Duration 86 ms by bot id=7771835226
2025-01-15, Wed, 07:47:30,821 aiogram.event INFO Update id=450710164 is handled. Duration 172 ms by bot id=7771835226
2025-01-15, Wed, 07:47:44,366 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:47:44,369 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-15, Wed, 07:47:44,369 sqlalchemy.engine.Engine INFO [generated in 0.00037s] ('Старт', 45000, 0, 'https://t.me/autoanswersmpbot?start=2142024077_Старт', 2142024077, '20.05.2025')
2025-01-15, Wed, 07:47:44,375 sqlalchemy.engine.Engine INFO COMMIT
2025-01-15, Wed, 07:47:44,660 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:47:44,661 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:47:44,661 sqlalchemy.engine.Engine INFO [cached since 24.62s ago] (2142024077,)
2025-01-15, Wed, 07:47:44,663 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:47:44,836 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:47:44,837 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-15, Wed, 07:47:44,837 sqlalchemy.engine.Engine INFO [cached since 24.8s ago] (2142024077,)
2025-01-15, Wed, 07:47:44,838 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:47:44,899 aiogram.event INFO Update id=450710165 is handled. Duration 535 ms by bot id=7771835226
2025-01-15, Wed, 07:53:01,246 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 07:53:01,247 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:53:01,247 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 07:53:05,916 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 07:53:05,963 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:53:08,689 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 07:53:08,689 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:53:08,691 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 07:53:08,691 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:53:08,692 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 07:53:08,692 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:53:08,693 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:53:08,696 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 07:53:08,696 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-15, Wed, 07:53:08,698 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:53:08,699 aiogram.event INFO Update id=450710166 is not handled. Duration 36 ms by bot id=7771835226
2025-01-15, Wed, 07:53:08,699 aiogram.event ERROR Cause exception while process update id=450710166 by bot id=7771835226
AttributeError: 'Promo' object has no attribute 'User'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in callback_marketer
    dictionry = [[i.promocode, i.price, i.expire_date, i.User.username] for i in promos_list]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in <listcomp>
    dictionry = [[i.promocode, i.price, i.expire_date, i.User.username] for i in promos_list]
AttributeError: 'Promo' object has no attribute 'User'
2025-01-15, Wed, 07:53:53,886 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 07:53:53,886 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:53:53,886 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 07:53:58,430 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 07:53:58,474 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 07:54:01,330 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 07:54:01,330 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:54:01,333 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 07:54:01,333 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:54:01,335 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 07:54:01,335 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 07:54:01,336 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:54:01,341 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 07:54:01,341 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-15, Wed, 07:54:01,343 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:54:01,343 aiogram.event INFO Update id=450710167 is handled. Duration 46 ms by bot id=7771835226
2025-01-15, Wed, 07:54:36,628 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 07:54:36,628 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 07:54:36,628 sqlalchemy.engine.Engine INFO [cached since 35.29s ago] (2142024077,)
2025-01-15, Wed, 07:54:36,629 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 07:54:36,630 aiogram.event INFO Update id=450710168 is handled. Duration 3 ms by bot id=7771835226
2025-01-15, Wed, 08:00:14,96 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:00:14,97 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:00:14,97 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:00:20,275 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:00:20,490 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:00:22,889 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:00:22,889 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:00:22,891 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:00:22,891 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:00:22,892 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:00:22,892 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:00:22,893 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:00:22,896 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 08:00:22,896 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-15, Wed, 08:00:22,898 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:00:22,898 aiogram.event INFO Update id=450710169 is handled. Duration 36 ms by bot id=7771835226
2025-01-15, Wed, 08:07:16,551 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:07:16,551 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:07:16,552 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:07:20,465 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:07:20,510 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:07:23,998 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:07:23,998 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:07:24,1 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:07:24,1 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:07:24,3 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:07:24,3 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:07:24,4 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:07:24,7 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 08:07:24,8 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-15, Wed, 08:07:24,9 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:07:24,10 aiogram.event INFO Update id=450710170 is not handled. Duration 40 ms by bot id=7771835226
2025-01-15, Wed, 08:07:24,10 aiogram.event ERROR Cause exception while process update id=450710170 by bot id=7771835226
AttributeError: 'Promo' object has no attribute 'User'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in callback_marketer
    dictionry = [[i.promocode, i.price, i.expire_date, i.User.username] for i in promos_list]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in <listcomp>
    dictionry = [[i.promocode, i.price, i.expire_date, i.User.username] for i in promos_list]
AttributeError: 'Promo' object has no attribute 'User'
2025-01-15, Wed, 08:08:14,968 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:08:14,968 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:08:14,969 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:10:33,659 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:10:33,901 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:10:36,245 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:10:36,245 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:10:36,247 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:10:36,247 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:10:36,249 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:10:36,249 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:10:36,250 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:10:36,253 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 08:10:36,253 sqlalchemy.engine.Engine INFO [generated in 0.00021s] (2142024077,)
2025-01-15, Wed, 08:10:36,254 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:10:36,255 aiogram.event INFO Update id=450710171 is not handled. Duration 37 ms by bot id=7771835226
2025-01-15, Wed, 08:10:36,255 aiogram.event ERROR Cause exception while process update id=450710171 by bot id=7771835226
AttributeError: 'Promo' object has no attribute 'user'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in callback_marketer
    dictionry = [[i.promocode, i.price, i.expire_date, i.user.username] for i in promos_list]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in <listcomp>
    dictionry = [[i.promocode, i.price, i.expire_date, i.user.username] for i in promos_list]
AttributeError: 'Promo' object has no attribute 'user'
2025-01-15, Wed, 08:10:52,226 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:10:52,227 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:10:52,227 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:12:25,662 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:12:25,722 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:12:28,9 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:12:28,10 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:12:28,12 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:12:28,12 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:12:28,13 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:12:28,13 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:12:28,14 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:12:28,17 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 08:12:28,17 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-15, Wed, 08:12:28,19 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:12:28,19 aiogram.event INFO Update id=450710172 is not handled. Duration 37 ms by bot id=7771835226
2025-01-15, Wed, 08:12:28,19 aiogram.event ERROR Cause exception while process update id=450710172 by bot id=7771835226
AttributeError: 'Promo' object has no attribute 'users'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in callback_marketer
    dictionry = [[i.promocode, i.price, i.expire_date, i.users.username] for i in promos_list]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in <listcomp>
    dictionry = [[i.promocode, i.price, i.expire_date, i.users.username] for i in promos_list]
AttributeError: 'Promo' object has no attribute 'users'
2025-01-15, Wed, 08:13:07,493 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:13:07,494 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:13:07,494 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:15:10,968 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:15:11,15 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:15:13,108 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:15:13,109 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:15:13,109 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:15:25,367 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:15:25,416 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:15:28,829 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:15:28,829 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:15:28,831 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:15:28,832 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:15:28,833 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:15:28,833 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:15:28,833 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:15:28,836 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:15:28,837 aiogram.event INFO Update id=450710173 is not handled. Duration 35 ms by bot id=7771835226
2025-01-15, Wed, 08:15:28,837 aiogram.event ERROR Cause exception while process update id=450710173 by bot id=7771835226
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'promos'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
KeyError: 'promos'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 36, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 31, in get_all
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'promos'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-15, Wed, 08:16:37,453 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:16:37,454 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:16:37,454 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:17:10,589 asyncio ERROR Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x70f8c8977be0>
2025-01-15, Wed, 08:17:22,265 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:17:22,517 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:17:22,609 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:17:22,609 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:17:22,611 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:17:22,612 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:17:22,613 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:17:22,613 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:17:22,614 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:17:22,617 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:17:22,618 aiogram.event INFO Update id=450710174 is not handled. Duration 35 ms by bot id=7771835226
2025-01-15, Wed, 08:17:22,618 aiogram.event ERROR Cause exception while process update id=450710174 by bot id=7771835226
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'pomocode'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2520, in get_property
    return self._props[key]
KeyError: 'pomocode'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 36, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 31, in get_all
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1578, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2522, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'pomocode'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-15, Wed, 08:17:24,175 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:17:24,176 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:17:24,176 aiogram.event INFO Update id=450710175 is not handled. Duration 2 ms by bot id=7771835226
2025-01-15, Wed, 08:17:24,176 aiogram.event ERROR Cause exception while process update id=450710175 by bot id=7771835226
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'pomocode'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 36, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 31, in get_all
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4252, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Promo(promos)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'pomocode'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-01-15, Wed, 08:18:54,132 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:18:54,133 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:18:54,133 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:18:58,112 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:18:58,157 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:18:59,943 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:18:59,943 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:18:59,945 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:18:59,945 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:18:59,946 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:18:59,946 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:18:59,947 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:18:59,950 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:18:59,950 aiogram.event INFO Update id=450710176 is not handled. Duration 35 ms by bot id=7771835226
2025-01-15, Wed, 08:18:59,950 aiogram.event ERROR Cause exception while process update id=450710176 by bot id=7771835226
InvalidRequestError: back_populates on relationship 'Promo.user' refers to attribute 'User.chat_id' that is not a relationship.  The back_populates parameter should refer to the name of a relationship on the target class.
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 36, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 31, in get_all
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1632, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 703, in _compile_w_cache
    compiled_sql = self._compiler(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 1429, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 870, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 915, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/visitors.py", line 141, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/compiler.py", line 4679, in visit_select
    compile_state = select_stmt._compile_state_factory(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/base.py", line 683, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 1110, in create_for_statement
    _QueryEntity.to_compile_state(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2565, in to_compile_state
    _MapperEntity(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 2645, in __init__
    entity._post_inspect
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 1253, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2722, in _post_inspect
    self._check_configure()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2399, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4215, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 4256, in _do_configure_registries
    mapper._post_configure_properties()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/mapper.py", line 2416, in _post_configure_properties
    prop.init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/interfaces.py", line 589, in init
    self.do_init()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1647, in do_init
    self._generate_backref()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 2133, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/relationships.py", line 1580, in _add_reverse_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: back_populates on relationship 'Promo.user' refers to attribute 'User.chat_id' that is not a relationship.  The back_populates parameter should refer to the name of a relationship on the target class.
2025-01-15, Wed, 08:20:54,868 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:20:54,868 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:20:54,868 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:20:58,758 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:20:58,805 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:21:03,598 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:21:03,598 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:21:03,601 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:21:03,601 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:21:03,602 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:21:03,602 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:21:03,603 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:21:03,609 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 08:21:03,610 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-15, Wed, 08:21:03,612 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:21:03,613 aiogram.event INFO Update id=450710177 is not handled. Duration 44 ms by bot id=7771835226
2025-01-15, Wed, 08:21:03,613 aiogram.event ERROR Cause exception while process update id=450710177 by bot id=7771835226
DetachedInstanceError: Parent instance <Promo at 0x7a2325f7c910> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in callback_marketer
    dictionry = [[i.promocode, i.price, i.expire_date, i.user.username] for i in promos_list]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 37, in <listcomp>
    dictionry = [[i.promocode, i.price, i.expire_date, i.user.username] for i in promos_list]
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1121, in _fire_loader_callables
    return self.callable_(state, passive)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Promo at 0x7a2325f7c910> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-01-15, Wed, 08:25:58,183 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:25:58,183 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:25:58,184 aiogram.dispatcher INFO Polling stopped
2025-01-15, Wed, 08:26:02,670 aiogram.dispatcher INFO Start polling
2025-01-15, Wed, 08:26:02,821 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:26:04,979 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-15, Wed, 08:26:04,979 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:26:04,981 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-15, Wed, 08:26:04,981 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:26:04,982 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-15, Wed, 08:26:04,982 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-15, Wed, 08:26:04,983 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-15, Wed, 08:26:04,991 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-15, Wed, 08:26:04,991 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-15, Wed, 08:26:04,996 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-15, Wed, 08:26:04,997 aiogram.event INFO Update id=450710178 is not handled. Duration 47 ms by bot id=7771835226
2025-01-15, Wed, 08:26:04,997 aiogram.event ERROR Cause exception while process update id=450710178 by bot id=7771835226
InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 36, in callback_marketer
    promos_list = await get_all_promos(call.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 9, in get_all_promos
    return await PromoDAO.get_all(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 32, in get_all
    records = result.scalars().all()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 1769, in all
    return self._allrows()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 562, in _allrows
    for made_row, sig_row in [
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 565, in <listcomp>
    strategy(made_row) if strategy else made_row,
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-01-15, Wed, 08:41:52,396 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-15, Wed, 08:41:52,396 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-15, Wed, 08:41:52,397 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 10:44:34,435 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 10:44:34,481 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:44:45,735 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 10:44:45,736 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:44:45,740 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 10:44:45,740 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:44:45,744 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 10:44:45,744 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:44:45,746 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:44:45,766 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance, promos_1.id, promos_1.promocode AS promocode_1, promos_1.price, promos_1.quantity, promos_1.referal, promos_1.chat_id AS chat_id_1, promos_1.expire_date 
FROM users LEFT OUTER JOIN promos AS promos_1 ON users.chat_id = promos_1.chat_id 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:44:45,766 sqlalchemy.engine.Engine INFO [generated in 0.00056s] (2142024077,)
2025-01-18, Sat, 10:44:45,771 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:44:45,773 aiogram.event INFO Update id=450710179 is not handled. Duration 468 ms by bot id=7771835226
2025-01-18, Sat, 10:44:45,773 aiogram.event ERROR Cause exception while process update id=450710179 by bot id=7771835226
InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 22, in start
    if(await get_user(chat_id=message.from_user.id)):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 6, in get_user
    return await UserDAO.get_by_chat_id(chat_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 38, in get_by_chat_id
    records = result.scalar_one_or_none()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 1487, in scalar_one_or_none
    return self._only_one_row(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-01-18, Sat, 10:46:03,141 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 10:46:03,141 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:46:03,142 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 10:46:09,287 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 10:46:09,338 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:46:09,767 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 10:46:09,767 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:46:09,771 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 10:46:09,771 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:46:09,774 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 10:46:09,775 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:46:09,778 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:46:09,795 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:46:09,795 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-18, Sat, 10:46:09,799 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:46:09,861 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:46:09,864 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:46:09,864 sqlalchemy.engine.Engine INFO [cached since 0.0692s ago] (2142024077,)
2025-01-18, Sat, 10:46:09,866 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:46:09,868 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:46:09,868 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:46:09,869 sqlalchemy.engine.Engine INFO [cached since 0.0741s ago] (2142024077,)
2025-01-18, Sat, 10:46:09,871 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:46:09,986 aiogram.event INFO Update id=450710180 is handled. Duration 460 ms by bot id=7771835226
2025-01-18, Sat, 10:46:13,486 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:46:13,491 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 10:46:13,492 sqlalchemy.engine.Engine INFO [generated in 0.00072s] (2142024077,)
2025-01-18, Sat, 10:46:13,497 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:46:13,498 aiogram.event INFO Update id=450710181 is handled. Duration 13 ms by bot id=7771835226
2025-01-18, Sat, 10:48:53,103 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 10:48:53,104 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:48:53,104 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 10:51:08,812 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 10:51:08,858 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:51:11,379 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 10:51:11,379 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:51:11,383 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 10:51:11,383 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:51:11,386 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 10:51:11,386 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:51:11,389 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:51:11,403 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:51:11,403 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-18, Sat, 10:51:11,408 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:51:11,531 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:51:11,534 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:51:11,534 sqlalchemy.engine.Engine INFO [cached since 0.1317s ago] (2142024077,)
2025-01-18, Sat, 10:51:11,537 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:51:11,539 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:51:11,539 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:51:11,539 sqlalchemy.engine.Engine INFO [cached since 0.1365s ago] (2142024077,)
2025-01-18, Sat, 10:51:11,542 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:51:11,619 aiogram.event INFO Update id=450710182 is handled. Duration 883 ms by bot id=7771835226
2025-01-18, Sat, 10:51:13,464 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:51:13,466 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date 
FROM promos 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 10:51:13,466 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077,)
2025-01-18, Sat, 10:51:13,476 sqlalchemy.engine.Engine INFO SELECT users.chat_id AS users_chat_id, users.username AS users_username, users.first_name AS users_first_name, users.promocode AS users_promocode, users.marketer AS users_marketer, users.balance AS users_balance, anon_1.promos_chat_id AS anon_1_promos_chat_id 
FROM (SELECT DISTINCT promos.chat_id AS promos_chat_id 
FROM promos 
WHERE promos.chat_id = $1::BIGINT) AS anon_1 JOIN users ON users.chat_id = anon_1.promos_chat_id
2025-01-18, Sat, 10:51:13,476 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (2142024077,)
2025-01-18, Sat, 10:51:13,480 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:51:13,481 aiogram.event INFO Update id=450710183 is handled. Duration 18 ms by bot id=7771835226
2025-01-18, Sat, 10:51:58,791 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 10:51:58,792 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:51:58,792 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 10:52:04,582 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 10:52:04,633 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:52:08,122 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 10:52:08,123 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:52:08,127 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 10:52:08,127 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:52:08,131 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 10:52:08,131 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:52:08,133 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:52:08,151 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 10:52:08,151 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (2142024077,)
2025-01-18, Sat, 10:52:08,156 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:52:08,158 aiogram.event INFO Update id=450710184 is handled. Duration 89 ms by bot id=7771835226
2025-01-18, Sat, 10:52:59,8 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 10:52:59,9 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:52:59,9 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 10:53:30,784 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 10:53:31,100 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:53:31,938 aiogram.event INFO Update id=450710185 is handled. Duration 614 ms by bot id=7771835226
2025-01-18, Sat, 10:53:45,920 aiogram.event INFO Update id=450710186 is handled. Duration 78 ms by bot id=7771835226
2025-01-18, Sat, 10:53:52,908 aiogram.event INFO Update id=450710187 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 10:53:52,908 aiogram.event ERROR Cause exception while process update id=450710187 by bot id=7771835226
ValueError: invalid literal for int() with base 10: '/start'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 55, in new_promo
    promos_dict[message.from_user.id]['price'] = int(var.replace(' ','').replace('.','').replace(',',''))
ValueError: invalid literal for int() with base 10: '/start'
2025-01-18, Sat, 10:54:55,969 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 10:54:56,68 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:54:59,914 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 10:54:59,914 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:54:59,918 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 10:54:59,918 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:54:59,921 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 10:54:59,921 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 10:54:59,923 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:54:59,938 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:54:59,938 sqlalchemy.engine.Engine INFO [generated in 0.00053s] (2142024077,)
2025-01-18, Sat, 10:54:59,942 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:55:00,39 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:55:00,42 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:55:00,42 sqlalchemy.engine.Engine INFO [cached since 0.1039s ago] (2142024077,)
2025-01-18, Sat, 10:55:00,44 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:55:00,46 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:55:00,46 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 10:55:00,47 sqlalchemy.engine.Engine INFO [cached since 0.1087s ago] (2142024077,)
2025-01-18, Sat, 10:55:00,49 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:55:00,372 aiogram.event INFO Update id=450710188 is handled. Duration 1203 ms by bot id=7771835226
2025-01-18, Sat, 10:55:02,847 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:55:02,851 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 10:55:02,852 sqlalchemy.engine.Engine INFO [generated in 0.00036s] (2142024077,)
2025-01-18, Sat, 10:55:02,856 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:55:02,858 aiogram.event INFO Update id=450710189 is handled. Duration 12 ms by bot id=7771835226
2025-01-18, Sat, 10:55:58,641 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 10:55:58,642 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 10:55:58,642 sqlalchemy.engine.Engine INFO [cached since 55.79s ago] (2142024077,)
2025-01-18, Sat, 10:55:58,644 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 10:55:58,645 aiogram.event INFO Update id=450710190 is handled. Duration 5 ms by bot id=7771835226
2025-01-18, Sat, 10:58:24,956 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 10:58:24,956 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 10:58:24,957 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 11:10:39,889 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 11:10:39,944 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:10:41,667 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 11:10:41,668 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:10:41,672 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 11:10:41,672 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:10:41,676 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 11:10:41,676 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:10:41,678 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:10:41,697 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 11:10:41,697 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (2142024077,)
2025-01-18, Sat, 11:10:41,702 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:10:41,703 aiogram.event INFO Update id=450710191 is handled. Duration 90 ms by bot id=7771835226
2025-01-18, Sat, 11:12:01,356 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 11:12:01,357 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:12:01,357 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 11:15:33,734 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 11:15:33,804 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:15:41,325 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 11:15:41,325 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:15:41,330 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 11:15:41,330 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:15:41,334 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 11:15:41,334 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:15:41,336 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:15:41,351 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 11:15:41,351 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (2142024077,)
2025-01-18, Sat, 11:15:41,355 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:15:41,711 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:15:41,713 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 11:15:41,713 sqlalchemy.engine.Engine INFO [cached since 0.3625s ago] (2142024077,)
2025-01-18, Sat, 11:15:41,716 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:15:41,717 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:15:41,717 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 11:15:41,718 sqlalchemy.engine.Engine INFO [cached since 0.3667s ago] (2142024077,)
2025-01-18, Sat, 11:15:41,720 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:15:41,905 aiogram.event INFO Update id=450710192 is handled. Duration 1635 ms by bot id=7771835226
2025-01-18, Sat, 11:15:47,538 aiogram.event INFO Update id=450710193 is handled. Duration 332 ms by bot id=7771835226
2025-01-18, Sat, 11:15:58,303 aiogram.event INFO Update id=450710194 is handled. Duration 133 ms by bot id=7771835226
2025-01-18, Sat, 11:16:07,256 aiogram.event INFO Update id=450710195 is handled. Duration 381 ms by bot id=7771835226
2025-01-18, Sat, 11:16:24,693 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:16:24,696 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-18, Sat, 11:16:24,696 sqlalchemy.engine.Engine INFO [generated in 0.00037s] ('Second', 34000, 0, 'https://t.me/autoanswersmpbot?start=2142024077_Second', 2142024077, '20.04.2025')
2025-01-18, Sat, 11:16:24,701 sqlalchemy.engine.Engine INFO COMMIT
2025-01-18, Sat, 11:16:25,0 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:16:25,1 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 11:16:25,1 sqlalchemy.engine.Engine INFO [cached since 43.65s ago] (2142024077,)
2025-01-18, Sat, 11:16:25,3 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:16:25,405 aiogram.event INFO Update id=450710196 is handled. Duration 715 ms by bot id=7771835226
2025-01-18, Sat, 11:16:28,849 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:16:28,853 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 11:16:28,854 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (2142024077,)
2025-01-18, Sat, 11:16:28,858 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:16:28,860 aiogram.event INFO Update id=450710197 is not handled. Duration 11 ms by bot id=7771835226
2025-01-18, Sat, 11:16:28,860 aiogram.event ERROR Cause exception while process update id=450710197 by bot id=7771835226
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<function marketer_menu_kb at 0x71b476cbcb80>, input_type=function]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 38, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {dictionry}", reply_markup=marketer_menu_kb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/types/message.py", line 3670, in edit_text
    return EditMessageText(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<function marketer_menu_kb at 0x71b476cbcb80>, input_type=function]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-01-18, Sat, 11:18:04,626 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 11:18:04,627 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:18:04,627 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 11:18:10,708 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 11:18:10,996 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:18:13,27 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 11:18:13,27 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:18:13,31 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 11:18:13,31 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:18:13,35 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 11:18:13,35 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:18:13,37 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:18:13,56 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 11:18:13,56 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (2142024077,)
2025-01-18, Sat, 11:18:13,61 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:18:13,62 aiogram.event INFO Update id=450710198 is not handled. Duration 89 ms by bot id=7771835226
2025-01-18, Sat, 11:18:13,63 aiogram.event ERROR Cause exception while process update id=450710198 by bot id=7771835226
ValidationError: 1 validation error for EditMessageCaption
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<function marketer_menu_kb at 0x7418f75b0550>, input_type=function]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 38, in callback_marketer
    await call.message.edit_caption(caption=f"Ваши промокоды: \n\n {dictionry}", reply_markup=marketer_menu_kb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/types/message.py", line 3995, in edit_caption
    return EditMessageCaption(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageCaption
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<function marketer_menu_kb at 0x7418f75b0550>, input_type=function]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-01-18, Sat, 11:20:24,239 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 11:20:24,240 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:20:24,241 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 11:20:30,390 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 11:20:30,438 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:20:30,570 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 11:20:30,570 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:20:30,574 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 11:20:30,574 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:20:30,577 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 11:20:30,577 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:20:30,579 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:20:30,597 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 11:20:30,597 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (2142024077,)
2025-01-18, Sat, 11:20:30,603 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:20:30,604 aiogram.event INFO Update id=450710199 is not handled. Duration 89 ms by bot id=7771835226
2025-01-18, Sat, 11:20:30,605 aiogram.event ERROR Cause exception while process update id=450710199 by bot id=7771835226
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<function marketer_menu_kb at 0x7a42b88d8550>, input_type=function]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 39, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", reply_markup=marketer_menu_kb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/types/message.py", line 3670, in edit_text
    return EditMessageText(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 214, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=<function marketer_menu_kb at 0x7a42b88d8550>, input_type=function]
    For further information visit https://errors.pydantic.dev/2.10/v/model_type
2025-01-18, Sat, 11:21:39,150 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 11:21:39,151 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:21:39,151 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 11:23:17,787 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 11:23:17,954 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:23:21,21 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 11:23:21,21 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:23:21,26 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 11:23:21,26 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:23:21,29 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 11:23:21,29 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 11:23:21,32 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 11:23:21,50 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 11:23:21,51 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (2142024077,)
2025-01-18, Sat, 11:23:21,56 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 11:23:21,913 aiogram.event INFO Update id=450710200 is handled. Duration 947 ms by bot id=7771835226
2025-01-18, Sat, 11:40:56,433 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 11:40:56,434 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 11:40:56,435 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:05:36,370 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:05:36,720 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:05:43,333 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:05:43,333 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:05:43,337 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:05:43,337 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:05:43,340 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:05:43,340 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:05:43,342 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:05:43,360 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:05:43,360 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-18, Sat, 12:05:43,365 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:05:43,809 aiogram.event INFO Update id=450710201 is handled. Duration 531 ms by bot id=7771835226
2025-01-18, Sat, 12:11:11,407 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:11:11,408 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:11:11,409 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:11:17,685 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:11:17,736 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:11:19,343 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:11:19,343 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:11:19,349 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:11:19,349 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:11:19,352 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:11:19,353 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:11:19,355 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:11:19,374 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:11:19,375 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-18, Sat, 12:11:19,380 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:11:19,790 aiogram.event INFO Update id=450710202 is handled. Duration 500 ms by bot id=7771835226
2025-01-18, Sat, 12:13:20,689 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:13:20,690 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:13:20,690 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:13:26,927 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:13:26,977 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:13:28,604 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:13:28,604 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:13:28,608 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:13:28,608 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:13:28,612 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:13:28,612 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:13:28,614 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:13:28,633 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:13:28,633 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077,)
2025-01-18, Sat, 12:13:28,639 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:13:29,340 aiogram.event INFO Update id=450710203 is handled. Duration 791 ms by bot id=7771835226
2025-01-18, Sat, 12:14:00,421 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:14:00,421 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:14:00,422 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:14:06,827 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:14:06,884 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:14:08,323 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:14:08,323 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:14:08,328 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:14:08,329 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:14:08,333 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:14:08,333 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:14:08,336 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:14:08,358 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:14:08,358 sqlalchemy.engine.Engine INFO [generated in 0.00066s] (2142024077,)
2025-01-18, Sat, 12:14:08,363 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:14:08,974 aiogram.event INFO Update id=450710204 is handled. Duration 711 ms by bot id=7771835226
2025-01-18, Sat, 12:19:16,875 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:19:16,876 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:19:16,876 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:19:23,19 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:19:23,259 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:19:24,345 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:19:24,345 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:19:24,350 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:19:24,350 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:19:24,354 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:19:24,354 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:19:24,356 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:19:24,376 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:19:24,376 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (2142024077,)
2025-01-18, Sat, 12:19:24,382 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:19:24,913 aiogram.event INFO Update id=450710205 is handled. Duration 627 ms by bot id=7771835226
2025-01-18, Sat, 12:21:15,676 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:21:15,677 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:21:15,677 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:21:21,722 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:21:21,891 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:21:25,709 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:21:25,709 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:21:25,714 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:21:25,715 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:21:25,718 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:21:25,719 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:21:25,722 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:21:25,742 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 12:21:25,743 sqlalchemy.engine.Engine INFO [generated in 0.00066s] (2142024077,)
2025-01-18, Sat, 12:21:25,748 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:21:25,827 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:21:25,832 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 12:21:25,832 sqlalchemy.engine.Engine INFO [cached since 0.09022s ago] (2142024077,)
2025-01-18, Sat, 12:21:25,835 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:21:25,837 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:21:25,838 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 12:21:25,838 sqlalchemy.engine.Engine INFO [cached since 0.09604s ago] (2142024077,)
2025-01-18, Sat, 12:21:25,841 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:21:25,969 aiogram.event INFO Update id=450710206 is handled. Duration 1183 ms by bot id=7771835226
2025-01-18, Sat, 12:21:28,170 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:21:28,175 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:21:28,175 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (2142024077,)
2025-01-18, Sat, 12:21:28,180 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:21:28,593 aiogram.event INFO Update id=450710207 is handled. Duration 425 ms by bot id=7771835226
2025-01-18, Sat, 12:30:31,112 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:30:31,113 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:30:31,114 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:34:47,603 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:34:47,649 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:34:50,665 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:34:50,666 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:34:50,670 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:34:50,670 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:34:50,673 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:34:50,673 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:34:50,676 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:34:50,695 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:34:50,695 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-18, Sat, 12:34:50,700 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:34:50,892 aiogram.event INFO Update id=450710208 is handled. Duration 279 ms by bot id=7771835226
2025-01-18, Sat, 12:34:53,341 aiogram.event INFO Update id=450710209 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 12:35:43,150 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:35:43,151 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:35:43,151 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:35:48,739 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:35:48,787 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:35:50,468 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:35:50,469 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:35:50,473 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:35:50,474 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:35:50,477 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:35:50,477 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:35:50,480 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:35:50,499 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:35:50,499 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (2142024077,)
2025-01-18, Sat, 12:35:50,505 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:35:50,941 aiogram.event INFO Update id=450710210 is handled. Duration 540 ms by bot id=7771835226
2025-01-18, Sat, 12:36:03,826 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:36:03,827 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:36:03,827 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:42:09,124 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:42:09,267 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:42:13,733 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:42:13,733 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:42:13,737 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:42:13,738 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:42:13,741 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:42:13,741 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:42:13,744 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:42:13,761 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:42:13,762 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (2142024077,)
2025-01-18, Sat, 12:42:13,766 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:42:14,2 aiogram.event INFO Update id=450710211 is not handled. Duration 323 ms by bot id=7771835226
2025-01-18, Sat, 12:42:14,2 aiogram.event ERROR Cause exception while process update id=450710211 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='html', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-01-18, Sat, 12:42:29,583 aiogram.event INFO Update id=450710212 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 12:43:46,446 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:43:46,447 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:43:46,447 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:43:53,32 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:43:53,410 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:43:54,925 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:43:54,926 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:43:54,931 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:43:54,931 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:43:54,936 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:43:54,936 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:43:54,944 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:43:54,969 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 12:43:54,970 sqlalchemy.engine.Engine INFO [generated in 0.00064s] (2142024077,)
2025-01-18, Sat, 12:43:54,975 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:43:55,296 aiogram.event INFO Update id=450710213 is handled. Duration 425 ms by bot id=7771835226
2025-01-18, Sat, 12:43:56,789 aiogram.event INFO Update id=450710214 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 12:43:56,789 aiogram.event ERROR Cause exception while process update id=450710214 by bot id=7771835226
AttributeError: 'Message' object has no attribute 'data'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 113, in trigger
    result, data = await handler.check(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 94, in check
    check = await event_filter.call(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 48, in call
    return await loop.run_in_executor(None, wrapped)
  File "/usr/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 104, in <lambda>
    dp.message.register(edit_promo, lambda c: c.data in('/edit_promo'))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Message' object has no attribute 'data'
2025-01-18, Sat, 12:45:05,185 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:45:05,186 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:45:05,187 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:45:10,773 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:45:10,823 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:45:14,645 aiogram.event INFO Update id=450710215 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 12:45:14,645 aiogram.event ERROR Cause exception while process update id=450710215 by bot id=7771835226
AttributeError: 'Message' object has no attribute 'data'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 113, in trigger
    result, data = await handler.check(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 94, in check
    check = await event_filter.call(*args, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 48, in call
    return await loop.run_in_executor(None, wrapped)
  File "/usr/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 104, in <lambda>
    dp.message.register(edit_promo, lambda c: c.data.startswith('/edit_promo'))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 892, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Message' object has no attribute 'data'
2025-01-18, Sat, 12:46:16,432 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:46:16,433 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:46:16,433 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:46:22,488 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:46:22,630 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:46:25,18 aiogram.event INFO Update id=450710216 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 12:46:25,19 aiogram.event ERROR Cause exception while process update id=450710216 by bot id=7771835226
NoOptionError: No option 'support' in section: 'bot'
Traceback (most recent call last):
  File "/usr/lib/python3.10/configparser.py", line 791, in get
    value = d[option]
  File "/usr/lib/python3.10/collections/__init__.py", line 986, in __getitem__
    return self.__missing__(key)            # support subclasses that define __missing__
  File "/usr/lib/python3.10/collections/__init__.py", line 978, in __missing__
    raise KeyError(key)
KeyError: 'support'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 87, in edit_promo
    support = config.get('bot', 'support')
  File "/usr/lib/python3.10/configparser.py", line 794, in get
    raise NoOptionError(option, section)
configparser.NoOptionError: No option 'support' in section: 'bot'
2025-01-18, Sat, 12:47:27,544 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 12:47:27,545 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:47:27,545 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 12:47:33,706 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 12:47:33,753 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 12:47:33,889 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 12:47:33,889 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:47:33,894 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 12:47:33,894 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:47:33,897 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 12:47:33,897 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 12:47:33,900 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:47:33,921 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR
2025-01-18, Sat, 12:47:33,921 sqlalchemy.engine.Engine INFO [generated in 0.00041s] ('promo',)
2025-01-18, Sat, 12:47:33,925 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:47:33,927 aiogram.event INFO Update id=450710217 is not handled. Duration 92 ms by bot id=7771835226
2025-01-18, Sat, 12:47:33,928 aiogram.event ERROR Cause exception while process update id=450710217 by bot id=7771835226
ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR]
[parameters: ('promo',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedFunctionError: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 89, in edit_promo
    promo_temp[message.from_user.id] = await get_promo_by_id(promocode_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 13, in get_promo_by_id
    return await PromoDAO.get_by_id(promo_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 43, in get_by_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR]
[parameters: ('promo',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-01-18, Sat, 12:47:37,387 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 12:47:37,388 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR
2025-01-18, Sat, 12:47:37,389 sqlalchemy.engine.Engine INFO [cached since 3.468s ago] ('promo',)
2025-01-18, Sat, 12:47:37,391 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 12:47:37,393 aiogram.event INFO Update id=450710218 is not handled. Duration 8 ms by bot id=7771835226
2025-01-18, Sat, 12:47:37,393 aiogram.event ERROR Cause exception while process update id=450710218 by bot id=7771835226
ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR]
[parameters: ('promo',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedFunctionError: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 89, in edit_promo
    promo_temp[message.from_user.id] = await get_promo_by_id(promocode_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 13, in get_promo_by_id
    return await PromoDAO.get_by_id(promo_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 43, in get_by_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR]
[parameters: ('promo',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-01-18, Sat, 17:03:53,386 aiogram.dispatcher ERROR Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-01-18, Sat, 17:03:53,386 aiogram.dispatcher WARNING Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7771835226)
2025-01-18, Sat, 17:04:05,133 aiogram.dispatcher INFO Connection established (tryings = 1, bot id = 7771835226)
2025-01-18, Sat, 17:04:08,826 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:04:08,826 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR
2025-01-18, Sat, 17:04:08,826 sqlalchemy.engine.Engine INFO [cached since 272.4s ago] ('promo',)
2025-01-18, Sat, 17:04:08,829 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:04:08,830 aiogram.event INFO Update id=450710219 is not handled. Duration 6 ms by bot id=7771835226
2025-01-18, Sat, 17:04:08,830 aiogram.event ERROR Cause exception while process update id=450710219 by bot id=7771835226
ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR]
[parameters: ('promo',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 510, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 756, in _prepare
    prepared_stmt = await self._connection.prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedFunctionError: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 89, in edit_promo
    promo_temp[message.from_user.id] = await get_promo_by_id(promocode_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 13, in get_promo_by_id
    return await PromoDAO.get_by_id(promo_id, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 43, in get_by_id
    result = await session.execute(query)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 461, in execute
    result = await greenlet_spawn(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2362, in execute
    return self._execute_internal(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2247, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedFunctionError'>: operator does not exist: bigint = character varying
HINT:  No operator matches the given name and argument types. You might need to add explicit type casts.
[SQL: SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::VARCHAR]
[parameters: ('promo',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-01-18, Sat, 17:07:12,793 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:07:12,794 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:07:12,794 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:07:19,509 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:07:19,810 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:07:22,336 aiogram.event INFO Update id=450710220 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 17:07:22,336 aiogram.event ERROR Cause exception while process update id=450710220 by bot id=7771835226
ValueError: invalid literal for int() with base 10: 'promo'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 84, in edit_promo
    promocode_id = int(message.text.split('_')[1])
ValueError: invalid literal for int() with base 10: 'promo'
2025-01-18, Sat, 17:08:44,707 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:08:44,708 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:08:44,708 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:08:50,668 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:08:50,748 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:08:53,181 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 17:08:53,181 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:08:53,185 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 17:08:53,186 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:08:53,189 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 17:08:53,189 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:08:53,192 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:08:53,210 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 17:08:53,211 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (4,)
2025-01-18, Sat, 17:08:53,215 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:08:53,661 aiogram.event INFO Update id=450710221 is handled. Duration 532 ms by bot id=7771835226
2025-01-18, Sat, 17:09:04,440 aiogram.event INFO Update id=450710222 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 17:09:04,441 aiogram.event ERROR Cause exception while process update id=450710222 by bot id=7771835226
ValueError: invalid literal for int() with base 10: '/start'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 58, in new_promo
    promos_dict[message.from_user.id]['price'] = int(var.replace(' ','').replace('.','').replace(',',''))
ValueError: invalid literal for int() with base 10: '/start'
2025-01-18, Sat, 17:09:13,158 aiogram.event INFO Update id=450710223 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 17:09:13,158 aiogram.event ERROR Cause exception while process update id=450710223 by bot id=7771835226
ValueError: invalid literal for int() with base 10: '/start'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 58, in new_promo
    promos_dict[message.from_user.id]['price'] = int(var.replace(' ','').replace('.','').replace(',',''))
ValueError: invalid literal for int() with base 10: '/start'
2025-01-18, Sat, 17:10:06,866 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:10:06,867 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:10:06,867 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:17:03,408 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:17:03,518 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:17:07,886 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:17:07,887 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:17:07,887 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:47:37,431 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:47:37,481 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:47:41,718 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 17:47:41,718 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:47:41,722 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 17:47:41,722 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:47:41,725 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 17:47:41,726 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:47:41,728 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:47:41,743 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 17:47:41,743 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (2142024077,)
2025-01-18, Sat, 17:47:41,747 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:47:42,53 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:47:42,55 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 17:47:42,56 sqlalchemy.engine.Engine INFO [cached since 0.3131s ago] (2142024077,)
2025-01-18, Sat, 17:47:42,58 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:47:42,59 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:47:42,60 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 17:47:42,60 sqlalchemy.engine.Engine INFO [cached since 0.3175s ago] (2142024077,)
2025-01-18, Sat, 17:47:42,63 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:47:42,289 aiogram.event INFO Update id=450710224 is handled. Duration 1134 ms by bot id=7771835226
2025-01-18, Sat, 17:47:44,104 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:47:44,109 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 17:47:44,109 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-18, Sat, 17:47:44,114 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:47:44,254 aiogram.event INFO Update id=450710225 is handled. Duration 151 ms by bot id=7771835226
2025-01-18, Sat, 17:47:48,399 aiogram.event INFO Update id=450710226 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 17:47:48,399 aiogram.event ERROR Cause exception while process update id=450710226 by bot id=7771835226
KeyError: 2142024077
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 90, in edit_promo
    promos_dict[message.from_user.id]['id'] = promocode_id
KeyError: 2142024077
2025-01-18, Sat, 17:48:46,551 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:48:46,552 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:48:46,553 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:51:44,521 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:51:44,798 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:51:47,777 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 17:51:47,777 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:51:47,781 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 17:51:47,781 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:51:47,784 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 17:51:47,784 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:51:47,787 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:51:47,808 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 17:51:47,808 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (2142024077,)
2025-01-18, Sat, 17:51:47,813 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:51:48,61 aiogram.event INFO Update id=450710227 is not handled. Duration 350 ms by bot id=7771835226
2025-01-18, Sat, 17:51:48,61 aiogram.event ERROR Cause exception while process update id=450710227 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='html', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-01-18, Sat, 17:51:50,728 aiogram.event INFO Update id=450710228 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 17:51:50,728 aiogram.event ERROR Cause exception while process update id=450710228 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 91, in edit_promo
    promos_dict[message.from_user.id]['promocode'] = get_promo_by_id(promocode_id).promocode
AttributeError: 'coroutine' object has no attribute 'promocode'
2025-01-18, Sat, 17:52:18,561 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:52:18,562 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:52:18,562 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:52:24,541 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:52:24,590 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:52:24,672 aiogram.event INFO Update id=450710230 is not handled. Duration 4 ms by bot id=7771835226
2025-01-18, Sat, 17:52:24,672 aiogram.event ERROR Cause exception while process update id=450710230 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 91, in edit_promo
    promos_dict[message.from_user.id]['promocode'] = await get_promo_by_id(promocode_id).promocode
AttributeError: 'coroutine' object has no attribute 'promocode'
2025-01-18, Sat, 17:52:24,727 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 17:52:24,727 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:52:24,731 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 17:52:24,731 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:52:24,734 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 17:52:24,734 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:52:24,737 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:52:24,756 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 17:52:24,756 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-18, Sat, 17:52:24,762 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:52:25,556 aiogram.event INFO Update id=450710229 is not handled. Duration 888 ms by bot id=7771835226
2025-01-18, Sat, 17:52:25,556 aiogram.event ERROR Cause exception while process update id=450710229 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='html', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-01-18, Sat, 17:52:32,704 aiogram.event INFO Update id=450710231 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 17:52:32,704 aiogram.event ERROR Cause exception while process update id=450710231 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 91, in edit_promo
    promos_dict[message.from_user.id]['promocode'] = await get_promo_by_id(promocode_id).promocode
AttributeError: 'coroutine' object has no attribute 'promocode'
2025-01-18, Sat, 17:53:34,574 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:53:34,575 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:53:34,575 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:53:40,190 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:53:40,238 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:53:41,603 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 17:53:41,603 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:53:41,608 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 17:53:41,608 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:53:41,611 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 17:53:41,611 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:53:41,613 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:53:41,632 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 17:53:41,632 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (2142024077,)
2025-01-18, Sat, 17:53:41,637 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:53:41,814 aiogram.event INFO Update id=450710232 is not handled. Duration 266 ms by bot id=7771835226
2025-01-18, Sat, 17:53:41,814 aiogram.event ERROR Cause exception while process update id=450710232 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='html', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-01-18, Sat, 17:53:42,794 aiogram.event INFO Update id=450710233 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 17:53:42,795 aiogram.event ERROR Cause exception while process update id=450710233 by bot id=7771835226
AttributeError: 'coroutine' object has no attribute 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 91, in edit_promo
    prom = await get_promo_by_id(promocode_id).promocode
AttributeError: 'coroutine' object has no attribute 'promocode'
2025-01-18, Sat, 17:58:18,218 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:58:18,219 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:58:18,220 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:58:24,84 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:58:24,227 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:58:26,185 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 17:58:26,185 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:58:26,189 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 17:58:26,190 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:58:26,193 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 17:58:26,193 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 17:58:26,196 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 17:58:26,218 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 17:58:26,218 sqlalchemy.engine.Engine INFO [generated in 0.00055s] (4,)
2025-01-18, Sat, 17:58:26,224 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 17:58:26,226 aiogram.event INFO Update id=450710234 is not handled. Duration 93 ms by bot id=7771835226
2025-01-18, Sat, 17:58:26,226 aiogram.event ERROR Cause exception while process update id=450710234 by bot id=7771835226
KeyError: 2142024077
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 92, in edit_promo
    promos_dict[message.from_user.id]['promocode'] = prom.promocode
KeyError: 2142024077
2025-01-18, Sat, 17:59:17,410 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 17:59:17,411 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 17:59:17,411 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 17:59:58,954 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 17:59:59,333 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:00:01,167 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:00:01,167 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:00:01,172 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:00:01,172 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:00:01,175 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:00:01,175 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:00:01,178 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:00:01,199 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:00:01,199 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (4,)
2025-01-18, Sat, 18:00:01,204 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:00:01,207 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:00:01,208 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:00:01,208 sqlalchemy.engine.Engine INFO [cached since 0.009283s ago] (4,)
2025-01-18, Sat, 18:00:01,210 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:00:01,211 aiogram.event INFO Update id=450710235 is not handled. Duration 99 ms by bot id=7771835226
2025-01-18, Sat, 18:00:01,212 aiogram.event ERROR Cause exception while process update id=450710235 by bot id=7771835226
TypeError: 'Promo' object does not support item assignment
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 105, in edit_promo
    promo_temp[message.from_user.id]['is_updating'] = True
TypeError: 'Promo' object does not support item assignment
2025-01-18, Sat, 18:02:50,914 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:02:50,914 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:02:50,915 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:02:56,949 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:02:56,995 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:02:58,928 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:02:58,929 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:02:58,933 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:02:58,933 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:02:58,936 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:02:58,936 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:02:58,939 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:02:58,959 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:02:58,959 sqlalchemy.engine.Engine INFO [generated in 0.00063s] (4,)
2025-01-18, Sat, 18:02:58,964 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:02:58,967 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:02:58,968 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:02:58,968 sqlalchemy.engine.Engine INFO [cached since 0.009474s ago] (4,)
2025-01-18, Sat, 18:02:58,971 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:02:58,972 aiogram.event INFO Update id=450710236 is not handled. Duration 96 ms by bot id=7771835226
2025-01-18, Sat, 18:02:58,972 aiogram.event ERROR Cause exception while process update id=450710236 by bot id=7771835226
KeyError: 2142024077
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 99, in edit_promo
    promo_temp[message.from_user.id]['obj'] = await get_promo_by_id(promocode_id)
KeyError: 2142024077
2025-01-18, Sat, 18:03:16,846 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:03:16,846 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:03:16,847 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:03:42,43 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:03:42,89 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:03:44,311 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:03:44,311 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:03:44,316 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:03:44,316 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:03:44,319 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:03:44,319 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:03:44,322 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:03:44,342 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:03:44,342 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (4,)
2025-01-18, Sat, 18:03:44,347 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:03:44,350 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:03:44,350 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:03:44,350 sqlalchemy.engine.Engine INFO [cached since 0.008701s ago] (4,)
2025-01-18, Sat, 18:03:44,353 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:03:44,354 aiogram.event INFO Update id=450710237 is not handled. Duration 95 ms by bot id=7771835226
2025-01-18, Sat, 18:03:44,354 aiogram.event ERROR Cause exception while process update id=450710237 by bot id=7771835226
AttributeError: 'dict' object has no attribute 'promocode'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 104, in edit_promo
    promos_dict[message.from_user.id]['promocode'] = promo_temp[message.from_user.id].promocode
AttributeError: 'dict' object has no attribute 'promocode'
2025-01-18, Sat, 18:04:27,739 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:04:27,740 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:04:27,740 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:04:33,882 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:04:33,933 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:04:35,665 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:04:35,665 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:04:35,669 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:04:35,669 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:04:35,672 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:04:35,672 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:04:35,675 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:04:35,694 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:04:35,694 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (4,)
2025-01-18, Sat, 18:04:35,699 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:04:35,702 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:04:35,702 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:04:35,703 sqlalchemy.engine.Engine INFO [cached since 0.00917s ago] (4,)
2025-01-18, Sat, 18:04:35,705 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:04:35,998 aiogram.event INFO Update id=450710238 is handled. Duration 383 ms by bot id=7771835226
2025-01-18, Sat, 18:04:51,682 aiogram.event INFO Update id=450710239 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 18:04:51,683 aiogram.event ERROR Cause exception while process update id=450710239 by bot id=7771835226
KeyError: 2142024077
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 58, in new_promo
    promos_dict[message.from_user.id]['price'] = int(var.replace(' ','').replace('.','').replace(',',''))
KeyError: 2142024077
2025-01-18, Sat, 18:05:35,154 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:05:35,154 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:05:35,155 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:07:29,519 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:07:29,638 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:07:40,45 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:07:40,46 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:07:40,49 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:07:40,50 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:07:40,53 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:07:40,53 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:07:40,56 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:07:40,76 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:07:40,76 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (4,)
2025-01-18, Sat, 18:07:40,80 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:07:40,82 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:07:40,83 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:07:40,83 sqlalchemy.engine.Engine INFO [cached since 0.007843s ago] (4,)
2025-01-18, Sat, 18:07:40,86 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:07:40,528 aiogram.event INFO Update id=450710240 is handled. Duration 535 ms by bot id=7771835226
2025-01-18, Sat, 18:07:53,607 aiogram.event INFO Update id=450710241 is handled. Duration 187 ms by bot id=7771835226
2025-01-18, Sat, 18:08:04,781 aiogram.event INFO Update id=450710242 is not handled. Duration 2 ms by bot id=7771835226
2025-01-18, Sat, 18:08:04,781 aiogram.event ERROR Cause exception while process update id=450710242 by bot id=7771835226
ValueError: time data '213213' does not match format '%d.%m.%Y'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 63, in new_promo
    if not datetime.strptime(var, '%d.%m.%Y') and datetime.strptime(var, '%d.%m.%Y').date() < datetime.now().date():
  File "/usr/lib/python3.10/_strptime.py", line 568, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
  File "/usr/lib/python3.10/_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '213213' does not match format '%d.%m.%Y'
2025-01-18, Sat, 18:09:21,408 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:09:21,409 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:09:21,409 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:22:01,76 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:22:01,122 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:22:06,859 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:22:06,859 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:22:06,863 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:22:06,863 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:22:06,867 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:22:06,867 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:22:06,870 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:22:06,889 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:22:06,890 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (4,)
2025-01-18, Sat, 18:22:06,895 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:22:06,898 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:22:06,898 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:22:06,899 sqlalchemy.engine.Engine INFO [cached since 0.009669s ago] (4,)
2025-01-18, Sat, 18:22:06,901 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:22:07,200 aiogram.event INFO Update id=450710243 is handled. Duration 397 ms by bot id=7771835226
2025-01-18, Sat, 18:22:14,865 aiogram.event INFO Update id=450710244 is handled. Duration 112 ms by bot id=7771835226
2025-01-18, Sat, 18:22:18,730 aiogram.event INFO Update id=450710245 is not handled. Duration 171 ms by bot id=7771835226
2025-01-18, Sat, 18:22:18,730 aiogram.event ERROR Cause exception while process update id=450710245 by bot id=7771835226
ValueError: time data '21341342' does not match format '%d.%m.%Y'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 71, in new_promo
    if datetime.strptime(var, '%d.%m.%Y').date() < datetime.now().date():
  File "/usr/lib/python3.10/_strptime.py", line 568, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
  File "/usr/lib/python3.10/_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '21341342' does not match format '%d.%m.%Y'
2025-01-18, Sat, 18:22:25,522 aiogram.event INFO Update id=450710246 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 18:22:25,522 aiogram.event ERROR Cause exception while process update id=450710246 by bot id=7771835226
TypeError: 'datetime.datetime' object cannot be interpreted as an integer
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    promos_dict[message.from_user.id]['expire_date'] = datetime(datetime.now() + timedelta(days=365)).strftime("%d.%m.%Y")
TypeError: 'datetime.datetime' object cannot be interpreted as an integer
2025-01-18, Sat, 18:23:21,924 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:23:21,925 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:23:21,926 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:23:27,862 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:23:27,938 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:23:29,515 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:23:29,515 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:23:29,519 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:23:29,519 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:23:29,522 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:23:29,523 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:23:29,525 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:23:29,543 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:23:29,544 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (4,)
2025-01-18, Sat, 18:23:29,549 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:23:29,551 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:23:29,552 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:23:29,552 sqlalchemy.engine.Engine INFO [cached since 0.009066s ago] (4,)
2025-01-18, Sat, 18:23:29,555 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:23:29,833 aiogram.event INFO Update id=450710247 is handled. Duration 370 ms by bot id=7771835226
2025-01-18, Sat, 18:23:33,455 aiogram.event INFO Update id=450710248 is handled. Duration 138 ms by bot id=7771835226
2025-01-18, Sat, 18:23:35,556 aiogram.event INFO Update id=450710249 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 18:23:35,556 aiogram.event ERROR Cause exception while process update id=450710249 by bot id=7771835226
TypeError: 'datetime.datetime' object cannot be interpreted as an integer
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    promos_dict[message.from_user.id]['expire_date'] = datetime(datetime.now() + timedelta(days=365)).strftime("%d.%m.%Y")
TypeError: 'datetime.datetime' object cannot be interpreted as an integer
2025-01-18, Sat, 18:24:31,208 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:24:31,209 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:24:31,209 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:24:37,116 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:24:37,407 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:24:39,119 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:24:39,119 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:24:39,123 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:24:39,123 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:24:39,126 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:24:39,127 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:24:39,129 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:24:39,148 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:24:39,148 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (4,)
2025-01-18, Sat, 18:24:39,153 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:24:39,155 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:24:39,156 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:24:39,156 sqlalchemy.engine.Engine INFO [cached since 0.008492s ago] (4,)
2025-01-18, Sat, 18:24:39,158 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:24:39,344 aiogram.event INFO Update id=450710250 is handled. Duration 276 ms by bot id=7771835226
2025-01-18, Sat, 18:24:42,528 aiogram.event INFO Update id=450710251 is handled. Duration 111 ms by bot id=7771835226
2025-01-18, Sat, 18:24:46,615 aiogram.event INFO Update id=450710252 is not handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 18:24:46,615 aiogram.event ERROR Cause exception while process update id=450710252 by bot id=7771835226
TypeError: 'datetime.datetime' object cannot be interpreted as an integer
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 64, in new_promo
    promos_dict[message.from_user.id]['expire_date'] = datetime(datetime.now() + timedelta(days=365)).strftime("%d.%m.%Y")
TypeError: 'datetime.datetime' object cannot be interpreted as an integer
2025-01-18, Sat, 18:25:56,527 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:25:56,528 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:25:56,528 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:26:02,444 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:26:02,490 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:26:02,872 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:26:02,872 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:26:02,876 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:26:02,877 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:26:02,880 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:26:02,880 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:26:02,882 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:26:02,899 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:26:02,899 sqlalchemy.engine.Engine INFO [generated in 0.00036s] (4,)
2025-01-18, Sat, 18:26:02,904 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:26:02,906 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:26:02,907 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:26:02,907 sqlalchemy.engine.Engine INFO [cached since 0.007736s ago] (4,)
2025-01-18, Sat, 18:26:02,909 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:26:03,344 aiogram.event INFO Update id=450710253 is handled. Duration 522 ms by bot id=7771835226
2025-01-18, Sat, 18:26:08,482 aiogram.event INFO Update id=450710254 is handled. Duration 159 ms by bot id=7771835226
2025-01-18, Sat, 18:26:10,263 aiogram.event INFO Update id=450710255 is handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 18:27:09,247 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:27:09,248 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:27:09,248 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:27:14,739 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:27:14,785 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:27:19,739 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:27:19,739 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:27:19,743 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:27:19,743 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:27:19,746 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:27:19,747 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:27:19,749 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:19,767 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:27:19,768 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (4,)
2025-01-18, Sat, 18:27:19,773 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:19,775 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:19,776 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:27:19,776 sqlalchemy.engine.Engine INFO [cached since 0.008919s ago] (4,)
2025-01-18, Sat, 18:27:19,779 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:20,707 aiogram.event INFO Update id=450710256 is handled. Duration 1023 ms by bot id=7771835226
2025-01-18, Sat, 18:27:23,773 aiogram.event INFO Update id=450710257 is handled. Duration 220 ms by bot id=7771835226
2025-01-18, Sat, 18:27:26,237 aiogram.event INFO Update id=450710258 is handled. Duration 0 ms by bot id=7771835226
2025-01-18, Sat, 18:27:44,220 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:27:44,221 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:27:44,221 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:27:50,117 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:27:50,503 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:27:51,963 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:27:51,963 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:27:51,968 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:27:51,969 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:27:51,972 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:27:51,972 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:27:51,974 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:51,989 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:27:51,989 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (2142024077,)
2025-01-18, Sat, 18:27:51,993 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:52,245 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:52,248 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:27:52,248 sqlalchemy.engine.Engine INFO [cached since 0.2591s ago] (2142024077,)
2025-01-18, Sat, 18:27:52,250 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:52,252 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:52,252 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:27:52,253 sqlalchemy.engine.Engine INFO [cached since 0.2639s ago] (2142024077,)
2025-01-18, Sat, 18:27:52,255 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:52,343 aiogram.event INFO Update id=450710259 is handled. Duration 694 ms by bot id=7771835226
2025-01-18, Sat, 18:27:54,434 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:54,440 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 18:27:54,441 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-18, Sat, 18:27:54,445 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:54,597 aiogram.event INFO Update id=450710260 is handled. Duration 164 ms by bot id=7771835226
2025-01-18, Sat, 18:27:56,544 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:56,547 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:27:56,547 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (4,)
2025-01-18, Sat, 18:27:56,551 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:56,554 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:27:56,554 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:27:56,554 sqlalchemy.engine.Engine INFO [cached since 0.007649s ago] (4,)
2025-01-18, Sat, 18:27:56,557 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:27:56,760 aiogram.event INFO Update id=450710261 is handled. Duration 217 ms by bot id=7771835226
2025-01-18, Sat, 18:28:06,937 aiogram.event INFO Update id=450710262 is handled. Duration 73 ms by bot id=7771835226
2025-01-18, Sat, 18:28:09,635 aiogram.event INFO Update id=450710263 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 18:28:09,635 aiogram.event ERROR Cause exception while process update id=450710263 by bot id=7771835226
AttributeError: type object 'PromoDAO' has no attribute 'update'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update(promocode_data, **kwargs)
AttributeError: type object 'PromoDAO' has no attribute 'update'
2025-01-18, Sat, 18:28:56,766 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:28:56,767 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:28:56,767 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:29:02,757 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:29:02,805 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:29:03,63 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:29:03,64 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:29:03,68 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:29:03,68 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:29:03,71 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:29:03,71 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:29:03,73 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:29:03,93 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:29:03,93 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (4,)
2025-01-18, Sat, 18:29:03,98 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:29:03,100 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:29:03,101 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:29:03,101 sqlalchemy.engine.Engine INFO [cached since 0.008615s ago] (4,)
2025-01-18, Sat, 18:29:03,104 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:29:03,840 aiogram.event INFO Update id=450710264 is handled. Duration 828 ms by bot id=7771835226
2025-01-18, Sat, 18:29:10,868 aiogram.event INFO Update id=450710265 is handled. Duration 105 ms by bot id=7771835226
2025-01-18, Sat, 18:29:12,881 aiogram.event INFO Update id=450710266 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 18:29:12,882 aiogram.event ERROR Cause exception while process update id=450710266 by bot id=7771835226
AttributeError: 'dict' object has no attribute 'id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 25, in update_by_id
    instance = select(cls.model).where(kwargs.id==cls.model.id)
AttributeError: 'dict' object has no attribute 'id'
2025-01-18, Sat, 18:38:37,102 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:38:37,103 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:38:37,103 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:38:43,609 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:38:43,688 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:38:46,197 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:38:46,197 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:38:46,202 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:38:46,202 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:38:46,205 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:38:46,205 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:38:46,208 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:38:46,223 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:38:46,224 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (2142024077,)
2025-01-18, Sat, 18:38:46,227 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:38:46,496 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:38:46,499 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:38:46,499 sqlalchemy.engine.Engine INFO [cached since 0.2762s ago] (2142024077,)
2025-01-18, Sat, 18:38:46,501 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:38:46,503 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:38:46,504 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:38:46,504 sqlalchemy.engine.Engine INFO [cached since 0.2807s ago] (2142024077,)
2025-01-18, Sat, 18:38:46,506 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:38:46,588 aiogram.event INFO Update id=450710267 is handled. Duration 891 ms by bot id=7771835226
2025-01-18, Sat, 18:38:48,709 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:38:48,713 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 18:38:48,714 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (2142024077,)
2025-01-18, Sat, 18:38:48,719 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:38:49,131 aiogram.event INFO Update id=450710268 is handled. Duration 423 ms by bot id=7771835226
2025-01-18, Sat, 18:38:53,9 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:38:53,13 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:38:53,13 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (4,)
2025-01-18, Sat, 18:38:53,17 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:38:53,20 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:38:53,20 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:38:53,20 sqlalchemy.engine.Engine INFO [cached since 0.007725s ago] (4,)
2025-01-18, Sat, 18:38:53,23 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:38:53,151 aiogram.event INFO Update id=450710269 is handled. Duration 143 ms by bot id=7771835226
2025-01-18, Sat, 18:38:57,129 aiogram.event INFO Update id=450710270 is handled. Duration 128 ms by bot id=7771835226
2025-01-18, Sat, 18:38:59,222 aiogram.event INFO Update id=450710271 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 18:38:59,222 aiogram.event ERROR Cause exception while process update id=450710271 by bot id=7771835226
UnmappedInstanceError: Class 'sqlalchemy.sql.selectable.Select' is not mapped
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 3473, in add
    state = attributes.instance_state(instance)
AttributeError: 'Select' object has no attribute '_sa_instance_state'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 29, in update_by_id
    session.add(instance)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1152, in add
    return self._proxied.add(instance, _warn=_warn)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 3475, in add
    raise exc.UnmappedInstanceError(instance) from err
sqlalchemy.orm.exc.UnmappedInstanceError: Class 'sqlalchemy.sql.selectable.Select' is not mapped
2025-01-18, Sat, 18:39:58,382 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:39:58,383 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:39:58,383 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:40:11,8 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:40:11,331 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:40:12,432 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:40:12,433 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:40:12,437 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:40:12,437 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:40:12,440 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:40:12,440 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:40:12,443 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:40:12,463 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:40:12,463 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (4,)
2025-01-18, Sat, 18:40:12,468 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:40:12,471 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:40:12,471 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:40:12,471 sqlalchemy.engine.Engine INFO [cached since 0.008727s ago] (4,)
2025-01-18, Sat, 18:40:12,474 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:40:13,140 aiogram.event INFO Update id=450710272 is handled. Duration 760 ms by bot id=7771835226
2025-01-18, Sat, 18:40:16,283 aiogram.event INFO Update id=450710273 is handled. Duration 143 ms by bot id=7771835226
2025-01-18, Sat, 18:40:18,156 aiogram.event INFO Update id=450710274 is not handled. Duration 1 ms by bot id=7771835226
2025-01-18, Sat, 18:40:18,156 aiogram.event ERROR Cause exception while process update id=450710274 by bot id=7771835226
AttributeError: 'Select' object has no attribute 'first'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 25, in update_by_id
    instance = select(cls.model).where(kwargs['id']==cls.model.id).first()
AttributeError: 'Select' object has no attribute 'first'
2025-01-18, Sat, 18:41:13,850 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:41:13,851 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:41:13,851 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:41:19,650 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:41:19,701 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:41:22,753 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:41:22,753 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:41:22,757 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:41:22,757 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:41:22,760 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:41:22,760 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:41:22,763 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:41:22,782 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:41:22,782 sqlalchemy.engine.Engine INFO [generated in 0.00052s] (4,)
2025-01-18, Sat, 18:41:22,787 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:41:22,790 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:41:22,790 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:41:22,790 sqlalchemy.engine.Engine INFO [cached since 0.008944s ago] (4,)
2025-01-18, Sat, 18:41:22,793 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:41:23,69 aiogram.event INFO Update id=450710275 is handled. Duration 367 ms by bot id=7771835226
2025-01-18, Sat, 18:41:26,483 aiogram.event INFO Update id=450710276 is handled. Duration 109 ms by bot id=7771835226
2025-01-18, Sat, 18:41:28,317 aiogram.event INFO Update id=450710277 is not handled. Duration 2 ms by bot id=7771835226
2025-01-18, Sat, 18:41:28,317 aiogram.event ERROR Cause exception while process update id=450710277 by bot id=7771835226
AttributeError: 'Select' object has no attribute 'scalar_one_or_none'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 25, in update_by_id
    instance = select(cls.model).where(kwargs['id']==cls.model.id).scalar_one_or_none()
AttributeError: 'Select' object has no attribute 'scalar_one_or_none'
2025-01-18, Sat, 18:45:10,710 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:45:10,711 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:45:10,711 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:45:17,441 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:45:17,668 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:45:19,773 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:45:19,774 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:45:19,778 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:45:19,778 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:45:19,781 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:45:19,781 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:45:19,783 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:45:19,801 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:45:19,802 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (4,)
2025-01-18, Sat, 18:45:19,806 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:45:19,809 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:45:19,809 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:45:19,809 sqlalchemy.engine.Engine INFO [cached since 0.008179s ago] (4,)
2025-01-18, Sat, 18:45:19,812 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:45:20,721 aiogram.event INFO Update id=450710278 is handled. Duration 1001 ms by bot id=7771835226
2025-01-18, Sat, 18:45:23,540 aiogram.event INFO Update id=450710279 is handled. Duration 361 ms by bot id=7771835226
2025-01-18, Sat, 18:45:42,799 aiogram.event INFO Update id=450710280 is not handled. Duration 68 ms by bot id=7771835226
2025-01-18, Sat, 18:45:42,799 aiogram.event ERROR Cause exception while process update id=450710280 by bot id=7771835226
AttributeError: 'State' object has no attribute 'get_state'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 67, in new_promo
    promos_dict[message.from_user.id]['expire_date'] = datetime.strftime(var, '%d.%m.%Y')
TypeError: descriptor 'strftime' for 'datetime.date' objects doesn't apply to a 'str' object

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 70, in new_promo
    state.set_state(NewPromo.expiering_date_state.get_state())
AttributeError: 'State' object has no attribute 'get_state'
2025-01-18, Sat, 18:46:11,681 aiogram.event INFO Update id=450710281 is not handled. Duration 255 ms by bot id=7771835226
2025-01-18, Sat, 18:46:11,681 aiogram.event ERROR Cause exception while process update id=450710281 by bot id=7771835226
AttributeError: 'State' object has no attribute 'get_state'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 67, in new_promo
    promos_dict[message.from_user.id]['expire_date'] = datetime.strftime(var, '%d.%m.%Y')
TypeError: descriptor 'strftime' for 'datetime.date' objects doesn't apply to a 'str' object

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 70, in new_promo
    state.set_state(NewPromo.expiering_date_state.get_state())
AttributeError: 'State' object has no attribute 'get_state'
2025-01-18, Sat, 18:47:21,389 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:47:21,390 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:47:21,390 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:47:27,627 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:47:27,692 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:47:29,712 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:47:29,712 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:47:29,717 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:47:29,717 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:47:29,720 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:47:29,720 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:47:29,723 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:47:29,742 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:47:29,742 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (4,)
2025-01-18, Sat, 18:47:29,747 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:47:29,749 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:47:29,749 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:47:29,749 sqlalchemy.engine.Engine INFO [cached since 0.007978s ago] (4,)
2025-01-18, Sat, 18:47:29,752 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:47:29,965 aiogram.event INFO Update id=450710282 is handled. Duration 304 ms by bot id=7771835226
2025-01-18, Sat, 18:47:33,418 aiogram.event INFO Update id=450710283 is handled. Duration 152 ms by bot id=7771835226
2025-01-18, Sat, 18:47:43,751 aiogram.event INFO Update id=450710284 is not handled. Duration 100 ms by bot id=7771835226
2025-01-18, Sat, 18:47:43,752 aiogram.event ERROR Cause exception while process update id=450710284 by bot id=7771835226
AttributeError: 'Select' object has no attribute 'execute'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 26, in update_by_id
    result = instance.execute()
AttributeError: 'Select' object has no attribute 'execute'
2025-01-18, Sat, 18:48:05,942 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:48:05,944 sqlalchemy.engine.Engine INFO INSERT INTO promos (id, promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::BIGINT, $2::VARCHAR, $3::BIGINT, $4::INTEGER, $5::VARCHAR, $6::BIGINT, $7::VARCHAR)
2025-01-18, Sat, 18:48:05,945 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (4, 'Second', 39000, 0, 'https://t.me/autoanswersmpbot?start=2142024077_Second', 2142024077, datetime.datetime(2025, 3, 11, 0, 0))
2025-01-18, Sat, 18:48:05,947 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:48:05,948 aiogram.event INFO Update id=450710285 is not handled. Duration 8 ms by bot id=7771835226
2025-01-18, Sat, 18:48:05,948 aiogram.event ERROR Cause exception while process update id=450710285 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $7: datetime.datetime(2025, 3, 11, 0, 0) (expected str, got datetime)
[SQL: INSERT INTO promos (id, promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::BIGINT, $2::VARCHAR, $3::BIGINT, $4::INTEGER, $5::VARCHAR, $6::BIGINT, $7::VARCHAR)]
[parameters: (4, 'Second', 39000, 0, 'https://t.me/autoanswersmpbot?start=2142024077_Second', 2142024077, datetime.datetime(2025, 3, 11, 0, 0))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/text.pyx", line 29, in asyncpg.pgproto.pgproto.text_encode
  File "asyncpg/pgproto/./codecs/text.pyx", line 12, in asyncpg.pgproto.pgproto.as_pg_string_and_size
TypeError: expected str, got datetime

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $7: datetime.datetime(2025, 3, 11, 0, 0) (expected str, got datetime)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $7: datetime.datetime(2025, 3, 11, 0, 0) (expected str, got datetime)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 90, in create_promo
    await add_promocode(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 20, in add_promocode
    promocode = await PromoDAO.add(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $7: datetime.datetime(2025, 3, 11, 0, 0) (expected str, got datetime)
[SQL: INSERT INTO promos (id, promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::BIGINT, $2::VARCHAR, $3::BIGINT, $4::INTEGER, $5::VARCHAR, $6::BIGINT, $7::VARCHAR)]
[parameters: (4, 'Second', 39000, 0, 'https://t.me/autoanswersmpbot?start=2142024077_Second', 2142024077, datetime.datetime(2025, 3, 11, 0, 0))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-18, Sat, 18:56:53,803 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 18:56:53,804 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:56:53,805 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 18:57:00,275 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 18:57:00,329 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 18:57:05,76 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 18:57:05,76 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:57:05,81 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 18:57:05,81 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:57:05,84 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 18:57:05,84 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 18:57:05,87 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:57:05,100 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:57:05,100 sqlalchemy.engine.Engine INFO [generated in 0.00041s] (2142024077,)
2025-01-18, Sat, 18:57:05,104 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:57:05,178 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:57:05,180 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:57:05,181 sqlalchemy.engine.Engine INFO [cached since 0.08099s ago] (2142024077,)
2025-01-18, Sat, 18:57:05,183 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:57:05,185 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:57:05,186 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 18:57:05,186 sqlalchemy.engine.Engine INFO [cached since 0.08629s ago] (2142024077,)
2025-01-18, Sat, 18:57:05,188 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:57:05,441 aiogram.event INFO Update id=450710286 is handled. Duration 1452 ms by bot id=7771835226
2025-01-18, Sat, 18:57:07,181 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:57:07,185 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 18:57:07,186 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (2142024077,)
2025-01-18, Sat, 18:57:07,190 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:57:07,275 aiogram.event INFO Update id=450710287 is handled. Duration 94 ms by bot id=7771835226
2025-01-18, Sat, 18:57:08,834 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:57:08,837 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:57:08,837 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (4,)
2025-01-18, Sat, 18:57:08,841 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:57:08,843 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 18:57:08,844 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 18:57:08,844 sqlalchemy.engine.Engine INFO [cached since 0.007296s ago] (4,)
2025-01-18, Sat, 18:57:08,846 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 18:57:09,143 aiogram.event INFO Update id=450710288 is handled. Duration 311 ms by bot id=7771835226
2025-01-18, Sat, 18:57:15,260 aiogram.event INFO Update id=450710289 is handled. Duration 311 ms by bot id=7771835226
2025-01-18, Sat, 18:57:29,791 aiogram.event INFO Update id=450710290 is not handled. Duration 3 ms by bot id=7771835226
2025-01-18, Sat, 18:57:29,791 aiogram.event ERROR Cause exception while process update id=450710290 by bot id=7771835226
AttributeError: 'Select' object has no attribute 'execute'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 76, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 89, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 26, in update_by_id
    result = instance.execute()
AttributeError: 'Select' object has no attribute 'execute'
2025-01-18, Sat, 19:01:23,646 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 19:01:23,647 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:01:23,647 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 19:01:29,544 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 19:01:29,590 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:01:32,400 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 19:01:32,400 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:01:32,404 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 19:01:32,404 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:01:32,407 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 19:01:32,408 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:01:32,410 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:01:32,433 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:01:32,433 sqlalchemy.engine.Engine INFO [generated in 0.00049s] (4,)
2025-01-18, Sat, 19:01:32,439 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:01:32,441 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:01:32,442 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:01:32,442 sqlalchemy.engine.Engine INFO [cached since 0.009369s ago] (4,)
2025-01-18, Sat, 19:01:32,445 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:01:33,88 aiogram.event INFO Update id=450710291 is handled. Duration 739 ms by bot id=7771835226
2025-01-18, Sat, 19:01:38,835 aiogram.event INFO Update id=450710292 is handled. Duration 216 ms by bot id=7771835226
2025-01-18, Sat, 19:01:49,787 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:01:49,788 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:01:49,788 sqlalchemy.engine.Engine INFO [cached since 17.36s ago] (4,)
2025-01-18, Sat, 19:01:49,794 sqlalchemy.engine.Engine INFO UPDATE promos SET price=$1::BIGINT, expire_date=$2::VARCHAR WHERE promos.id = $3::BIGINT
2025-01-18, Sat, 19:01:49,794 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (55000, datetime.datetime(2025, 3, 20, 0, 0), 4)
2025-01-18, Sat, 19:01:49,796 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:01:49,797 aiogram.event INFO Update id=450710293 is not handled. Duration 13 ms by bot id=7771835226
2025-01-18, Sat, 19:01:49,797 aiogram.event ERROR Cause exception while process update id=450710293 by bot id=7771835226
DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 3, 20, 0, 0) (expected str, got datetime)
[SQL: UPDATE promos SET price=$1::BIGINT, expire_date=$2::VARCHAR WHERE promos.id = $3::BIGINT]
[parameters: (55000, datetime.datetime(2025, 3, 20, 0, 0), 4)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "asyncpg/protocol/prepared_stmt.pyx", line 175, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg/protocol/codecs/base.pyx", line 227, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg/protocol/codecs/base.pyx", line 129, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg/pgproto/./codecs/text.pyx", line 29, in asyncpg.pgproto.pgproto.text_encode
  File "asyncpg/pgproto/./codecs/text.pyx", line 12, in asyncpg.pgproto.pgproto.as_pg_string_and_size
TypeError: expected str, got datetime

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 534, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 185, in bind_execute
  File "asyncpg/protocol/prepared_stmt.pyx", line 204, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
asyncpg.exceptions.DataError: invalid input for query argument $2: datetime.datetime(2025, 3, 20, 0, 0) (expected str, got datetime)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 3, 20, 0, 0) (expected str, got datetime)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 76, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 89, in create_promo
    await update_promo(promos_dict[message.from_user.id])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 26, in update_promo
    promocode = await PromoDAO.update_by_id(promocode_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 35, in update_by_id
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 32, in update_by_id
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 568, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 546, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 497, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 780, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $2: datetime.datetime(2025, 3, 20, 0, 0) (expected str, got datetime)
[SQL: UPDATE promos SET price=$1::BIGINT, expire_date=$2::VARCHAR WHERE promos.id = $3::BIGINT]
[parameters: (55000, datetime.datetime(2025, 3, 20, 0, 0), 4)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-01-18, Sat, 19:03:11,328 aiogram.dispatcher ERROR Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 104] Connection reset by peer
2025-01-18, Sat, 19:03:11,328 aiogram.dispatcher WARNING Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7771835226)
2025-01-18, Sat, 19:03:17,9 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 19:03:17,10 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:03:17,11 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 19:04:30,39 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 19:04:30,120 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:04:31,744 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 19:04:31,744 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:04:31,748 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 19:04:31,748 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:04:31,751 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 19:04:31,752 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:04:31,754 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:04:31,772 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:04:31,772 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (4,)
2025-01-18, Sat, 19:04:31,778 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:04:31,780 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:04:31,781 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:04:31,781 sqlalchemy.engine.Engine INFO [cached since 0.009412s ago] (4,)
2025-01-18, Sat, 19:04:31,784 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:04:31,939 aiogram.event INFO Update id=450710294 is handled. Duration 247 ms by bot id=7771835226
2025-01-18, Sat, 19:04:36,505 aiogram.event INFO Update id=450710295 is handled. Duration 403 ms by bot id=7771835226
2025-01-18, Sat, 19:04:47,523 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:04:47,523 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:04:47,524 sqlalchemy.engine.Engine INFO [cached since 15.75s ago] (4,)
2025-01-18, Sat, 19:04:47,529 sqlalchemy.engine.Engine INFO UPDATE promos SET price=$1::BIGINT, expire_date=$2::VARCHAR WHERE promos.id = $3::BIGINT
2025-01-18, Sat, 19:04:47,529 sqlalchemy.engine.Engine INFO [generated in 0.00056s] (30000, '20.11.2025', 4)
2025-01-18, Sat, 19:04:47,533 sqlalchemy.engine.Engine INFO COMMIT
2025-01-18, Sat, 19:04:47,537 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:04:47,539 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 19:04:47,539 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (2142024077,)
2025-01-18, Sat, 19:04:47,542 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:04:47,769 aiogram.event INFO Update id=450710296 is handled. Duration 409 ms by bot id=7771835226
2025-01-18, Sat, 19:04:59,875 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:04:59,878 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 19:04:59,878 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077,)
2025-01-18, Sat, 19:04:59,882 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:05:00,287 aiogram.event INFO Update id=450710297 is handled. Duration 413 ms by bot id=7771835226
2025-01-18, Sat, 19:06:37,740 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 19:06:37,741 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:06:37,741 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 19:06:43,735 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 19:06:44,0 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:06:49,506 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 19:06:49,506 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:06:49,510 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 19:06:49,510 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:06:49,513 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 19:06:49,513 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:06:49,516 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:06:49,538 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:06:49,538 sqlalchemy.engine.Engine INFO [generated in 0.00053s] (4,)
2025-01-18, Sat, 19:06:49,544 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:06:49,547 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:06:49,547 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:06:49,547 sqlalchemy.engine.Engine INFO [cached since 0.009759s ago] (4,)
2025-01-18, Sat, 19:06:49,549 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:06:50,137 aiogram.event INFO Update id=450710298 is handled. Duration 681 ms by bot id=7771835226
2025-01-18, Sat, 19:06:56,864 aiogram.event INFO Update id=450710299 is handled. Duration 252 ms by bot id=7771835226
2025-01-18, Sat, 19:07:07,749 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:07:07,749 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:07:07,749 sqlalchemy.engine.Engine INFO [cached since 18.21s ago] (4,)
2025-01-18, Sat, 19:07:07,755 sqlalchemy.engine.Engine INFO UPDATE promos SET price=$1::BIGINT WHERE promos.id = $2::BIGINT
2025-01-18, Sat, 19:07:07,755 sqlalchemy.engine.Engine INFO [generated in 0.00040s] (44000, 4)
2025-01-18, Sat, 19:07:07,758 sqlalchemy.engine.Engine INFO COMMIT
2025-01-18, Sat, 19:07:07,762 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:07:07,764 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 19:07:07,764 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (2142024077,)
2025-01-18, Sat, 19:07:07,767 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:07:08,56 aiogram.event INFO Update id=450710300 is handled. Duration 406 ms by bot id=7771835226
2025-01-18, Sat, 19:07:53,948 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 19:07:53,949 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:07:53,950 aiogram.dispatcher INFO Polling stopped
2025-01-18, Sat, 19:08:01,20 aiogram.dispatcher INFO Start polling
2025-01-18, Sat, 19:08:01,75 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:08:01,205 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-18, Sat, 19:08:01,205 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:08:01,209 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-18, Sat, 19:08:01,210 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:08:01,213 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-18, Sat, 19:08:01,213 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-18, Sat, 19:08:01,216 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:08:01,236 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-18, Sat, 19:08:01,236 sqlalchemy.engine.Engine INFO [generated in 0.00041s] (2142024077,)
2025-01-18, Sat, 19:08:01,241 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:08:01,724 aiogram.event INFO Update id=450710301 is handled. Duration 572 ms by bot id=7771835226
2025-01-18, Sat, 19:08:04,384 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:08:04,387 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:08:04,388 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (4,)
2025-01-18, Sat, 19:08:04,391 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:08:04,394 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:08:04,394 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:08:04,395 sqlalchemy.engine.Engine INFO [cached since 0.007551s ago] (4,)
2025-01-18, Sat, 19:08:04,398 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:08:04,548 aiogram.event INFO Update id=450710302 is handled. Duration 165 ms by bot id=7771835226
2025-01-18, Sat, 19:08:13,786 aiogram.event INFO Update id=450710303 is handled. Duration 197 ms by bot id=7771835226
2025-01-18, Sat, 19:08:25,923 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:08:25,924 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.id = $1::BIGINT
2025-01-18, Sat, 19:08:25,924 sqlalchemy.engine.Engine INFO [cached since 21.54s ago] (4,)
2025-01-18, Sat, 19:08:25,929 sqlalchemy.engine.Engine INFO UPDATE promos SET price=$1::BIGINT, expire_date=$2::VARCHAR WHERE promos.id = $3::BIGINT
2025-01-18, Sat, 19:08:25,929 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (39990, '11.11.2025', 4)
2025-01-18, Sat, 19:08:25,932 sqlalchemy.engine.Engine INFO COMMIT
2025-01-18, Sat, 19:08:25,936 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-18, Sat, 19:08:25,937 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-18, Sat, 19:08:25,938 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-18, Sat, 19:08:25,941 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-18, Sat, 19:08:26,112 aiogram.event INFO Update id=450710304 is handled. Duration 192 ms by bot id=7771835226
2025-01-18, Sat, 19:09:21,981 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-18, Sat, 19:09:21,982 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-18, Sat, 19:09:21,982 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 07:25:51,619 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 07:25:52,0 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:26:43,647 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 07:26:43,648 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:26:43,648 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 07:47:46,460 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 07:47:46,537 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:47:48,873 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 07:47:48,874 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:47:48,878 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 07:47:48,878 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:47:48,882 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 07:47:48,882 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:47:48,885 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:47:48,904 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 07:47:48,905 sqlalchemy.engine.Engine INFO [generated in 0.00065s] (2142024077,)
2025-01-19, Sun, 07:47:48,912 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:47:49,726 aiogram.event INFO Update id=450710305 is handled. Duration 908 ms by bot id=7771835226
2025-01-19, Sun, 07:48:31,339 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 07:48:31,340 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:48:31,340 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 07:48:37,421 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 07:48:37,469 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:48:40,882 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 07:48:40,883 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:48:40,888 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 07:48:40,888 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:48:40,892 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 07:48:40,893 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:48:40,896 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:48:40,911 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 07:48:40,912 sqlalchemy.engine.Engine INFO [generated in 0.00063s] (2142024077,)
2025-01-19, Sun, 07:48:40,916 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:48:40,982 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:48:40,983 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 07:48:40,983 sqlalchemy.engine.Engine INFO [cached since 0.07257s ago] (2142024077,)
2025-01-19, Sun, 07:48:40,986 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:48:40,989 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:48:40,989 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 07:48:40,989 sqlalchemy.engine.Engine INFO [cached since 0.07863s ago] (2142024077,)
2025-01-19, Sun, 07:48:40,992 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:48:41,159 aiogram.event INFO Update id=450710306 is handled. Duration 612 ms by bot id=7771835226
2025-01-19, Sun, 07:48:43,14 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:48:43,21 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 07:48:43,21 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-19, Sun, 07:48:43,27 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:48:43,114 aiogram.event INFO Update id=450710307 is handled. Duration 102 ms by bot id=7771835226
2025-01-19, Sun, 07:50:42,20 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 07:50:42,21 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:50:42,21 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 07:50:47,791 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 07:50:47,836 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:50:56,261 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 07:50:56,261 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:50:56,266 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 07:50:56,266 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:50:56,269 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 07:50:56,269 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:50:56,271 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:50:56,288 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 07:50:56,288 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-19, Sun, 07:50:56,293 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:50:57,318 aiogram.event INFO Update id=450710308 is handled. Duration 1114 ms by bot id=7771835226
2025-01-19, Sun, 07:54:16,872 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 07:54:16,873 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:54:16,874 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 07:54:22,724 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 07:54:22,771 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:54:22,906 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 07:54:22,906 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:54:22,910 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 07:54:22,910 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:54:22,913 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 07:54:22,913 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:54:22,915 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:54:22,933 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 07:54:22,933 sqlalchemy.engine.Engine INFO [generated in 0.00068s] (2142024077,)
2025-01-19, Sun, 07:54:22,938 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:54:23,149 aiogram.event INFO Update id=450710309 is handled. Duration 300 ms by bot id=7771835226
2025-01-19, Sun, 07:54:44,822 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 07:54:44,823 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:54:44,823 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 07:54:50,877 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 07:54:51,255 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 07:54:58,980 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 07:54:58,980 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:54:58,985 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 07:54:58,985 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:54:58,989 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 07:54:58,989 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 07:54:58,991 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 07:54:59,8 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 07:54:59,9 sqlalchemy.engine.Engine INFO [generated in 0.00052s] (2142024077,)
2025-01-19, Sun, 07:54:59,14 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 07:54:59,749 aiogram.event INFO Update id=450710310 is handled. Duration 825 ms by bot id=7771835226
2025-01-19, Sun, 08:02:44,297 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:02:44,298 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:02:44,298 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:02:50,86 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:02:50,158 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:02:51,748 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:02:51,748 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:02:51,753 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:02:51,753 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:02:51,756 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:02:51,756 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:02:51,759 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:02:51,775 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:02:51,775 sqlalchemy.engine.Engine INFO [generated in 0.00041s] (2142024077,)
2025-01-19, Sun, 08:02:51,780 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:02:52,430 aiogram.event INFO Update id=450710311 is handled. Duration 737 ms by bot id=7771835226
2025-01-19, Sun, 08:05:37,290 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:05:37,291 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:05:37,291 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:06:15,523 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:06:15,571 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:06:19,751 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:06:19,751 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:06:19,756 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:06:19,756 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:06:19,759 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:06:19,760 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:06:19,763 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:06:19,780 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:06:19,780 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (2142024077,)
2025-01-19, Sun, 08:06:19,785 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:06:20,487 aiogram.event INFO Update id=450710312 is not handled. Duration 793 ms by bot id=7771835226
2025-01-19, Sun, 08:06:20,488 aiogram.event ERROR Cause exception while process update id=450710312 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
2025-01-19, Sun, 08:06:33,391 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:06:33,393 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:06:33,394 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (2142024077,)
2025-01-19, Sun, 08:06:33,397 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:06:33,472 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:06:33,473 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:06:33,473 sqlalchemy.engine.Engine INFO [cached since 0.07956s ago] (2142024077,)
2025-01-19, Sun, 08:06:33,475 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:06:33,477 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:06:33,477 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:06:33,478 sqlalchemy.engine.Engine INFO [cached since 0.08427s ago] (2142024077,)
2025-01-19, Sun, 08:06:33,480 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:06:33,557 aiogram.event INFO Update id=450710313 is handled. Duration 228 ms by bot id=7771835226
2025-01-19, Sun, 08:06:36,44 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:06:36,45 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:06:36,45 sqlalchemy.engine.Engine INFO [cached since 16.27s ago] (2142024077,)
2025-01-19, Sun, 08:06:36,48 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:06:36,158 aiogram.event INFO Update id=450710314 is not handled. Duration 115 ms by bot id=7771835226
2025-01-19, Sun, 08:06:36,159 aiogram.event ERROR Cause exception while process update id=450710314 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
2025-01-19, Sun, 08:08:38,323 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:08:38,324 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:08:38,324 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:08:45,533 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:08:45,583 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:08:45,795 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:08:45,796 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:08:45,800 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:08:45,800 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:08:45,803 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:08:45,804 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:08:45,806 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:08:45,822 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:08:45,822 sqlalchemy.engine.Engine INFO [generated in 0.00045s] (2142024077,)
2025-01-19, Sun, 08:08:45,827 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:08:46,858 aiogram.event INFO Update id=450710315 is not handled. Duration 1119 ms by bot id=7771835226
2025-01-19, Sun, 08:08:46,858 aiogram.event ERROR Cause exception while process update id=450710315 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
2025-01-19, Sun, 08:09:46,744 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:09:46,745 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:09:46,745 sqlalchemy.engine.Engine INFO [cached since 60.92s ago] (2142024077,)
2025-01-19, Sun, 08:09:46,748 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:09:46,911 aiogram.event INFO Update id=450710316 is not handled. Duration 168 ms by bot id=7771835226
2025-01-19, Sun, 08:09:46,911 aiogram.event ERROR Cause exception while process update id=450710316 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 42, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 495
2025-01-19, Sun, 08:09:57,256 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:09:57,257 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:09:57,257 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:12:42,487 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:12:42,558 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:12:42,691 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:12:42,692 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:12:42,695 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:12:42,696 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:12:42,699 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:12:42,699 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:12:42,701 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:12:42,718 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:12:42,719 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (2142024077,)
2025-01-19, Sun, 08:12:42,724 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:12:43,703 aiogram.event INFO Update id=450710317 is handled. Duration 1067 ms by bot id=7771835226
2025-01-19, Sun, 08:15:36,212 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:15:36,213 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:15:36,213 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:15:41,798 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:15:42,88 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:15:42,216 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:15:42,216 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:15:42,221 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:15:42,221 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:15:42,224 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:15:42,224 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:15:42,226 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:15:42,243 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:15:42,243 sqlalchemy.engine.Engine INFO [generated in 0.00041s] (2142024077,)
2025-01-19, Sun, 08:15:42,248 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:15:43,862 aiogram.event INFO Update id=450710318 is handled. Duration 1699 ms by bot id=7771835226
2025-01-19, Sun, 08:16:07,37 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:16:07,38 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:16:07,38 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:16:13,225 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:16:13,524 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:16:14,793 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:16:14,793 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:16:14,798 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:16:14,798 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:16:14,801 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:16:14,801 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:16:14,804 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:16:14,820 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:16:14,820 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-19, Sun, 08:16:14,825 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:16:15,96 aiogram.event INFO Update id=450710319 is handled. Duration 357 ms by bot id=7771835226
2025-01-19, Sun, 08:18:21,206 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:18:21,207 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:18:21,207 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:18:27,369 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:18:27,416 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:18:27,552 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:18:27,553 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:18:27,557 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:18:27,557 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:18:27,560 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:18:27,560 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:18:27,563 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:18:27,580 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 08:18:27,581 sqlalchemy.engine.Engine INFO [generated in 0.00066s] (2142024077,)
2025-01-19, Sun, 08:18:27,586 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:18:28,103 aiogram.event INFO Update id=450710320 is handled. Duration 606 ms by bot id=7771835226
2025-01-19, Sun, 08:19:20,99 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:19:20,101 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:19:20,101 sqlalchemy.engine.Engine INFO [generated in 0.00037s] (7675368439,)
2025-01-19, Sun, 08:19:20,104 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:19:20,106 aiogram.event INFO Update id=450710321 is not handled. Duration 213 ms by bot id=7771835226
2025-01-19, Sun, 08:19:20,106 aiogram.event ERROR Cause exception while process update id=450710321 by bot id=7771835226
AttributeError: 'Message' object has no attribute 'startBot'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    arg = message.startBot()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/pydantic/main.py", line 891, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Message' object has no attribute 'startBot'
2025-01-19, Sun, 08:23:38,142 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:23:38,143 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:23:38,144 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:25:28,651 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:25:28,697 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:25:40,763 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:25:40,764 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:25:40,768 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:25:40,768 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:25:40,770 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:25:40,771 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:25:40,774 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:25:40,788 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:25:40,789 sqlalchemy.engine.Engine INFO [generated in 0.00060s] (7675368439,)
2025-01-19, Sun, 08:25:40,792 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:25:40,794 aiogram.event INFO Update id=450710322 is not handled. Duration 697 ms by bot id=7771835226
2025-01-19, Sun, 08:25:40,794 aiogram.event ERROR Cause exception while process update id=450710322 by bot id=7771835226
IndexError: list index out of range
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 29, in start
    arg = message.text.split('=')[1]
IndexError: list index out of range
2025-01-19, Sun, 08:30:48,110 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:30:48,111 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:30:48,111 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:30:54,290 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:30:54,341 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:31:06,61 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:31:06,62 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:31:06,66 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:31:06,66 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:31:06,70 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:31:06,70 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:31:06,72 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:31:06,87 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:31:06,87 sqlalchemy.engine.Engine INFO [generated in 0.00056s] (7675368439,)
2025-01-19, Sun, 08:31:06,91 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:31:06,93 aiogram.event INFO Update id=450710323 is not handled. Duration 1109 ms by bot id=7771835226
2025-01-19, Sun, 08:31:06,93 aiogram.event ERROR Cause exception while process update id=450710323 by bot id=7771835226
AttributeError: type object 'Promo' has no attribute 'kwargs'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 30, in start
    promo_obj = await get_promo_by_kwargs(referal=arg)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 16, in get_promo_by_kwargs
    return await PromoDAO.get_by_kwarg_one(kwargs=kwargs, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 66, in get_by_kwarg_one
    query = query.where(getattr(cls.model, key) == value)
AttributeError: type object 'Promo' has no attribute 'kwargs'
2025-01-19, Sun, 08:32:23,222 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:32:23,223 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:32:23,223 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:32:29,26 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:32:29,197 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:32:33,251 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:32:33,251 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:32:33,256 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:32:33,256 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:32:33,259 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:32:33,259 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:32:33,262 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:32:33,278 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:32:33,278 sqlalchemy.engine.Engine INFO [generated in 0.00056s] (7675368439,)
2025-01-19, Sun, 08:32:33,282 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:32:33,284 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:32:33,288 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id
2025-01-19, Sun, 08:32:33,289 sqlalchemy.engine.Engine INFO [generated in 0.00052s] ()
2025-01-19, Sun, 08:32:33,296 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:32:33,298 aiogram.event INFO Update id=450710324 is not handled. Duration 356 ms by bot id=7771835226
2025-01-19, Sun, 08:32:33,298 aiogram.event ERROR Cause exception while process update id=450710324 by bot id=7771835226
MultipleResultsFound: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 30, in start
    promo_obj = await get_promo_by_kwargs(referal=arg)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/get.py", line 16, in get_promo_by_kwargs
    return await PromoDAO.get_by_kwarg_one(kwargs, session=session)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 68, in get_by_kwarg_one
    records = result.scalar_one_or_none()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/result.py", line 805, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-01-19, Sun, 08:38:22,839 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:38:22,840 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:38:22,840 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:38:28,996 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:38:29,92 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:38:36,825 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:38:36,825 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:38:36,829 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:38:36,829 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:38:36,832 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:38:36,832 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:38:36,835 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:38:36,849 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:38:36,849 sqlalchemy.engine.Engine INFO [generated in 0.00034s] (7675368439,)
2025-01-19, Sun, 08:38:36,853 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:38:36,855 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:38:36,859 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 08:38:36,859 sqlalchemy.engine.Engine INFO [generated in 0.00039s] ('2142024077_Second',)
2025-01-19, Sun, 08:38:36,866 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:38:36,868 aiogram.event INFO Update id=450710325 is not handled. Duration 1174 ms by bot id=7771835226
2025-01-19, Sun, 08:38:36,868 aiogram.event ERROR Cause exception while process update id=450710325 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'referal'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 31, in start
    usr[message.from_user.id]['referal'] = promo_obj.referal
AttributeError: 'NoneType' object has no attribute 'referal'
2025-01-19, Sun, 08:44:15,666 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:44:15,667 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:44:15,667 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:44:57,210 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:44:57,499 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:45:04,921 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:45:04,921 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:45:04,925 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:45:04,926 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:45:04,929 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:45:04,929 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:45:04,931 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:45:04,947 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:45:04,947 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (7675368439,)
2025-01-19, Sun, 08:45:04,951 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:45:04,953 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:45:04,958 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 08:45:04,958 sqlalchemy.engine.Engine INFO [generated in 0.00050s] ('2142024077_Second',)
2025-01-19, Sun, 08:45:04,967 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:45:05,374 aiogram.event INFO Update id=450710326 is handled. Duration 1193 ms by bot id=7771835226
2025-01-19, Sun, 08:45:14,596 aiogram.event INFO Update id=450710327 is handled. Duration 410 ms by bot id=7771835226
2025-01-19, Sun, 08:56:06,99 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:56:06,100 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:56:06,100 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:56:15,585 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:56:15,698 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:56:23,378 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:56:23,379 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:56:23,383 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:56:23,383 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:56:23,387 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:56:23,387 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:56:23,390 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:56:23,404 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:56:23,405 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (7675368439,)
2025-01-19, Sun, 08:56:23,409 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:56:23,411 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:56:23,415 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 08:56:23,416 sqlalchemy.engine.Engine INFO [generated in 0.00041s] ('2142024077_Second',)
2025-01-19, Sun, 08:56:23,425 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:56:23,695 aiogram.event INFO Update id=450710328 is handled. Duration 813 ms by bot id=7771835226
2025-01-19, Sun, 08:56:42,174 aiogram.event INFO Update id=450710329 is handled. Duration 63 ms by bot id=7771835226
2025-01-19, Sun, 08:59:02,586 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 08:59:02,586 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:59:02,587 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 08:59:08,545 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 08:59:08,593 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 08:59:17,697 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 08:59:17,697 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:59:17,701 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 08:59:17,701 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:59:17,705 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 08:59:17,705 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 08:59:17,708 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:59:17,724 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 08:59:17,724 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (7675368439,)
2025-01-19, Sun, 08:59:17,728 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:59:17,730 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 08:59:17,734 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 08:59:17,735 sqlalchemy.engine.Engine INFO [generated in 0.00045s] ('2142024077_Second',)
2025-01-19, Sun, 08:59:17,743 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 08:59:18,64 aiogram.event INFO Update id=450710330 is handled. Duration 1164 ms by bot id=7771835226
2025-01-19, Sun, 08:59:21,343 aiogram.event INFO Update id=450710331 is handled. Duration 1 ms by bot id=7771835226
2025-01-19, Sun, 09:02:09,283 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:02:09,283 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:02:09,284 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:02:18,505 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:02:18,570 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:02:25,617 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:02:25,617 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:02:25,622 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:02:25,622 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:02:25,624 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:02:25,625 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:02:25,627 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:02:25,642 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:02:25,642 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (7675368439,)
2025-01-19, Sun, 09:02:25,647 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:02:25,649 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:02:25,654 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:02:25,654 sqlalchemy.engine.Engine INFO [generated in 0.00050s] ('2142024077_Second',)
2025-01-19, Sun, 09:02:25,663 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:02:25,912 aiogram.event INFO Update id=450710332 is handled. Duration 1037 ms by bot id=7771835226
2025-01-19, Sun, 09:02:33,265 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:02:33,265 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:02:33,267 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: BaseDAO.add() missing 1 required keyword-only argument: 'session'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'

2025-01-19, Sun, 09:03:33,277 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: BaseDAO.add() missing 1 required keyword-only argument: 'session'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'

2025-01-19, Sun, 09:04:33,654 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:04:33,655 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:04:33,655 sqlalchemy.engine.Engine INFO [cached since 128s ago] (7675368439,)
2025-01-19, Sun, 09:04:33,658 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:04:33,660 aiogram.event INFO Update id=450710333 is not handled. Duration 120395 ms by bot id=7771835226
2025-01-19, Sun, 09:04:33,660 aiogram.event ERROR Cause exception while process update id=450710333 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'marketer'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 80, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 115, in write_registration
    if user_obj[chat_id].marketer == True:
AttributeError: 'NoneType' object has no attribute 'marketer'
2025-01-19, Sun, 09:12:07,120 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:12:07,121 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:12:07,121 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:12:13,738 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:12:13,913 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:12:22,21 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:12:22,21 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:12:22,25 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:12:22,25 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:12:22,28 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:12:22,28 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:12:22,31 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:12:22,47 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:12:22,47 sqlalchemy.engine.Engine INFO [generated in 0.00060s] (7675368439,)
2025-01-19, Sun, 09:12:22,51 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:12:22,54 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:12:22,58 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:12:22,59 sqlalchemy.engine.Engine INFO [generated in 0.00037s] ('2142024077_Second',)
2025-01-19, Sun, 09:12:22,66 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:12:22,842 aiogram.event INFO Update id=450710334 is handled. Duration 1420 ms by bot id=7771835226
2025-01-19, Sun, 09:12:25,790 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:12:25,790 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:12:25,792 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 13, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:13:25,803 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 13, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:14:26,112 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:14:26,113 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:14:26,113 sqlalchemy.engine.Engine INFO [cached since 124.1s ago] (7675368439,)
2025-01-19, Sun, 09:14:26,115 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:14:26,116 aiogram.event INFO Update id=450710335 is not handled. Duration 120327 ms by bot id=7771835226
2025-01-19, Sun, 09:14:26,117 aiogram.event ERROR Cause exception while process update id=450710335 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'marketer'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 80, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 115, in write_registration
    if user_obj[chat_id].marketer == True:
AttributeError: 'NoneType' object has no attribute 'marketer'
2025-01-19, Sun, 09:14:31,854 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:14:31,855 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:14:31,855 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:15:58,59 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:15:58,107 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:16:09,733 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:16:09,733 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:16:09,737 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:16:09,737 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:16:09,740 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:16:09,740 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:16:09,743 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:16:09,760 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:16:09,760 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (7675368439,)
2025-01-19, Sun, 09:16:09,764 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:16:09,766 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:16:09,773 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:16:09,773 sqlalchemy.engine.Engine INFO [generated in 0.00041s] ('2142024077_Second',)
2025-01-19, Sun, 09:16:09,778 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:16:10,343 aiogram.event INFO Update id=450710336 is handled. Duration 1319 ms by bot id=7771835226
2025-01-19, Sun, 09:16:13,329 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:16:13,329 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:16:13,332 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 20, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:16:41,576 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:16:41,577 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:16:41,577 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:16:41,829 aiogram.event INFO Update id=450710337 is not handled. Duration 28500 ms by bot id=7771835226
2025-01-19, Sun, 09:18:17,520 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:18:17,569 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:18:29,727 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:18:29,727 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:18:29,731 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:18:29,731 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:18:29,735 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:18:29,735 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:18:29,738 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:18:29,755 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:18:29,756 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (7675368439,)
2025-01-19, Sun, 09:18:29,761 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:18:29,763 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:18:29,769 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:18:29,769 sqlalchemy.engine.Engine INFO [generated in 0.00049s] ('2142024077_Second',)
2025-01-19, Sun, 09:18:29,780 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:18:30,13 aiogram.event INFO Update id=450710338 is handled. Duration 810 ms by bot id=7771835226
2025-01-19, Sun, 09:18:33,124 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:18:33,125 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:18:33,127 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 21, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:19:33,138 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 21, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:20:33,521 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:20:33,522 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:20:33,522 sqlalchemy.engine.Engine INFO [cached since 123.8s ago] (7675368439,)
2025-01-19, Sun, 09:20:33,524 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:20:33,526 aiogram.event INFO Update id=450710339 is not handled. Duration 120402 ms by bot id=7771835226
2025-01-19, Sun, 09:20:33,526 aiogram.event ERROR Cause exception while process update id=450710339 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'marketer'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 80, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 115, in write_registration
    if user_obj[chat_id].marketer == True:
AttributeError: 'NoneType' object has no attribute 'marketer'
2025-01-19, Sun, 09:21:16,952 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:21:16,953 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:21:16,953 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:21:23,314 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:21:23,367 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:21:35,726 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:21:35,727 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:21:35,731 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:21:35,731 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:21:35,734 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:21:35,734 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:21:35,737 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:21:35,753 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:21:35,753 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (7675368439,)
2025-01-19, Sun, 09:21:35,757 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:21:35,758 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:21:35,763 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:21:35,763 sqlalchemy.engine.Engine INFO [generated in 0.00047s] ('2142024077_Second',)
2025-01-19, Sun, 09:21:35,772 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:21:36,591 aiogram.event INFO Update id=450710340 is handled. Duration 1944 ms by bot id=7771835226
2025-01-19, Sun, 09:21:38,640 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:21:38,640 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:21:38,643 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 21, in add
    new_instance = cls.model(**kwargs)
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:22:38,654 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'session' is an invalid keyword argument for User. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 21, in add
    kwargs.update(args[0])
  File "<string>", line 4, in __init__
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 571, in _initialize_instance
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py", line 2175, in _declarative_constructor
    raise TypeError(
TypeError: 'session' is an invalid keyword argument for User

2025-01-19, Sun, 09:23:31,282 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:23:31,283 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:23:31,283 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:23:31,535 aiogram.event INFO Update id=450710341 is not handled. Duration 112895 ms by bot id=7771835226
2025-01-19, Sun, 09:24:38,164 asyncio ERROR Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7c7b8b347850>
2025-01-19, Sun, 09:28:00,594 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:28:00,657 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:28:01,433 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:28:01,433 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:28:01,437 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:28:01,437 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:28:01,440 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:28:01,440 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:28:01,442 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:28:01,460 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:28:01,461 sqlalchemy.engine.Engine INFO [generated in 0.00052s] (7675368439,)
2025-01-19, Sun, 09:28:01,464 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:28:01,466 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:28:01,470 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal IS NULL
2025-01-19, Sun, 09:28:01,471 sqlalchemy.engine.Engine INFO [generated in 0.00041s] ()
2025-01-19, Sun, 09:28:01,473 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:28:01,473 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:28:01,473 sqlalchemy.engine.Engine INFO [cached since 0.01346s ago] (7675368439,)
2025-01-19, Sun, 09:28:01,477 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:28:01,478 aiogram.event INFO Update id=450710343 is not handled. Duration 587 ms by bot id=7771835226
2025-01-19, Sun, 09:28:01,479 aiogram.event ERROR Cause exception while process update id=450710343 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'referal'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 33, in start
    usr[message.from_user.id]['referal'] = promo_obj.referal
AttributeError: 'NoneType' object has no attribute 'referal'
2025-01-19, Sun, 09:28:01,481 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:28:01,483 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:28:01,486 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:28:01,486 sqlalchemy.engine.Engine INFO [generated in 0.00041s] ('2142024077_Second',)
2025-01-19, Sun, 09:28:01,487 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:28:01,487 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:28:01,487 sqlalchemy.engine.Engine INFO [cached since 0.02744s ago] (7675368439,)
2025-01-19, Sun, 09:28:01,492 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:28:01,493 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:28:01,498 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:28:01,498 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:28:01,499 sqlalchemy.engine.Engine INFO [cached since 0.01267s ago] ('2142024077_Second',)
2025-01-19, Sun, 09:28:01,504 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:28:01,682 aiogram.event INFO Update id=450710342 is handled. Duration 791 ms by bot id=7771835226
2025-01-19, Sun, 09:28:01,697 aiogram.event INFO Update id=450710344 is handled. Duration 805 ms by bot id=7771835226
2025-01-19, Sun, 09:28:14,517 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:28:14,517 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:28:14,518 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: BaseDAO.add() missing 1 required keyword-only argument: 'session'. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    user = await UserDAO.add(data)
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'

2025-01-19, Sun, 09:29:14,530 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: BaseDAO.add() missing 1 required keyword-only argument: 'session'. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 14, in add_user
    return user
TypeError: BaseDAO.add() missing 1 required keyword-only argument: 'session'

2025-01-19, Sun, 09:29:54,206 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:29:54,207 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:29:54,208 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:29:54,462 aiogram.event INFO Update id=450710345 is not handled. Duration 99945 ms by bot id=7771835226
2025-01-19, Sun, 09:30:00,514 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:30:00,562 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:30:10,837 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:30:10,837 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:30:10,841 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:30:10,841 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:30:10,844 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:30:10,844 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:30:10,846 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:30:10,862 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:30:10,862 sqlalchemy.engine.Engine INFO [generated in 0.00048s] (7675368439,)
2025-01-19, Sun, 09:30:10,867 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:30:10,869 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:30:10,873 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:30:10,873 sqlalchemy.engine.Engine INFO [generated in 0.00035s] ('2142024077_Second',)
2025-01-19, Sun, 09:30:10,881 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:30:11,217 aiogram.event INFO Update id=450710346 is handled. Duration 650 ms by bot id=7771835226
2025-01-19, Sun, 09:30:14,287 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:30:14,287 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:30:14,288 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'NoneType' object is not iterable. Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 12, in add
    kwargs.update(args[0])
TypeError: 'NoneType' object is not iterable

2025-01-19, Sun, 09:31:14,295 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: 'NoneType' object is not iterable. Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 12, in add
    kwargs.update(args[0])
TypeError: 'NoneType' object is not iterable

2025-01-19, Sun, 09:31:59,584 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:31:59,585 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:31:59,585 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:31:59,838 aiogram.event INFO Update id=450710347 is not handled. Duration 105552 ms by bot id=7771835226
2025-01-19, Sun, 09:32:08,785 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:32:08,930 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:32:15,813 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:32:15,813 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:32:15,818 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:32:15,818 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:32:15,821 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:32:15,821 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:32:15,823 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:32:15,839 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:32:15,839 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (7675368439,)
2025-01-19, Sun, 09:32:15,843 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:32:15,845 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:32:15,851 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 09:32:15,851 sqlalchemy.engine.Engine INFO [generated in 0.00065s] ('2142024077_Second',)
2025-01-19, Sun, 09:32:15,860 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:32:16,74 aiogram.event INFO Update id=450710348 is handled. Duration 582 ms by bot id=7771835226
2025-01-19, Sun, 09:32:19,449 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, Second, False
2025-01-19, Sun, 09:32:19,449 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 09:32:19,450 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:32:19,453 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT)
2025-01-19, Sun, 09:32:19,454 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (7675368439, 'Dm_dev_acc', 'Devid', 'Second', False, 0)
2025-01-19, Sun, 09:32:19,457 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 09:32:19,460 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-19, Sun, 09:32:19,615 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:32:19,616 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:32:19,616 sqlalchemy.engine.Engine INFO [cached since 3.777s ago] (7675368439,)
2025-01-19, Sun, 09:32:19,618 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:32:19,619 aiogram.event INFO Update id=450710349 is handled. Duration 171 ms by bot id=7771835226
2025-01-19, Sun, 09:36:12,984 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:36:12,985 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:36:12,985 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:36:47,838 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:36:47,883 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:36:51,783 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:36:51,784 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:36:51,788 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:36:51,788 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:36:51,791 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:36:51,791 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:36:51,793 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:36:51,808 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:36:51,808 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (7675368439,)
2025-01-19, Sun, 09:36:51,812 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:36:51,885 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:36:51,886 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:36:51,886 sqlalchemy.engine.Engine INFO [cached since 0.07823s ago] (7675368439,)
2025-01-19, Sun, 09:36:51,888 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:36:51,889 aiogram.event INFO Update id=450710350 is handled. Duration 742 ms by bot id=7771835226
2025-01-19, Sun, 09:37:55,987 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:37:55,988 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:37:55,988 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:38:01,492 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:38:01,683 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:38:15,623 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:38:15,624 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:38:15,628 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:38:15,628 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:38:15,631 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:38:15,632 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:38:15,634 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:38:15,649 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:38:15,649 sqlalchemy.engine.Engine INFO [generated in 0.00043s] (7675368439,)
2025-01-19, Sun, 09:38:15,653 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:38:15,655 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:38:15,662 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal IS NULL
2025-01-19, Sun, 09:38:15,662 sqlalchemy.engine.Engine INFO [generated in 0.00056s] ()
2025-01-19, Sun, 09:38:15,671 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:38:15,672 aiogram.event INFO Update id=450710351 is not handled. Duration 589 ms by bot id=7771835226
2025-01-19, Sun, 09:38:15,672 aiogram.event ERROR Cause exception while process update id=450710351 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'referal'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 33, in start
    usr[message.from_user.id]['referal'] = promo_obj.referal
AttributeError: 'NoneType' object has no attribute 'referal'
2025-01-19, Sun, 09:41:17,519 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:41:17,520 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:41:17,520 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:41:25,473 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:41:25,521 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:45:47,653 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:45:47,653 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:45:47,653 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:45:52,266 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:45:52,310 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:48:05,36 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:48:05,37 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:48:05,37 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:48:09,654 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:48:09,701 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:49:04,510 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 09:49:04,511 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:49:04,512 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 09:49:04,512 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:49:04,513 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 09:49:04,513 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 09:49:04,515 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:49:04,523 sqlalchemy.engine.Engine INFO SELECT users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 09:49:04,523 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (7675368439,)
2025-01-19, Sun, 09:49:04,525 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:49:04,526 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 09:49:04,528 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal IS NULL
2025-01-19, Sun, 09:49:04,529 sqlalchemy.engine.Engine INFO [generated in 0.00023s] ()
2025-01-19, Sun, 09:49:04,535 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 09:49:04,536 aiogram.event INFO Update id=450710352 is not handled. Duration 676 ms by bot id=7771835226
2025-01-19, Sun, 09:49:04,536 aiogram.event ERROR Cause exception while process update id=450710352 by bot id=7771835226
AttributeError: 'NoneType' object has no attribute 'referal'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 37, in start
    usr[message.from_user.id]['referal'] = promo_obj.referal
AttributeError: 'NoneType' object has no attribute 'referal'
2025-01-19, Sun, 09:49:58,100 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:49:58,100 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:49:58,101 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:50:40,140 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:50:40,189 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:52:12,783 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:52:12,784 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:52:12,784 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:52:17,129 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:52:17,212 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:54:26,49 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:54:26,50 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:54:26,50 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:54:30,234 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:54:30,282 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:56:06,125 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:56:06,125 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:56:06,125 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:56:12,259 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:56:12,306 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:56:57,698 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 09:56:57,699 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 09:56:57,699 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 09:59:28,846 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 09:59:28,897 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:01:03,507 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:01:03,507 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:01:03,507 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:10:24,301 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:10:24,350 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:10:30,778 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:10:30,778 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:10:30,780 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:10:30,780 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:10:30,781 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:10:30,781 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:10:30,781 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:10:30,789 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:10:30,789 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 10:10:30,791 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:10:30,792 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:10:30,795 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal IS NULL
2025-01-19, Sun, 10:10:30,795 sqlalchemy.engine.Engine INFO [generated in 0.00025s] ()
2025-01-19, Sun, 10:10:30,799 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:10:30,863 root ERROR При запуске бота ошибка 'NoneType' object has no attribute 'expire_date'
2025-01-19, Sun, 10:10:30,863 aiogram.event INFO Update id=450710353 is handled. Duration 704 ms by bot id=7771835226
2025-01-19, Sun, 10:11:41,914 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:11:41,915 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:11:41,915 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:11:45,840 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:11:46,133 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:11:50,170 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:11:50,170 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:11:50,171 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:11:50,172 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:11:50,172 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:11:50,172 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:11:50,173 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:11:50,180 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:11:50,180 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-19, Sun, 10:11:50,182 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:11:50,183 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:11:50,186 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal IS NULL
2025-01-19, Sun, 10:11:50,186 sqlalchemy.engine.Engine INFO [generated in 0.00023s] ()
2025-01-19, Sun, 10:11:50,190 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:11:50,191 root ERROR При запуске бота ошибка 'NoneType' object has no attribute 'expire_date'
2025-01-19, Sun, 10:11:50,191 aiogram.event INFO Update id=450710354 is handled. Duration 466 ms by bot id=7771835226
2025-01-19, Sun, 10:14:50,261 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:14:50,262 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:14:50,262 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:14:54,621 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:14:54,669 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:14:56,671 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:14:56,671 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:14:56,673 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:14:56,673 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:14:56,674 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:14:56,674 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:14:56,674 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:14:56,682 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:14:56,682 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 10:14:56,683 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:14:56,684 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:14:56,687 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal IS NULL
2025-01-19, Sun, 10:14:56,687 sqlalchemy.engine.Engine INFO [generated in 0.00033s] ()
2025-01-19, Sun, 10:14:56,690 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:14:57,57 aiogram.event INFO Update id=450710355 is handled. Duration 1114 ms by bot id=7771835226
2025-01-19, Sun, 10:15:03,323 aiogram.event INFO Update id=450710356 is handled. Duration 324 ms by bot id=7771835226
2025-01-19, Sun, 10:15:08,320 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-19, Sun, 10:15:08,321 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 10:15:08,322 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:15:08,323 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 10:15:08,324 sqlalchemy.engine.Engine INFO [generated in 0.00031s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-19, Sun, 10:15:08,326 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 10:15:08,328 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-19, Sun, 10:15:08,548 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:15:08,549 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:15:08,549 sqlalchemy.engine.Engine INFO [cached since 11.87s ago] (2142024077,)
2025-01-19, Sun, 10:15:08,551 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:15:08,552 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:15:08,552 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:15:08,552 sqlalchemy.engine.Engine INFO [cached since 11.87s ago] (2142024077,)
2025-01-19, Sun, 10:15:08,553 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:15:08,660 aiogram.event INFO Update id=450710357 is handled. Duration 340 ms by bot id=7771835226
2025-01-19, Sun, 10:15:11,926 aiogram.event INFO Update id=450710358 is handled. Duration 118 ms by bot id=7771835226
2025-01-19, Sun, 10:15:21,188 aiogram.event INFO Update id=450710359 is handled. Duration 263 ms by bot id=7771835226
2025-01-19, Sun, 10:15:27,441 aiogram.event INFO Update id=450710360 is handled. Duration 70 ms by bot id=7771835226
2025-01-19, Sun, 10:15:30,648 aiogram.event INFO Update id=450710361 is not handled. Duration 0 ms by bot id=7771835226
2025-01-19, Sun, 10:15:30,648 aiogram.event ERROR Cause exception while process update id=450710361 by bot id=7771835226
KeyError: 2142024077
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 79, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 87, in create_promo
    if promo_temp[message.from_user.id]['is_updating']:
KeyError: 2142024077
2025-01-19, Sun, 10:18:16,640 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:18:16,641 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:18:16,641 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:18:20,805 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:18:20,903 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:18:31,216 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:18:31,216 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:18:31,217 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:18:31,217 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:18:31,218 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:18:31,218 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:18:31,219 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:18:31,226 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:18:31,226 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 10:18:31,228 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:18:31,304 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:18:31,305 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:18:31,305 sqlalchemy.engine.Engine INFO [cached since 0.07882s ago] (2142024077,)
2025-01-19, Sun, 10:18:31,306 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:18:31,308 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:18:31,308 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:18:31,308 sqlalchemy.engine.Engine INFO [cached since 0.08242s ago] (2142024077,)
2025-01-19, Sun, 10:18:31,310 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:18:31,592 aiogram.event INFO Update id=450710362 is handled. Duration 1107 ms by bot id=7771835226
2025-01-19, Sun, 10:18:34,779 aiogram.event INFO Update id=450710363 is handled. Duration 419 ms by bot id=7771835226
2025-01-19, Sun, 10:18:40,910 aiogram.event INFO Update id=450710364 is handled. Duration 272 ms by bot id=7771835226
2025-01-19, Sun, 10:18:45,4 aiogram.event INFO Update id=450710365 is handled. Duration 496 ms by bot id=7771835226
2025-01-19, Sun, 10:18:46,956 aiogram.event INFO Update id=450710366 is not handled. Duration 0 ms by bot id=7771835226
2025-01-19, Sun, 10:18:46,956 aiogram.event ERROR Cause exception while process update id=450710366 by bot id=7771835226
KeyError: 2142024077
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 88, in create_promo
    promo_temp[message.from_user.id]['is_updating']
KeyError: 2142024077

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 79, in new_promo
    await create_promo(message)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 90, in create_promo
    promo_temp[message.from_user.id]['is_updating'] = False
KeyError: 2142024077
2025-01-19, Sun, 10:20:16,454 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:20:16,454 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:20:16,455 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:20:25,730 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:20:25,822 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:20:28,672 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:20:28,672 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:20:28,674 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:20:28,674 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:20:28,675 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:20:28,675 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:20:28,676 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:20:28,683 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:20:28,683 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 10:20:28,685 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:20:28,747 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:20:28,748 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:20:28,748 sqlalchemy.engine.Engine INFO [cached since 0.06488s ago] (2142024077,)
2025-01-19, Sun, 10:20:28,749 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:20:28,751 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:20:28,751 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:20:28,751 sqlalchemy.engine.Engine INFO [cached since 0.06845s ago] (2142024077,)
2025-01-19, Sun, 10:20:28,753 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:20:28,890 aiogram.event INFO Update id=450710367 is handled. Duration 645 ms by bot id=7771835226
2025-01-19, Sun, 10:20:30,650 aiogram.event INFO Update id=450710368 is handled. Duration 169 ms by bot id=7771835226
2025-01-19, Sun, 10:20:34,659 aiogram.event INFO Update id=450710369 is handled. Duration 184 ms by bot id=7771835226
2025-01-19, Sun, 10:20:38,475 aiogram.event INFO Update id=450710370 is handled. Duration 214 ms by bot id=7771835226
2025-01-19, Sun, 10:20:40,313 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:20:40,316 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-19, Sun, 10:20:40,316 sqlalchemy.engine.Engine INFO [generated in 0.00033s] ('Старт', 35000, 0, '2142024077_Старт', 2142024077, '19.01.2026')
2025-01-19, Sun, 10:20:40,319 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 10:20:40,588 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:20:40,588 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:20:40,588 sqlalchemy.engine.Engine INFO [cached since 11.91s ago] (2142024077,)
2025-01-19, Sun, 10:20:40,590 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:20:40,925 aiogram.event INFO Update id=450710371 is handled. Duration 613 ms by bot id=7771835226
2025-01-19, Sun, 10:21:58,10 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:21:58,11 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:21:58,11 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:22:03,434 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:22:03,767 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:22:10,229 aiogram.event INFO Update id=450710372 is handled. Duration 921 ms by bot id=7771835226
2025-01-19, Sun, 10:22:22,772 aiogram.event INFO Update id=450710373 is handled. Duration 61 ms by bot id=7771835226
2025-01-19, Sun, 10:22:27,420 aiogram.event INFO Update id=450710374 is handled. Duration 312 ms by bot id=7771835226
2025-01-19, Sun, 10:22:40,728 aiogram.event INFO Update id=450710375 is not handled. Duration 405 ms by bot id=7771835226
2025-01-19, Sun, 10:22:40,728 aiogram.event ERROR Cause exception while process update id=450710375 by bot id=7771835226
ValueError: time data '20ю12ю25' does not match format '%d.%m.%Y'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    if datetime.strptime(var, '%d.%m.%Y').date() < datetime.now().date():
  File "/usr/lib/python3.10/_strptime.py", line 568, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
  File "/usr/lib/python3.10/_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '20ю12ю25' does not match format '%d.%m.%Y'
2025-01-19, Sun, 10:22:57,763 aiogram.event INFO Update id=450710376 is not handled. Duration 410 ms by bot id=7771835226
2025-01-19, Sun, 10:22:57,763 aiogram.event ERROR Cause exception while process update id=450710376 by bot id=7771835226
ValueError: time data '11.12.24' does not match format '%d.%m.%Y'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 75, in new_promo
    if datetime.strptime(var, '%d.%m.%Y').date() < datetime.now().date():
  File "/usr/lib/python3.10/_strptime.py", line 568, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
  File "/usr/lib/python3.10/_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '11.12.24' does not match format '%d.%m.%Y'
2025-01-19, Sun, 10:23:09,824 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:23:09,824 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:23:09,825 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:23:09,826 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:23:09,826 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:23:09,827 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:23:09,827 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:23:09,829 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-19, Sun, 10:23:09,829 sqlalchemy.engine.Engine INFO [generated in 0.00015s] ('Крутой', 50000, 0, '2142024077_Крутой', 2142024077, '11.12.2024')
2025-01-19, Sun, 10:23:09,831 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 10:23:10,223 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:23:10,225 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:23:10,225 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077,)
2025-01-19, Sun, 10:23:10,227 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:23:10,626 aiogram.event INFO Update id=450710377 is handled. Duration 1119 ms by bot id=7771835226
2025-01-19, Sun, 10:24:06,504 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:24:06,504 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:24:06,504 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:24:47,494 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:24:47,826 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:24:54,288 aiogram.event INFO Update id=450710378 is handled. Duration 713 ms by bot id=7771835226
2025-01-19, Sun, 10:25:02,679 aiogram.event INFO Update id=450710379 is handled. Duration 114 ms by bot id=7771835226
2025-01-19, Sun, 10:25:12,351 aiogram.event INFO Update id=450710380 is handled. Duration 63 ms by bot id=7771835226
2025-01-19, Sun, 10:25:20,971 aiogram.event INFO Update id=450710381 is handled. Duration 392 ms by bot id=7771835226
2025-01-19, Sun, 10:26:13,491 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:26:13,491 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:26:13,492 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:26:13,492 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:26:13,493 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:26:13,493 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:26:13,494 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:26:13,495 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-19, Sun, 10:26:13,496 sqlalchemy.engine.Engine INFO [generated in 0.00017s] ('Блеск', 44000, 0, '2142024077_Блеск', 2142024077, '11.03.2025')
2025-01-19, Sun, 10:26:13,498 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 10:26:13,789 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:26:13,792 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:26:13,792 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-19, Sun, 10:26:13,794 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:26:13,875 aiogram.event INFO Update id=450710382 is handled. Duration 418 ms by bot id=7771835226
2025-01-19, Sun, 10:30:28,790 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:30:28,790 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:30:28,791 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:30:32,907 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:30:32,955 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:34:08,39 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:34:08,40 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:34:08,40 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:34:12,667 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:34:12,952 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:36:09,185 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:36:09,185 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:36:09,185 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:36:13,252 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:36:13,299 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:38:25,426 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 10:38:25,427 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:38:25,429 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 10:38:25,429 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:38:25,430 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 10:38:25,430 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 10:38:25,431 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 10:38:25,438 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 10:38:25,438 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (7675368439,)
2025-01-19, Sun, 10:38:25,441 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 10:38:25,819 aiogram.event INFO Update id=450710383 is handled. Duration 1543 ms by bot id=7771835226
2025-01-19, Sun, 10:44:37,289 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:44:37,289 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:44:37,290 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:44:41,461 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:44:41,507 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:46:39,184 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:46:39,184 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:46:39,184 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:46:43,575 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:46:43,806 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:47:41,859 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:47:41,860 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:47:41,860 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:47:45,915 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:47:45,985 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:50:10,649 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:50:10,650 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:50:10,650 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:50:14,580 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:50:14,765 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:52:29,94 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:52:29,95 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:52:29,95 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:52:33,20 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:52:33,67 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:58:23,35 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 10:58:23,36 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 10:58:23,36 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 10:58:28,653 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 10:58:28,701 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:03:03,772 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:03:03,773 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:03:03,773 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:03:07,963 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:03:08,260 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:04:05,195 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:04:05,196 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:04:05,196 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:04:09,795 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:04:09,882 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:07:08,183 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:07:08,183 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:07:08,183 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:07:48,836 asyncio ERROR Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7bb8b371e380>
2025-01-19, Sun, 11:07:53,334 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:07:53,722 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:09:12,956 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:09:12,957 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:09:12,957 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:09:17,236 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:09:17,282 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:09:23,948 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 11:09:23,948 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:09:23,950 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 11:09:23,951 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:09:23,952 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 11:09:23,952 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:09:23,952 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:09:23,960 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:09:23,960 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (7675368439,)
2025-01-19, Sun, 11:09:23,962 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:09:24,97 aiogram.event INFO Update id=450710384 is handled. Duration 474 ms by bot id=7771835226
2025-01-19, Sun, 11:09:36,536 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:09:36,540 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 11:09:36,540 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-19, Sun, 11:09:36,543 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:09:36,745 aiogram.event INFO Update id=450710385 is handled. Duration 210 ms by bot id=7771835226
2025-01-19, Sun, 11:09:40,316 aiogram.event INFO Update id=450710386 is handled. Duration 148 ms by bot id=7771835226
2025-01-19, Sun, 11:09:47,879 aiogram.event INFO Update id=450710387 is handled. Duration 74 ms by bot id=7771835226
2025-01-19, Sun, 11:09:57,250 aiogram.event INFO Update id=450710388 is handled. Duration 78 ms by bot id=7771835226
2025-01-19, Sun, 11:09:59,19 aiogram.event INFO Update id=450710389 is handled. Duration 0 ms by bot id=7771835226
2025-01-19, Sun, 11:13:23,846 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:13:23,847 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:13:23,847 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:13:27,942 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:13:28,22 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:13:32,452 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 11:13:32,452 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:13:32,454 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 11:13:32,454 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:13:32,455 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 11:13:32,455 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:13:32,456 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:13:32,464 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:13:32,465 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 11:13:32,467 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:13:32,831 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:13:32,832 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:13:32,832 sqlalchemy.engine.Engine INFO [cached since 0.3677s ago] (2142024077,)
2025-01-19, Sun, 11:13:32,833 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:13:32,834 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:13:32,835 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:13:32,835 sqlalchemy.engine.Engine INFO [cached since 0.3705s ago] (2142024077,)
2025-01-19, Sun, 11:13:32,836 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:13:33,42 aiogram.event INFO Update id=450710390 is handled. Duration 1319 ms by bot id=7771835226
2025-01-19, Sun, 11:13:36,731 aiogram.event INFO Update id=450710391 is handled. Duration 419 ms by bot id=7771835226
2025-01-19, Sun, 11:13:40,731 aiogram.event INFO Update id=450710392 is handled. Duration 221 ms by bot id=7771835226
2025-01-19, Sun, 11:13:46,922 aiogram.event INFO Update id=450710393 is handled. Duration 274 ms by bot id=7771835226
2025-01-19, Sun, 11:13:48,594 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:13:48,596 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-19, Sun, 11:13:48,597 sqlalchemy.engine.Engine INFO [generated in 0.00037s] ('English', 59900, 0, '2142024077_English', 2142024077, '19.01.2026')
2025-01-19, Sun, 11:13:48,599 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 11:13:48,906 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:13:48,906 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:13:48,906 sqlalchemy.engine.Engine INFO [cached since 16.44s ago] (2142024077,)
2025-01-19, Sun, 11:13:48,908 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:13:49,36 aiogram.event INFO Update id=450710394 is handled. Duration 443 ms by bot id=7771835226
2025-01-19, Sun, 11:14:08,611 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:14:08,611 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:14:08,611 sqlalchemy.engine.Engine INFO [cached since 36.15s ago] (7675368439,)
2025-01-19, Sun, 11:14:08,613 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:14:08,615 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:14:08,619 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 11:14:08,620 sqlalchemy.engine.Engine INFO [generated in 0.00050s] ('2142024077_English',)
2025-01-19, Sun, 11:14:08,623 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:14:08,972 aiogram.event INFO Update id=450710395 is handled. Duration 715 ms by bot id=7771835226
2025-01-19, Sun, 11:14:33,238 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, English, False
2025-01-19, Sun, 11:14:33,238 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 11:14:33,239 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:14:33,240 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 11:14:33,240 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)
2025-01-19, Sun, 11:14:33,242 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 11:14:33,244 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-19, Sun, 11:14:33,619 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:14:33,619 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:14:33,619 sqlalchemy.engine.Engine INFO [cached since 61.16s ago] (7675368439,)
2025-01-19, Sun, 11:14:33,621 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:14:33,622 aiogram.event INFO Update id=450710396 is handled. Duration 384 ms by bot id=7771835226
2025-01-19, Sun, 11:18:27,726 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:18:27,727 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:18:27,727 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:19:23,675 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:19:23,806 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:19:41,401 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 11:19:41,402 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:19:41,403 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 11:19:41,404 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:19:41,404 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 11:19:41,404 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:19:41,405 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:19:41,412 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:19:41,412 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (7675368439,)
2025-01-19, Sun, 11:19:41,415 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:19:41,417 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:19:41,422 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 11:19:41,422 sqlalchemy.engine.Engine INFO [generated in 0.00039s] ('2142024077_English',)
2025-01-19, Sun, 11:19:41,425 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:19:41,899 aiogram.event INFO Update id=450710397 is handled. Duration 1645 ms by bot id=7771835226
2025-01-19, Sun, 11:19:46,301 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, English, False
2025-01-19, Sun, 11:19:46,302 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 11:19:46,302 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:19:46,305 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 11:19:46,305 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)
2025-01-19, Sun, 11:19:46,307 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 11:19:46,309 root INFO Company: unnamed_company. Function db.session.wrapper is done successfully! (Attempt number 1)
2025-01-19, Sun, 11:19:46,498 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:19:46,499 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:19:46,499 sqlalchemy.engine.Engine INFO [cached since 5.087s ago] (7675368439,)
2025-01-19, Sun, 11:19:46,501 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:19:46,502 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, English, False
2025-01-19, Sun, 11:19:46,502 root INFO Company: unnamed_company. Run function db.session.wrapper
2025-01-19, Sun, 11:19:46,502 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:19:46,503 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 11:19:46,503 sqlalchemy.engine.Engine INFO [cached since 0.1984s ago] (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)
2025-01-19, Sun, 11:19:46,505 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:19:46,511 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 1)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-19, Sun, 11:20:46,516 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:20:46,516 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 11:20:46,516 sqlalchemy.engine.Engine INFO [cached since 60.21s ago] (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)
2025-01-19, Sun, 11:20:46,517 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:20:46,519 root ERROR Company: unnamed_company. In function db.session.wrapper error occurs: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj). Try through 1 minutes. (Attempt number 2)
 Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/errh.py", line 24, in handle_errors
    result = await task
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'English', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2025-01-19, Sun, 11:21:46,779 aiogram.event INFO Update id=450710398 is handled. Duration 120478 ms by bot id=7771835226
2025-01-19, Sun, 11:22:19,804 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:22:19,804 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:22:19,804 sqlalchemy.engine.Engine INFO [cached since 158.4s ago] (7675368439,)
2025-01-19, Sun, 11:22:19,806 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:22:19,890 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:22:19,890 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:22:19,891 sqlalchemy.engine.Engine INFO [cached since 158.5s ago] (7675368439,)
2025-01-19, Sun, 11:22:19,892 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:22:19,893 aiogram.event INFO Update id=450710399 is handled. Duration 409 ms by bot id=7771835226
2025-01-19, Sun, 11:23:49,650 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:23:49,651 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:23:49,651 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:46:41,616 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:46:41,912 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:46:51,850 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 11:46:51,851 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:46:51,852 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 11:46:51,852 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:46:51,853 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 11:46:51,853 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:46:51,853 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:46:51,860 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:46:51,861 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 11:46:51,863 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:46:51,968 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:46:51,968 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:46:51,968 sqlalchemy.engine.Engine INFO [cached since 0.1078s ago] (2142024077,)
2025-01-19, Sun, 11:46:51,969 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:46:51,970 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:46:51,971 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:46:51,971 sqlalchemy.engine.Engine INFO [cached since 0.1102s ago] (2142024077,)
2025-01-19, Sun, 11:46:51,971 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:46:52,64 aiogram.event INFO Update id=450710400 is handled. Duration 694 ms by bot id=7771835226
2025-01-19, Sun, 11:46:54,581 aiogram.event INFO Update id=450710401 is handled. Duration 258 ms by bot id=7771835226
2025-01-19, Sun, 11:46:59,134 aiogram.event INFO Update id=450710402 is handled. Duration 920 ms by bot id=7771835226
2025-01-19, Sun, 11:47:10,942 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 11:47:10,943 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:47:10,943 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 11:47:40,205 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 11:47:40,499 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 11:47:44,412 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 11:47:44,412 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:47:44,414 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 11:47:44,414 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:47:44,414 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 11:47:44,414 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 11:47:44,415 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:47:44,422 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:47:44,422 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (2142024077,)
2025-01-19, Sun, 11:47:44,425 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:47:44,488 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:47:44,488 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:47:44,488 sqlalchemy.engine.Engine INFO [cached since 0.0663s ago] (2142024077,)
2025-01-19, Sun, 11:47:44,489 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:47:44,490 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:47:44,491 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:47:44,491 sqlalchemy.engine.Engine INFO [cached since 0.06886s ago] (2142024077,)
2025-01-19, Sun, 11:47:44,492 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:47:44,798 aiogram.event INFO Update id=450710403 is handled. Duration 1164 ms by bot id=7771835226
2025-01-19, Sun, 11:47:46,957 aiogram.event INFO Update id=450710404 is handled. Duration 79 ms by bot id=7771835226
2025-01-19, Sun, 11:47:51,450 aiogram.event INFO Update id=450710405 is handled. Duration 308 ms by bot id=7771835226
2025-01-19, Sun, 11:48:31,588 aiogram.event INFO Update id=450710406 is handled. Duration 312 ms by bot id=7771835226
2025-01-19, Sun, 11:48:38,443 aiogram.event INFO Update id=450710407 is handled. Duration 403 ms by bot id=7771835226
2025-01-19, Sun, 11:48:40,498 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:48:40,500 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-19, Sun, 11:48:40,500 sqlalchemy.engine.Engine INFO [generated in 0.00033s] ('wow_777', 77000, 0, '2142024077_wow_777', 2142024077, '19.01.2026')
2025-01-19, Sun, 11:48:40,503 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 11:48:40,900 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:48:40,901 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 11:48:40,901 sqlalchemy.engine.Engine INFO [cached since 56.48s ago] (2142024077,)
2025-01-19, Sun, 11:48:40,903 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:48:41,212 aiogram.event INFO Update id=450710408 is handled. Duration 715 ms by bot id=7771835226
2025-01-19, Sun, 11:48:47,556 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 11:48:47,559 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 11:48:47,559 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-19, Sun, 11:48:47,562 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 11:48:47,614 aiogram.event INFO Update id=450710409 is not handled. Duration 58 ms by bot id=7771835226
2025-01-19, Sun, 11:48:47,614 aiogram.event ERROR Cause exception while process update id=450710409 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:01:21,730 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:01:21,731 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:01:21,731 sqlalchemy.engine.Engine INFO [cached since 754.2s ago] (2142024077,)
2025-01-19, Sun, 12:01:21,732 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:01:22,472 aiogram.event INFO Update id=450710410 is not handled. Duration 742 ms by bot id=7771835226
2025-01-19, Sun, 12:01:22,472 aiogram.event ERROR Cause exception while process update id=450710410 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:03:13,228 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:03:13,229 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:03:13,229 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:03:16,929 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:03:16,976 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:03:19,661 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:03:19,661 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:03:19,664 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:03:19,664 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:03:19,666 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:03:19,666 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:03:19,667 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:03:19,676 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:03:19,676 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077,)
2025-01-19, Sun, 12:03:19,679 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:03:20,76 aiogram.event INFO Update id=450710411 is not handled. Duration 447 ms by bot id=7771835226
2025-01-19, Sun, 12:03:20,76 aiogram.event ERROR Cause exception while process update id=450710411 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:03:43,441 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:03:43,441 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:03:43,441 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:03:47,111 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:03:47,500 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:03:48,842 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:03:48,842 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:03:48,843 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:03:48,843 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:03:48,844 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:03:48,844 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:03:48,845 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:03:48,855 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:03:48,855 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-19, Sun, 12:03:48,858 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:03:49,567 aiogram.event INFO Update id=450710412 is not handled. Duration 751 ms by bot id=7771835226
2025-01-19, Sun, 12:03:49,567 aiogram.event ERROR Cause exception while process update id=450710412 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:05:40,233 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:05:40,233 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:05:40,234 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:05:44,173 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:05:44,462 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:05:46,675 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:05:46,676 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:05:46,678 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:05:46,678 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:05:46,679 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:05:46,679 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:05:46,679 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:05:46,687 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:05:46,687 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-19, Sun, 12:05:46,689 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:05:49,420 aiogram.event INFO Update id=450710413 is not handled. Duration 2772 ms by bot id=7771835226
2025-01-19, Sun, 12:05:49,421 aiogram.event ERROR Cause exception while process update id=450710413 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await bot.send_message(call.from_user.id, f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 2966, in send_message
    return await self(call, request_timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:08:34,230 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:08:34,231 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:08:34,231 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:08:37,784 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:08:37,831 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:08:40,985 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:08:40,985 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:08:40,987 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:08:40,987 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:08:40,987 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:08:40,988 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:08:40,988 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:08:40,996 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:08:40,996 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (2142024077,)
2025-01-19, Sun, 12:08:40,998 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:08:41,152 aiogram.event INFO Update id=450710414 is not handled. Duration 194 ms by bot id=7771835226
2025-01-19, Sun, 12:08:41,152 aiogram.event ERROR Cause exception while process update id=450710414 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await call.message.edit_text(text=f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:09:03,287 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:09:03,288 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:09:03,288 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:09:06,825 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:09:06,953 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:09:07,826 aiogram.event INFO Update id=450710415 is handled. Duration 453 ms by bot id=7771835226
2025-01-19, Sun, 12:09:16,668 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:09:16,669 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:09:16,669 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:09:20,599 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:09:20,646 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:09:25,32 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:09:25,33 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:09:25,34 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:09:25,34 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:09:25,35 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:09:25,35 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:09:25,35 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:09:25,43 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:09:25,43 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 12:09:25,45 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:09:25,174 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:09:25,174 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:09:25,174 sqlalchemy.engine.Engine INFO [cached since 0.1317s ago] (2142024077,)
2025-01-19, Sun, 12:09:25,175 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:09:25,176 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:09:25,177 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:09:25,177 sqlalchemy.engine.Engine INFO [cached since 0.1341s ago] (2142024077,)
2025-01-19, Sun, 12:09:25,177 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:09:25,277 aiogram.event INFO Update id=450710416 is handled. Duration 428 ms by bot id=7771835226
2025-01-19, Sun, 12:09:26,604 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:09:26,608 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:09:26,608 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077,)
2025-01-19, Sun, 12:09:26,611 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:09:26,733 aiogram.event INFO Update id=450710417 is not handled. Duration 131 ms by bot id=7771835226
2025-01-19, Sun, 12:09:26,734 aiogram.event ERROR Cause exception while process update id=450710417 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:09:58,846 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:09:58,847 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:09:58,847 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:10:25,702 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:10:25,748 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:10:27,775 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:10:27,775 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:10:27,776 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:10:27,776 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:10:27,777 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:10:27,778 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:10:27,779 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:10:27,787 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:10:27,787 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 12:10:27,789 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:10:28,37 aiogram.event INFO Update id=450710418 is not handled. Duration 289 ms by bot id=7771835226
2025-01-19, Sun, 12:10:28,38 aiogram.event ERROR Cause exception while process update id=450710418 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1350
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {dictionry}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1350
2025-01-19, Sun, 12:10:37,583 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:10:37,583 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:10:37,583 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:14:11,822 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:14:11,874 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:14:14,482 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:14:14,482 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:14:14,484 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:14:14,484 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:14:14,485 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:14:14,485 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:14:14,486 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:14:14,493 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:14:14,493 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (2142024077,)
2025-01-19, Sun, 12:14:14,496 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:14:14,773 aiogram.event INFO Update id=450710419 is not handled. Duration 318 ms by bot id=7771835226
2025-01-19, Sun, 12:14:14,774 aiogram.event ERROR Cause exception while process update id=450710419 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await bot.send_message(call.from_user.id, f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 2966, in send_message
    return await self(call, request_timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:18:53,166 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:18:53,167 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:18:53,167 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:18:57,264 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:18:57,318 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:18:59,388 aiogram.event INFO Update id=450710420 is handled. Duration 312 ms by bot id=7771835226
2025-01-19, Sun, 12:19:29,460 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:19:29,460 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:19:29,460 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:19:33,147 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:19:33,535 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:19:34,499 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:19:34,499 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:19:34,500 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:19:34,500 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:19:34,501 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:19:34,501 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:19:34,502 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:19:34,509 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:19:34,509 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 12:19:34,512 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:19:34,981 aiogram.event INFO Update id=450710421 is not handled. Duration 509 ms by bot id=7771835226
2025-01-19, Sun, 12:19:34,982 aiogram.event ERROR Cause exception while process update id=450710421 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 47, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n txt", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-01-19, Sun, 12:19:43,615 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:19:43,616 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:19:43,617 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077,)
2025-01-19, Sun, 12:19:43,618 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:19:43,861 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:19:43,862 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:19:43,862 sqlalchemy.engine.Engine INFO [cached since 0.2459s ago] (2142024077,)
2025-01-19, Sun, 12:19:43,863 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:19:43,864 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:19:43,864 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:19:43,865 sqlalchemy.engine.Engine INFO [cached since 0.2483s ago] (2142024077,)
2025-01-19, Sun, 12:19:43,866 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:19:44,187 aiogram.event INFO Update id=450710422 is handled. Duration 715 ms by bot id=7771835226
2025-01-19, Sun, 12:19:45,719 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:19:45,719 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:19:45,720 sqlalchemy.engine.Engine INFO [cached since 11.21s ago] (2142024077,)
2025-01-19, Sun, 12:19:45,721 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:19:45,925 aiogram.event INFO Update id=450710423 is handled. Duration 207 ms by bot id=7771835226
2025-01-19, Sun, 12:20:50,887 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:20:50,887 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:20:50,888 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:20:54,544 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:20:55,146 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:21:01,604 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:21:01,604 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:21:01,606 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:21:01,606 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:21:01,607 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:21:01,607 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:21:01,608 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:21:01,615 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:21:01,615 sqlalchemy.engine.Engine INFO [generated in 0.00026s] (2142024077,)
2025-01-19, Sun, 12:21:01,617 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:21:02,4 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:21:02,4 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:21:02,4 sqlalchemy.engine.Engine INFO [cached since 0.3895s ago] (2142024077,)
2025-01-19, Sun, 12:21:02,6 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:21:02,7 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:21:02,7 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:21:02,7 sqlalchemy.engine.Engine INFO [cached since 0.3921s ago] (2142024077,)
2025-01-19, Sun, 12:21:02,8 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:21:02,237 aiogram.event INFO Update id=450710424 is handled. Duration 1039 ms by bot id=7771835226
2025-01-19, Sun, 12:21:04,53 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:21:04,58 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:21:04,58 sqlalchemy.engine.Engine INFO [generated in 0.00030s] (2142024077,)
2025-01-19, Sun, 12:21:04,60 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:21:04,235 aiogram.event INFO Update id=450710425 is handled. Duration 183 ms by bot id=7771835226
2025-01-19, Sun, 12:23:15,485 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:23:15,486 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:23:15,486 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:23:19,981 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:23:20,370 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:23:21,643 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:23:21,643 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:23:21,644 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:23:21,644 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:23:21,645 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:23:21,645 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:23:21,646 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:23:21,654 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:23:21,654 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-19, Sun, 12:23:21,657 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:23:22,52 aiogram.event INFO Update id=450710426 is not handled. Duration 434 ms by bot id=7771835226
2025-01-19, Sun, 12:23:22,52 aiogram.event ERROR Cause exception while process update id=450710426 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 48, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:27:56,434 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:27:56,435 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:27:56,435 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:28:00,723 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:28:00,830 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:28:03,627 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:28:03,627 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:28:03,629 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:28:03,629 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:28:03,630 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:28:03,630 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:28:03,631 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:28:03,639 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:28:03,639 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 12:28:03,642 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:28:03,642 aiogram.event INFO Update id=450710427 is not handled. Duration 41 ms by bot id=7771835226
2025-01-19, Sun, 12:28:03,643 aiogram.event ERROR Cause exception while process update id=450710427 by bot id=7771835226
KeyError: 'user'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in callback_marketer
    dictionry = [f"Промокод: {i['promocode']}\nЦена: {i['price']}\nДата окончания: {i['expire_date']}\nПереходы: {i['quantity']}\nВаш ник: {i['user']['username']}\nCсылка: `https://t.me/{bot_link}?start={i['referal']}`\n[Изменить промокод /edit_promo_{i.id}]\n\n" for i in pr_dict]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in <listcomp>
    dictionry = [f"Промокод: {i['promocode']}\nЦена: {i['price']}\nДата окончания: {i['expire_date']}\nПереходы: {i['quantity']}\nВаш ник: {i['user']['username']}\nCсылка: `https://t.me/{bot_link}?start={i['referal']}`\n[Изменить промокод /edit_promo_{i.id}]\n\n" for i in pr_dict]
KeyError: 'user'
2025-01-19, Sun, 12:28:43,582 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:28:43,582 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:28:43,582 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:28:48,32 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:28:48,422 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:28:49,493 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:28:49,493 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:28:49,494 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:28:49,494 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:28:49,495 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:28:49,495 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:28:49,496 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:28:49,504 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:28:49,504 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-19, Sun, 12:28:49,506 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:28:49,507 aiogram.event INFO Update id=450710428 is not handled. Duration 39 ms by bot id=7771835226
2025-01-19, Sun, 12:28:49,507 aiogram.event ERROR Cause exception while process update id=450710428 by bot id=7771835226
KeyError: 'user'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in callback_marketer
    dictionry = [f"Промокод: {i['promocode']}\nЦена: {i['price']}\nДата окончания: {i['expire_date']}\nПереходы: {i['quantity']}\nВаш ник: {i['user'].username}\nCсылка: `https://t.me/{bot_link}?start={i['referal']}`\n[Изменить промокод /edit_promo_{i.id}]\n\n" for i in pr_dict]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in <listcomp>
    dictionry = [f"Промокод: {i['promocode']}\nЦена: {i['price']}\nДата окончания: {i['expire_date']}\nПереходы: {i['quantity']}\nВаш ник: {i['user'].username}\nCсылка: `https://t.me/{bot_link}?start={i['referal']}`\n[Изменить промокод /edit_promo_{i.id}]\n\n" for i in pr_dict]
KeyError: 'user'
2025-01-19, Sun, 12:29:06,381 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:29:06,382 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:29:06,382 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:29:10,765 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:29:11,154 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:29:11,247 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:29:11,247 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:29:11,249 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:29:11,249 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:29:11,250 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:29:11,250 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:29:11,251 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:29:11,258 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:29:11,258 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 12:29:11,261 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:29:11,261 aiogram.event INFO Update id=450710429 is not handled. Duration 40 ms by bot id=7771835226
2025-01-19, Sun, 12:29:11,261 aiogram.event ERROR Cause exception while process update id=450710429 by bot id=7771835226
AttributeError: 'dict' object has no attribute 'id'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in callback_marketer
    dictionry = [f"Промокод: {i['promocode']}\nЦена: {i['price']}\nДата окончания: {i['expire_date']}\nПереходы: {i['quantity']}\nВаш ник: \nCсылка: `https://t.me/{bot_link}?start={i['referal']}`\n[Изменить промокод /edit_promo_{i.id}]\n\n" for i in pr_dict]
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 46, in <listcomp>
    dictionry = [f"Промокод: {i['promocode']}\nЦена: {i['price']}\nДата окончания: {i['expire_date']}\nПереходы: {i['quantity']}\nВаш ник: \nCсылка: `https://t.me/{bot_link}?start={i['referal']}`\n[Изменить промокод /edit_promo_{i.id}]\n\n" for i in pr_dict]
AttributeError: 'dict' object has no attribute 'id'
2025-01-19, Sun, 12:29:21,638 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:29:21,638 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:29:21,638 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:29:55,991 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:29:56,38 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:29:58,402 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:29:58,402 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:29:58,403 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:29:58,403 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:29:58,404 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:29:58,404 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:29:58,405 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:29:58,413 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:29:58,413 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 12:29:58,415 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:29:59,163 aiogram.event INFO Update id=450710430 is not handled. Duration 787 ms by bot id=7771835226
2025-01-19, Sun, 12:29:59,164 aiogram.event ERROR Cause exception while process update id=450710430 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1244
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 51, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1244
2025-01-19, Sun, 12:32:32,649 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:32:32,649 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:32:32,650 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:32:36,588 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:32:36,847 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:32:39,78 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:32:39,78 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:32:39,79 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:32:39,80 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:32:39,80 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:32:39,80 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:32:39,81 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:32:39,89 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:32:39,89 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 12:32:39,91 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:32:39,629 aiogram.event INFO Update id=450710431 is not handled. Duration 577 ms by bot id=7771835226
2025-01-19, Sun, 12:32:39,629 aiogram.event ERROR Cause exception while process update id=450710431 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 50, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:33:41,254 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:33:41,255 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:33:41,255 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:33:44,863 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:33:44,910 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:33:45,4 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:33:45,4 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:33:45,6 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:33:45,6 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:33:45,7 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:33:45,7 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:33:45,8 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:33:45,16 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:33:45,16 sqlalchemy.engine.Engine INFO [generated in 0.00022s] (2142024077,)
2025-01-19, Sun, 12:33:45,19 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:33:45,821 aiogram.event INFO Update id=450710432 is not handled. Duration 842 ms by bot id=7771835226
2025-01-19, Sun, 12:33:45,821 aiogram.event ERROR Cause exception while process update id=450710432 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 48, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", parse_mode='markdown', reply_markup=marketer_menu_kb())
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1294
2025-01-19, Sun, 12:34:05,207 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:34:05,208 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:34:05,208 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:34:09,59 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:34:09,319 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:34:11,109 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:34:11,109 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:34:11,111 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:34:11,111 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:34:11,111 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:34:11,111 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:34:11,112 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:34:11,120 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:34:11,120 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (2142024077,)
2025-01-19, Sun, 12:34:11,122 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:34:11,297 aiogram.event INFO Update id=450710433 is handled. Duration 214 ms by bot id=7771835226
2025-01-19, Sun, 12:45:03,158 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:45:03,159 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:45:03,159 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:45:07,829 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:45:08,144 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:45:10,730 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:45:10,730 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:45:10,732 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:45:10,732 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:45:10,733 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:45:10,733 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:45:10,734 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:45:10,741 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:45:10,741 sqlalchemy.engine.Engine INFO [generated in 0.00024s] (2142024077,)
2025-01-19, Sun, 12:45:10,743 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:45:10,879 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:45:10,879 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:45:10,879 sqlalchemy.engine.Engine INFO [cached since 0.1381s ago] (2142024077,)
2025-01-19, Sun, 12:45:10,880 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:45:10,881 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:45:10,881 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:45:10,881 sqlalchemy.engine.Engine INFO [cached since 0.1402s ago] (2142024077,)
2025-01-19, Sun, 12:45:10,882 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:45:11,213 aiogram.event INFO Update id=450710434 is handled. Duration 1208 ms by bot id=7771835226
2025-01-19, Sun, 12:45:12,854 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:45:12,858 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:45:12,859 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-19, Sun, 12:45:12,861 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:45:13,82 aiogram.event INFO Update id=450710435 is handled. Duration 229 ms by bot id=7771835226
2025-01-19, Sun, 12:46:15,46 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:46:15,47 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:46:15,47 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:46:20,23 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:46:20,71 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:46:22,15 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:46:22,15 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:46:22,17 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:46:22,17 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:46:22,18 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:46:22,18 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:46:22,18 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:46:22,27 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:46:22,27 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (2142024077,)
2025-01-19, Sun, 12:46:22,29 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:46:22,860 aiogram.event INFO Update id=450710436 is not handled. Duration 870 ms by bot id=7771835226
2025-01-19, Sun, 12:46:22,860 aiogram.event ERROR Cause exception while process update id=450710436 by bot id=7771835226
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "input" at byte offset 176
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/marketer.py", line 48, in callback_marketer
    await call.message.edit_text(f"Ваши промокоды: \n\n {txt}", reply_markup=marketer_menu_kb(), parse_mode='html')
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/bot.py", line 498, in __call__
    return await self.session(self, method, timeout=request_timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Unsupported start tag "input" at byte offset 176
2025-01-19, Sun, 12:49:01,578 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:49:01,578 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:49:01,578 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:49:04,926 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:49:04,973 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:49:06,602 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:49:06,602 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:49:06,604 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:49:06,604 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:49:06,605 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:49:06,605 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:49:06,606 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:49:06,614 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:49:06,614 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (2142024077,)
2025-01-19, Sun, 12:49:06,616 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:49:06,785 aiogram.event INFO Update id=450710437 is handled. Duration 211 ms by bot id=7771835226
2025-01-19, Sun, 12:50:14,495 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:50:14,495 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:50:14,495 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:50:34,818 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:50:35,207 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:50:40,577 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:50:40,577 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:50:40,578 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:50:40,579 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:50:40,579 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:50:40,580 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:50:40,580 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:50:40,589 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:50:40,589 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (2142024077,)
2025-01-19, Sun, 12:50:40,591 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:50:40,653 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:50:40,654 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:50:40,654 sqlalchemy.engine.Engine INFO [cached since 0.06519s ago] (2142024077,)
2025-01-19, Sun, 12:50:40,655 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:50:40,656 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:50:40,656 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:50:40,656 sqlalchemy.engine.Engine INFO [cached since 0.06771s ago] (2142024077,)
2025-01-19, Sun, 12:50:40,658 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:50:40,726 aiogram.event INFO Update id=450710438 is handled. Duration 581 ms by bot id=7771835226
2025-01-19, Sun, 12:50:42,687 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:50:42,692 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-19, Sun, 12:50:42,692 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (2142024077,)
2025-01-19, Sun, 12:50:42,695 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:50:42,826 aiogram.event INFO Update id=450710439 is handled. Duration 140 ms by bot id=7771835226
2025-01-19, Sun, 12:51:24,451 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:51:24,451 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:51:24,451 sqlalchemy.engine.Engine INFO [cached since 43.86s ago] (7675368439,)
2025-01-19, Sun, 12:51:24,452 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:51:24,453 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:51:24,455 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 12:51:24,455 sqlalchemy.engine.Engine INFO [generated in 0.00036s] ('2142024077_wow_777',)
2025-01-19, Sun, 12:51:24,458 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:51:24,756 aiogram.event INFO Update id=450710440 is handled. Duration 369 ms by bot id=7771835226
2025-01-19, Sun, 12:51:29,854 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 12:51:29,855 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:51:29,858 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 12:51:29,858 sqlalchemy.engine.Engine INFO [generated in 0.00039s] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 12:51:29,860 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 12:51:30,56 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:51:30,56 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:51:30,57 sqlalchemy.engine.Engine INFO [cached since 49.47s ago] (7675368439,)
2025-01-19, Sun, 12:51:30,58 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:51:30,59 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 12:51:30,60 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:51:30,60 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 12:51:30,61 sqlalchemy.engine.Engine INFO [cached since 0.2028s ago] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 12:51:30,62 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:51:30,63 aiogram.event INFO Update id=450710441 is not handled. Duration 209 ms by bot id=7771835226
2025-01-19, Sun, 12:51:30,63 aiogram.event ERROR Cause exception while process update id=450710441 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 92, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 132, in write_registration
    await promo_continue(chat_id, usr[chat_id]['price'])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 144, in promo_continue
    await write_registration(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 123, in write_registration
    if await add_user(chat_id=chat_id, username=usr[chat_id]['username'], first_name=usr[chat_id]['first_name'], promocode=usr[chat_id]['promocode'], marketer=usr[chat_id]['marketer']):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-19, Sun, 12:54:30,33 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:54:30,34 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:54:30,34 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 12:54:47,830 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 12:54:48,95 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:54:55,644 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 12:54:55,644 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:54:55,647 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 12:54:55,647 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:54:55,648 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 12:54:55,649 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 12:54:55,650 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:54:55,657 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:54:55,658 sqlalchemy.engine.Engine INFO [generated in 0.00025s] (7675368439,)
2025-01-19, Sun, 12:54:55,659 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:54:55,660 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:54:55,665 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 12:54:55,665 sqlalchemy.engine.Engine INFO [generated in 0.00032s] ('2142024077_wow_777',)
2025-01-19, Sun, 12:54:55,668 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:54:56,27 aiogram.event INFO Update id=450710442 is handled. Duration 1004 ms by bot id=7771835226
2025-01-19, Sun, 12:55:00,842 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 12:55:00,842 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:55:00,845 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 12:55:00,845 sqlalchemy.engine.Engine INFO [generated in 0.00056s] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 12:55:00,847 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 12:55:00,990 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 12:55:00,990 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 12:55:00,990 sqlalchemy.engine.Engine INFO [cached since 5.333s ago] (7675368439,)
2025-01-19, Sun, 12:55:00,991 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 12:55:00,992 aiogram.event INFO Update id=450710443 is not handled. Duration 151 ms by bot id=7771835226
2025-01-19, Sun, 12:55:00,992 aiogram.event ERROR Cause exception while process update id=450710443 by bot id=7771835226
AttributeError: 'User' object has no attribute 'price'
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 92, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 132, in write_registration
    await promo_continue(chat_id, user_obj[chat_id].price)
AttributeError: 'User' object has no attribute 'price'
2025-01-19, Sun, 12:59:49,581 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 12:59:49,582 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 12:59:49,582 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 13:00:10,829 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 13:00:11,218 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:00:25,996 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 13:00:25,997 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:00:25,998 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 13:00:25,999 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:00:25,999 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 13:00:25,999 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:00:26,0 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:00:26,10 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:00:26,11 sqlalchemy.engine.Engine INFO [generated in 0.00044s] (7675368439,)
2025-01-19, Sun, 13:00:26,13 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:00:26,14 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:00:26,19 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 13:00:26,20 sqlalchemy.engine.Engine INFO [generated in 0.00056s] ('2142024077_wow_777',)
2025-01-19, Sun, 13:00:26,25 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:00:26,785 aiogram.event INFO Update id=450710444 is handled. Duration 1637 ms by bot id=7771835226
2025-01-19, Sun, 13:00:30,780 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:00:30,781 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:00:30,783 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:00:30,783 sqlalchemy.engine.Engine INFO [generated in 0.00032s] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:00:30,785 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 13:00:31,183 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:00:31,184 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:00:31,184 sqlalchemy.engine.Engine INFO [cached since 5.174s ago] (7675368439,)
2025-01-19, Sun, 13:00:31,185 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:00:31,186 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:00:31,186 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:00:31,187 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:00:31,187 sqlalchemy.engine.Engine INFO [cached since 0.4044s ago] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:00:31,189 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:00:31,190 aiogram.event INFO Update id=450710445 is not handled. Duration 411 ms by bot id=7771835226
2025-01-19, Sun, 13:00:31,190 aiogram.event ERROR Cause exception while process update id=450710445 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 92, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 132, in write_registration
    await promo_continue(chat_id, usr[chat_id]['price'])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 144, in promo_continue
    await write_registration(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 123, in write_registration
    if await add_user(chat_id=chat_id, username=usr[chat_id]['username'], first_name=usr[chat_id]['first_name'], promocode=usr[chat_id]['promocode'], marketer=usr[chat_id]['marketer']):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-19, Sun, 13:06:32,601 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 13:06:32,602 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:06:32,602 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 13:06:39,627 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 13:06:39,708 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:06:53,766 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 13:06:53,766 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:06:53,768 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 13:06:53,768 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:06:53,768 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 13:06:53,768 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:06:53,769 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:06:53,776 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:06:53,776 sqlalchemy.engine.Engine INFO [generated in 0.00023s] (7675368439,)
2025-01-19, Sun, 13:06:53,778 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:06:53,780 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:06:53,786 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 13:06:53,786 sqlalchemy.engine.Engine INFO [generated in 0.00026s] ('2142024077_wow_777',)
2025-01-19, Sun, 13:06:53,789 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:06:54,554 aiogram.event INFO Update id=450710446 is handled. Duration 1634 ms by bot id=7771835226
2025-01-19, Sun, 13:06:58,759 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:06:58,760 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:06:58,762 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:06:58,762 sqlalchemy.engine.Engine INFO [generated in 0.00038s] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:06:58,764 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 13:06:59,133 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:06:59,134 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:06:59,134 sqlalchemy.engine.Engine INFO [cached since 5.358s ago] (7675368439,)
2025-01-19, Sun, 13:06:59,135 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:06:59,135 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:06:59,136 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:06:59,136 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:06:59,136 sqlalchemy.engine.Engine INFO [cached since 0.3745s ago] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:06:59,137 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:06:59,138 aiogram.event INFO Update id=450710447 is not handled. Duration 379 ms by bot id=7771835226
2025-01-19, Sun, 13:06:59,138 aiogram.event ERROR Cause exception while process update id=450710447 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 92, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 132, in write_registration
    await promo_continue(chat_id, usr[chat_id]['price'])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 144, in promo_continue
    await write_registration(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 123, in write_registration
    if await add_user(chat_id=chat_id, username=usr[chat_id]['username'], first_name=usr[chat_id]['first_name'], promocode=usr[chat_id]['promocode'], marketer=usr[chat_id]['marketer']):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-19, Sun, 13:14:18,266 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 13:14:18,267 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:14:18,267 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 13:14:23,86 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 13:14:23,474 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:14:41,730 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 13:14:41,730 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:14:41,732 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 13:14:41,733 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:14:41,733 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 13:14:41,734 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:14:41,734 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:14:41,742 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:14:41,743 sqlalchemy.engine.Engine INFO [generated in 0.00027s] (7675368439,)
2025-01-19, Sun, 13:14:41,745 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:14:41,746 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:14:41,752 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 13:14:41,752 sqlalchemy.engine.Engine INFO [generated in 0.00036s] ('2142024077_wow_777',)
2025-01-19, Sun, 13:14:41,754 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:14:42,114 aiogram.event INFO Update id=450710448 is handled. Duration 824 ms by bot id=7771835226
2025-01-19, Sun, 13:14:46,518 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:14:46,519 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:14:46,521 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:14:46,522 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:14:46,523 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 13:14:46,594 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:14:46,594 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:14:46,594 sqlalchemy.engine.Engine INFO [cached since 4.852s ago] (7675368439,)
2025-01-19, Sun, 13:14:46,596 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:14:46,597 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:14:46,598 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:14:46,599 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:14:46,599 sqlalchemy.engine.Engine INFO [cached since 0.07762s ago] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:14:46,601 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:14:46,602 aiogram.event INFO Update id=450710449 is not handled. Duration 84 ms by bot id=7771835226
2025-01-19, Sun, 13:14:46,602 aiogram.event ERROR Cause exception while process update id=450710449 by bot id=7771835226
IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/asyncpg/prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
  File "asyncpg/protocol/protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 93, in get_answer_reg
    await write_registration(message.from_user.id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 132, in write_registration
    await promo_continue(chat_id, usr[chat_id]['price'])
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 144, in promo_continue
    await write_registration(chat_id)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/func/selling.py", line 123, in write_registration
    if await add_user(chat_id=chat_id, username=usr[chat_id]['username'], first_name=usr[chat_id]['first_name'], promocode=usr[chat_id]['promocode'], marketer=usr[chat_id]['marketer']):
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 31, in wrapper
    raise e  # Поднимаем исключение дальше
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/session.py", line 28, in wrapper
    return await method(*args, session=session, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/set.py", line 13, in add_user
    user = await UserDAO.add(user_data, **kwargs)
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 19, in add
    raise e
  File "/home/dm/dev/TGbots/AnswerMPbot/app/db/dao.py", line 16, in add
    await session.commit()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4353, in flush
    self._flush(objects)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4488, in _flush
    with util.safe_reraise():
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4449, in _flush
    flush_context.execute()
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/home/dm/dev/TGbots/AnswerMPbot/venv/lib/python3.10/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "users_chat_id_key"
DETAIL:  Key (chat_id)=(7675368439) already exists.
[SQL: INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id]
[parameters: (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-01-19, Sun, 13:15:52,433 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 13:15:52,434 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:15:52,434 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 13:16:20,945 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 13:16:21,131 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:16:40,724 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 13:16:40,724 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:16:40,725 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 13:16:40,725 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:16:40,726 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 13:16:40,726 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:16:40,726 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:16:40,734 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:16:40,734 sqlalchemy.engine.Engine INFO [generated in 0.00035s] (7675368439,)
2025-01-19, Sun, 13:16:40,737 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:16:40,738 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:16:40,742 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.referal = $1::VARCHAR
2025-01-19, Sun, 13:16:40,742 sqlalchemy.engine.Engine INFO [generated in 0.00023s] ('2142024077_wow_777',)
2025-01-19, Sun, 13:16:40,745 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:16:41,303 aiogram.event INFO Update id=450710450 is handled. Duration 1326 ms by bot id=7771835226
2025-01-19, Sun, 13:16:46,838 root INFO REGISTRATION DATA: Dm_dev_acc, Devid, wow_777, False
2025-01-19, Sun, 13:16:46,839 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:16:46,841 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:16:46,841 sqlalchemy.engine.Engine INFO [generated in 0.00029s] (7675368439, 'Dm_dev_acc', 'Devid', 'wow_777', False, 0)
2025-01-19, Sun, 13:16:46,843 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 13:16:47,142 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:16:47,142 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:16:47,142 sqlalchemy.engine.Engine INFO [cached since 6.408s ago] (7675368439,)
2025-01-19, Sun, 13:16:47,144 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:16:47,285 aiogram.event INFO Update id=450710451 is handled. Duration 447 ms by bot id=7771835226
2025-01-19, Sun, 13:19:00,895 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 13:19:00,895 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:19:00,896 aiogram.dispatcher INFO Polling stopped
2025-01-19, Sun, 13:19:05,207 aiogram.dispatcher INFO Start polling
2025-01-19, Sun, 13:19:05,253 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:19:17,292 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-19, Sun, 13:19:17,292 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:19:17,294 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-19, Sun, 13:19:17,294 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:19:17,294 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-19, Sun, 13:19:17,294 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-19, Sun, 13:19:17,295 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:19:17,304 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:19:17,304 sqlalchemy.engine.Engine INFO [generated in 0.00028s] (2142024077,)
2025-01-19, Sun, 13:19:17,306 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:19:17,644 aiogram.event INFO Update id=450710452 is handled. Duration 1505 ms by bot id=7771835226
2025-01-19, Sun, 13:19:23,407 aiogram.event INFO Update id=450710453 is handled. Duration 312 ms by bot id=7771835226
2025-01-19, Sun, 13:19:29,962 root INFO REGISTRATION DATA: DmPetrosel, Дмитрий, ямаркетолог, True
2025-01-19, Sun, 13:19:29,963 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:19:29,965 sqlalchemy.engine.Engine INFO INSERT INTO users (chat_id, username, first_name, promocode, marketer, balance) VALUES ($1::BIGINT, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BIGINT) RETURNING users.id
2025-01-19, Sun, 13:19:29,965 sqlalchemy.engine.Engine INFO [generated in 0.00033s] (2142024077, 'DmPetrosel', 'Дмитрий', 'ямаркетолог', True, 0)
2025-01-19, Sun, 13:19:29,969 sqlalchemy.engine.Engine INFO COMMIT
2025-01-19, Sun, 13:19:30,366 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:19:30,367 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:19:30,367 sqlalchemy.engine.Engine INFO [cached since 13.06s ago] (2142024077,)
2025-01-19, Sun, 13:19:30,369 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:19:30,370 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-19, Sun, 13:19:30,370 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-19, Sun, 13:19:30,370 sqlalchemy.engine.Engine INFO [cached since 13.07s ago] (2142024077,)
2025-01-19, Sun, 13:19:30,372 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-19, Sun, 13:19:30,678 aiogram.event INFO Update id=450710454 is handled. Duration 716 ms by bot id=7771835226
2025-01-19, Sun, 13:19:49,786 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-19, Sun, 13:19:49,786 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-19, Sun, 13:19:49,787 aiogram.dispatcher INFO Polling stopped
2025-01-20, Mon, 10:36:32,996 aiogram.dispatcher INFO Start polling
2025-01-20, Mon, 10:36:33,45 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-20, Mon, 10:36:49,285 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-20, Mon, 10:36:49,285 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-20, Mon, 10:36:49,288 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-20, Mon, 10:36:49,288 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-20, Mon, 10:36:49,289 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-20, Mon, 10:36:49,289 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-20, Mon, 10:36:49,290 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-20, Mon, 10:36:49,299 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-20, Mon, 10:36:49,300 sqlalchemy.engine.Engine INFO [generated in 0.00047s] (2142024077,)
2025-01-20, Mon, 10:36:49,302 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-20, Mon, 10:36:49,422 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-20, Mon, 10:36:49,423 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-20, Mon, 10:36:49,423 sqlalchemy.engine.Engine INFO [cached since 0.1237s ago] (2142024077,)
2025-01-20, Mon, 10:36:49,424 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-20, Mon, 10:36:49,425 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-20, Mon, 10:36:49,425 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-20, Mon, 10:36:49,425 sqlalchemy.engine.Engine INFO [cached since 0.1261s ago] (2142024077,)
2025-01-20, Mon, 10:36:49,427 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-20, Mon, 10:36:49,535 aiogram.event INFO Update id=450710455 is handled. Duration 505 ms by bot id=7771835226
2025-01-20, Mon, 10:36:51,902 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-20, Mon, 10:36:51,905 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-20, Mon, 10:36:51,905 sqlalchemy.engine.Engine INFO [generated in 0.00019s] (2142024077,)
2025-01-20, Mon, 10:36:51,907 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-20, Mon, 10:36:52,25 aiogram.event INFO Update id=450710456 is handled. Duration 124 ms by bot id=7771835226
2025-01-20, Mon, 10:36:55,592 aiogram.event INFO Update id=450710457 is handled. Duration 62 ms by bot id=7771835226
2025-01-20, Mon, 10:37:01,812 aiogram.event INFO Update id=450710458 is handled. Duration 95 ms by bot id=7771835226
2025-01-20, Mon, 10:37:11,924 aiogram.event INFO Update id=450710459 is handled. Duration 66 ms by bot id=7771835226
2025-01-20, Mon, 10:37:16,943 aiogram.event INFO Update id=450710460 is handled. Duration 69 ms by bot id=7771835226
2025-01-20, Mon, 10:37:19,4 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-20, Mon, 10:37:19,6 sqlalchemy.engine.Engine INFO INSERT INTO promos (promocode, price, quantity, referal, chat_id, expire_date) VALUES ($1::VARCHAR, $2::BIGINT, $3::INTEGER, $4::VARCHAR, $5::BIGINT, $6::VARCHAR) RETURNING promos.id
2025-01-20, Mon, 10:37:19,6 sqlalchemy.engine.Engine INFO [generated in 0.00020s] ('promo', 30000, 0, '2142024077_promo', 2142024077, '20.01.2026')
2025-01-20, Mon, 10:37:19,8 sqlalchemy.engine.Engine INFO COMMIT
2025-01-20, Mon, 10:37:19,81 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-20, Mon, 10:37:19,81 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-20, Mon, 10:37:19,81 sqlalchemy.engine.Engine INFO [cached since 29.78s ago] (2142024077,)
2025-01-20, Mon, 10:37:19,83 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-20, Mon, 10:37:19,174 aiogram.event INFO Update id=450710461 is handled. Duration 169 ms by bot id=7771835226
2025-01-20, Mon, 11:22:11,996 aiogram.dispatcher ERROR Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-01-20, Mon, 11:22:11,996 aiogram.dispatcher WARNING Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7771835226)
2025-01-20, Mon, 11:22:23,360 aiogram.dispatcher INFO Connection established (tryings = 1, bot id = 7771835226)
2025-01-24, Fri, 07:31:12,907 aiogram.dispatcher INFO Start polling
2025-01-24, Fri, 07:31:13,186 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'Автоответы на мп'
2025-01-24, Fri, 07:31:19,809 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-24, Fri, 07:31:19,809 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-24, Fri, 07:31:19,814 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-24, Fri, 07:31:19,814 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-24, Fri, 07:31:19,817 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-24, Fri, 07:31:19,817 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-24, Fri, 07:31:19,820 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-24, Fri, 07:31:19,837 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-24, Fri, 07:31:19,837 sqlalchemy.engine.Engine INFO [generated in 0.00042s] (2142024077,)
2025-01-24, Fri, 07:31:19,842 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-24, Fri, 07:31:20,188 aiogram.event INFO Update id=450710462 is handled. Duration 431 ms by bot id=7771835226
2025-01-24, Fri, 09:30:54,759 aiogram.dispatcher INFO Start polling
2025-01-24, Fri, 09:30:55,89 aiogram.dispatcher INFO Run polling for bot @autoanswersmpbot id=7771835226 - 'SSet АОтветы'
2025-01-24, Fri, 09:31:01,812 sqlalchemy.engine.Engine INFO select pg_catalog.version()
2025-01-24, Fri, 09:31:01,813 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-24, Fri, 09:31:01,819 sqlalchemy.engine.Engine INFO select current_schema()
2025-01-24, Fri, 09:31:01,819 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-24, Fri, 09:31:01,823 sqlalchemy.engine.Engine INFO show standard_conforming_strings
2025-01-24, Fri, 09:31:01,824 sqlalchemy.engine.Engine INFO [raw sql] ()
2025-01-24, Fri, 09:31:01,826 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-24, Fri, 09:31:01,843 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-24, Fri, 09:31:01,843 sqlalchemy.engine.Engine INFO [generated in 0.00046s] (2142024077,)
2025-01-24, Fri, 09:31:01,850 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-24, Fri, 09:31:02,154 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-24, Fri, 09:31:02,155 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-24, Fri, 09:31:02,155 sqlalchemy.engine.Engine INFO [cached since 0.3122s ago] (2142024077,)
2025-01-24, Fri, 09:31:02,158 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-24, Fri, 09:31:02,160 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-24, Fri, 09:31:02,160 sqlalchemy.engine.Engine INFO SELECT users.id, users.chat_id, users.username, users.first_name, users.promocode, users.marketer, users.balance 
FROM users 
WHERE users.chat_id = $1::BIGINT
2025-01-24, Fri, 09:31:02,161 sqlalchemy.engine.Engine INFO [cached since 0.3177s ago] (2142024077,)
2025-01-24, Fri, 09:31:02,163 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-24, Fri, 09:31:02,395 aiogram.event INFO Update id=450710463 is handled. Duration 1409 ms by bot id=7771835226
2025-01-24, Fri, 09:31:04,303 sqlalchemy.engine.Engine INFO BEGIN (implicit)
2025-01-24, Fri, 09:31:04,311 sqlalchemy.engine.Engine INFO SELECT promos.id, promos.promocode, promos.price, promos.quantity, promos.referal, promos.chat_id, promos.expire_date, users_1.id AS id_1, users_1.chat_id AS chat_id_1, users_1.username, users_1.first_name, users_1.promocode AS promocode_1, users_1.marketer, users_1.balance 
FROM promos LEFT OUTER JOIN users AS users_1 ON users_1.chat_id = promos.chat_id 
WHERE promos.chat_id = $1::BIGINT
2025-01-24, Fri, 09:31:04,312 sqlalchemy.engine.Engine INFO [generated in 0.00051s] (2142024077,)
2025-01-24, Fri, 09:31:04,319 sqlalchemy.engine.Engine INFO ROLLBACK
2025-01-24, Fri, 09:31:04,580 aiogram.event INFO Update id=450710464 is handled. Duration 278 ms by bot id=7771835226
2025-01-24, Fri, 09:31:13,680 aiogram.dispatcher WARNING Received SIGINT signal
2025-01-24, Fri, 09:31:13,681 aiogram.dispatcher INFO Polling stopped for bot @autoanswersmpbot id=7771835226 - 'SSet АОтветы'
2025-01-24, Fri, 09:31:13,681 aiogram.dispatcher INFO Polling stopped
